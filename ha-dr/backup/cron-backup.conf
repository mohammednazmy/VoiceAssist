# VoiceAssist Automated Backup Cron Configuration (Phase 12 - HA/DR)
# Install this file to /etc/cron.d/voiceassist-backup
#
# Usage:
#   sudo cp cron-backup.conf /etc/cron.d/voiceassist-backup
#   sudo chmod 0644 /etc/cron.d/voiceassist-backup
#
# Cron format: minute hour day month weekday command

# Environment variables for backup scripts
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
BACKUP_DIR=/var/backups/voiceassist
DB_HOST=localhost
DB_PORT=5432
DB_NAME=voiceassist
DB_USER=voiceassist
# POSTGRES_PASSWORD should be set in /etc/environment or passed via systemd
# BACKUP_ENCRYPTION_KEY should be set in /etc/environment or passed via systemd

# Daily backup at 2:00 AM (local time)
# Performs full database backup with encryption
0 2 * * * root /opt/voiceassist/ha-dr/backup/backup-database.sh >> /var/log/voiceassist-backup.log 2>&1

# Upload backup to off-site storage at 3:00 AM (after backup completes)
0 3 * * * root /opt/voiceassist/ha-dr/backup/upload-backup.sh >> /var/log/voiceassist-backup.log 2>&1

# Weekly backup verification on Sundays at 4:00 AM
# This performs a test restore to a separate database to verify backup integrity
0 4 * * 0 root /opt/voiceassist/ha-dr/backup/verify-backup.sh >> /var/log/voiceassist-backup.log 2>&1

# Cleanup old logs (keep last 90 days)
0 5 * * * root find /var/log/voiceassist-backup.log -mtime +90 -delete
