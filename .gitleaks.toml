# VoiceAssist V2 - Gitleaks Configuration
# Phase 9: Infrastructure as Code
#
# Gitleaks detects and prevents hardcoded secrets

title = "VoiceAssist V2 Gitleaks Configuration"

# Paths to exclude from scanning
[allowlist]
paths = [
    '''^\.git/''',
    '''^\.github/workflows/.*\.yml$''',
    '''(.*)?/node_modules/''',
    '''(.*)?/venv/''',
    '''(.*)?/\.venv/''',
    '''\.md$''',
    '''\.txt$''',
    '''\.example$''',
    '''\.sample$''',
    # Test files with example passwords
    '''tests/''',
    '''test_''',
    '''_test\.py$''',
    '''\.test\.(ts|tsx|js|jsx)$''',
    '''\.stories\.(ts|tsx|js|jsx)$''',
    '''conftest\.py$''',
    # Specific false positive files
    '''services/api-gateway/app/services/caldav_service\.py$''',
    '''services/api-gateway/app/services/nextcloud_file_indexer\.py$''',
    '''services/api-gateway/app/services/tools/oauth_service\.py$''',
]

# Stopwords to ignore
stopwords = [
    "test",
    "example",
    "sample",
    "dummy",
    "placeholder",
]

# AWS Access Key
[[rules]]
id = "aws-access-key"
description = "AWS Access Key ID"
regex = '''(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
tags = ["key", "AWS"]
severity = "critical"

# AWS Secret Key
[[rules]]
id = "aws-secret-key"
description = "AWS Secret Access Key"
regex = '''(?i)aws(.{0,20})?(?-i)['\"][0-9a-zA-Z\/+]{40}['\"]'''
tags = ["secret", "AWS"]
severity = "critical"

# Generic API Key
[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey|api[_-]?secret)['\":\s=]+['"]?[a-zA-Z0-9]{32,}['"]?'''
tags = ["key", "API"]
severity = "high"

# Private SSH Key
[[rules]]
id = "private-ssh-key"
description = "Private SSH Key"
regex = '''-----BEGIN (RSA|DSA|EC|OPENSSH) PRIVATE KEY-----'''
tags = ["key", "SSH"]
severity = "critical"

# GitHub Token
[[rules]]
id = "github-token"
description = "GitHub Personal Access Token"
regex = '''ghp_[0-9a-zA-Z]{36}'''
tags = ["key", "GitHub"]
severity = "critical"

# GitHub OAuth Token
[[rules]]
id = "github-oauth"
description = "GitHub OAuth Token"
regex = '''gho_[0-9a-zA-Z]{36}'''
tags = ["token", "GitHub"]
severity = "critical"

# Slack Token
[[rules]]
id = "slack-token"
description = "Slack Token"
regex = '''xox[baprs]-[0-9]{10,13}-[0-9]{10,13}-[a-zA-Z0-9]{24,32}'''
tags = ["token", "Slack"]
severity = "high"

# Stripe API Key
[[rules]]
id = "stripe-key"
description = "Stripe API Key"
regex = '''(?i)stripe(.{0,20})?['\"][sk|pk]_(test|live)_[0-9a-zA-Z]{24,}['\"]'''
tags = ["key", "Stripe"]
severity = "high"

# Google API Key
[[rules]]
id = "google-api-key"
description = "Google API Key"
regex = '''AIza[0-9A-Za-z\\-_]{35}'''
tags = ["key", "Google"]
severity = "high"

# JWT Token
[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}\.[A-Za-z0-9_-]{10,}'''
tags = ["token", "JWT"]
severity = "medium"
[rules.allowlist]
regexes = [
    '''example''',
    '''test''',
    '''dummy''',
]

# Database Connection String
[[rules]]
id = "database-url"
description = "Database Connection String"
regex = '''(?i)(postgres|mysql|mongodb|redis)://[^:]+:[^@]+@[^/]+/[^\s'"]+'''
tags = ["connection", "database"]
severity = "critical"

# Generic Password
[[rules]]
id = "generic-password"
description = "Generic Password"
regex = '''(?i)(password|passwd|pwd)['\":\s=]+['"]?[^\s'"]{8,}['"]?'''
tags = ["password"]
severity = "high"
[rules.allowlist]
regexes = [
    '''example''',
    '''test''',
    '''dummy''',
    '''placeholder''',
    '''your_password_here''',
]

# Docker Auth
[[rules]]
id = "docker-auth"
description = "Docker Auth Token"
regex = '''(?i)docker(.{0,20})?['"][a-zA-Z0-9]{40,}['"]'''
tags = ["token", "Docker"]
severity = "high"

# NPM Token
[[rules]]
id = "npm-token"
description = "NPM Token"
regex = '''npm_[a-zA-Z0-9]{36}'''
tags = ["token", "NPM"]
severity = "high"

# PyPI Token
[[rules]]
id = "pypi-token"
description = "PyPI API Token"
regex = '''pypi-AgEIcHlwaS5vcmc[A-Za-z0-9\\-_]{50,}'''
tags = ["token", "PyPI"]
severity = "high"
