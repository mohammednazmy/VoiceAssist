{
  "path": "docker-compose.yml",
  "language": "yaml",
  "size": 8419,
  "last_modified": "2025-12-05T03:07:13.123Z",
  "lines": 302,
  "content": "# Networks\nnetworks:\n  voiceassist-network:\n    driver: bridge\n\n  database-network:\n    driver: bridge\n    internal: true # Database network is internal-only\n\n# Volumes for data persistence\nvolumes:\n  postgres-data:\n    driver: local\n  redis-data:\n    driver: local\n  qdrant-data:\n    driver: local\n  nextcloud-data:\n    driver: local\n  nextcloud-db-data:\n    driver: local\n  keycloak-data:\n    driver: local\n\nservices:\n  # ===================================\n  # Phase 1: Core Infrastructure\n  # ===================================\n\n  # PostgreSQL - Main database with pgvector extension\n  postgres:\n    image: pgvector/pgvector:pg16\n    container_name: voiceassist-postgres\n    environment:\n      POSTGRES_USER: ${POSTGRES_USER}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n      POSTGRES_DB: ${POSTGRES_DB}\n      PGDATA: /var/lib/postgresql/data/pgdata\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n      - ./infrastructure/docker/init-scripts:/docker-entrypoint-initdb.d\n    ports:\n      - \"5432:5432\"\n    networks:\n      - database-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    restart: unless-stopped\n\n  # Redis - Cache and session storage\n  redis:\n    image: redis:7-alpine\n    container_name: voiceassist-redis\n    command: redis-server --requirepass ${REDIS_PASSWORD} --appendonly yes\n    volumes:\n      - redis-data:/data\n    ports:\n      - \"6379:6379\"\n    networks:\n      - database-network\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    restart: unless-stopped\n\n  # Qdrant - Vector database for semantic search\n  qdrant:\n    image: qdrant/qdrant:v1.7.4\n    container_name: voiceassist-qdrant\n    volumes:\n      - qdrant-data:/qdrant/storage\n    ports:\n      - \"6333:6333\"\n      - \"6334:6334\"\n    networks:\n      - database-network\n    environment:\n      QDRANT__SERVICE__GRPC_PORT: \"6334\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"timeout 2 bash -c '</dev/tcp/localhost/6333' || exit 1\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_period: 40s\n    restart: unless-stopped\n\n  # VoiceAssist API Gateway - FastAPI backend\n  voiceassist-server:\n    build:\n      context: ./services/api-gateway\n      dockerfile: Dockerfile\n    container_name: voiceassist-server\n    environment:\n      - POSTGRES_USER=${POSTGRES_USER}\n      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}\n      - POSTGRES_HOST=postgres\n      - POSTGRES_PORT=5432\n      - POSTGRES_DB=${POSTGRES_DB}\n      - REDIS_HOST=redis\n      - REDIS_PORT=6379\n      - REDIS_PASSWORD=${REDIS_PASSWORD}\n      - QDRANT_HOST=qdrant\n      - QDRANT_PORT=6333\n      - SECRET_KEY=${SECRET_KEY}\n      - JWT_SECRET=${JWT_SECRET}\n      - OPENAI_API_KEY=${OPENAI_API_KEY}\n      - ENVIRONMENT=${ENVIRONMENT}\n      - DEBUG=${DEBUG}\n      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-http://localhost:5173,http://frontend-gateway:8080}\n      - NEXTCLOUD_URL=${NEXTCLOUD_URL}\n      - NEXTCLOUD_ADMIN_USER=${NEXTCLOUD_ADMIN_USER}\n      - NEXTCLOUD_ADMIN_PASSWORD=${NEXTCLOUD_ADMIN_PASSWORD}\n      # OAuth Providers\n      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}\n      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}\n      - GOOGLE_OAUTH_REDIRECT_URI=${GOOGLE_OAUTH_REDIRECT_URI}\n      - MICROSOFT_CLIENT_ID=${MICROSOFT_CLIENT_ID}\n      - MICROSOFT_CLIENT_SECRET=${MICROSOFT_CLIENT_SECRET}\n      - MICROSOFT_OAUTH_REDIRECT_URI=${MICROSOFT_OAUTH_REDIRECT_URI}\n      # TTS and STT\n      - ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}\n      - DEEPGRAM_API_KEY=${DEEPGRAM_API_KEY}\n      # Calendar Integration\n      - CALENDAR_ENCRYPTION_KEY=${CALENDAR_ENCRYPTION_KEY}\n      # Web Search\n      - SERPAPI_API_KEY=${SERPAPI_API_KEY}\n    ports:\n      - \"8000:8000\"\n    networks:\n      - voiceassist-network\n      - database-network\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      qdrant:\n        condition: service_healthy\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n    restart: unless-stopped\n\n  # ===================================\n  # Phase 2: Security & Nextcloud\n  # ===================================\n\n  nextcloud-db:\n    image: postgres:16-alpine\n    container_name: voiceassist-nextcloud-db\n    environment:\n      POSTGRES_DB: nextcloud\n      POSTGRES_USER: nextcloud\n      POSTGRES_PASSWORD: ${NEXTCLOUD_DB_PASSWORD}\n    volumes:\n      - nextcloud-db-data:/var/lib/postgresql/data\n    networks:\n      - database-network\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U nextcloud\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  nextcloud:\n    image: nextcloud:29-apache\n    container_name: voiceassist-nextcloud\n    restart: unless-stopped\n    depends_on:\n      - nextcloud-db\n    environment:\n      - POSTGRES_HOST=nextcloud-db\n      - POSTGRES_DB=nextcloud\n      - POSTGRES_USER=nextcloud\n      - POSTGRES_PASSWORD=${NEXTCLOUD_DB_PASSWORD}\n      - NEXTCLOUD_ADMIN_USER=${NEXTCLOUD_ADMIN_USER}\n      - NEXTCLOUD_ADMIN_PASSWORD=${NEXTCLOUD_ADMIN_PASSWORD}\n      - NEXTCLOUD_TRUSTED_DOMAINS=nextcloud.local localhost\n    volumes:\n      - nextcloud-data:/var/www/html\n    ports:\n      - \"8080:80\"\n    networks:\n      - voiceassist-network\n      - database-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"curl -f http://localhost/status.php || exit 1\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # ===================================\n  # Phase 7: Contract Testing (P3.4)\n  # ===================================\n\n  # Pact Broker - Contract testing broker\n  pact-broker:\n    image: pactfoundation/pact-broker:latest\n    container_name: voiceassist-pact-broker\n    ports:\n      - \"9292:9292\"\n    environment:\n      PACT_BROKER_DATABASE_URL: \"postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres/pact_broker\"\n      PACT_BROKER_BASIC_AUTH_USERNAME: pact\n      PACT_BROKER_BASIC_AUTH_PASSWORD: pact\n      PACT_BROKER_PUBLIC_HEARTBEAT: \"true\"\n    depends_on:\n      postgres:\n        condition: service_healthy\n    networks:\n      - voiceassist-network\n      - database-network\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"-q\", \"--tries=1\", \"--spider\", \"http://localhost:9292/diagnostic/status/heartbeat\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n    restart: unless-stopped\n\n  # ===================================\n  # Phase 3: Additional Microservices\n  # ===================================\n  # - voice-proxy\n  # - medical-kb\n  # - admin-api\n  # - prometheus\n  # - grafana\n\n  # =============================\n  # Frontend applications bundle\n  # =============================\n  web-app:\n    build:\n      context: .\n      dockerfile: apps/web-app/Dockerfile\n    container_name: voiceassist-web-app\n    environment:\n      - VITE_API_BASE_URL=http://frontend-gateway:8080/api\n      - VITE_APP_ENV=${ENVIRONMENT:-development}\n    networks:\n      - voiceassist-network\n\n  admin-panel:\n    build:\n      context: .\n      dockerfile: apps/admin-panel/Dockerfile\n    container_name: voiceassist-admin-panel\n    environment:\n      - VITE_API_BASE_URL=http://frontend-gateway:8080/api\n      - VITE_APP_ENV=${ENVIRONMENT:-development}\n    networks:\n      - voiceassist-network\n\n  docs-site:\n    build:\n      context: .\n      dockerfile: apps/docs-site/Dockerfile\n    container_name: voiceassist-docs-site\n    environment:\n      - NODE_ENV=production\n    networks:\n      - voiceassist-network\n\n  frontend-gateway:\n    image: nginx:stable-alpine\n    container_name: voiceassist-frontend-gateway\n    volumes:\n      - ./infrastructure/docker/frontend-gateway/nginx.conf:/etc/nginx/nginx.conf:ro\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      voiceassist-server:\n        condition: service_started\n      web-app:\n        condition: service_started\n      admin-panel:\n        condition: service_started\n      docs-site:\n        condition: service_started\n    networks:\n      - voiceassist-network\n\n  frontend-metrics:\n    image: nginx/nginx-prometheus-exporter:1.3.0\n    container_name: voiceassist-frontend-metrics\n    command:\n      - \"-nginx.scrape-uri=http://frontend-gateway:8080/stub_status\"\n    ports:\n      - \"9113:9113\"\n    depends_on:\n      - frontend-gateway\n    networks:\n      - voiceassist-network\n"
}
