{
  "path": "apps/web-app/src/components/performance/OptimizedImage.tsx",
  "language": "typescript",
  "size": 5054,
  "last_modified": "2025-11-27T06:44:49.508Z",
  "lines": 198,
  "content": "/**\n * Optimized Image Component\n * Provides lazy loading, placeholder, and error handling for images\n *\n * Phase 10: Performance & Scalability\n */\n\nimport { useState, useEffect } from \"react\";\nimport { useLazyLoad } from \"../../hooks/useIntersectionObserver\";\n\nexport interface OptimizedImageProps {\n  /** Image source URL */\n  src: string;\n  /** Alt text for accessibility */\n  alt: string;\n  /** Width of the image */\n  width?: number | string;\n  /** Height of the image */\n  height?: number | string;\n  /** Low-quality placeholder image URL */\n  placeholder?: string;\n  /** Use blur-up effect with placeholder */\n  blurPlaceholder?: boolean;\n  /** Fallback image on error */\n  fallbackSrc?: string;\n  /** Loading strategy */\n  loading?: \"lazy\" | \"eager\";\n  /** Object fit style */\n  objectFit?: \"contain\" | \"cover\" | \"fill\" | \"none\" | \"scale-down\";\n  /** Additional class names */\n  className?: string;\n  /** Callback when image loads */\n  onLoad?: () => void;\n  /** Callback when image fails to load */\n  onError?: () => void;\n}\n\nexport function OptimizedImage({\n  src,\n  alt,\n  width,\n  height,\n  placeholder,\n  blurPlaceholder = false,\n  fallbackSrc,\n  loading = \"lazy\",\n  objectFit = \"cover\",\n  className = \"\",\n  onLoad,\n  onError,\n}: OptimizedImageProps) {\n  const { ref, isInView } = useLazyLoad();\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [hasError, setHasError] = useState(false);\n  const [currentSrc, setCurrentSrc] = useState<string | null>(null);\n\n  // Determine which source to use\n  useEffect(() => {\n    if (!isInView && loading === \"lazy\") {\n      setCurrentSrc(null);\n      return;\n    }\n\n    if (hasError && fallbackSrc) {\n      setCurrentSrc(fallbackSrc);\n    } else {\n      setCurrentSrc(src);\n    }\n  }, [isInView, loading, src, hasError, fallbackSrc]);\n\n  const handleLoad = () => {\n    setIsLoaded(true);\n    onLoad?.();\n  };\n\n  const handleError = () => {\n    setHasError(true);\n    onError?.();\n\n    if (fallbackSrc && currentSrc !== fallbackSrc) {\n      setCurrentSrc(fallbackSrc);\n    }\n  };\n\n  return (\n    <div\n      ref={ref}\n      className={`relative overflow-hidden ${className}`}\n      style={{ width, height }}\n    >\n      {/* Placeholder */}\n      {!isLoaded && (\n        <div className=\"absolute inset-0\">\n          {placeholder ? (\n            <img\n              src={placeholder}\n              alt=\"\"\n              className={`w-full h-full ${blurPlaceholder ? \"blur-sm scale-105\" : \"\"}`}\n              style={{ objectFit }}\n              aria-hidden=\"true\"\n            />\n          ) : (\n            <div className=\"w-full h-full bg-neutral-200 animate-pulse\" />\n          )}\n        </div>\n      )}\n\n      {/* Main image */}\n      {currentSrc && (\n        <img\n          src={currentSrc}\n          alt={alt}\n          width={width}\n          height={height}\n          loading={loading}\n          onLoad={handleLoad}\n          onError={handleError}\n          className={`w-full h-full transition-opacity duration-300 ${\n            isLoaded ? \"opacity-100\" : \"opacity-0\"\n          }`}\n          style={{ objectFit }}\n        />\n      )}\n\n      {/* Error state */}\n      {hasError && !fallbackSrc && (\n        <div className=\"absolute inset-0 flex items-center justify-center bg-neutral-100\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={1.5}\n            stroke=\"currentColor\"\n            className=\"w-8 h-8 text-neutral-400\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z\"\n            />\n          </svg>\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * Avatar-specific optimized image with circular crop\n */\nexport function OptimizedAvatar({\n  src,\n  alt,\n  size = 40,\n  fallback,\n  className = \"\",\n}: {\n  src?: string | null;\n  alt: string;\n  size?: number;\n  fallback?: string;\n  className?: string;\n}) {\n  const [hasError, setHasError] = useState(false);\n\n  const showFallback = !src || hasError;\n  const initials =\n    fallback ||\n    alt\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n\n  return (\n    <div\n      className={`relative rounded-full overflow-hidden bg-primary-100 ${className}`}\n      style={{ width: size, height: size }}\n    >\n      {showFallback ? (\n        <div className=\"w-full h-full flex items-center justify-center bg-primary-500 text-white font-medium text-sm\">\n          {initials}\n        </div>\n      ) : (\n        <img\n          src={src!}\n          alt={alt}\n          width={size}\n          height={size}\n          className=\"w-full h-full object-cover\"\n          onError={() => setHasError(true)}\n        />\n      )}\n    </div>\n  );\n}\n"
}
