{
  "path": "apps/web-app/src/components/export/ExportDialog.tsx",
  "language": "typescript",
  "size": 10191,
  "last_modified": "2025-11-24T08:42:04.668Z",
  "lines": 284,
  "content": "/**\n * Export Dialog Component\n * Dialog for exporting conversations to PDF or Markdown\n * Uses backend export API for server-side generation\n */\n\nimport { useState } from \"react\";\nimport { Button } from \"@voiceassist/ui\";\nimport type { Message } from \"@voiceassist/types\";\nimport { useAuth } from \"../../hooks/useAuth\";\n\nexport interface ExportDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  conversationId: string;\n  conversationTitle: string;\n  messages: Message[];\n}\n\n/**\n * Trigger browser download of a blob with the given filename\n */\nfunction downloadBlob(blob: Blob, filename: string): void {\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n\nexport function ExportDialog({\n  isOpen,\n  onClose,\n  conversationId,\n  conversationTitle,\n  messages,\n}: ExportDialogProps) {\n  const { apiClient } = useAuth();\n  const [format, setFormat] = useState<\"markdown\" | \"pdf\">(\"markdown\");\n  const [isExporting, setIsExporting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleExport = async () => {\n    setIsExporting(true);\n    setError(null);\n\n    try {\n      const timestamp = new Date().toISOString().split(\"T\")[0];\n      const sanitizedTitle = conversationTitle\n        .replace(/[^a-z0-9]/gi, \"-\")\n        .toLowerCase();\n\n      let blob: Blob;\n      let filename: string;\n\n      if (format === \"markdown\") {\n        blob = await apiClient.exportConversationAsMarkdown(conversationId);\n        filename = `${sanitizedTitle}-${timestamp}.md`;\n      } else {\n        blob = await apiClient.exportConversationAsPdf(conversationId);\n        filename = `${sanitizedTitle}-${timestamp}.pdf`;\n      }\n\n      // Trigger download\n      downloadBlob(blob, filename);\n\n      // Close dialog after short delay\n      setTimeout(() => {\n        onClose();\n        setIsExporting(false);\n      }, 500);\n    } catch (err) {\n      console.error(\"Export failed:\", err);\n      setError(\n        err instanceof Error ? err.message : \"Failed to export conversation\",\n      );\n      setIsExporting(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  const messageCount = messages.length;\n  const citationCount = messages.reduce((count, msg) => {\n    const citations = msg.metadata?.citations || msg.citations || [];\n    return count + citations.length;\n  }, 0);\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50\"\n      onClick={onClose}\n      role=\"dialog\"\n      aria-labelledby=\"export-dialog-title\"\n      aria-modal=\"true\"\n    >\n      <div\n        className=\"bg-white dark:bg-neutral-900 rounded-lg shadow-xl max-w-md w-full p-6\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2\n            id=\"export-dialog-title\"\n            className=\"text-xl font-semibold text-neutral-900 dark:text-neutral-100\"\n          >\n            Export Conversation\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors\"\n            aria-label=\"Close dialog\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-5 h-5 text-neutral-600 dark:text-neutral-400\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          </button>\n        </div>\n\n        {/* Content Stats */}\n        <div className=\"mb-6 p-3 bg-neutral-50 dark:bg-neutral-800 rounded-lg\">\n          <h3 className=\"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2\">\n            {conversationTitle}\n          </h3>\n          <div className=\"text-xs text-neutral-600 dark:text-neutral-400 space-y-1\">\n            <p>{messageCount} messages</p>\n            {citationCount > 0 && <p>{citationCount} citations</p>}\n          </div>\n        </div>\n\n        {/* Format Selection */}\n        <div className=\"mb-6\">\n          <label className=\"block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-3\">\n            Export Format\n          </label>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <button\n              type=\"button\"\n              onClick={() => setFormat(\"markdown\")}\n              className={`p-4 rounded-lg border-2 transition-colors ${\n                format === \"markdown\"\n                  ? \"border-primary-500 bg-primary-50 dark:bg-primary-900/20\"\n                  : \"border-neutral-200 dark:border-neutral-700 hover:border-neutral-300\"\n              }`}\n            >\n              <div className=\"flex flex-col items-center space-y-2\">\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={1.5}\n                  stroke=\"currentColor\"\n                  className={`w-6 h-6 ${\n                    format === \"markdown\"\n                      ? \"text-primary-600\"\n                      : \"text-neutral-500\"\n                  }`}\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z\"\n                  />\n                </svg>\n                <span\n                  className={`text-sm font-medium ${\n                    format === \"markdown\"\n                      ? \"text-primary-700 dark:text-primary-400\"\n                      : \"text-neutral-700 dark:text-neutral-300\"\n                  }`}\n                >\n                  Markdown\n                </span>\n              </div>\n            </button>\n\n            <button\n              type=\"button\"\n              onClick={() => setFormat(\"pdf\")}\n              className={`p-4 rounded-lg border-2 transition-colors ${\n                format === \"pdf\"\n                  ? \"border-primary-500 bg-primary-50 dark:bg-primary-900/20\"\n                  : \"border-neutral-200 dark:border-neutral-700 hover:border-neutral-300\"\n              }`}\n            >\n              <div className=\"flex flex-col items-center space-y-2\">\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={1.5}\n                  stroke=\"currentColor\"\n                  className={`w-6 h-6 ${\n                    format === \"pdf\" ? \"text-primary-600\" : \"text-neutral-500\"\n                  }`}\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z\"\n                  />\n                </svg>\n                <span\n                  className={`text-sm font-medium ${\n                    format === \"pdf\"\n                      ? \"text-primary-700 dark:text-primary-400\"\n                      : \"text-neutral-700 dark:text-neutral-300\"\n                  }`}\n                >\n                  PDF\n                </span>\n              </div>\n            </button>\n          </div>\n        </div>\n\n        {/* Info Note */}\n        <div className=\"mb-6 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg\">\n          <p className=\"text-sm text-blue-800 dark:text-blue-300\">\n            Export includes timestamps and citations automatically\n          </p>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\">\n            <p className=\"text-sm text-red-800 dark:text-red-300\">{error}</p>\n          </div>\n        )}\n\n        {/* Actions */}\n        <div className=\"flex justify-end space-x-3\">\n          <Button variant=\"ghost\" onClick={onClose} disabled={isExporting}>\n            Cancel\n          </Button>\n          <Button\n            onClick={handleExport}\n            disabled={isExporting || messages.length === 0}\n          >\n            {isExporting ? (\n              <>\n                <div className=\"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                Exporting...\n              </>\n            ) : (\n              <>\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={2}\n                  stroke=\"currentColor\"\n                  className=\"w-4 h-4 mr-2\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3\"\n                  />\n                </svg>\n                Export\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
}
