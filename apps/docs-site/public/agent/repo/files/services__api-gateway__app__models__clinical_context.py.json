{
  "path": "services/api-gateway/app/models/clinical_context.py",
  "language": "python",
  "size": 4444,
  "last_modified": "2025-12-05T03:07:13.131Z",
  "lines": 138,
  "content": "\"\"\"\nClinical context model for storing patient/clinical information\n\"\"\"\n\nimport uuid\nfrom datetime import datetime\nfrom typing import List, Optional\n\nfrom app.core.database import Base\nfrom pydantic import BaseModel\nfrom sqlalchemy import Column, DateTime, ForeignKey, Integer, Numeric, String, Text\nfrom sqlalchemy.dialects.postgresql import JSONB, UUID\n\n\nclass ClinicalContext(Base):\n    \"\"\"Clinical context model for patient/clinical information\"\"\"\n\n    __tablename__ = \"clinical_contexts\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    user_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey(\"users.id\", ondelete=\"CASCADE\"),\n        nullable=False,\n        index=True,\n    )\n    session_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey(\"sessions.id\", ondelete=\"SET NULL\"),\n        nullable=True,\n        index=True,\n    )\n\n    # Demographics\n    age = Column(Integer, nullable=True)\n    gender = Column(String(50), nullable=True)\n    weight_kg = Column(Numeric(5, 2), nullable=True)\n    height_cm = Column(Numeric(5, 2), nullable=True)\n\n    # Clinical data\n    chief_complaint = Column(Text, nullable=True)\n    problems = Column(JSONB, nullable=True)  # Array of problems/diagnoses\n    medications = Column(JSONB, nullable=True)  # Array of medications\n    allergies = Column(JSONB, nullable=True)  # Array of allergies\n\n    # Vitals\n    vitals = Column(JSONB, nullable=True)  # {temp, heart_rate, blood_pressure, respiratory_rate, spo2}\n\n    # Timestamps\n    last_updated = Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)\n    created_at = Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)\n\n    def __repr__(self):\n        return f\"<ClinicalContext(id={self.id}, user_id={self.user_id}, session_id={self.session_id})>\"\n\n    def to_dict(self):\n        \"\"\"Convert to dictionary\"\"\"\n        return {\n            \"id\": str(self.id),\n            \"user_id\": str(self.user_id),\n            \"session_id\": str(self.session_id) if self.session_id else None,\n            \"age\": self.age,\n            \"gender\": self.gender,\n            \"weight_kg\": float(self.weight_kg) if self.weight_kg else None,\n            \"height_cm\": float(self.height_cm) if self.height_cm else None,\n            \"chief_complaint\": self.chief_complaint,\n            \"problems\": self.problems or [],\n            \"medications\": self.medications or [],\n            \"allergies\": self.allergies or [],\n            \"vitals\": self.vitals or {},\n            \"last_updated\": (self.last_updated.isoformat() if self.last_updated else None),\n            \"created_at\": self.created_at.isoformat() if self.created_at else None,\n        }\n\n\n# Pydantic models for API\n\n\nclass Vitals(BaseModel):\n    \"\"\"Vitals data\"\"\"\n\n    temperature: Optional[float] = None  # Celsius\n    heart_rate: Optional[int] = None  # BPM\n    blood_pressure: Optional[str] = None  # e.g., \"120/80\"\n    respiratory_rate: Optional[int] = None  # breaths per minute\n    spo2: Optional[int] = None  # percentage\n\n\nclass ClinicalContextCreate(BaseModel):\n    \"\"\"Create clinical context\"\"\"\n\n    session_id: Optional[str] = None\n    age: Optional[int] = None\n    gender: Optional[str] = None\n    weight_kg: Optional[float] = None\n    height_cm: Optional[float] = None\n    chief_complaint: Optional[str] = None\n    problems: Optional[List[str]] = None\n    medications: Optional[List[str]] = None\n    allergies: Optional[List[str]] = None\n    vitals: Optional[Vitals] = None\n\n\nclass ClinicalContextUpdate(BaseModel):\n    \"\"\"Update clinical context\"\"\"\n\n    age: Optional[int] = None\n    gender: Optional[str] = None\n    weight_kg: Optional[float] = None\n    height_cm: Optional[float] = None\n    chief_complaint: Optional[str] = None\n    problems: Optional[List[str]] = None\n    medications: Optional[List[str]] = None\n    allergies: Optional[List[str]] = None\n    vitals: Optional[Vitals] = None\n\n\nclass ClinicalContextResponse(BaseModel):\n    \"\"\"Clinical context response\"\"\"\n\n    id: str\n    user_id: str\n    session_id: Optional[str] = None\n    age: Optional[int] = None\n    gender: Optional[str] = None\n    weight_kg: Optional[float] = None\n    height_cm: Optional[float] = None\n    chief_complaint: Optional[str] = None\n    problems: List[str] = []\n    medications: List[str] = []\n    allergies: List[str] = []\n    vitals: dict = {}\n    last_updated: str\n    created_at: str\n\n    class Config:\n        from_attributes = True\n"
}
