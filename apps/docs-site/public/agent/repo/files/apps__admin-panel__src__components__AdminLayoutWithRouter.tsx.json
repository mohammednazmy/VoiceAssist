{
  "path": "apps/admin-panel/src/components/AdminLayoutWithRouter.tsx",
  "language": "typescript",
  "size": 9786,
  "last_modified": "2025-12-02T02:42:24.675Z",
  "lines": 265,
  "content": "import { ReactNode, useState, useEffect } from \"react\";\nimport { NavLink, useNavigate, useLocation } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport { LocaleSwitcher } from \"@voiceassist/ui\";\nimport { useLanguage } from \"../contexts/LanguageContext\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport { SessionTimeoutWarning } from \"./session/SessionTimeoutWarning\";\n\ninterface LayoutProps {\n  children: ReactNode;\n}\n\nexport function AdminLayoutWithRouter({ children }: LayoutProps) {\n  const { user, logout, role, isViewer } = useAuth();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const { t } = useTranslation();\n  const { supportedLanguages } = useLanguage();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n  // Close mobile menu on route change\n  useEffect(() => {\n    setMobileMenuOpen(false);\n  }, [location.pathname]);\n\n  const handleLogout = () => {\n    logout();\n    navigate(\"/login\");\n  };\n\n  const navLinkClass = ({ isActive }: { isActive: boolean }) =>\n    `block px-4 py-2 border-b border-slate-900 hover:bg-slate-900 transition-colors ${\n      isActive\n        ? \"bg-slate-900 text-blue-400 border-l-2 border-l-blue-500\"\n        : \"text-slate-300\"\n    }`;\n\n  return (\n    <div className=\"min-h-screen flex bg-slate-950 text-slate-50\">\n      {/* Mobile backdrop */}\n      {mobileMenuOpen && (\n        <div\n          className=\"fixed inset-0 bg-black/60 z-40 md:hidden\"\n          onClick={() => setMobileMenuOpen(false)}\n          aria-hidden=\"true\"\n        />\n      )}\n\n      {/* Mobile header with hamburger */}\n      <header className=\"fixed top-0 left-0 right-0 h-14 bg-slate-950 border-b border-slate-800 flex items-center px-4 z-30 md:hidden\">\n        <button\n          onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n          className=\"p-2 -ml-2 text-slate-400 hover:text-slate-200 transition-colors\"\n          aria-label=\"Toggle navigation menu\"\n          aria-expanded={mobileMenuOpen}\n        >\n          {mobileMenuOpen ? (\n            <svg\n              className=\"w-6 h-6\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          ) : (\n            <svg\n              className=\"w-6 h-6\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M4 6h16M4 12h16M4 18h16\"\n              />\n            </svg>\n          )}\n        </button>\n        <div className=\"ml-3 font-semibold text-sm\">{t(\"meta.app\")}</div>\n        {isViewer && (\n          <span className=\"ml-2 text-[10px] text-amber-400 bg-amber-950/50 px-1.5 py-0.5 rounded\">\n            Viewer\n          </span>\n        )}\n      </header>\n\n      {/* Sidebar - hidden on mobile by default, slide-in when open */}\n      <aside\n        className={`\n          fixed md:static inset-y-0 left-0 z-50\n          w-64 border-r border-slate-800 bg-slate-950 flex flex-col\n          transform transition-transform duration-200 ease-in-out\n          ${mobileMenuOpen ? \"translate-x-0\" : \"-translate-x-full md:translate-x-0\"}\n        `}\n      >\n        <div className=\"px-4 py-4 border-b border-slate-800\">\n          <div className=\"font-semibold text-sm tracking-tight\">\n            {t(\"meta.app\")}\n          </div>\n          <div className=\"text-[11px] text-slate-500\">{t(\"meta.tagline\")}</div>\n          {isViewer && (\n            <div className=\"text-[11px] text-amber-400 mt-1\">\n              Read-only viewer\n            </div>\n          )}\n          <div className=\"mt-3\">\n            <LocaleSwitcher languages={supportedLanguages} />\n          </div>\n          {/* Back to VoiceAssist link */}\n          <a\n            href={import.meta.env.VITE_APP_URL || \"https://dev.asimo.io\"}\n            className=\"mt-3 flex items-center gap-1.5 text-xs text-blue-400 hover:text-blue-300 transition-colors\"\n          >\n            <svg\n              className=\"w-3.5 h-3.5\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18\"\n              />\n            </svg>\n            Back to VoiceAssist\n          </a>\n        </div>\n\n        <nav className=\"flex-1 text-sm overflow-y-auto\">\n          <NavLink to=\"/dashboard\" className={navLinkClass}>\n            ğŸ“Š {t(\"nav.dashboard\")}\n          </NavLink>\n          <NavLink to=\"/users\" className={navLinkClass}>\n            ğŸ‘¥ {t(\"nav.users\")}\n          </NavLink>\n          <NavLink to=\"/conversations\" className={navLinkClass}>\n            ğŸ’¬ {t(\"nav.conversations\", \"Conversations\")}\n          </NavLink>\n          <NavLink to=\"/clinical-contexts\" className={navLinkClass}>\n            ğŸ¥ {t(\"nav.clinicalContexts\", \"Clinical Contexts\")}\n          </NavLink>\n          <NavLink to=\"/knowledge-base\" className={navLinkClass}>\n            ğŸ“š {t(\"nav.knowledge\")}\n          </NavLink>\n          <NavLink to=\"/analytics\" className={navLinkClass}>\n            ğŸ“ˆ {t(\"nav.analytics\")}\n          </NavLink>\n          <NavLink to=\"/voice\" className={navLinkClass}>\n            ğŸ™ï¸ {t(\"nav.voice\", \"Voice Monitor\")}\n          </NavLink>\n          <NavLink to=\"/integrations\" className={navLinkClass}>\n            ğŸ”— {t(\"nav.integrations\", \"Integrations\")}\n          </NavLink>\n          <NavLink to=\"/security\" className={navLinkClass}>\n            ğŸ”’ {t(\"nav.security\", \"Security & PHI\")}\n          </NavLink>\n          <NavLink to=\"/tools\" className={navLinkClass}>\n            ğŸ”§ {t(\"nav.tools\", \"Tools\")}\n          </NavLink>\n          <NavLink to=\"/calendar-connections\" className={navLinkClass}>\n            ğŸ“… {t(\"nav.calendarConnections\", \"Calendars\")}\n          </NavLink>\n          <NavLink to=\"/function-analytics\" className={navLinkClass}>\n            ğŸ“Š {t(\"nav.functionAnalytics\", \"Function Analytics\")}\n          </NavLink>\n          <NavLink to=\"/feature-flags\" className={navLinkClass}>\n            ğŸš© {t(\"nav.featureFlags\", \"Feature Flags\")}\n          </NavLink>\n          <NavLink to=\"/prompts\" className={navLinkClass}>\n            ğŸ“ {t(\"nav.prompts\", \"Prompts\")}\n          </NavLink>\n          <NavLink to=\"/system\" className={navLinkClass}>\n            âš™ï¸ {t(\"nav.system\")}\n          </NavLink>\n          <NavLink to=\"/backups\" className={navLinkClass}>\n            ğŸ’¾ {t(\"nav.backups\", \"Backups & DR\")}\n          </NavLink>\n          <NavLink to=\"/troubleshooting\" className={navLinkClass}>\n            ğŸ” {t(\"nav.troubleshooting\", \"Troubleshooting\")}\n          </NavLink>\n        </nav>\n\n        <div className=\"border-t border-slate-800 p-4 space-y-2\">\n          {/* Documentation link */}\n          <a\n            href={import.meta.env.VITE_DOCS_URL || \"https://docs.asimo.io\"}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"flex items-center gap-1.5 text-xs text-slate-400 hover:text-slate-200 transition-colors\"\n          >\n            <svg\n              className=\"w-3.5 h-3.5\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25\"\n              />\n            </svg>\n            Documentation\n            <svg\n              className=\"w-3 h-3 opacity-50\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25\"\n              />\n            </svg>\n          </a>\n          <div className=\"text-xs text-slate-400\">\n            Logged in as:\n            <div className=\"mt-1 font-medium text-slate-300 truncate\">\n              {user?.email}\n            </div>\n            <div className=\"mt-1 inline-flex items-center gap-2 px-2 py-1 rounded border border-slate-700 text-[11px] text-slate-400\">\n              <span\n                className=\"h-1.5 w-1.5 rounded-full bg-slate-500\"\n                aria-hidden\n              />\n              {role === \"viewer\" ? \"Viewer (read-only)\" : \"Admin\"}\n            </div>\n          </div>\n          <button\n            onClick={handleLogout}\n            className=\"w-full px-3 py-1.5 text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 rounded transition-colors\"\n          >\n            {t(\"nav.logout\")}\n          </button>\n        </div>\n\n        <div className=\"px-4 py-3 text-[10px] text-slate-500 border-t border-slate-800\">\n          {t(\"meta.hipaa\")}\n        </div>\n      </aside>\n\n      {/* Main content - add top padding on mobile for fixed header */}\n      <main className=\"flex-1 flex flex-col overflow-hidden pt-14 md:pt-0\">\n        {children}\n      </main>\n\n      {/* Session timeout warning modal */}\n      <SessionTimeoutWarning />\n    </div>\n  );\n}\n"
}
