{
  "path": "apps/web-app/src/components/admin/WebSocketStatusPanel.tsx",
  "language": "typescript",
  "size": 6900,
  "last_modified": "2025-11-27T02:50:32.091Z",
  "lines": 194,
  "content": "/**\n * WebSocket Status Panel (Phase 8.3)\n * Real-time monitoring of WebSocket connections\n */\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport {\n  getDefaultAdminApi,\n  type WebSocketStatusResponse,\n} from \"../../lib/api/adminApi\";\n\nexport function WebSocketStatusPanel() {\n  const [status, setStatus] = useState<WebSocketStatusResponse | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadStatus = useCallback(async () => {\n    try {\n      setError(null);\n      const adminApi = getDefaultAdminApi();\n      const data = await adminApi.getWebSocketStatus();\n      setStatus(data);\n      setIsLoading(false);\n    } catch (err) {\n      console.error(\"Failed to load WebSocket status:\", err);\n      setError(err instanceof Error ? err.message : \"Unknown error\");\n      setIsLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    loadStatus();\n\n    // Refresh every 5 seconds\n    const interval = setInterval(loadStatus, 5000);\n    return () => clearInterval(interval);\n  }, [loadStatus]);\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-6 bg-neutral-200 rounded w-1/3\" />\n          <div className=\"h-20 bg-neutral-200 rounded\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h2 className=\"text-lg font-semibold text-neutral-900\">\n            WebSocket Status\n          </h2>\n          <button\n            onClick={loadStatus}\n            className=\"text-sm text-primary-600 hover:text-primary-700\"\n          >\n            Retry\n          </button>\n        </div>\n        <div className=\"bg-red-50 border border-red-200 rounded p-4 text-sm text-red-700\">\n          {error}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow p-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h2 className=\"text-lg font-semibold text-neutral-900\">\n          WebSocket Status\n        </h2>\n        <div className=\"flex items-center space-x-2\">\n          <span\n            className={`w-2 h-2 rounded-full ${status?.active_connections ? \"bg-green-500 animate-pulse\" : \"bg-neutral-300\"}`}\n          />\n          <span className=\"text-sm text-neutral-600\">\n            {status?.active_connections || 0} active\n          </span>\n        </div>\n      </div>\n\n      {/* Connection Summary */}\n      <div className=\"grid grid-cols-3 gap-4 mb-6\">\n        <div className=\"text-center p-3 bg-blue-50 rounded-lg\">\n          <p className=\"text-2xl font-bold text-blue-600\">\n            {status?.connections_by_type.chat || 0}\n          </p>\n          <p className=\"text-xs text-blue-700\">Chat</p>\n        </div>\n        <div className=\"text-center p-3 bg-purple-50 rounded-lg\">\n          <p className=\"text-2xl font-bold text-purple-600\">\n            {status?.connections_by_type.voice || 0}\n          </p>\n          <p className=\"text-xs text-purple-700\">Voice</p>\n        </div>\n        <div className=\"text-center p-3 bg-neutral-50 rounded-lg\">\n          <p className=\"text-2xl font-bold text-neutral-600\">\n            {status?.connections_by_type.other || 0}\n          </p>\n          <p className=\"text-xs text-neutral-700\">Other</p>\n        </div>\n      </div>\n\n      {/* Pool Stats */}\n      <div className=\"space-y-3 mb-6\">\n        <h3 className=\"text-sm font-medium text-neutral-700\">\n          Connection Pools\n        </h3>\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"p-3 border border-neutral-200 rounded-lg\">\n            <p className=\"text-xs text-neutral-600 mb-1\">Database Pool</p>\n            <div className=\"flex items-baseline space-x-2\">\n              <span className=\"text-lg font-semibold text-neutral-900\">\n                {status?.pool_stats.database.checked_out || 0}\n              </span>\n              <span className=\"text-xs text-neutral-500\">\n                / {status?.pool_stats.database.size || 0} used\n              </span>\n            </div>\n          </div>\n          <div className=\"p-3 border border-neutral-200 rounded-lg\">\n            <p className=\"text-xs text-neutral-600 mb-1\">Redis Pool</p>\n            <div className=\"flex items-baseline space-x-2\">\n              <span className=\"text-lg font-semibold text-neutral-900\">\n                {status?.pool_stats.redis.in_use_connections || 0}\n              </span>\n              <span className=\"text-xs text-neutral-500\">\n                / {status?.pool_stats.redis.max_connections || 0} used\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Connections */}\n      {status?.recent_connections && status.recent_connections.length > 0 && (\n        <div>\n          <h3 className=\"text-sm font-medium text-neutral-700 mb-2\">\n            Recent Connections\n          </h3>\n          <div className=\"max-h-40 overflow-y-auto\">\n            <table className=\"w-full text-sm\">\n              <thead>\n                <tr className=\"text-left text-xs text-neutral-500\">\n                  <th className=\"pb-2\">Type</th>\n                  <th className=\"pb-2\">User</th>\n                  <th className=\"pb-2\">Connected</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-neutral-100\">\n                {status.recent_connections.map((conn) => (\n                  <tr key={conn.session_id} className=\"hover:bg-neutral-50\">\n                    <td className=\"py-2\">\n                      <span\n                        className={`px-2 py-0.5 rounded text-xs ${\n                          conn.type === \"voice\"\n                            ? \"bg-purple-100 text-purple-700\"\n                            : conn.type === \"chat\"\n                              ? \"bg-blue-100 text-blue-700\"\n                              : \"bg-neutral-100 text-neutral-700\"\n                        }`}\n                      >\n                        {conn.type}\n                      </span>\n                    </td>\n                    <td className=\"py-2 text-neutral-600 truncate max-w-[120px]\">\n                      {conn.user_id?.substring(0, 8)}...\n                    </td>\n                    <td className=\"py-2 text-neutral-500\">\n                      {new Date(conn.connected_at).toLocaleTimeString()}\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </div>\n      )}\n\n      {(!status?.recent_connections ||\n        status.recent_connections.length === 0) && (\n        <div className=\"text-center py-4 text-neutral-500 text-sm\">\n          No active connections\n        </div>\n      )}\n    </div>\n  );\n}\n"
}
