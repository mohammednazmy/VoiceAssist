{
  "path": "packages/types/src/index.ts",
  "language": "typescript",
  "size": 38431,
  "last_modified": "2025-12-04T11:37:52.176Z",
  "lines": 1642,
  "content": "/**\n * VoiceAssist Shared Types\n * Common TypeScript types used across all applications\n */\n\n// ============================================================================\n// User & Authentication Types\n// ============================================================================\n\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  role: UserRole;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport type UserRole = \"admin\" | \"physician\" | \"staff\" | \"patient\";\n\nexport interface AuthTokens {\n  accessToken: string;\n  refreshToken: string;\n  expiresIn: number;\n}\n\nexport interface LoginRequest {\n  email: string;\n  password: string;\n}\n\n// Backend token response (what /api/auth/login actually returns)\nexport interface TokenResponse {\n  access_token: string;\n  refresh_token: string;\n  token_type: string;\n  expires_in: number;\n}\n\n// Frontend login response (after fetching user profile)\nexport interface LoginResponse {\n  user: User;\n  tokens: AuthTokens;\n}\n\n// ============================================================================\n// Chat & Conversation Types\n// ============================================================================\n\nexport interface Message {\n  id: string;\n  conversationId?: string;\n  role: \"user\" | \"assistant\" | \"system\";\n  content: string;\n  delta?: string;\n  citations?: Citation[];\n  attachments?: string[];\n  timestamp: number;\n  metadata?: MessageMetadata;\n  // Conversation branching support (Phase 2, Week 10)\n  parentId?: string;\n  branchId?: string;\n}\n\n/**\n * Citation interface - matches backend CitationSchema\n * Supports both structured (new) and legacy fields for backward compatibility\n */\nexport interface Citation {\n  // Core fields\n  id: string;\n\n  // Legacy fields (maintained for backward compatibility)\n  source?: \"kb\" | \"url\" | \"pubmed\" | \"doi\";\n  reference?: string;\n\n  // Structured fields (Phase 8)\n  sourceId?: string;\n  sourceType?: string;\n  title?: string;\n  subtitle?: string;\n  location?: string;\n  url?: string;\n  doi?: string;\n  pubmedId?: string;\n  page?: number;\n  authors?: string[];\n  publicationYear?: number;\n  journal?: string;\n  snippet?: string;\n  relevanceScore?: number;\n  metadata?: Record<string, any>;\n}\n\nexport interface MessageMetadata {\n  sources?: Source[];\n  citations?: Citation[]; // Phase 8: Structured citations\n  toolCalls?: ToolCall[];\n  errorInfo?: ErrorInfo;\n}\n\nexport interface Source {\n  documentId: string;\n  title: string;\n  pageNumber?: number;\n  confidence: number;\n  excerpt: string;\n}\n\nexport interface ToolCall {\n  id: string;\n  name: string;\n  arguments: Record<string, unknown>;\n  result?: unknown;\n}\n\nexport interface ErrorInfo {\n  code: string;\n  message: string;\n  details?: unknown;\n}\n\nexport interface Conversation {\n  id: string;\n  userId: string;\n  title: string;\n  createdAt: string;\n  updatedAt: string;\n  messageCount: number;\n  archived?: boolean;\n  lastMessagePreview?: string;\n  folderId?: string | null;\n}\n\nexport interface UpdateConversationRequest {\n  title?: string;\n  archived?: boolean;\n  folderId?: string | null;\n}\n\n// ============================================================================\n// Folder Types\n// ============================================================================\n\nexport interface Folder {\n  id: string;\n  userId: string;\n  name: string;\n  color?: string | null;\n  icon?: string | null;\n  parentFolderId?: string | null;\n  createdAt: string;\n  children?: Folder[];\n}\n\nexport interface CreateFolderRequest {\n  name: string;\n  color?: string | null;\n  icon?: string | null;\n  parentFolderId?: string | null;\n}\n\nexport interface UpdateFolderRequest {\n  name?: string;\n  color?: string | null;\n  icon?: string | null;\n  parentFolderId?: string | null;\n}\n\n// ============================================================================\n// Sharing Types\n// ============================================================================\n\nexport interface ShareRequest {\n  expiresInHours?: number;\n  password?: string | null;\n  allowAnonymous?: boolean;\n}\n\nexport interface ShareResponse {\n  shareId: string;\n  shareUrl: string;\n  expiresAt: string;\n  passwordProtected: boolean;\n}\n\nexport interface ShareLink {\n  shareToken: string;\n  shareUrl: string;\n  createdAt: string;\n  expiresAt: string;\n  passwordProtected: boolean;\n  accessCount: number;\n}\n\n// ============================================================================\n// Template Types\n// ============================================================================\n\nexport interface ConversationTemplate {\n  id: string;\n  name: string;\n  description?: string;\n  category?: string;\n  icon?: string;\n  color?: string;\n  messages: TemplateMessage[];\n  clinicalContext?: Record<string, any>;\n  createdAt: string;\n  updatedAt: string;\n  usageCount: number;\n}\n\nexport interface TemplateMessage {\n  role: \"user\" | \"assistant\" | \"system\";\n  content: string;\n}\n\nexport interface CreateTemplateRequest {\n  name: string;\n  description?: string;\n  category?: string;\n  icon?: string;\n  color?: string;\n  fromConversationId?: string;\n}\n\nexport interface UpdateTemplateRequest {\n  name?: string;\n  description?: string;\n  category?: string;\n  icon?: string;\n  color?: string;\n}\n\n// Conversation Branching Types (Phase 2, Week 10)\nexport interface Branch {\n  branchId: string;\n  sessionId: string;\n  parentMessageId: string | null;\n  messageCount: number;\n  createdAt: string;\n  lastActivity: string;\n}\n\nexport interface CreateBranchRequest {\n  parentMessageId: string;\n  initialMessage?: string;\n}\n\n// ============================================================================\n// Voice Types\n// ============================================================================\n\nexport interface VoiceConfig {\n  voiceId: string;\n  speed: number;\n  pitch: number;\n  volume: number;\n}\n\nexport interface TranscriptionResult {\n  text: string;\n  confidence: number;\n  language: string;\n  timestamp: string;\n}\n\n// ============================================================================\n// Voice Barge-In Settings Types (Phase 7-10)\n// ============================================================================\n\n/**\n * Phase 7: Multilingual settings for voice sessions\n */\nexport interface MultilingualSettings {\n  /** Selected accent profile ID */\n  accentProfileId: string | null;\n  /** Enable automatic language detection from speech */\n  autoLanguageDetection: boolean;\n  /** Confidence threshold (0-1) for automatic language switching */\n  languageSwitchConfidence: number;\n}\n\n/**\n * Phase 8: Personalization/Calibration settings\n */\nexport interface CalibrationSettings {\n  /** Whether user has completed voice calibration */\n  vadCalibrated: boolean;\n  /** Timestamp of last calibration */\n  lastCalibrationDate: number | null;\n  /** Personalized VAD threshold from calibration (0-1) */\n  personalizedVadThreshold: number | null;\n  /** Enable adaptive learning from speech patterns */\n  enableBehaviorLearning: boolean;\n  /** VAD sensitivity (0-1 scale, higher = more sensitive) */\n  vadSensitivity: number;\n}\n\n/**\n * Phase 9: Offline mode settings\n */\nexport interface OfflineModeSettings {\n  /** Enable offline VAD fallback when network is unavailable */\n  enableOfflineFallback: boolean;\n  /** Prefer local VAD processing even when online */\n  preferOfflineVAD: boolean;\n  /** Cache common TTS phrases for offline playback */\n  ttsCacheEnabled: boolean;\n}\n\n/**\n * Phase 10: Conversation management settings\n */\nexport interface ConversationIntelligenceSettings {\n  /** Track user sentiment during conversation */\n  enableSentimentTracking: boolean;\n  /** Enable discourse/topic tracking */\n  enableDiscourseAnalysis: boolean;\n  /** Get AI response behavior recommendations */\n  enableResponseRecommendations: boolean;\n  /** Display suggested follow-up questions */\n  showSuggestedFollowUps: boolean;\n}\n\n/**\n * Voice privacy settings\n */\nexport interface VoicePrivacySettings {\n  /** Store transcript history locally */\n  storeTranscriptHistory: boolean;\n  /** Share anonymous usage data for improvement */\n  shareAnonymousAnalytics: boolean;\n}\n\n/**\n * Combined Phase 7-10 advanced voice settings\n */\nexport interface AdvancedVoiceSettings {\n  multilingual: MultilingualSettings;\n  calibration: CalibrationSettings;\n  offline: OfflineModeSettings;\n  conversationIntelligence: ConversationIntelligenceSettings;\n  privacy: VoicePrivacySettings;\n}\n\n/**\n * Voice session configuration for Thinker/Talker pipeline\n * Matches backend TTSessionConfig\n */\nexport interface TTSessionConfig {\n  userId: string;\n  sessionId: string;\n  conversationId?: string;\n\n  // Voice settings\n  voiceId: string;\n  ttsModel: string;\n  language: string;\n\n  // STT settings\n  sttSampleRate: number;\n  sttEndpointingMs: number;\n  sttUtteranceEndMs: number;\n\n  // Barge-in\n  bargeInEnabled: boolean;\n\n  // Timeouts\n  connectionTimeoutSec: number;\n  idleTimeoutSec: number;\n\n  // Phase 7-10: Advanced settings (all optional)\n  advancedSettings?: AdvancedVoiceSettings;\n}\n\n/**\n * Voice session metrics for Thinker/Talker pipeline\n */\nexport interface TTVoiceMetrics {\n  /** Time from connect() call to ready status (ms) */\n  connectionTimeMs: number | null;\n  /** Time from speech end to first transcript (ms) */\n  sttLatencyMs: number | null;\n  /** Time from transcript to first LLM token (ms) */\n  llmFirstTokenMs: number | null;\n  /** Time from first LLM token to first TTS audio (ms) */\n  ttsFirstAudioMs: number | null;\n  /** Total time from speech end to first audio (ms) */\n  totalLatencyMs: number | null;\n  /** Session duration (ms) */\n  sessionDurationMs: number | null;\n  /** Count of user utterances */\n  userUtteranceCount: number;\n  /** Count of AI responses */\n  aiResponseCount: number;\n  /** Count of tool calls */\n  toolCallCount: number;\n  /** Count of barge-ins */\n  bargeInCount: number;\n  /** Reconnection count */\n  reconnectCount: number;\n  /** Session start timestamp */\n  sessionStartedAt: number | null;\n}\n\n/**\n * Sentiment analysis result\n */\nexport type SentimentType =\n  | \"positive\"\n  | \"negative\"\n  | \"neutral\"\n  | \"frustrated\"\n  | \"confused\"\n  | \"engaged\";\n\nexport interface SentimentResult {\n  sentiment: SentimentType;\n  confidence: number;\n  valence: number; // -1 to 1\n  arousal: number; // 0 to 1\n}\n\n/**\n * Discourse/conversation phase\n */\nexport type DiscoursePhase =\n  | \"opening\"\n  | \"information_gathering\"\n  | \"deep_discussion\"\n  | \"clarification\"\n  | \"action_oriented\"\n  | \"closing\";\n\n/**\n * Discourse state for conversation tracking\n */\nexport interface DiscourseState {\n  topic: string | null;\n  phase: DiscoursePhase;\n  coherence: number; // 0 to 1\n  topicShiftCount: number;\n}\n\n/**\n * Response recommendations for AI behavior adjustment\n */\nexport interface ResponseRecommendations {\n  speakSlower: boolean;\n  useSimpleLanguage: boolean;\n  offerClarification: boolean;\n  pauseForQuestions: boolean;\n  suggestedTone: \"neutral\" | \"empathetic\" | \"professional\" | \"encouraging\";\n  urgency: \"low\" | \"normal\" | \"high\";\n}\n\n/**\n * Calibration progress during voice calibration\n */\nexport interface CalibrationProgress {\n  state:\n    | \"idle\"\n    | \"preparing\"\n    | \"measuring_noise\"\n    | \"waiting_speech\"\n    | \"measuring_voice\"\n    | \"analyzing\"\n    | \"complete\"\n    | \"error\";\n  progress: number; // 0-100\n  message: string;\n  instruction?: string;\n}\n\n/**\n * Calibration result after voice calibration completes\n */\nexport interface CalibrationResult {\n  id: string;\n  timestamp: number;\n  backgroundNoiseLevel: number;\n  voiceEnergyLevel: number;\n  recommendedVadThreshold: number;\n  recommendedSilenceThreshold: number;\n  pitchRange: {\n    min: number;\n    max: number;\n    mean: number;\n  };\n  speakingRate: number;\n  qualityScore: number;\n  duration: number;\n  environment: \"quiet\" | \"moderate\" | \"noisy\" | \"outdoor\";\n}\n\n// ============================================================================\n// Knowledge Base Types\n// ============================================================================\n\nexport interface Document {\n  id: string;\n  title: string;\n  category: string;\n  author?: string;\n  uploadedAt: string;\n  uploadedBy: string;\n  fileSize: number;\n  pageCount?: number;\n  status: DocumentStatus;\n}\n\nexport type DocumentStatus = \"pending\" | \"processing\" | \"indexed\" | \"failed\";\n\nexport interface KnowledgeBaseEntry {\n  id: string;\n  documentId: string;\n  content: string;\n  embedding?: number[];\n  metadata: Record<string, unknown>;\n}\n\nexport interface SearchResult {\n  id: string;\n  documentId: string;\n  title: string;\n  excerpt: string;\n  score: number;\n  pageNumber?: number;\n}\n\n// ============================================================================\n// API Response Types\n// ============================================================================\n\nexport interface ApiResponse<T = unknown> {\n  success: boolean;\n  data?: T;\n  error?: ApiError;\n  meta?: ApiMeta;\n}\n\nexport interface ApiError {\n  code: string;\n  message: string;\n  details?: unknown;\n  timestamp: string;\n}\n\nexport interface ApiMeta {\n  page?: number;\n  pageSize?: number;\n  totalCount?: number;\n  totalPages?: number;\n}\n\nexport interface PaginatedResponse<T> {\n  items: T[];\n  page: number;\n  pageSize: number;\n  totalCount: number;\n  totalPages: number;\n}\n\n// ============================================================================\n// WebSocket Types\n// ============================================================================\n\nexport interface WebSocketMessage<T = unknown> {\n  type: string;\n  payload: T;\n  timestamp: string;\n}\n\nexport interface ChatStreamChunk {\n  conversationId: string;\n  messageId: string;\n  delta: string;\n  isComplete: boolean;\n}\n\nexport type WebSocketEventType =\n  | \"delta\"\n  | \"chunk\"\n  | \"message.done\"\n  | \"user_message.created\"\n  | \"history\"\n  | \"connected\"\n  | \"error\"\n  | \"ping\"\n  | \"pong\";\n\nexport interface WebSocketEvent {\n  type: WebSocketEventType;\n  eventId?: string;\n  messageId?: string;\n  clientMessageId?: string;\n  content?: string;\n  delta?: string;\n  message?: Message;\n  messages?: Message[];\n  metadata?: any;\n  error?: WebSocketError;\n}\n\nexport interface WebSocketError {\n  code: WebSocketErrorCode;\n  message: string;\n  details?: unknown;\n}\n\nexport type WebSocketErrorCode =\n  | \"AUTH_FAILED\"\n  | \"RATE_LIMITED\"\n  | \"QUOTA_EXCEEDED\"\n  | \"INVALID_EVENT\"\n  | \"BACKEND_ERROR\"\n  | \"CONNECTION_DROPPED\";\n\nexport type ConnectionStatus =\n  | \"connecting\"\n  | \"connected\"\n  | \"reconnecting\"\n  | \"disconnected\"\n  | \"failed\";\n\n// ============================================================================\n// Attachment Types\n// ============================================================================\n\nexport interface Attachment {\n  id: string;\n  messageId: string;\n  fileName: string;\n  fileType: string; // 'pdf', 'image', 'text', 'markdown', 'document'\n  fileSize: number; // bytes\n  fileUrl: string;\n  mimeType?: string;\n  metadata?: Record<string, any>;\n  uploadedAt: string;\n  createdAt: string;\n}\n\nexport interface AttachmentUploadResponse {\n  id: string;\n  messageId: string;\n  fileName: string;\n  fileType: string;\n  fileSize: number;\n  fileUrl: string;\n  mimeType?: string;\n  uploadedAt: string;\n  createdAt: string;\n}\n\nexport interface UploadProgress {\n  fileName: string;\n  progress: number; // 0-100\n  status: \"uploading\" | \"complete\" | \"error\";\n  error?: string;\n}\n\n// ============================================================================\n// Clinical Context Types\n// ============================================================================\n\nexport interface Vitals {\n  temperature?: number; // Celsius\n  heartRate?: number; // BPM\n  bloodPressure?: string; // e.g., \"120/80\"\n  respiratoryRate?: number; // breaths per minute\n  spo2?: number; // percentage (SpO2)\n}\n\nexport interface ClinicalContext {\n  id: string;\n  userId: string;\n  sessionId?: string;\n  age?: number;\n  gender?: string;\n  weightKg?: number;\n  heightCm?: number;\n  chiefComplaint?: string;\n  problems: string[]; // Array of problems/diagnoses\n  medications: string[]; // Array of medications\n  allergies: string[]; // Array of allergies\n  vitals: Vitals;\n  lastUpdated: string;\n  createdAt: string;\n}\n\nexport interface ClinicalContextCreate {\n  sessionId?: string;\n  age?: number;\n  gender?: string;\n  weightKg?: number;\n  heightCm?: number;\n  chiefComplaint?: string;\n  problems?: string[];\n  medications?: string[];\n  allergies?: string[];\n  vitals?: Vitals;\n}\n\nexport interface ClinicalContextUpdate {\n  age?: number;\n  gender?: string;\n  weightKg?: number;\n  heightCm?: number;\n  chiefComplaint?: string;\n  problems?: string[];\n  medications?: string[];\n  allergies?: string[];\n  vitals?: Vitals;\n}\n\n// ============================================================================\n// Clinical Context Preset Types\n// ============================================================================\n\nexport type ClinicalPresetCategory = \"builtin\" | \"custom\";\n\nexport interface PresetVitals {\n  /** Temperature in Celsius */\n  temperature?: number;\n  /** Heart rate in BPM */\n  heartRate?: number;\n  /** Blood pressure as structured object with systolic/diastolic */\n  bloodPressure?: { systolic: number; diastolic: number };\n  /** Respiratory rate in breaths per minute */\n  respiratoryRate?: number;\n  /** Oxygen saturation percentage */\n  oxygenSaturation?: number;\n  /** Blood glucose in mg/dL */\n  bloodGlucose?: number;\n  /** Weight in kg */\n  weight?: number;\n  /** Pain scale 0-10 */\n  painScale?: number;\n}\n\nexport interface PresetContext {\n  /** Session ID to link preset to */\n  sessionId?: string;\n  /** Patient age */\n  age?: number;\n  /** Patient gender */\n  gender?: string;\n  /** Weight in kg */\n  weightKg?: number;\n  /** Height in cm */\n  heightCm?: number;\n  /** Chief complaint */\n  chiefComplaint?: string;\n  /** List of problems/diagnoses */\n  problems?: string[];\n  /** List of medications */\n  medications?: string[];\n  /** List of allergies */\n  allergies?: string[];\n  /** Vitals with structured blood pressure */\n  vitals?: PresetVitals;\n}\n\nexport interface ClinicalContextPreset {\n  /** Unique identifier */\n  id: string;\n  /** Display name */\n  name: string;\n  /** Short description */\n  description: string;\n  /** Whether this is a built-in or custom preset */\n  category: ClinicalPresetCategory;\n  /** Icon identifier for UI */\n  icon?: string;\n  /** The clinical context data for this preset */\n  context: PresetContext;\n  /** User who created this preset (for custom presets) */\n  userId?: string;\n  /** ISO timestamp when created */\n  createdAt?: string;\n  /** ISO timestamp when last updated */\n  updatedAt?: string;\n}\n\nexport interface ClinicalPresetCreate {\n  name: string;\n  description: string;\n  icon?: string;\n  context: PresetContext;\n}\n\nexport interface ClinicalPresetUpdate {\n  name?: string;\n  description?: string;\n  icon?: string;\n  context?: PresetContext;\n}\n\n// ============================================================================\n// Settings Types\n// ============================================================================\n\nexport interface UserSettings {\n  theme: \"light\" | \"dark\" | \"auto\";\n  language: string;\n  voiceConfig: VoiceConfig;\n  notifications: NotificationSettings;\n}\n\nexport interface NotificationSettings {\n  email: boolean;\n  push: boolean;\n  inApp: boolean;\n}\n\n// ============================================================================\n// Admin Types\n// ============================================================================\n\nexport interface SystemMetrics {\n  activeUsers: number;\n  totalConversations: number;\n  totalMessages: number;\n  documentsIndexed: number;\n  avgResponseTime: number;\n  uptime: number;\n}\n\nexport interface AuditLogEntry {\n  id: string;\n  userId: string;\n  action: string;\n  resource: string;\n  timestamp: string;\n  ipAddress: string;\n  userAgent: string;\n  metadata?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Admin Integrations Types (Sprint 2)\n// ============================================================================\n\nexport type IntegrationStatus =\n  | \"connected\"\n  | \"disconnected\"\n  | \"error\"\n  | \"degraded\"\n  | \"not_configured\";\n\nexport type IntegrationType =\n  | \"database\"\n  | \"cache\"\n  | \"vector_db\"\n  | \"storage\"\n  | \"llm\"\n  | \"tts\"\n  | \"stt\"\n  | \"realtime\"\n  | \"oauth\"\n  | \"monitoring\"\n  | \"external_api\";\n\nexport interface IntegrationSummary {\n  id: string;\n  name: string;\n  type: IntegrationType;\n  status: IntegrationStatus;\n  provider: string;\n  lastChecked?: string;\n  errorMessage?: string;\n}\n\nexport interface IntegrationConfig {\n  host?: string;\n  port?: number;\n  enabled?: boolean;\n  timeoutSec?: number;\n  model?: string;\n  endpoint?: string;\n  extra?: Record<string, unknown>;\n}\n\nexport interface IntegrationDetail {\n  id: string;\n  name: string;\n  type: IntegrationType;\n  status: IntegrationStatus;\n  provider: string;\n  description: string;\n  config: IntegrationConfig;\n  hasApiKey: boolean;\n  lastChecked?: string;\n  errorMessage?: string;\n  metrics?: IntegrationMetrics;\n}\n\nexport interface IntegrationConfigUpdate {\n  enabled?: boolean;\n  timeoutSec?: number;\n  model?: string;\n  endpoint?: string;\n  extra?: Record<string, unknown>;\n}\n\nexport interface IntegrationTestResult {\n  success: boolean;\n  latencyMs: number;\n  message: string;\n  details?: Record<string, unknown>;\n}\n\nexport interface IntegrationMetrics {\n  integrationId: string;\n  totalRequests: number;\n  successfulRequests: number;\n  failedRequests: number;\n  avgLatencyMs: number;\n  p99LatencyMs: number;\n  lastError?: string;\n  lastErrorTime?: string;\n}\n\nexport interface IntegrationsHealthSummary {\n  overallStatus: \"healthy\" | \"degraded\" | \"unhealthy\" | \"critical\";\n  totalIntegrations: number;\n  connected: number;\n  degraded: number;\n  errors: number;\n  notConfigured: number;\n  checkedAt: string;\n}\n\n// ============================================================================\n// Admin PHI & Security Types (Sprint 3)\n// ============================================================================\n\nexport type PHIRuleStatus = \"enabled\" | \"disabled\";\n\nexport type PHIRuleType =\n  | \"ssn\"\n  | \"phone\"\n  | \"email\"\n  | \"mrn\"\n  | \"account\"\n  | \"ip_address\"\n  | \"url\"\n  | \"dob\"\n  | \"name\"\n  | \"address\"\n  | \"credit_card\";\n\nexport type PHIRoutingMode = \"local_only\" | \"cloud_allowed\" | \"hybrid\";\n\nexport interface PHIRule {\n  id: string;\n  name: string;\n  description: string;\n  phiType: PHIRuleType;\n  status: PHIRuleStatus;\n  pattern?: string;\n  isBuiltin: boolean;\n  detectionCount: number;\n  lastDetection?: string;\n}\n\nexport interface PHIRuleUpdate {\n  status: PHIRuleStatus;\n}\n\nexport interface PHITestRequest {\n  text: string;\n  includeRedacted?: boolean;\n}\n\nexport interface PHITestResult {\n  containsPhi: boolean;\n  phiTypes: string[];\n  confidence: number;\n  details: Record<string, unknown>;\n  redactedText?: string;\n}\n\nexport interface PHIRedactResult {\n  originalLength: number;\n  redactedLength: number;\n  redactionCount: number;\n  redactedText: string;\n}\n\nexport interface PHIRoutingConfig {\n  mode: PHIRoutingMode;\n  confidenceThreshold: number;\n  localLlmEnabled: boolean;\n  localLlmUrl?: string;\n  redactBeforeCloud: boolean;\n  auditAllPhi: boolean;\n}\n\nexport interface PHIRoutingUpdate {\n  mode?: PHIRoutingMode;\n  confidenceThreshold?: number;\n  redactBeforeCloud?: boolean;\n  auditAllPhi?: boolean;\n}\n\nexport interface PHIStats {\n  totalDetections: number;\n  detectionsToday: number;\n  detectionsThisWeek: number;\n  byType: Record<string, number>;\n  byDay: Array<{\n    date: string;\n    count: number;\n    byType: Record<string, number>;\n  }>;\n  routingStats: {\n    routedLocal: number;\n    redactedCloud: number;\n    blocked: number;\n  };\n}\n\nexport interface PHIEvent {\n  id: string;\n  timestamp: string;\n  phiTypes: string[];\n  confidence: number;\n  actionTaken: string;\n  userId?: string;\n  sessionId?: string;\n}\n\nexport interface PHIHealthStatus {\n  overall: \"healthy\" | \"degraded\" | \"unhealthy\";\n  components: {\n    detector: string;\n    redisConfig: string;\n    localLlm: string;\n    auditLogging: string;\n  };\n  routingMode: PHIRoutingMode;\n  timestamp: string;\n}\n\nexport interface PHIRulesResponse {\n  rules: PHIRule[];\n  total: number;\n  enabled: number;\n}\n\nexport interface PHIEventsResponse {\n  events: PHIEvent[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\n// ============================================================================\n// Admin Medical AI Types (Sprint 4)\n// ============================================================================\n\nexport type ModelProvider = \"openai\" | \"anthropic\" | \"local\";\nexport type ModelType = \"chat\" | \"embedding\" | \"tts\" | \"stt\";\n\nexport interface ModelInfo {\n  id: string;\n  name: string;\n  provider: ModelProvider;\n  type: ModelType;\n  enabled: boolean;\n  isPrimary: boolean;\n  supportsPhi: boolean;\n  contextWindow: number;\n  costPer1kInput: number;\n  costPer1kOutput: number;\n}\n\nexport interface ModelUsageMetrics {\n  totalRequests24h: number;\n  totalTokensInput24h: number;\n  totalTokensOutput24h: number;\n  estimatedCost24h: number;\n  avgLatencyMs: number;\n  p95LatencyMs: number;\n  errorRate: number;\n  cloudRequests: number;\n  localRequests: number;\n  cloudPercentage: number;\n  modelBreakdown: ModelBreakdown[];\n  periodDays: number;\n  timestamp: string;\n}\n\nexport interface ModelBreakdown {\n  modelId: string;\n  modelName: string;\n  provider: ModelProvider;\n  requests: number;\n  tokensInput: number;\n  tokensOutput: number;\n  estimatedCost: number;\n  avgLatencyMs: number;\n}\n\nexport interface SearchStats {\n  totalSearches24h: number;\n  avgLatencyMs: number;\n  p95LatencyMs: number;\n  cacheHitRate: number;\n  topQueries: Array<{ query: string; count: number }>;\n  searchTypes: {\n    semantic: number;\n    keyword: number;\n    hybrid: number;\n  };\n  noResultsRate: number;\n  periodDays: number;\n  timestamp: string;\n}\n\nexport interface EmbeddingStats {\n  totalDocuments: number;\n  totalChunks: number;\n  totalEmbeddings: number;\n  embeddingDimensions: number;\n  indexSizeMb: number;\n  lastIndexedAt?: string;\n  timestamp: string;\n}\n\nexport interface ModelRoutingConfig {\n  phiDetectionEnabled: boolean;\n  phiRouteToLocal: boolean;\n  defaultChatModel: string;\n  defaultEmbeddingModel: string;\n  fallbackEnabled: boolean;\n  fallbackModel?: string;\n  timestamp: string;\n}\n\nexport interface ModelRoutingUpdate {\n  phiDetectionEnabled?: boolean;\n  phiRouteToLocal?: boolean;\n  defaultChatModel?: string;\n  defaultEmbeddingModel?: string;\n  fallbackEnabled?: boolean;\n  fallbackModel?: string;\n}\n\n// ============================================================================\n// Admin System Types (Sprint 4)\n// ============================================================================\n\nexport interface ResourceMetrics {\n  diskTotalGb: number;\n  diskUsedGb: number;\n  diskFreeGb: number;\n  diskUsagePercent: number;\n  memoryTotalGb: number;\n  memoryUsedGb: number;\n  memoryFreeGb: number;\n  memoryUsagePercent: number;\n  cpuCount: number;\n  cpuUsagePercent: number;\n  loadAverage1m: number;\n  loadAverage5m: number;\n  loadAverage15m: number;\n  timestamp: string;\n}\n\nexport type BackupResult = \"success\" | \"failed\" | \"in_progress\" | \"unknown\";\nexport type BackupType = \"full\" | \"incremental\";\n\nexport interface BackupStatus {\n  lastBackupAt?: string;\n  lastBackupResult: BackupResult;\n  backupDestination: string;\n  schedule: string;\n  retentionDays: number;\n  nextScheduledAt?: string;\n  backupSizeMb?: number;\n  timestamp: string;\n}\n\nexport interface BackupHistoryEntry {\n  id: string;\n  startedAt: string;\n  completedAt?: string;\n  status: BackupResult;\n  sizeBytes?: number;\n  backupType: BackupType;\n  errorMessage?: string;\n}\n\nexport interface BackupTriggerResult {\n  message: string;\n  backupId: string;\n  backupType: BackupType;\n  status: BackupResult;\n  timestamp: string;\n}\n\nexport interface MaintenanceStatus {\n  enabled: boolean;\n  startedAt?: string;\n  startedBy?: string;\n  message?: string;\n  estimatedEnd?: string;\n  timestamp: string;\n}\n\nexport interface MaintenanceRequest {\n  message?: string;\n  estimatedDurationMinutes?: number;\n}\n\nexport type SystemHealthStatus = \"healthy\" | \"degraded\" | \"unhealthy\";\n\nexport interface SystemHealth {\n  status: SystemHealthStatus;\n  uptimeSeconds: number;\n  services: Record<string, string>;\n  lastCheckedAt: string;\n}\n\n// ============================================================================\n// Admin Cache Types (Sprint 4 Enhanced)\n// ============================================================================\n\nexport interface CacheStats {\n  l1Size: number;\n  l1MaxSize: number;\n  l1Utilization: number;\n  l2UsedMemory: number;\n  l2UsedMemoryHuman: string;\n  l2ConnectedClients: number;\n}\n\nexport interface CacheNamespaceStats {\n  namespace: string;\n  keyCount: number;\n  estimatedSizeBytes: number;\n}\n\nexport interface CacheNamespacesResponse {\n  namespaces: CacheNamespaceStats[];\n  totalNamespaces: number;\n}\n\nexport interface CacheInvalidateResult {\n  pattern?: string;\n  namespace?: string;\n  deletedCount: number;\n  message: string;\n}\n\n// ============================================================================\n// Admin Conversations Types\n// ============================================================================\n\nexport interface AdminConversation {\n  id: string;\n  userId: string;\n  userEmail?: string;\n  title: string;\n  messageCount: number;\n  branchCount: number;\n  model?: string;\n  folderName?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface AdminConversationsResponse {\n  conversations: AdminConversation[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\nexport interface AdminMessage {\n  id: string;\n  sessionId: string;\n  role: \"user\" | \"assistant\" | \"system\";\n  content: string;\n  createdAt: string;\n  tokensUsed?: number;\n  model?: string;\n  branchId?: string;\n  parentMessageId?: string;\n  attachments?: AdminAttachment[];\n  metadata?: Record<string, unknown>;\n}\n\nexport interface AdminMessagesResponse {\n  messages: AdminMessage[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\nexport interface AdminConversationExport {\n  content: string;\n  format: \"json\" | \"markdown\";\n}\n\n// ============================================================================\n// Admin Clinical Contexts Types\n// ============================================================================\n\nexport interface AdminClinicalContext {\n  id: string;\n  userId: string;\n  userEmail?: string;\n  sessionId?: string;\n  createdAt: string;\n  lastUpdated: string;\n  /** Demographics summary (age, gender) - always visible */\n  demographicsSummary?: string;\n  /** Medication count - always visible */\n  medicationsCount: number;\n  /** Allergies count - always visible */\n  allergiesCount: number;\n  /** Problems count - always visible */\n  problemsCount: number;\n  /** Full context data - only when includePhi is true */\n  fullContext?: ClinicalContext;\n}\n\nexport interface AdminClinicalContextsResponse {\n  contexts: AdminClinicalContext[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\nexport interface AdminClinicalContextStats {\n  totalContexts: number;\n  activeContexts24h: number;\n  avgMedicationsPerContext: number;\n  avgAllergiesPerContext: number;\n  avgProblemsPerContext: number;\n  contextsByDay: Array<{\n    date: string;\n    count: number;\n  }>;\n}\n\nexport interface AdminPHIAccessLog {\n  id: string;\n  adminUserId: string;\n  adminEmail: string;\n  contextId: string;\n  accessedAt: string;\n  ipAddress?: string;\n  userAgent?: string;\n}\n\nexport interface AdminPHIAuditResponse {\n  logs: AdminPHIAccessLog[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\n// ============================================================================\n// Admin Attachments Types\n// ============================================================================\n\nexport interface AdminAttachment {\n  id: string;\n  messageId: string;\n  userId: string;\n  userEmail?: string;\n  fileName: string;\n  fileType: string;\n  fileSize: number;\n  mimeType?: string;\n  uploadedAt: string;\n}\n\nexport interface AdminAttachmentsResponse {\n  attachments: AdminAttachment[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\nexport interface AdminAttachmentStats {\n  totalAttachments: number;\n  totalSizeBytes: number;\n  byFileType: Record<string, { count: number; sizeBytes: number }>;\n  uploadsByDay: Array<{\n    date: string;\n    count: number;\n    sizeBytes: number;\n  }>;\n}\n\n// ============================================================================\n// Admin Folders Types\n// ============================================================================\n\nexport interface AdminFolder {\n  id: string;\n  userId: string;\n  userEmail?: string;\n  name: string;\n  color?: string;\n  icon?: string;\n  parentFolderId?: string;\n  conversationCount: number;\n  depth: number;\n  createdAt: string;\n}\n\nexport interface AdminFoldersResponse {\n  folders: AdminFolder[];\n  total: number;\n  limit: number;\n  offset: number;\n}\n\nexport interface AdminFolderStats {\n  totalFolders: number;\n  avgConversationsPerFolder: number;\n  maxDepth: number;\n  foldersWithSubfolders: number;\n}\n\n// ============================================================================\n// Admin Voice & TT Pipeline Types\n// ============================================================================\n\nexport interface AdminVoiceSession {\n  sessionId: string;\n  userId: string;\n  userEmail?: string;\n  connectedAt: string;\n  sessionType: \"text\" | \"voice\" | \"realtime\";\n  clientInfo: Record<string, unknown>;\n  messagesCount: number;\n  lastActivity?: string;\n}\n\nexport interface AdminVoiceSessionDetail extends AdminVoiceSession {\n  conversationId?: string;\n  voice?: string;\n  language?: string;\n  durationSeconds?: number;\n  audioFormat?: string;\n}\n\nexport interface AdminVoiceSessionsResponse {\n  sessions: AdminVoiceSession[];\n  total: number;\n}\n\nexport interface AdminVoiceMetrics {\n  activeSessions: number;\n  totalSessions24h: number;\n  avgSessionDurationSec: number;\n  sttLatencyP95Ms: number;\n  ttsLatencyP95Ms: number;\n  errorRate24h: number;\n  connectionsByType: Record<string, number>;\n  timestamp: string;\n}\n\nexport interface AdminVoiceHealth {\n  status: \"healthy\" | \"degraded\" | \"unhealthy\";\n  realtimeApiEnabled: boolean;\n  openaiApiConfigured: boolean;\n  redisConnected: boolean;\n  activeConnections: number;\n  details: Record<string, unknown>;\n  timestamp: string;\n}\n\nexport interface AdminVoiceConfig {\n  defaultVoice: string;\n  defaultLanguage: string;\n  vadEnabled: boolean;\n  vadThreshold: number;\n  maxSessionDurationSec: number;\n  sttProvider: string;\n  ttsProvider: string;\n  realtimeEnabled: boolean;\n  timestamp: string;\n}\n\n// TT Pipeline Types\nexport type TTSessionState = \"idle\" | \"listening\" | \"thinking\" | \"speaking\";\n\nexport interface AdminTTSession {\n  sessionId: string;\n  userId: string;\n  userEmail?: string;\n  state: TTSessionState;\n  connectedAt: string;\n  lastActivity: string;\n  thinkerModel?: string;\n  talkerVoice?: string;\n  messagesProcessed: number;\n  avgResponseTimeMs?: number;\n}\n\nexport interface AdminTTSessionsResponse {\n  sessions: AdminTTSession[];\n  total: number;\n}\n\nexport interface AdminTTContext {\n  contextId: string;\n  sessionId: string;\n  userId: string;\n  createdAt: string;\n  lastAccessed: string;\n  messageCount: number;\n  tokenCount: number;\n  expiresAt: string;\n}\n\nexport interface AdminTTContextsResponse {\n  contexts: AdminTTContext[];\n  total: number;\n}\n\nexport interface AdminQualityPreset {\n  name: string;\n  description: string;\n  ttsModel: string;\n  voiceId: string;\n  speed: number;\n  isDefault: boolean;\n}\n\nexport interface AdminQualityPresetsResponse {\n  presets: AdminQualityPreset[];\n}\n\nexport interface AdminTTAnalytics {\n  totalToolCalls24h: number;\n  avgToolLatencyMs: number;\n  toolSuccessRate: number;\n  toolsByFrequency: Record<string, number>;\n  kbCalls24h: number;\n  kbAvgLatencyMs: number;\n}\n\nexport interface AdminContextCleanupResult {\n  cleanedCount: number;\n}\n\n// ============================================================================\n// Admin Real-time Event Types\n// ============================================================================\n\nexport type AdminEventType =\n  | \"session.connected\"\n  | \"session.disconnected\"\n  | \"conversation.created\"\n  | \"conversation.updated\"\n  | \"message.created\"\n  | \"clinical_context.updated\"\n  | \"attachment.uploaded\"\n  | \"phi.accessed\"\n  | \"voice.session_started\"\n  | \"voice.session_ended\"\n  | \"tt.state_changed\"\n  | \"system.alert\";\n\nexport interface AdminRealtimeEvent {\n  type: AdminEventType;\n  timestamp: string;\n  userId?: string;\n  userEmail?: string;\n  sessionId?: string;\n  resourceId?: string;\n  data?: Record<string, unknown>;\n}\n\nexport interface AdminEventSubscription {\n  eventTypes: AdminEventType[];\n  userFilter?: string[];\n  callback: (event: AdminRealtimeEvent) => void;\n}\n\n// ============================================================================\n// Utility Types\n// ============================================================================\n\nexport type Nullable<T> = T | null;\nexport type Optional<T> = T | undefined;\nexport type DeepPartial<T> = {\n  [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P];\n};\n\n// ============================================================================\n// Error Handling Utilities\n// ============================================================================\n\n/**\n * Type guard to check if an error has a message property\n */\nexport function isErrorWithMessage(err: unknown): err is { message: string } {\n  return (\n    typeof err === \"object\" &&\n    err !== null &&\n    \"message\" in err &&\n    typeof (err as { message: unknown }).message === \"string\"\n  );\n}\n\n/**\n * Safely extracts an error message from an unknown error type.\n * Handles Error instances, objects with message property, and strings.\n * This replaces the need for `catch (err: any)` patterns.\n *\n * @example\n * try {\n *   await fetchData();\n * } catch (err: unknown) {\n *   setError(extractErrorMessage(err));\n * }\n */\nexport function extractErrorMessage(err: unknown): string {\n  if (err instanceof Error) return err.message;\n  if (isErrorWithMessage(err)) return err.message;\n  if (typeof err === \"string\") return err;\n  return \"An unknown error occurred\";\n}\n\n// ============================================================================\n// Feature Flag Types (Phase 7 Enhancement)\n// ============================================================================\n\nexport * from \"./featureFlags\";\n"
}
