{
  "path": "apps/web-app/src/components/conversations/ConversationsSidebar.tsx",
  "language": "typescript",
  "size": 29788,
  "last_modified": "2025-12-01T09:35:55.885Z",
  "lines": 772,
  "content": "/**\n * Conversations Sidebar\n * Displays list of conversations with search, folder organization, and management\n */\n\nimport { useState, useMemo } from \"react\";\nimport { Link, useParams } from \"react-router-dom\";\nimport { Button, Input } from \"@voiceassist/ui\";\nimport { useConversations } from \"../../hooks/useConversations\";\nimport { useFolders } from \"../../hooks/useFolders\";\nimport { FolderDialog } from \"../folders/FolderDialog\";\nimport { DeleteAllConfirmDialog } from \"../sidebar/DeleteAllConfirmDialog\";\nimport { useToastContext } from \"../../contexts/ToastContext\";\nimport type { Folder } from \"@voiceassist/types\";\n\nexport function ConversationsSidebar() {\n  const { conversationId } = useParams<{ conversationId: string }>();\n  const toast = useToastContext();\n\n  const {\n    conversations,\n    allConversations,\n    isLoading,\n    error,\n    searchQuery,\n    setSearchQuery,\n    showArchived,\n    setShowArchived,\n    createConversation,\n    archiveConversation,\n    unarchiveConversation,\n    deleteConversation,\n    deleteAllConversations,\n    exportConversation,\n    updateConversation,\n  } = useConversations();\n\n  const { folders, createFolder, updateFolder, deleteFolder } = useFolders();\n\n  const [isCreating, setIsCreating] = useState(false);\n  const [menuOpenId, setMenuOpenId] = useState<string | null>(null);\n  const [isFolderDialogOpen, setIsFolderDialogOpen] = useState(false);\n  const [folderDialogMode, setFolderDialogMode] = useState<\"create\" | \"edit\">(\n    \"create\",\n  );\n  const [editingFolder, setEditingFolder] = useState<Folder | null>(null);\n  const [folderMenuOpenId, setFolderMenuOpenId] = useState<string | null>(null);\n  const [selectedFolderId, setSelectedFolderId] = useState<string | null>(null);\n  const [expandedFolderIds, setExpandedFolderIds] = useState<Set<string>>(\n    new Set(),\n  );\n  const [showFolders, setShowFolders] = useState(true);\n  const [movingConversationId, setMovingConversationId] = useState<\n    string | null\n  >(null);\n  const [isDeleteAllDialogOpen, setIsDeleteAllDialogOpen] = useState(false);\n  const [isDeletingAll, setIsDeletingAll] = useState(false);\n\n  const handleCreateConversation = async () => {\n    setIsCreating(true);\n    try {\n      await createConversation(\"New Conversation\");\n    } catch (err) {\n      console.error(\"Failed to create conversation:\", err);\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const handleArchive = async (id: string, archived: boolean) => {\n    try {\n      if (archived) {\n        await unarchiveConversation(id);\n      } else {\n        await archiveConversation(id);\n      }\n      setMenuOpenId(null);\n    } catch (err) {\n      console.error(\"Failed to archive conversation:\", err);\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    if (!confirm(\"Are you sure you want to delete this conversation?\")) return;\n\n    try {\n      await deleteConversation(id);\n      setMenuOpenId(null);\n    } catch (err) {\n      console.error(\"Failed to delete conversation:\", err);\n    }\n  };\n\n  const handleExport = async (id: string, format: \"markdown\" | \"text\") => {\n    try {\n      await exportConversation(id, format);\n      setMenuOpenId(null);\n    } catch (err) {\n      console.error(\"Failed to export conversation:\", err);\n    }\n  };\n\n  const handleDeleteAll = async () => {\n    setIsDeletingAll(true);\n    try {\n      const result = await deleteAllConversations();\n      setIsDeleteAllDialogOpen(false);\n      toast?.success(\n        `Deleted ${result.deleted_count} conversation${result.deleted_count !== 1 ? \"s\" : \"\"}`,\n      );\n    } catch (err) {\n      console.error(\"Failed to delete all conversations:\", err);\n      toast?.error(\"Failed to delete all conversations\");\n    } finally {\n      setIsDeletingAll(false);\n    }\n  };\n\n  const handleMoveToFolder = async (\n    conversationId: string,\n    folderId: string | null,\n  ) => {\n    try {\n      await updateConversation(conversationId, { folderId });\n      setMovingConversationId(null);\n      setMenuOpenId(null);\n      toast?.success(\n        `Conversation moved to ${folderId ? \"folder\" : \"root level\"}`,\n      );\n    } catch (err) {\n      console.error(\"Failed to move conversation:\", err);\n      toast?.error(\"Failed to move conversation\");\n    }\n  };\n\n  const handleCreateFolder = () => {\n    setFolderDialogMode(\"create\");\n    setEditingFolder(null);\n    setIsFolderDialogOpen(true);\n  };\n\n  const handleEditFolder = (folder: Folder) => {\n    setFolderDialogMode(\"edit\");\n    setEditingFolder(folder);\n    setFolderMenuOpenId(null);\n    setIsFolderDialogOpen(true);\n  };\n\n  const handleDeleteFolder = async (folderId: string) => {\n    if (\n      !confirm(\n        \"Are you sure you want to delete this folder? Conversations in this folder will be moved to the root.\",\n      )\n    ) {\n      return;\n    }\n    try {\n      await deleteFolder(folderId);\n      setFolderMenuOpenId(null);\n      if (selectedFolderId === folderId) {\n        setSelectedFolderId(null);\n      }\n      toast?.success(\"Folder deleted\");\n    } catch (err) {\n      console.error(\"Failed to delete folder:\", err);\n      toast?.error(\"Failed to delete folder\");\n    }\n  };\n\n  const handleSaveFolder = async (\n    name: string,\n    color?: string | null,\n    icon?: string | null,\n  ) => {\n    if (folderDialogMode === \"create\") {\n      await createFolder({ name, color, icon });\n      toast?.success(\"Folder created\");\n    } else if (editingFolder) {\n      await updateFolder(editingFolder.id, { name, color, icon });\n      toast?.success(\"Folder updated\");\n    }\n  };\n\n  const toggleFolder = (folderId: string) => {\n    setExpandedFolderIds((prev) => {\n      const next = new Set(prev);\n      if (next.has(folderId)) {\n        next.delete(folderId);\n      } else {\n        next.add(folderId);\n      }\n      return next;\n    });\n  };\n\n  const renderFolderTree = (\n    folderList: typeof folders,\n    level: number = 0,\n  ): JSX.Element[] => {\n    return folderList.map((folder) => {\n      const isExpanded = expandedFolderIds.has(folder.id);\n      const isSelected = selectedFolderId === folder.id;\n      const hasChildren = folder.children && folder.children.length > 0;\n      const isMenuOpen = folderMenuOpenId === folder.id;\n\n      return (\n        <div key={folder.id} className=\"relative group\">\n          <button\n            onClick={() => setSelectedFolderId(folder.id)}\n            className={`w-full flex items-center px-4 py-2 text-sm hover:bg-neutral-100 ${\n              isSelected ? \"bg-primary-50\" : \"\"\n            }`}\n            style={{ paddingLeft: `${16 + level * 16}px` }}\n          >\n            {hasChildren && (\n              <span\n                onClick={(e) => {\n                  e.stopPropagation();\n                  toggleFolder(folder.id);\n                }}\n                className=\"mr-1 text-neutral-600 cursor-pointer\"\n              >\n                {isExpanded ? \"‚ñº\" : \"‚ñ∂\"}\n              </span>\n            )}\n            <span\n              className=\"mr-2\"\n              style={folder.color ? { color: folder.color } : undefined}\n            >\n              {folder.icon || \"üìÅ\"}\n            </span>\n            <span className=\"flex-1 text-left truncate\">{folder.name}</span>\n            {/* Folder menu button */}\n            <span\n              onClick={(e) => {\n                e.stopPropagation();\n                setFolderMenuOpenId(isMenuOpen ? null : folder.id);\n              }}\n              className=\"opacity-0 group-hover:opacity-100 p-1 hover:bg-neutral-200 rounded transition-opacity\"\n            >\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={2}\n                stroke=\"currentColor\"\n                className=\"w-3 h-3 text-neutral-600\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z\"\n                />\n              </svg>\n            </span>\n          </button>\n          {/* Folder context menu */}\n          {isMenuOpen && (\n            <div className=\"absolute left-full top-0 ml-1 w-36 bg-white border border-neutral-200 rounded-md shadow-lg z-20\">\n              <button\n                onClick={() => handleEditFolder(folder)}\n                className=\"w-full px-3 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={1.5}\n                  stroke=\"currentColor\"\n                  className=\"w-4 h-4\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z\"\n                  />\n                </svg>\n                <span>Edit</span>\n              </button>\n              <button\n                onClick={() => handleDeleteFolder(folder.id)}\n                className=\"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={1.5}\n                  stroke=\"currentColor\"\n                  className=\"w-4 h-4\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0\"\n                  />\n                </svg>\n                <span>Delete</span>\n              </button>\n            </div>\n          )}\n          {isExpanded &&\n            hasChildren &&\n            renderFolderTree(folder.children!, level + 1)}\n        </div>\n      );\n    });\n  };\n\n  const filteredConversations = useMemo(() => {\n    let filtered = conversations;\n\n    // Filter by folder\n    if (selectedFolderId !== null) {\n      filtered = filtered.filter((conv) => conv.folderId === selectedFolderId);\n    } else if (selectedFolderId === \"root\") {\n      filtered = filtered.filter((conv) => !conv.folderId);\n    }\n\n    return filtered;\n  }, [conversations, selectedFolderId]);\n\n  const formatDate = (timestamp: number): string => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n\n    if (days === 0) return \"Today\";\n    if (days === 1) return \"Yesterday\";\n    if (days < 7) return `${days} days ago`;\n    return date.toLocaleDateString(\"en-US\", { month: \"short\", day: \"numeric\" });\n  };\n\n  return (\n    <div className=\"w-80 h-full bg-white border-r border-neutral-200 flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-neutral-200\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <h2 className=\"text-lg font-semibold text-neutral-900\">\n            Conversations\n          </h2>\n          <Button\n            onClick={handleCreateConversation}\n            disabled={isCreating}\n            size=\"sm\"\n            aria-label=\"New conversation\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n              className=\"w-4 h-4 mr-1\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M12 4.5v15m7.5-7.5h-15\"\n              />\n            </svg>\n            New\n          </Button>\n        </div>\n\n        {/* Search */}\n        <div className=\"relative\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={1.5}\n            stroke=\"currentColor\"\n            className=\"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"\n            />\n          </svg>\n          <Input\n            type=\"text\"\n            placeholder=\"Search conversations...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n\n        {/* Archive Toggle */}\n        <button\n          onClick={() => setShowArchived(!showArchived)}\n          className=\"mt-2 text-sm text-neutral-600 hover:text-neutral-900 flex items-center space-x-1\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={1.5}\n            stroke=\"currentColor\"\n            className=\"w-4 h-4\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z\"\n            />\n          </svg>\n          <span>{showArchived ? \"Show Active\" : \"Show Archived\"}</span>\n        </button>\n\n        {/* Folders Toggle */}\n        <button\n          onClick={() => setShowFolders(!showFolders)}\n          className=\"mt-2 text-sm text-neutral-600 hover:text-neutral-900 flex items-center space-x-1\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={1.5}\n            stroke=\"currentColor\"\n            className=\"w-4 h-4\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z\"\n            />\n          </svg>\n          <span>{showFolders ? \"Hide Folders\" : \"Show Folders\"}</span>\n        </button>\n      </div>\n\n      {/* Folder Tree */}\n      {showFolders && (\n        <div className=\"border-b border-neutral-200 max-h-64 overflow-y-auto\">\n          {/* New Folder Button */}\n          <button\n            onClick={handleCreateFolder}\n            className=\"w-full flex items-center px-4 py-2 text-sm text-primary-600 hover:bg-primary-50 border-b border-neutral-100\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-4 h-4 mr-2\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M12 4.5v15m7.5-7.5h-15\"\n              />\n            </svg>\n            <span className=\"font-medium\">New Folder</span>\n          </button>\n\n          {/* All Conversations (root) */}\n          <button\n            onClick={() => setSelectedFolderId(null)}\n            className={`w-full flex items-center px-4 py-2 text-sm hover:bg-neutral-100 ${\n              selectedFolderId === null ? \"bg-primary-50\" : \"\"\n            }`}\n          >\n            <span className=\"mr-2\">üìÇ</span>\n            <span className=\"flex-1 text-left font-medium\">\n              All Conversations\n            </span>\n          </button>\n\n          {/* Render folder tree */}\n          {folders.length > 0 && renderFolderTree(folders)}\n        </div>\n      )}\n\n      {/* Conversations List */}\n      <div className=\"flex-1 overflow-y-auto\">\n        {isLoading && (\n          <div className=\"p-4 text-center\">\n            <div className=\"w-8 h-8 mx-auto rounded-full border-4 border-primary-500 border-t-transparent animate-spin\" />\n            <p className=\"mt-2 text-sm text-neutral-600\">Loading...</p>\n          </div>\n        )}\n\n        {error && (\n          <div className=\"p-4 m-4 bg-red-50 rounded-md border border-red-200\">\n            <p className=\"text-sm text-red-800\">{error}</p>\n          </div>\n        )}\n\n        {!isLoading && filteredConversations.length === 0 && (\n          <div className=\"p-4 text-center\">\n            <p className=\"text-sm text-neutral-600\">\n              {searchQuery ? \"No conversations found\" : \"No conversations yet\"}\n            </p>\n          </div>\n        )}\n\n        {!isLoading &&\n          filteredConversations.map((conversation) => (\n            <div\n              key={conversation.id}\n              className={`relative group ${\n                conversationId === conversation.id\n                  ? \"bg-primary-50\"\n                  : \"hover:bg-neutral-50\"\n              }`}\n            >\n              <Link\n                to={`/chat/${conversation.id}`}\n                className=\"block p-4 border-b border-neutral-100\"\n              >\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex-1 min-w-0 pr-8\">\n                    <h3 className=\"text-sm font-medium text-neutral-900 truncate\">\n                      {conversation.title || \"Untitled Conversation\"}\n                    </h3>\n                    <p className=\"text-xs text-neutral-500 mt-1\">\n                      {formatDate(\n                        new Date(\n                          conversation.updatedAt || conversation.createdAt,\n                        ).getTime(),\n                      )}\n                    </p>\n                  </div>\n\n                  {/* Menu Button */}\n                  <button\n                    onClick={(e) => {\n                      e.preventDefault();\n                      setMenuOpenId(\n                        menuOpenId === conversation.id ? null : conversation.id,\n                      );\n                    }}\n                    className=\"opacity-0 group-hover:opacity-100 p-1 hover:bg-neutral-200 rounded transition-opacity\"\n                    aria-label=\"Conversation options\"\n                  >\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                      strokeWidth={2}\n                      stroke=\"currentColor\"\n                      className=\"w-4 h-4 text-neutral-600\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </Link>\n\n              {/* Dropdown Menu */}\n              {menuOpenId === conversation.id && (\n                <div className=\"absolute right-4 top-12 w-48 bg-white border border-neutral-200 rounded-md shadow-lg z-10\">\n                  <button\n                    onClick={() =>\n                      handleArchive(\n                        conversation.id,\n                        conversation.archived || false,\n                      )\n                    }\n                    className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n                  >\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                      strokeWidth={1.5}\n                      stroke=\"currentColor\"\n                      className=\"w-4 h-4\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z\"\n                      />\n                    </svg>\n                    <span>\n                      {conversation.archived ? \"Unarchive\" : \"Archive\"}\n                    </span>\n                  </button>\n                  <div className=\"border-t border-neutral-200\">\n                    <button\n                      onClick={() => handleExport(conversation.id, \"markdown\")}\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3\"\n                        />\n                      </svg>\n                      <span>Export as Markdown</span>\n                    </button>\n                    <button\n                      onClick={() => handleExport(conversation.id, \"text\")}\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3\"\n                        />\n                      </svg>\n                      <span>Export as Text</span>\n                    </button>\n                  </div>\n                  <div className=\"border-t border-neutral-200\">\n                    <button\n                      onClick={() => setMovingConversationId(conversation.id)}\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z\"\n                        />\n                      </svg>\n                      <span>Move to Folder</span>\n                    </button>\n                  </div>\n                  <div className=\"border-t border-neutral-200\">\n                    <button\n                      onClick={() => handleDelete(conversation.id)}\n                      className=\"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0\"\n                        />\n                      </svg>\n                      <span>Delete</span>\n                    </button>\n                  </div>\n                </div>\n              )}\n\n              {/* Folder Picker Submenu */}\n              {movingConversationId === conversation.id && (\n                <div className=\"absolute right-4 top-12 w-56 bg-white border border-neutral-200 rounded-md shadow-lg z-20 max-h-96 overflow-y-auto\">\n                  <div className=\"p-2 border-b border-neutral-200 bg-neutral-50\">\n                    <p className=\"text-xs font-medium text-neutral-700\">\n                      Select Destination Folder\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => handleMoveToFolder(conversation.id, null)}\n                    className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n                  >\n                    <span className=\"mr-2\">üìÇ</span>\n                    <span>Root (No Folder)</span>\n                  </button>\n                  {folders.map((folder) => (\n                    <button\n                      key={folder.id}\n                      onClick={() =>\n                        handleMoveToFolder(conversation.id, folder.id)\n                      }\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-50 flex items-center space-x-2\"\n                    >\n                      <span className=\"mr-2\">{folder.icon || \"üìÅ\"}</span>\n                      <span className=\"truncate\">{folder.name}</span>\n                    </button>\n                  ))}\n                  <div className=\"border-t border-neutral-200\">\n                    <button\n                      onClick={() => setMovingConversationId(null)}\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-500 hover:bg-neutral-50\"\n                    >\n                      Cancel\n                    </button>\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n      </div>\n\n      {/* Sidebar Footer - Delete All */}\n      {allConversations.length > 0 && (\n        <div className=\"p-4 border-t border-neutral-200\">\n          <button\n            onClick={() => setIsDeleteAllDialogOpen(true)}\n            className=\"w-full flex items-center justify-center gap-2 px-3 py-2 text-sm\n                       text-red-600 hover:text-red-700 hover:bg-red-50\n                       rounded-lg transition-colors\"\n            data-testid=\"delete-all-button\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-4 h-4\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0\"\n              />\n            </svg>\n            Delete All Conversations\n          </button>\n        </div>\n      )}\n\n      {/* Folder Dialog */}\n      <FolderDialog\n        isOpen={isFolderDialogOpen}\n        onClose={() => {\n          setIsFolderDialogOpen(false);\n          setEditingFolder(null);\n        }}\n        onSave={handleSaveFolder}\n        folder={editingFolder}\n        mode={folderDialogMode}\n      />\n\n      {/* Delete All Confirmation Dialog */}\n      <DeleteAllConfirmDialog\n        isOpen={isDeleteAllDialogOpen}\n        conversationCount={allConversations.length}\n        onConfirm={handleDeleteAll}\n        onCancel={() => setIsDeleteAllDialogOpen(false)}\n        isDeleting={isDeletingAll}\n      />\n    </div>\n  );\n}\n"
}
