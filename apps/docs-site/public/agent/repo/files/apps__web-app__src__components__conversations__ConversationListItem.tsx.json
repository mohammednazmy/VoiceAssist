{
  "path": "apps/web-app/src/components/conversations/ConversationListItem.tsx",
  "language": "typescript",
  "size": 11186,
  "last_modified": "2025-11-29T04:27:41.404Z",
  "lines": 289,
  "content": "/**\n * ConversationListItem Component\n * Individual conversation item in the list\n */\n\nimport { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport type { Conversation } from \"@voiceassist/types\";\nimport { relativeTime } from \"@voiceassist/utils\";\n\nexport interface ConversationListItemProps {\n  conversation: Conversation;\n  isActive: boolean;\n  onRename: (id: string, newTitle: string) => Promise<void>;\n  onArchive: (id: string) => Promise<void>;\n  onDelete: (id: string) => Promise<void>;\n}\n\nexport function ConversationListItem({\n  conversation,\n  isActive,\n  onRename,\n  onArchive,\n  onDelete,\n}: ConversationListItemProps) {\n  const navigate = useNavigate();\n  const [isEditing, setIsEditing] = useState(false);\n  const [editedTitle, setEditedTitle] = useState(conversation.title);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);\n\n  const handleClick = () => {\n    if (!isEditing) {\n      navigate(`/chat/${conversation.id}`);\n    }\n  };\n\n  const handleRename = async () => {\n    if (editedTitle.trim() && editedTitle !== conversation.title) {\n      await onRename(conversation.id, editedTitle.trim());\n    }\n    setIsEditing(false);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      handleRename();\n    } else if (e.key === \"Escape\") {\n      setEditedTitle(conversation.title);\n      setIsEditing(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    setIsDeleting(true);\n    try {\n      await onDelete(conversation.id);\n      setShowDeleteConfirm(false);\n    } catch (error) {\n      console.error(\"Failed to delete conversation:\", error);\n      setIsDeleting(false);\n    }\n  };\n\n  const displayTitle =\n    conversation.title || `Conversation ${conversation.id.slice(0, 8)}`;\n  const preview = conversation.lastMessagePreview || \"No messages yet\";\n  const timeAgo = relativeTime(conversation.updatedAt);\n\n  return (\n    <>\n      <div\n        className={`group relative flex items-center px-3 py-2.5 rounded-md cursor-pointer transition-colors ${\n          isActive\n            ? \"bg-primary-50 border-l-2 border-primary-500\"\n            : \"hover:bg-neutral-100\"\n        }`}\n        onClick={handleClick}\n        role=\"button\"\n        tabIndex={0}\n        aria-label={`Conversation: ${displayTitle}`}\n        aria-current={isActive ? \"page\" : undefined}\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\" || e.key === \" \") {\n            e.preventDefault();\n            handleClick();\n          }\n        }}\n      >\n        <div className=\"flex-1 min-w-0\">\n          {isEditing ? (\n            <input\n              type=\"text\"\n              value={editedTitle}\n              onChange={(e) => setEditedTitle(e.target.value)}\n              onBlur={handleRename}\n              onKeyDown={handleKeyDown}\n              className=\"w-full px-2 py-1 text-sm font-medium border border-primary-500 rounded focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              autoFocus\n              onClick={(e) => e.stopPropagation()}\n            />\n          ) : (\n            <>\n              <h3\n                className={`text-sm font-medium truncate ${isActive ? \"text-primary-700\" : \"text-neutral-900\"}`}\n              >\n                {displayTitle}\n              </h3>\n              <p className=\"text-xs text-neutral-500 truncate mt-0.5\">\n                {preview}\n              </p>\n              <p className=\"text-xs text-neutral-400 mt-0.5\">{timeAgo}</p>\n            </>\n          )}\n        </div>\n\n        {/* Actions Menu */}\n        {!isEditing && (\n          <div className=\"relative ml-2\">\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsMenuOpen(!isMenuOpen);\n              }}\n              className=\"p-1 rounded opacity-0 group-hover:opacity-100 hover:bg-neutral-200 transition-opacity focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              aria-label=\"Conversation actions\"\n              aria-expanded={isMenuOpen}\n            >\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-4 h-4 text-neutral-600\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z\"\n                />\n              </svg>\n            </button>\n\n            {isMenuOpen && (\n              <>\n                {/* Backdrop */}\n                <div\n                  className=\"fixed inset-0 z-10\"\n                  onClick={() => setIsMenuOpen(false)}\n                  aria-hidden=\"true\"\n                />\n\n                {/* Menu */}\n                <div className=\"absolute right-0 top-full mt-1 w-48 bg-white rounded-md shadow-lg border border-neutral-200 z-20\">\n                  <div className=\"py-1\">\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setIsMenuOpen(false);\n                        setIsEditing(true);\n                      }}\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-100 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10\"\n                        />\n                      </svg>\n                      <span>Rename</span>\n                    </button>\n\n                    <button\n                      type=\"button\"\n                      onClick={async (e) => {\n                        e.stopPropagation();\n                        setIsMenuOpen(false);\n                        await onArchive(conversation.id);\n                      }}\n                      className=\"w-full px-4 py-2 text-left text-sm text-neutral-700 hover:bg-neutral-100 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0l-3-3m3 3l3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z\"\n                        />\n                      </svg>\n                      <span>Archive</span>\n                    </button>\n\n                    <hr className=\"my-1 border-neutral-200\" />\n\n                    <button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        setIsMenuOpen(false);\n                        setShowDeleteConfirm(true);\n                      }}\n                      className=\"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={1.5}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0\"\n                        />\n                      </svg>\n                      <span>Delete</span>\n                    </button>\n                  </div>\n                </div>\n              </>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Delete Confirmation Dialog */}\n      {showDeleteConfirm && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50\">\n          <div className=\"bg-white rounded-lg shadow-xl max-w-md w-full p-6\">\n            <h3 className=\"text-lg font-semibold text-neutral-900 mb-2\">\n              Delete Conversation?\n            </h3>\n            <p className=\"text-sm text-neutral-600 mb-6\">\n              This will permanently delete \"{displayTitle}\" and all its\n              messages. This action cannot be undone.\n            </p>\n            <div className=\"flex justify-end space-x-3\">\n              <button\n                type=\"button\"\n                onClick={() => setShowDeleteConfirm(false)}\n                disabled={isDeleting}\n                className=\"px-4 py-2 text-sm font-medium text-neutral-700 bg-neutral-100 rounded-md hover:bg-neutral-200 disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleDelete}\n                disabled={isDeleting}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 disabled:opacity-50 flex items-center space-x-2\"\n              >\n                {isDeleting ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    <span>Deleting...</span>\n                  </>\n                ) : (\n                  <span>Delete</span>\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"
}
