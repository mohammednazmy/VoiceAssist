{
  "path": "apps/admin-panel/src/components/knowledge/DocumentTable.tsx",
  "language": "typescript",
  "size": 11222,
  "last_modified": "2025-11-29T04:26:40.443Z",
  "lines": 339,
  "content": "import { useMemo, useState } from \"react\";\nimport type { KnowledgeDocument } from \"../../hooks/useKnowledgeDocuments\";\n\nexport type DocumentStatus = \"indexed\" | \"pending\" | \"reindexing\" | \"failed\";\n\nexport interface DocumentRow extends KnowledgeDocument {\n  status: DocumentStatus;\n  sizeMb?: number;\n  source?: string;\n}\n\ninterface DocumentTableProps {\n  documents: DocumentRow[];\n  loading?: boolean;\n  onDelete: (ids: string[]) => Promise<void> | void;\n  onReindex: (ids: string[]) => Promise<void> | void;\n  onOpenAudit: (doc: DocumentRow) => void;\n}\n\nexport function DocumentTable({\n  documents,\n  loading,\n  onDelete,\n  onReindex,\n  onOpenAudit,\n}: DocumentTableProps) {\n  const [selected, setSelected] = useState<Set<string>>(new Set());\n  const [selectAll, setSelectAll] = useState(false);\n\n  const toggleAll = () => {\n    if (selectAll) {\n      setSelected(new Set());\n      setSelectAll(false);\n      return;\n    }\n    setSelected(new Set(documents.map((d) => d.id)));\n    setSelectAll(true);\n  };\n\n  const toggleOne = (id: string) => {\n    setSelected((prev) => {\n      const next = new Set(prev);\n      if (next.has(id)) {\n        next.delete(id);\n      } else {\n        next.add(id);\n      }\n      setSelectAll(next.size === documents.length && documents.length > 0);\n      return next;\n    });\n  };\n\n  const bulkDelete = () => {\n    if (!selected.size) return;\n    onDelete(Array.from(selected));\n    setSelected(new Set());\n    setSelectAll(false);\n  };\n\n  const bulkReindex = () => {\n    if (!selected.size) return;\n    onReindex(Array.from(selected));\n    setSelected(new Set());\n    setSelectAll(false);\n  };\n\n  const statusBadge = (status: DocumentStatus) => {\n    const common = \"px-2 py-1 rounded-full text-xs font-medium\";\n    switch (status) {\n      case \"indexed\":\n        return (\n          <span\n            className={`${common} bg-emerald-500/10 text-emerald-200 border border-emerald-700/40`}\n          >\n            Indexed\n          </span>\n        );\n      case \"pending\":\n        return (\n          <span\n            className={`${common} bg-slate-700/40 text-slate-200 border border-slate-600`}\n          >\n            Pending\n          </span>\n        );\n      case \"reindexing\":\n        return (\n          <span\n            className={`${common} bg-blue-500/10 text-blue-200 border border-blue-700/40`}\n          >\n            Reindexing…\n          </span>\n        );\n      case \"failed\":\n      default:\n        return (\n          <span\n            className={`${common} bg-rose-500/10 text-rose-200 border border-rose-700/40`}\n          >\n            Failed\n          </span>\n        );\n    }\n  };\n\n  const selectedCount = selected.size;\n\n  const sortedDocs = useMemo(\n    () => [...documents].sort((a, b) => a.name.localeCompare(b.name)),\n    [documents],\n  );\n\n  // Mobile card view renderer\n  const renderMobileCards = () => {\n    if (loading) {\n      return Array.from({ length: 3 }).map((_, idx) => (\n        <div\n          key={idx}\n          className=\"bg-slate-900/50 border border-slate-800 rounded-lg p-4 animate-pulse space-y-3\"\n        >\n          <div className=\"h-4 w-3/4 bg-slate-800 rounded\" />\n          <div className=\"h-3 w-1/2 bg-slate-800 rounded\" />\n          <div className=\"flex gap-2\">\n            <div className=\"h-6 w-16 bg-slate-800 rounded\" />\n          </div>\n        </div>\n      ));\n    }\n\n    if (sortedDocs.length === 0) {\n      return (\n        <div className=\"p-6 text-center text-slate-400 bg-slate-900/50 border border-slate-800 rounded-lg\">\n          No documents found. Upload a PDF or text file to get started.\n        </div>\n      );\n    }\n\n    return sortedDocs.map((doc) => {\n      const isChecked = selected.has(doc.id);\n      return (\n        <div\n          key={doc.id}\n          className={`bg-slate-900/50 border rounded-lg p-4 space-y-3 ${\n            isChecked ? \"border-blue-700 bg-slate-900/80\" : \"border-slate-800\"\n          }`}\n        >\n          {/* Header with checkbox and title */}\n          <div className=\"flex items-start gap-3\">\n            <input\n              type=\"checkbox\"\n              className=\"h-4 w-4 mt-1 rounded border-slate-700 bg-slate-900 flex-shrink-0\"\n              checked={isChecked}\n              onChange={() => toggleOne(doc.id)}\n              aria-label={`Select ${doc.name}`}\n            />\n            <div className=\"min-w-0 flex-1\">\n              <div className=\"text-sm font-medium text-slate-200 break-words\">\n                {doc.name}\n              </div>\n              <div className=\"flex items-center gap-2 mt-1 flex-wrap\">\n                <span className=\"text-xs text-slate-400\">{doc.type}</span>\n                {statusBadge(doc.status)}\n              </div>\n            </div>\n          </div>\n\n          {/* Metadata */}\n          <div className=\"flex items-center gap-4 text-xs text-slate-500 flex-wrap\">\n            <span>Version: {doc.version ?? \"—\"}</span>\n            <span>\n              Size: {doc.sizeMb ? `${doc.sizeMb.toFixed(1)} MB` : \"—\"}\n            </span>\n            <span>\n              Indexed:{\" \"}\n              {doc.lastIndexedAt\n                ? new Date(doc.lastIndexedAt).toLocaleDateString()\n                : \"—\"}\n            </span>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center justify-end gap-3 pt-2 border-t border-slate-800\">\n            <button\n              className=\"text-xs text-slate-300 hover:text-white px-2 py-1\"\n              onClick={() => onOpenAudit(doc)}\n            >\n              Audit\n            </button>\n            <button\n              className=\"text-xs text-blue-300 hover:text-blue-100 px-2 py-1\"\n              onClick={() => onReindex([doc.id])}\n            >\n              Reindex\n            </button>\n            <button\n              className=\"text-xs text-rose-300 hover:text-rose-100 px-2 py-1\"\n              onClick={() => onDelete([doc.id])}\n            >\n              Delete\n            </button>\n          </div>\n        </div>\n      );\n    });\n  };\n\n  return (\n    <div className=\"bg-slate-900/60 border border-slate-800 rounded-lg overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-3 px-4 py-3 border-b border-slate-800\">\n        <div>\n          <div className=\"text-sm font-semibold text-slate-100\">Documents</div>\n          <p className=\"text-xs text-slate-500 hidden sm:block\">\n            Bulk select to delete or reindex. Audit opens per document.\n          </p>\n        </div>\n        {selectedCount > 0 && (\n          <div className=\"flex items-center gap-2\">\n            <button\n              className=\"px-3 py-1.5 text-xs rounded bg-rose-900/60 text-rose-100 border border-rose-700/60 hover:bg-rose-900\"\n              onClick={bulkDelete}\n            >\n              Delete ({selectedCount})\n            </button>\n            <button\n              className=\"px-3 py-1.5 text-xs rounded bg-blue-900/40 text-blue-100 border border-blue-700/60 hover:bg-blue-900/60\"\n              onClick={bulkReindex}\n            >\n              Reindex\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Mobile card view */}\n      <div className=\"md:hidden p-3 space-y-3\">{renderMobileCards()}</div>\n\n      {/* Desktop table view */}\n      <table className=\"hidden md:table w-full text-sm\">\n        <thead className=\"bg-slate-950 border-b border-slate-800 text-xs text-slate-400 uppercase tracking-wide\">\n          <tr>\n            <th className=\"px-4 py-3 text-left w-10\">\n              <input\n                type=\"checkbox\"\n                className=\"h-4 w-4 rounded border-slate-700 bg-slate-900\"\n                checked={selectAll}\n                onChange={toggleAll}\n                aria-label=\"Select all documents\"\n              />\n            </th>\n            <th className=\"px-4 py-3 text-left\">Title</th>\n            <th className=\"px-4 py-3 text-left\">Type</th>\n            <th className=\"px-4 py-3 text-left\">Status</th>\n            <th className=\"px-4 py-3 text-left\">Version</th>\n            <th className=\"px-4 py-3 text-left\">Size</th>\n            <th className=\"px-4 py-3 text-left\">Last Indexed</th>\n            <th className=\"px-4 py-3 text-right\">Actions</th>\n          </tr>\n        </thead>\n        <tbody className=\"divide-y divide-slate-800\">\n          {loading && (\n            <tr>\n              <td\n                colSpan={8}\n                className=\"px-4 py-6 text-center text-slate-500 text-sm\"\n              >\n                Loading documents…\n              </td>\n            </tr>\n          )}\n          {!loading && sortedDocs.length === 0 && (\n            <tr>\n              <td\n                colSpan={8}\n                className=\"px-4 py-6 text-center text-slate-500 text-sm\"\n              >\n                No documents found. Upload a PDF or text file to get started.\n              </td>\n            </tr>\n          )}\n          {!loading &&\n            sortedDocs.map((doc) => {\n              const isChecked = selected.has(doc.id);\n              return (\n                <tr key={doc.id} className=\"hover:bg-slate-800/40\">\n                  <td className=\"px-4 py-3\">\n                    <input\n                      type=\"checkbox\"\n                      className=\"h-4 w-4 rounded border-slate-700 bg-slate-900\"\n                      checked={isChecked}\n                      onChange={() => toggleOne(doc.id)}\n                      aria-label={`Select ${doc.name}`}\n                    />\n                  </td>\n                  <td className=\"px-4 py-3 text-slate-100 font-medium\">\n                    {doc.name}\n                  </td>\n                  <td className=\"px-4 py-3 text-slate-400\">{doc.type}</td>\n                  <td className=\"px-4 py-3\">{statusBadge(doc.status)}</td>\n                  <td className=\"px-4 py-3 text-slate-400\">\n                    {doc.version ?? \"—\"}\n                  </td>\n                  <td className=\"px-4 py-3 text-slate-400\">\n                    {doc.sizeMb ? `${doc.sizeMb.toFixed(1)} MB` : \"—\"}\n                  </td>\n                  <td className=\"px-4 py-3 text-slate-400\">\n                    {doc.lastIndexedAt\n                      ? new Date(doc.lastIndexedAt).toLocaleDateString()\n                      : \"—\"}\n                  </td>\n                  <td className=\"px-4 py-3 text-right space-x-3\">\n                    <button\n                      className=\"text-xs text-slate-300 hover:text-white\"\n                      onClick={() => onOpenAudit(doc)}\n                    >\n                      Audit\n                    </button>\n                    <button\n                      className=\"text-xs text-blue-300 hover:text-blue-100\"\n                      onClick={() => onReindex([doc.id])}\n                    >\n                      Reindex\n                    </button>\n                    <button\n                      className=\"text-xs text-rose-300 hover:text-rose-100\"\n                      onClick={() => onDelete([doc.id])}\n                    >\n                      Delete\n                    </button>\n                  </td>\n                </tr>\n              );\n            })}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n"
}
