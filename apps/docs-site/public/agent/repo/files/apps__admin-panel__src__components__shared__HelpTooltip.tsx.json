{
  "path": "apps/admin-panel/src/components/shared/HelpTooltip.tsx",
  "language": "typescript",
  "size": 13704,
  "last_modified": "2025-12-04T12:32:40.221Z",
  "lines": 417,
  "content": "/**\n * HelpTooltip - Contextual help tooltips with documentation links\n *\n * Provides inline help indicators that show documentation summaries\n * on hover/click and link to the full documentation page.\n */\nimport { useState, useRef, useEffect, useCallback } from \"react\";\n\nexport type HelpTopic =\n  // Feature Flags\n  | \"feature-flags\"\n  | \"feature-flags.naming\"\n  | \"feature-flags.lifecycle\"\n  | \"feature-flags.types\"\n  | \"feature-flags.percentage\"\n  | \"feature-flags.environments\"\n  // Knowledge Base\n  | \"knowledge-base\"\n  | \"knowledge-base.upload\"\n  | \"knowledge-base.search\"\n  | \"knowledge-base.embeddings\"\n  // Settings\n  | \"settings\"\n  | \"settings.api-keys\"\n  | \"settings.security\"\n  // General\n  | \"dashboard\"\n  | \"analytics\";\n\ninterface HelpContent {\n  title: string;\n  summary: string;\n  docPath: string;\n  tips?: string[];\n}\n\n/**\n * Mapping of help topics to their content\n * This should eventually be loaded from the docs-summary.json endpoint\n */\nconst helpContentMap: Record<HelpTopic, HelpContent> = {\n  // Feature Flags\n  \"feature-flags\": {\n    title: \"Feature Flags\",\n    summary:\n      \"Feature flags enable runtime feature toggling without deployments. Use category.feature_name pattern for naming.\",\n    docPath: \"admin-guide/feature-flags/README\",\n    tips: [\n      \"Flags are stored in PostgreSQL, cached in Redis (5min TTL)\",\n      \"Use percentage rollouts for gradual feature releases\",\n    ],\n  },\n  \"feature-flags.naming\": {\n    title: \"Feature Flag Naming\",\n    summary:\n      \"Use the category.feature_name pattern (e.g., ui.dark_mode, backend.rag_strategy). Valid categories: ui, backend, admin, integration, experiment, ops.\",\n    docPath: \"admin-guide/feature-flags/naming-conventions\",\n    tips: [\n      \"Avoid the deprecated ff_ prefix\",\n      \"Use snake_case for feature names\",\n    ],\n  },\n  \"feature-flags.lifecycle\": {\n    title: \"Feature Flag Lifecycle\",\n    summary:\n      \"Flags progress through draft → active → deprecated → removed. Remove flags after stable rollout to avoid tech debt.\",\n    docPath: \"admin-guide/feature-flags/lifecycle\",\n    tips: [\"Review flags quarterly\", \"Archive deprecated flags before removal\"],\n  },\n  \"feature-flags.types\": {\n    title: \"Feature Flag Types\",\n    summary:\n      \"Four types: boolean (on/off), percentage (gradual rollout 0-100%), variant (A/B/C testing), scheduled (time-based activation).\",\n    docPath: \"admin-guide/feature-flags/advanced-types\",\n  },\n  \"feature-flags.percentage\": {\n    title: \"Percentage Rollouts\",\n    summary:\n      \"Gradually roll out features to a percentage of users. Start at 10%, monitor, then increase to 25%, 50%, 75%, 100%.\",\n    docPath: \"admin-guide/feature-flags/advanced-types#percentage-flags\",\n    tips: [\n      \"User assignment is deterministic based on user ID hash\",\n      \"Same user sees same variant across sessions\",\n    ],\n  },\n  \"feature-flags.environments\": {\n    title: \"Multi-Environment Flags\",\n    summary:\n      \"Flags have per-environment states. Dev flags auto-enable, staging mirrors prod, prod requires explicit enablement.\",\n    docPath: \"admin-guide/feature-flags/multi-environment\",\n    tips: [\n      \"Use Redis namespaced keys (flags:dev:name, flags:prod:name)\",\n      \"Test in dev first, then staging, then prod\",\n    ],\n  },\n\n  // Knowledge Base\n  \"knowledge-base\": {\n    title: \"Knowledge Base\",\n    summary:\n      \"The Knowledge Base stores documents for RAG-powered AI responses. Upload PDFs, and the system extracts, chunks, and embeds content.\",\n    docPath: \"knowledge-base/overview\",\n  },\n  \"knowledge-base.upload\": {\n    title: \"Document Upload\",\n    summary:\n      \"Upload PDF documents to the knowledge base. Files are processed asynchronously with progress tracking.\",\n    docPath: \"knowledge-base/upload-guide\",\n    tips: [\"Maximum file size: 50MB\", \"Supported formats: PDF, TXT, MD\"],\n  },\n  \"knowledge-base.search\": {\n    title: \"Semantic Search\",\n    summary:\n      \"Search uses hybrid retrieval combining BM25 keyword matching with vector similarity for best results.\",\n    docPath: \"knowledge-base/search\",\n  },\n  \"knowledge-base.embeddings\": {\n    title: \"Document Embeddings\",\n    summary:\n      \"Documents are chunked and embedded using OpenAI's text-embedding-3-small model for semantic search.\",\n    docPath: \"knowledge-base/embeddings\",\n  },\n\n  // Settings\n  settings: {\n    title: \"Settings\",\n    summary:\n      \"Configure system-wide settings including API keys, security options, and integration endpoints.\",\n    docPath: \"admin-guide/settings\",\n  },\n  \"settings.api-keys\": {\n    title: \"API Keys\",\n    summary:\n      \"Manage API keys for external service integrations. Keys are encrypted at rest and masked in the UI.\",\n    docPath: \"admin-guide/settings/api-keys\",\n    tips: [\"Rotate keys periodically\", \"Use environment-specific keys\"],\n  },\n  \"settings.security\": {\n    title: \"Security Settings\",\n    summary:\n      \"Configure authentication, RBAC enforcement, rate limiting, and other security features.\",\n    docPath: \"admin-guide/settings/security\",\n  },\n\n  // General\n  dashboard: {\n    title: \"Dashboard\",\n    summary:\n      \"The dashboard provides an overview of system health, recent activity, and key metrics.\",\n    docPath: \"admin-guide/dashboard\",\n  },\n  analytics: {\n    title: \"Analytics\",\n    summary:\n      \"View usage analytics, search patterns, and performance metrics for the VoiceAssist platform.\",\n    docPath: \"admin-guide/analytics\",\n  },\n};\n\nexport interface HelpTooltipProps {\n  /**\n   * The help topic to display\n   */\n  topic: HelpTopic;\n\n  /**\n   * Size of the help icon\n   * @default \"sm\"\n   */\n  size?: \"xs\" | \"sm\" | \"md\";\n\n  /**\n   * Position of the tooltip\n   * @default \"top\"\n   */\n  position?: \"top\" | \"bottom\" | \"left\" | \"right\";\n\n  /**\n   * Additional className for the wrapper\n   */\n  className?: string;\n\n  /**\n   * Whether to show on hover (default) or click\n   * @default \"hover\"\n   */\n  trigger?: \"hover\" | \"click\";\n}\n\nexport function HelpTooltip({\n  topic,\n  size = \"sm\",\n  position = \"top\",\n  className = \"\",\n  trigger = \"hover\",\n}: HelpTooltipProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [tooltipStyle, setTooltipStyle] = useState<React.CSSProperties>({});\n  const triggerRef = useRef<HTMLButtonElement>(null);\n  const tooltipRef = useRef<HTMLDivElement>(null);\n\n  const content = helpContentMap[topic];\n\n  const docsBaseUrl =\n    typeof import.meta !== \"undefined\" && import.meta.env?.VITE_DOCS_URL\n      ? import.meta.env.VITE_DOCS_URL\n      : \"https://assistdocs.asimo.io/\";\n\n  // Calculate tooltip position\n  const updatePosition = useCallback(() => {\n    if (!triggerRef.current || !tooltipRef.current) return;\n\n    const triggerRect = triggerRef.current.getBoundingClientRect();\n    const tooltipRect = tooltipRef.current.getBoundingClientRect();\n    const gap = 8;\n\n    let top = 0;\n    let left = 0;\n\n    switch (position) {\n      case \"top\":\n        top = triggerRect.top - tooltipRect.height - gap;\n        left = triggerRect.left + triggerRect.width / 2 - tooltipRect.width / 2;\n        break;\n      case \"bottom\":\n        top = triggerRect.bottom + gap;\n        left = triggerRect.left + triggerRect.width / 2 - tooltipRect.width / 2;\n        break;\n      case \"left\":\n        top = triggerRect.top + triggerRect.height / 2 - tooltipRect.height / 2;\n        left = triggerRect.left - tooltipRect.width - gap;\n        break;\n      case \"right\":\n        top = triggerRect.top + triggerRect.height / 2 - tooltipRect.height / 2;\n        left = triggerRect.right + gap;\n        break;\n    }\n\n    // Keep within viewport bounds\n    const padding = 12;\n    left = Math.max(\n      padding,\n      Math.min(left, window.innerWidth - tooltipRect.width - padding),\n    );\n    top = Math.max(\n      padding,\n      Math.min(top, window.innerHeight - tooltipRect.height - padding),\n    );\n\n    setTooltipStyle({ top, left });\n  }, [position]);\n\n  useEffect(() => {\n    if (isOpen) {\n      updatePosition();\n      window.addEventListener(\"scroll\", updatePosition, true);\n      window.addEventListener(\"resize\", updatePosition);\n    }\n    return () => {\n      window.removeEventListener(\"scroll\", updatePosition, true);\n      window.removeEventListener(\"resize\", updatePosition);\n    };\n  }, [isOpen, updatePosition]);\n\n  // Close on escape\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleEscape);\n    return () => document.removeEventListener(\"keydown\", handleEscape);\n  }, [isOpen]);\n\n  // Close on click outside for click trigger\n  useEffect(() => {\n    if (!isOpen || trigger !== \"click\") return;\n\n    const handleClickOutside = (e: MouseEvent) => {\n      if (\n        triggerRef.current &&\n        !triggerRef.current.contains(e.target as Node) &&\n        tooltipRef.current &&\n        !tooltipRef.current.contains(e.target as Node)\n      ) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [isOpen, trigger]);\n\n  // Early return for unknown topic - MUST be after all hooks\n  if (!content) {\n    console.warn(`HelpTooltip: Unknown topic \"${topic}\"`);\n    return null;\n  }\n\n  const sizeClasses = {\n    xs: \"w-3.5 h-3.5\",\n    sm: \"w-4 h-4\",\n    md: \"w-5 h-5\",\n  };\n\n  const handleTriggerProps =\n    trigger === \"hover\"\n      ? {\n          onMouseEnter: () => setIsOpen(true),\n          onMouseLeave: () => setIsOpen(false),\n          onFocus: () => setIsOpen(true),\n          onBlur: () => setIsOpen(false),\n        }\n      : {\n          onClick: () => setIsOpen(!isOpen),\n        };\n\n  return (\n    <span className={`inline-flex items-center ${className}`}>\n      <button\n        ref={triggerRef}\n        type=\"button\"\n        className={`inline-flex items-center justify-center rounded-full text-slate-500 hover:text-slate-300 hover:bg-slate-700/50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-1 focus:ring-offset-slate-900 transition-colors ${sizeClasses[size]} p-0.5`}\n        aria-label={`Help: ${content.title}`}\n        aria-describedby={isOpen ? `help-tooltip-${topic}` : undefined}\n        {...handleTriggerProps}\n      >\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 20 20\"\n          fill=\"currentColor\"\n          className=\"w-full h-full\"\n        >\n          <path\n            fillRule=\"evenodd\"\n            d=\"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0ZM8.94 6.94a.75.75 0 1 1-1.061-1.061 3 3 0 1 1 2.871 5.026v.345a.75.75 0 0 1-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 1 0 8.94 6.94ZM10 15a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z\"\n            clipRule=\"evenodd\"\n          />\n        </svg>\n      </button>\n\n      {isOpen && (\n        <div\n          ref={tooltipRef}\n          id={`help-tooltip-${topic}`}\n          role=\"tooltip\"\n          className=\"fixed z-50 w-72 p-3 bg-slate-800 border border-slate-700 rounded-lg shadow-xl text-sm\"\n          style={tooltipStyle}\n        >\n          {/* Arrow indicator */}\n          <div\n            className={`absolute w-2 h-2 bg-slate-800 border-slate-700 transform rotate-45 ${\n              position === \"top\"\n                ? \"bottom-[-5px] left-1/2 -translate-x-1/2 border-b border-r\"\n                : position === \"bottom\"\n                  ? \"top-[-5px] left-1/2 -translate-x-1/2 border-t border-l\"\n                  : position === \"left\"\n                    ? \"right-[-5px] top-1/2 -translate-y-1/2 border-t border-r\"\n                    : \"left-[-5px] top-1/2 -translate-y-1/2 border-b border-l\"\n            }`}\n          />\n\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-2\">\n            <h4 className=\"font-semibold text-slate-100\">{content.title}</h4>\n            <a\n              href={`${docsBaseUrl}${content.docPath}`}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1\"\n            >\n              <span>View docs</span>\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                viewBox=\"0 0 16 16\"\n                fill=\"currentColor\"\n                className=\"w-3 h-3\"\n              >\n                <path d=\"M6.22 8.72a.75.75 0 0 0 1.06 1.06l5.22-5.22v1.69a.75.75 0 0 0 1.5 0v-3.5a.75.75 0 0 0-.75-.75h-3.5a.75.75 0 0 0 0 1.5h1.69L6.22 8.72Z\" />\n                <path d=\"M3.5 6.75c0-.69.56-1.25 1.25-1.25H7A.75.75 0 0 0 7 4H4.75A2.75 2.75 0 0 0 2 6.75v4.5A2.75 2.75 0 0 0 4.75 14h4.5A2.75 2.75 0 0 0 12 11.25V9a.75.75 0 0 0-1.5 0v2.25c0 .69-.56 1.25-1.25 1.25h-4.5c-.69 0-1.25-.56-1.25-1.25v-4.5Z\" />\n              </svg>\n            </a>\n          </div>\n\n          {/* Summary */}\n          <p className=\"text-slate-300 text-xs leading-relaxed\">\n            {content.summary}\n          </p>\n\n          {/* Tips */}\n          {content.tips && content.tips.length > 0 && (\n            <div className=\"mt-2 pt-2 border-t border-slate-700\">\n              <p className=\"text-[10px] text-slate-500 uppercase tracking-wide mb-1\">\n                Tips\n              </p>\n              <ul className=\"text-xs text-slate-400 space-y-0.5\">\n                {content.tips.map((tip, idx) => (\n                  <li key={idx} className=\"flex items-start gap-1.5\">\n                    <span className=\"text-blue-400 mt-0.5\">•</span>\n                    <span>{tip}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </div>\n      )}\n    </span>\n  );\n}\n\nHelpTooltip.displayName = \"HelpTooltip\";\n"
}
