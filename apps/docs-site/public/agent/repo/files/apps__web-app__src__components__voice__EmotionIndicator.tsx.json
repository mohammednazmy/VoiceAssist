{
  "path": "apps/web-app/src/components/voice/EmotionIndicator.tsx",
  "language": "typescript",
  "size": 5668,
  "last_modified": "2025-12-04T07:44:58.969Z",
  "lines": 202,
  "content": "/**\n * EmotionIndicator Component\n *\n * Displays the user's detected emotional state from Hume AI.\n * Shows primary emotion with a subtle visual indicator.\n *\n * Phase: Voice Mode Intelligence Enhancement - Phase 1\n */\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport type { TTEmotionResult } from \"../../hooks/useThinkerTalkerSession\";\n\n// Emotion to emoji mapping\nconst EMOTION_EMOJI: Record<string, string> = {\n  joy: \"ğŸ˜Š\",\n  sadness: \"ğŸ˜¢\",\n  anger: \"ğŸ˜ \",\n  fear: \"ğŸ˜¨\",\n  surprise: \"ğŸ˜²\",\n  disgust: \"ğŸ˜–\",\n  contempt: \"ğŸ˜’\",\n  neutral: \"ğŸ˜\",\n  confusion: \"ğŸ˜•\",\n  interest: \"ğŸ¤”\",\n  excitement: \"ğŸ¤©\",\n  anxiety: \"ğŸ˜°\",\n  calm: \"ğŸ˜Œ\",\n  frustration: \"ğŸ˜¤\",\n};\n\n// Emotion to color mapping (for background tint)\nconst EMOTION_COLORS: Record<string, string> = {\n  joy: \"bg-yellow-100 border-yellow-300\",\n  sadness: \"bg-blue-100 border-blue-300\",\n  anger: \"bg-red-100 border-red-300\",\n  fear: \"bg-purple-100 border-purple-300\",\n  surprise: \"bg-orange-100 border-orange-300\",\n  disgust: \"bg-green-100 border-green-300\",\n  contempt: \"bg-gray-100 border-gray-300\",\n  neutral: \"bg-gray-50 border-gray-200\",\n  confusion: \"bg-indigo-100 border-indigo-300\",\n  interest: \"bg-cyan-100 border-cyan-300\",\n  excitement: \"bg-pink-100 border-pink-300\",\n  anxiety: \"bg-amber-100 border-amber-300\",\n  calm: \"bg-teal-100 border-teal-300\",\n  frustration: \"bg-rose-100 border-rose-300\",\n};\n\ninterface EmotionIndicatorProps {\n  /** Current emotion result from backend */\n  emotion: TTEmotionResult | null;\n  /** Whether to show detailed info */\n  showDetails?: boolean;\n  /** Size variant */\n  size?: \"sm\" | \"md\" | \"lg\";\n  /** Custom class names */\n  className?: string;\n}\n\nexport const EmotionIndicator: React.FC<EmotionIndicatorProps> = ({\n  emotion,\n  showDetails = false,\n  size = \"md\",\n  className = \"\",\n}) => {\n  const [isVisible, setIsVisible] = useState(false);\n  const [fadeOut, setFadeOut] = useState(false);\n\n  // Animate in when emotion changes\n  useEffect(() => {\n    if (emotion && emotion.primary_confidence > 0.3) {\n      setIsVisible(true);\n      setFadeOut(false);\n\n      // Auto-hide after 5 seconds\n      const timer = setTimeout(() => {\n        setFadeOut(true);\n        setTimeout(() => setIsVisible(false), 300);\n      }, 5000);\n\n      return () => clearTimeout(timer);\n    }\n  }, [emotion]);\n\n  if (!emotion || !isVisible) {\n    return null;\n  }\n\n  const emotionKey = emotion.primary_emotion.toLowerCase();\n  const emoji = EMOTION_EMOJI[emotionKey] || \"ğŸ˜\";\n  const colorClass = EMOTION_COLORS[emotionKey] || EMOTION_COLORS.neutral;\n\n  // Size classes\n  const sizeClasses = {\n    sm: \"text-sm px-2 py-1\",\n    md: \"text-base px-3 py-1.5\",\n    lg: \"text-lg px-4 py-2\",\n  };\n\n  // Confidence indicator width\n  const confidenceWidth = Math.round(emotion.primary_confidence * 100);\n\n  // Valence color (negative=red, neutral=gray, positive=green)\n  const valenceColor =\n    emotion.valence > 0.2\n      ? \"bg-green-400\"\n      : emotion.valence < -0.2\n        ? \"bg-red-400\"\n        : \"bg-gray-400\";\n\n  return (\n    <div\n      className={`\n        inline-flex items-center gap-2 rounded-full border\n        transition-all duration-300 ease-in-out\n        ${colorClass}\n        ${sizeClasses[size]}\n        ${fadeOut ? \"opacity-0 scale-95\" : \"opacity-100 scale-100\"}\n        ${className}\n      `}\n      title={`Detected emotion: ${emotion.primary_emotion} (${Math.round(emotion.primary_confidence * 100)}%)`}\n    >\n      {/* Emoji */}\n      <span className=\"select-none\">{emoji}</span>\n\n      {/* Emotion label */}\n      <span className=\"font-medium capitalize text-gray-700\">\n        {emotion.primary_emotion}\n      </span>\n\n      {/* Confidence bar (only in detailed mode) */}\n      {showDetails && (\n        <div className=\"flex items-center gap-1.5\">\n          <div className=\"h-1.5 w-12 rounded-full bg-gray-200 overflow-hidden\">\n            <div\n              className=\"h-full bg-gray-500 rounded-full transition-all duration-300\"\n              style={{ width: `${confidenceWidth}%` }}\n            />\n          </div>\n          <span className=\"text-xs text-gray-500\">{confidenceWidth}%</span>\n        </div>\n      )}\n\n      {/* Valence indicator (only in detailed mode) */}\n      {showDetails && (\n        <div\n          className={`w-2 h-2 rounded-full ${valenceColor}`}\n          title={`Valence: ${emotion.valence.toFixed(2)}`}\n        />\n      )}\n    </div>\n  );\n};\n\n/**\n * Hook to manage emotion state with decay\n */\nexport const useEmotionState = () => {\n  const [currentEmotion, setCurrentEmotion] = useState<TTEmotionResult | null>(\n    null,\n  );\n  const [emotionHistory, setEmotionHistory] = useState<TTEmotionResult[]>([]);\n\n  const handleEmotionDetected = useCallback((emotion: TTEmotionResult) => {\n    setCurrentEmotion(emotion);\n    setEmotionHistory((prev) => [...prev.slice(-9), emotion]); // Keep last 10\n  }, []);\n\n  const clearEmotion = useCallback(() => {\n    setCurrentEmotion(null);\n  }, []);\n\n  // Calculate dominant emotion trend\n  const emotionTrend = React.useMemo(() => {\n    if (emotionHistory.length < 3) return null;\n\n    const recentEmotions = emotionHistory.slice(-5);\n    const emotionCounts: Record<string, number> = {};\n\n    recentEmotions.forEach((e) => {\n      emotionCounts[e.primary_emotion] =\n        (emotionCounts[e.primary_emotion] || 0) + 1;\n    });\n\n    const dominant = Object.entries(emotionCounts).sort(\n      ([, a], [, b]) => b - a,\n    )[0];\n\n    return dominant ? dominant[0] : null;\n  }, [emotionHistory]);\n\n  return {\n    currentEmotion,\n    emotionHistory,\n    emotionTrend,\n    handleEmotionDetected,\n    clearEmotion,\n  };\n};\n\nexport default EmotionIndicator;\n"
}
