{
  "path": "apps/web-app/src/components/voice/QualityBadge.tsx",
  "language": "typescript",
  "size": 6840,
  "last_modified": "2025-12-04T22:09:55.011Z",
  "lines": 262,
  "content": "/**\n * QualityBadge - Adaptive Quality Level Indicator\n *\n * Displays the current voice processing quality level based on\n * network conditions and system load. Part of the adaptive quality\n * service integration for Voice Mode v4.1 Phase 3.\n *\n * Quality Levels:\n * - ULTRA: Best quality, high latency budget (800ms)\n * - HIGH: Premium quality, balanced latency (600ms)\n * - MEDIUM: Standard quality, reduced latency (500ms)\n * - LOW: Basic quality, tight latency (400ms)\n * - MINIMAL: Fallback quality, minimal latency (300ms)\n *\n * Reference: docs/voice/adaptive-quality-service.md\n */\n\nimport { useState, useEffect, useMemo } from \"react\";\nimport { cn } from \"@/lib/utils\";\nimport { Tooltip } from \"../ui/Tooltip\";\n\nexport type QualityLevel = \"ultra\" | \"high\" | \"medium\" | \"low\" | \"minimal\";\n\nexport type NetworkCondition =\n  | \"excellent\"\n  | \"good\"\n  | \"fair\"\n  | \"poor\"\n  | \"critical\";\n\ninterface QualityBadgeProps {\n  /** Current quality level */\n  level: QualityLevel;\n  /** Network condition (for tooltip details) */\n  networkCondition?: NetworkCondition;\n  /** Round-trip time in milliseconds */\n  rttMs?: number;\n  /** Whether to show the quality label */\n  showLabel?: boolean;\n  /** Size variant */\n  size?: \"sm\" | \"md\" | \"lg\";\n  /** Whether quality is currently changing (show pulse) */\n  isChanging?: boolean;\n  /** Callback when user clicks for more details */\n  onClick?: () => void;\n  /** Custom class name */\n  className?: string;\n}\n\ninterface QualityConfig {\n  color: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;\n  label: string;\n  latencyTarget: number;\n}\n\nconst QUALITY_CONFIG: Record<QualityLevel, QualityConfig> = {\n  ultra: {\n    color: \"text-purple-700 dark:text-purple-300\",\n    bgColor: \"bg-purple-100 dark:bg-purple-900/30\",\n    borderColor: \"border-purple-300 dark:border-purple-700\",\n    icon: \"✦\",\n    label: \"Ultra\",\n    latencyTarget: 800,\n  },\n  high: {\n    color: \"text-green-700 dark:text-green-300\",\n    bgColor: \"bg-green-100 dark:bg-green-900/30\",\n    borderColor: \"border-green-300 dark:border-green-700\",\n    icon: \"●\",\n    label: \"High\",\n    latencyTarget: 600,\n  },\n  medium: {\n    color: \"text-yellow-700 dark:text-yellow-300\",\n    bgColor: \"bg-yellow-100 dark:bg-yellow-900/30\",\n    borderColor: \"border-yellow-300 dark:border-yellow-700\",\n    icon: \"◐\",\n    label: \"Medium\",\n    latencyTarget: 500,\n  },\n  low: {\n    color: \"text-orange-700 dark:text-orange-300\",\n    bgColor: \"bg-orange-100 dark:bg-orange-900/30\",\n    borderColor: \"border-orange-300 dark:border-orange-700\",\n    icon: \"○\",\n    label: \"Low\",\n    latencyTarget: 400,\n  },\n  minimal: {\n    color: \"text-red-700 dark:text-red-300\",\n    bgColor: \"bg-red-100 dark:bg-red-900/30\",\n    borderColor: \"border-red-300 dark:border-red-700\",\n    icon: \"◌\",\n    label: \"Minimal\",\n    latencyTarget: 300,\n  },\n};\n\nconst SIZE_CLASSES = {\n  sm: \"px-1.5 py-0.5 text-xs gap-1\",\n  md: \"px-2 py-1 text-sm gap-1.5\",\n  lg: \"px-3 py-1.5 text-base gap-2\",\n};\n\nexport function QualityBadge({\n  level,\n  networkCondition,\n  rttMs,\n  showLabel = true,\n  size = \"md\",\n  isChanging = false,\n  onClick,\n  className,\n}: QualityBadgeProps) {\n  const [previousLevel, setPreviousLevel] = useState<QualityLevel>(level);\n  const [showTransition, setShowTransition] = useState(false);\n\n  const config = QUALITY_CONFIG[level];\n\n  // Detect level changes for animation\n  useEffect(() => {\n    if (level !== previousLevel) {\n      setShowTransition(true);\n      const timeout = setTimeout(() => {\n        setShowTransition(false);\n        setPreviousLevel(level);\n      }, 500);\n      return () => clearTimeout(timeout);\n    }\n  }, [level, previousLevel]);\n\n  // Build tooltip content\n  const tooltipContent = useMemo(() => {\n    const lines = [\n      `Quality: ${config.label}`,\n      `Target Latency: ${config.latencyTarget}ms`,\n    ];\n\n    if (networkCondition) {\n      lines.push(`Network: ${networkCondition}`);\n    }\n\n    if (rttMs !== undefined) {\n      lines.push(`RTT: ${rttMs}ms`);\n    }\n\n    return (\n      <div className=\"space-y-0.5\">\n        {lines.map((line, i) => (\n          <div key={i}>{line}</div>\n        ))}\n      </div>\n    );\n  }, [config, networkCondition, rttMs]);\n\n  const badge = (\n    <div\n      className={cn(\n        \"inline-flex items-center rounded-full border transition-all duration-200\",\n        config.bgColor,\n        config.borderColor,\n        config.color,\n        SIZE_CLASSES[size],\n        onClick && \"cursor-pointer hover:opacity-80\",\n        (isChanging || showTransition) && \"animate-pulse\",\n        className,\n      )}\n      onClick={onClick}\n      role={onClick ? \"button\" : undefined}\n      tabIndex={onClick ? 0 : undefined}\n      aria-label={`Voice quality: ${config.label}`}\n    >\n      {/* Quality indicator dot/icon */}\n      <span\n        className={cn(\n          \"flex-shrink-0\",\n          size === \"sm\" && \"text-xs\",\n          size === \"md\" && \"text-sm\",\n          size === \"lg\" && \"text-base\",\n        )}\n      >\n        {config.icon}\n      </span>\n\n      {/* Label */}\n      {showLabel && (\n        <span className=\"font-medium uppercase tracking-wide\">\n          {config.label}\n        </span>\n      )}\n    </div>\n  );\n\n  return (\n    <Tooltip content={tooltipContent} placement=\"bottom\">\n      {badge}\n    </Tooltip>\n  );\n}\n\n/**\n * Hook to manage quality state with automatic degradation simulation\n */\nexport function useQualityLevel(initialLevel: QualityLevel = \"high\") {\n  const [level, setLevel] = useState<QualityLevel>(initialLevel);\n  const [networkCondition, setNetworkCondition] =\n    useState<NetworkCondition>(\"good\");\n  const [rttMs, setRttMs] = useState(100);\n\n  // Simulate network monitoring (in production, this would come from the backend)\n  useEffect(() => {\n    const updateNetwork = () => {\n      // Simulate RTT fluctuation\n      const newRtt = Math.max(\n        20,\n        Math.min(1000, rttMs + (Math.random() - 0.5) * 50),\n      );\n      setRttMs(Math.round(newRtt));\n\n      // Determine condition and level based on RTT\n      let condition: NetworkCondition;\n      let newLevel: QualityLevel;\n\n      if (newRtt < 50) {\n        condition = \"excellent\";\n        newLevel = \"ultra\";\n      } else if (newRtt < 150) {\n        condition = \"good\";\n        newLevel = \"high\";\n      } else if (newRtt < 300) {\n        condition = \"fair\";\n        newLevel = \"medium\";\n      } else if (newRtt < 500) {\n        condition = \"poor\";\n        newLevel = \"low\";\n      } else {\n        condition = \"critical\";\n        newLevel = \"minimal\";\n      }\n\n      setNetworkCondition(condition);\n      setLevel(newLevel);\n    };\n\n    const interval = setInterval(updateNetwork, 5000);\n    return () => clearInterval(interval);\n  }, [rttMs]);\n\n  return {\n    level,\n    setLevel,\n    networkCondition,\n    rttMs,\n    isChanging: false,\n  };\n}\n\nexport default QualityBadge;\n"
}
