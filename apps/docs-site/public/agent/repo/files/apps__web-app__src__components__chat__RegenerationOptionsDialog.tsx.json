{
  "path": "apps/web-app/src/components/chat/RegenerationOptionsDialog.tsx",
  "language": "typescript",
  "size": 10630,
  "last_modified": "2025-11-29T01:30:28.315Z",
  "lines": 320,
  "content": "/**\n * RegenerationOptionsDialog\n *\n * Dialog for configuring message regeneration options:\n * - Temperature slider (creativity/randomness)\n * - Length preference (short/medium/detailed)\n * - Clinical context toggle\n *\n * Creates a branch to preserve the original message.\n */\n\nimport { useState, useCallback } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@voiceassist/ui\";\nimport { Slider } from \"@voiceassist/ui\";\n\nexport type LengthPreference = \"short\" | \"medium\" | \"detailed\";\n\nexport interface RegenerationOptions {\n  /** Temperature for generation (0.0 - 2.0, default 0.7) */\n  temperature: number;\n  /** Response length preference */\n  lengthPreference: LengthPreference;\n  /** Whether to apply clinical context */\n  useClinicalContext: boolean;\n  /** Whether to create a branch (preserve original) */\n  createBranch: boolean;\n}\n\nexport interface RegenerationOptionsDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onRegenerate: (options: RegenerationOptions) => void;\n  /** Message being regenerated (for preview) */\n  originalContent?: string;\n  /** Whether regeneration is in progress */\n  isRegenerating?: boolean;\n  /** Whether clinical context is available */\n  hasClinicalContext?: boolean;\n}\n\nconst LENGTH_OPTIONS: {\n  value: LengthPreference;\n  label: string;\n  description: string;\n}[] = [\n  { value: \"short\", label: \"Short\", description: \"Brief, concise responses\" },\n  {\n    value: \"medium\",\n    label: \"Medium\",\n    description: \"Balanced detail and length\",\n  },\n  {\n    value: \"detailed\",\n    label: \"Detailed\",\n    description: \"Comprehensive explanations\",\n  },\n];\n\nexport function RegenerationOptionsDialog({\n  isOpen,\n  onClose,\n  onRegenerate,\n  originalContent,\n  isRegenerating = false,\n  hasClinicalContext = false,\n}: RegenerationOptionsDialogProps) {\n  const [temperature, setTemperature] = useState(0.7);\n  const [lengthPreference, setLengthPreference] =\n    useState<LengthPreference>(\"medium\");\n  const [useClinicalContext, setUseClinicalContext] = useState(true);\n  const [createBranch, setCreateBranch] = useState(true);\n\n  const handleRegenerate = useCallback(() => {\n    onRegenerate({\n      temperature,\n      lengthPreference,\n      useClinicalContext: hasClinicalContext && useClinicalContext,\n      createBranch,\n    });\n  }, [\n    temperature,\n    lengthPreference,\n    useClinicalContext,\n    createBranch,\n    hasClinicalContext,\n    onRegenerate,\n  ]);\n\n  const handleClose = useCallback(() => {\n    if (!isRegenerating) {\n      onClose();\n    }\n  }, [isRegenerating, onClose]);\n\n  // Reset to defaults when dialog opens\n  const handleOpenChange = useCallback(\n    (open: boolean) => {\n      if (!open) {\n        handleClose();\n      }\n    },\n    [handleClose],\n  );\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleOpenChange}>\n      <DialogContent\n        className=\"sm:max-w-md\"\n        data-testid=\"regeneration-options-dialog\"\n      >\n        <DialogHeader>\n          <DialogTitle>Regenerate Response</DialogTitle>\n          <DialogDescription>\n            Customize how the AI generates a new response. The original will be\n            preserved in a branch.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* Temperature Slider */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <label\n                htmlFor=\"temperature-slider\"\n                className=\"text-sm font-medium text-neutral-900\"\n              >\n                Creativity\n              </label>\n              <span className=\"text-sm text-neutral-500\">\n                {temperature.toFixed(1)}\n              </span>\n            </div>\n            <Slider\n              id=\"temperature-slider\"\n              min={0}\n              max={2}\n              step={0.1}\n              value={[temperature]}\n              onValueChange={(value) => setTemperature(value[0])}\n              className=\"w-full\"\n              aria-label=\"Temperature slider\"\n              data-testid=\"temperature-slider\"\n            />\n            <div className=\"flex justify-between text-xs text-neutral-500\">\n              <span>Focused</span>\n              <span>Balanced</span>\n              <span>Creative</span>\n            </div>\n          </div>\n\n          {/* Length Preference */}\n          <div className=\"space-y-3\">\n            <label className=\"text-sm font-medium text-neutral-900\">\n              Response Length\n            </label>\n            <div className=\"grid grid-cols-3 gap-2\">\n              {LENGTH_OPTIONS.map((option) => (\n                <button\n                  key={option.value}\n                  type=\"button\"\n                  onClick={() => setLengthPreference(option.value)}\n                  className={`\n                    flex flex-col items-center p-3 rounded-lg border-2 transition-all\n                    ${\n                      lengthPreference === option.value\n                        ? \"border-primary-500 bg-primary-50 text-primary-900\"\n                        : \"border-neutral-200 bg-white hover:border-neutral-300 text-neutral-700\"\n                    }\n                  `}\n                  data-testid={`length-option-${option.value}`}\n                  aria-pressed={lengthPreference === option.value}\n                >\n                  <span className=\"font-medium text-sm\">{option.label}</span>\n                  <span className=\"text-xs mt-1 text-center opacity-70\">\n                    {option.description}\n                  </span>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Clinical Context Toggle */}\n          {hasClinicalContext && (\n            <div className=\"flex items-center justify-between p-3 bg-neutral-50 rounded-lg\">\n              <div className=\"space-y-1\">\n                <label\n                  htmlFor=\"clinical-context-toggle\"\n                  className=\"text-sm font-medium text-neutral-900\"\n                >\n                  Use Clinical Context\n                </label>\n                <p className=\"text-xs text-neutral-500\">\n                  Apply active patient context to the response\n                </p>\n              </div>\n              <button\n                id=\"clinical-context-toggle\"\n                type=\"button\"\n                role=\"switch\"\n                aria-checked={useClinicalContext}\n                onClick={() => setUseClinicalContext(!useClinicalContext)}\n                className={`\n                  relative w-11 h-6 rounded-full transition-colors\n                  ${useClinicalContext ? \"bg-primary-500\" : \"bg-neutral-300\"}\n                `}\n                data-testid=\"clinical-context-toggle\"\n              >\n                <span\n                  className={`\n                    absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform\n                    ${useClinicalContext ? \"translate-x-5\" : \"translate-x-0\"}\n                  `}\n                />\n              </button>\n            </div>\n          )}\n\n          {/* Create Branch Toggle */}\n          <div className=\"flex items-center justify-between p-3 bg-neutral-50 rounded-lg\">\n            <div className=\"space-y-1\">\n              <label\n                htmlFor=\"branch-toggle\"\n                className=\"text-sm font-medium text-neutral-900\"\n              >\n                Preserve Original\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Create a branch to keep the original response\n              </p>\n            </div>\n            <button\n              id=\"branch-toggle\"\n              type=\"button\"\n              role=\"switch\"\n              aria-checked={createBranch}\n              onClick={() => setCreateBranch(!createBranch)}\n              className={`\n                relative w-11 h-6 rounded-full transition-colors\n                ${createBranch ? \"bg-primary-500\" : \"bg-neutral-300\"}\n              `}\n              data-testid=\"branch-toggle\"\n            >\n              <span\n                className={`\n                  absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform\n                  ${createBranch ? \"translate-x-5\" : \"translate-x-0\"}\n                `}\n              />\n            </button>\n          </div>\n\n          {/* Original Content Preview */}\n          {originalContent && (\n            <div className=\"p-3 bg-neutral-100 rounded-lg\">\n              <p className=\"text-xs font-medium text-neutral-500 mb-1\">\n                Original Response\n              </p>\n              <p className=\"text-sm text-neutral-700 line-clamp-3\">\n                {originalContent}\n              </p>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"flex gap-2 sm:gap-0\">\n          <button\n            type=\"button\"\n            onClick={handleClose}\n            disabled={isRegenerating}\n            className=\"flex-1 sm:flex-none px-4 py-2 text-sm font-medium text-neutral-700 bg-neutral-100 hover:bg-neutral-200 rounded-lg transition-colors disabled:opacity-50\"\n            data-testid=\"regenerate-cancel-button\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleRegenerate}\n            disabled={isRegenerating}\n            className=\"flex-1 sm:flex-none px-4 py-2 text-sm font-medium text-white bg-primary-500 hover:bg-primary-600 rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n            data-testid=\"regenerate-confirm-button\"\n          >\n            {isRegenerating && (\n              <svg\n                className=\"animate-spin h-4 w-4\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n              >\n                <circle\n                  className=\"opacity-25\"\n                  cx=\"12\"\n                  cy=\"12\"\n                  r=\"10\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"4\"\n                />\n                <path\n                  className=\"opacity-75\"\n                  fill=\"currentColor\"\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                />\n              </svg>\n            )}\n            {isRegenerating ? \"Regenerating...\" : \"Regenerate\"}\n          </button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default RegenerationOptionsDialog;\n"
}
