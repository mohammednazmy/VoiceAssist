{
  "path": "services/api-gateway/app/models/user_voice_preferences.py",
  "language": "python",
  "size": 4078,
  "last_modified": "2025-12-05T03:07:13.132Z",
  "lines": 106,
  "content": "\"\"\"\nUser Voice Preferences Model\n\nStores per-user voice settings including:\n- TTS provider selection\n- Voice selection for each provider\n- Speech rate and quality parameters\n- Behavior preferences\n\"\"\"\n\nimport uuid\nfrom datetime import datetime\n\nfrom app.core.database import Base\nfrom sqlalchemy import Boolean, Column, DateTime, Float, ForeignKey, String\nfrom sqlalchemy.dialects.postgresql import UUID\nfrom sqlalchemy.orm import relationship\n\n\nclass UserVoicePreferences(Base):\n    \"\"\"\n    User voice preferences for TTS customization.\n\n    Supports both OpenAI and ElevenLabs providers with full\n    parameter control for voice quality and naturalness.\n    \"\"\"\n\n    __tablename__ = \"user_voice_preferences\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    user_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey(\"users.id\", ondelete=\"CASCADE\"),\n        unique=True,\n        nullable=False,\n        index=True,\n    )\n\n    # Provider selection\n    tts_provider = Column(String(50), default=\"openai\", nullable=False)  # \"openai\" or \"elevenlabs\"\n\n    # Voice selection per provider\n    openai_voice_id = Column(String(50), default=\"alloy\", nullable=False)\n    elevenlabs_voice_id = Column(String(100), nullable=True)\n\n    # Speech control\n    speech_rate = Column(Float, default=1.0, nullable=False)  # 0.5-2.0\n\n    # ElevenLabs-specific parameters (tuned for natural, less robotic sound)\n    stability = Column(Float, default=0.7, nullable=False)  # 0-1: higher = more consistent voice\n    similarity_boost = Column(Float, default=0.8, nullable=False)  # 0-1: voice matching fidelity\n    style = Column(Float, default=0.15, nullable=False)  # 0-1: adds subtle expression\n    speaker_boost = Column(Boolean, default=True, nullable=False)  # Clarity enhancement\n\n    # Behavior preferences\n    auto_play = Column(Boolean, default=True, nullable=False)  # Auto-play TTS responses\n    context_aware_style = Column(Boolean, default=True, nullable=False)  # Auto-adjust based on content\n    preferred_language = Column(String(10), default=\"en\", nullable=False)  # Language code\n\n    # Timestamps\n    created_at = Column(DateTime, default=datetime.utcnow, nullable=False)\n    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow, nullable=False)\n\n    # Relationships\n    user = relationship(\"User\", backref=\"voice_preferences\", uselist=False)\n\n    def __repr__(self):\n        return f\"<UserVoicePreferences(user_id={self.user_id}, provider={self.tts_provider})>\"\n\n    def to_dict(self):\n        \"\"\"Convert to dictionary for API responses.\"\"\"\n        return {\n            \"id\": str(self.id),\n            \"user_id\": str(self.user_id),\n            \"tts_provider\": self.tts_provider,\n            \"openai_voice_id\": self.openai_voice_id,\n            \"elevenlabs_voice_id\": self.elevenlabs_voice_id,\n            \"speech_rate\": self.speech_rate,\n            \"stability\": self.stability,\n            \"similarity_boost\": self.similarity_boost,\n            \"style\": self.style,\n            \"speaker_boost\": self.speaker_boost,\n            \"auto_play\": self.auto_play,\n            \"context_aware_style\": self.context_aware_style,\n            \"preferred_language\": self.preferred_language,\n            \"created_at\": self.created_at.isoformat() if self.created_at else None,\n            \"updated_at\": self.updated_at.isoformat() if self.updated_at else None,\n        }\n\n    @classmethod\n    def get_default_preferences(cls, user_id: uuid.UUID) -> \"UserVoicePreferences\":\n        \"\"\"Create a new preferences object with default values.\"\"\"\n        return cls(\n            user_id=user_id,\n            tts_provider=\"openai\",\n            openai_voice_id=\"alloy\",\n            speech_rate=1.0,\n            stability=0.7,  # Higher for more consistent, natural voice\n            similarity_boost=0.8,  # Better voice matching\n            style=0.15,  # Subtle expression for less robotic sound\n            speaker_boost=True,\n            auto_play=True,\n            context_aware_style=True,\n            preferred_language=\"en\",\n        )\n"
}
