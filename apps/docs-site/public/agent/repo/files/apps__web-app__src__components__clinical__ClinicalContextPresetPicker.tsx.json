{
  "path": "apps/web-app/src/components/clinical/ClinicalContextPresetPicker.tsx",
  "language": "typescript",
  "size": 20011,
  "last_modified": "2025-11-29T04:23:13.365Z",
  "lines": 565,
  "content": "/**\n * ClinicalContextPresetPicker\n *\n * Component for selecting and managing clinical context presets.\n * Includes built-in medical specialty presets:\n * - Cardiac\n * - Diabetic\n * - Respiratory\n * - Neurological\n *\n * Also supports user-created custom presets.\n */\n\nimport { useState, useCallback, useMemo } from \"react\";\nimport type { ClinicalContextPreset } from \"@voiceassist/types\";\n\n// Re-export the type for consumers\nexport type { ClinicalContextPreset } from \"@voiceassist/types\";\n\n/** Built-in medical specialty presets */\nexport const BUILTIN_PRESETS: ClinicalContextPreset[] = [\n  {\n    id: \"cardiac-default\",\n    name: \"Cardiac Patient\",\n    description:\n      \"Standard cardiac patient profile with common cardiovascular conditions\",\n    category: \"builtin\",\n    icon: \"heart\",\n    context: {\n      chiefComplaint: \"Cardiovascular symptoms\",\n      problems: [\"Hypertension\", \"Coronary artery disease\", \"Hyperlipidemia\"],\n      medications: [\n        \"Lisinopril 10mg daily\",\n        \"Atorvastatin 40mg daily\",\n        \"Aspirin 81mg daily\",\n        \"Metoprolol 25mg twice daily\",\n      ],\n      vitals: {\n        bloodPressure: { systolic: 140, diastolic: 85 },\n        heartRate: 78,\n        respiratoryRate: 16,\n        oxygenSaturation: 97,\n        temperature: 37,\n      },\n    },\n  },\n  {\n    id: \"diabetic-default\",\n    name: \"Diabetic Patient\",\n    description: \"Type 2 diabetes patient with typical comorbidities\",\n    category: \"builtin\",\n    icon: \"glucose\",\n    context: {\n      chiefComplaint: \"Diabetes management follow-up\",\n      problems: [\n        \"Type 2 Diabetes Mellitus\",\n        \"Hypertension\",\n        \"Diabetic nephropathy Stage 2\",\n        \"Peripheral neuropathy\",\n      ],\n      medications: [\n        \"Metformin 1000mg twice daily\",\n        \"Empagliflozin 10mg daily\",\n        \"Lisinopril 20mg daily\",\n        \"Gabapentin 300mg three times daily\",\n      ],\n      vitals: {\n        bloodPressure: { systolic: 135, diastolic: 80 },\n        heartRate: 76,\n        respiratoryRate: 16,\n        oxygenSaturation: 98,\n        temperature: 37,\n        bloodGlucose: 145,\n      },\n    },\n  },\n  {\n    id: \"respiratory-default\",\n    name: \"Respiratory Patient\",\n    description: \"COPD patient with chronic respiratory conditions\",\n    category: \"builtin\",\n    icon: \"lungs\",\n    context: {\n      chiefComplaint: \"Shortness of breath and chronic cough\",\n      problems: [\n        \"COPD - Moderate (GOLD Stage II)\",\n        \"Chronic bronchitis\",\n        \"Former smoker (30 pack-years)\",\n      ],\n      medications: [\n        \"Tiotropium 18mcg inhaler daily\",\n        \"Fluticasone/Salmeterol 250/50 twice daily\",\n        \"Albuterol PRN\",\n        \"Prednisone 10mg (tapering dose)\",\n      ],\n      allergies: [\"Penicillin - rash\"],\n      vitals: {\n        bloodPressure: { systolic: 125, diastolic: 75 },\n        heartRate: 84,\n        respiratoryRate: 20,\n        oxygenSaturation: 93,\n        temperature: 37.2,\n      },\n    },\n  },\n  {\n    id: \"neurological-default\",\n    name: \"Neurological Patient\",\n    description: \"Patient with chronic neurological conditions\",\n    category: \"builtin\",\n    icon: \"brain\",\n    context: {\n      chiefComplaint: \"Neurological symptoms and follow-up care\",\n      problems: [\n        \"Parkinson's disease\",\n        \"Mild cognitive impairment\",\n        \"Orthostatic hypotension\",\n      ],\n      medications: [\n        \"Carbidopa/Levodopa 25/100mg three times daily\",\n        \"Pramipexole 0.5mg three times daily\",\n        \"Midodrine 5mg three times daily\",\n        \"Donepezil 10mg daily\",\n      ],\n      vitals: {\n        bloodPressure: { systolic: 110, diastolic: 65 },\n        heartRate: 68,\n        respiratoryRate: 16,\n        oxygenSaturation: 97,\n        temperature: 36.8,\n      },\n    },\n  },\n];\n\nexport interface ClinicalContextPresetPickerProps {\n  /** Currently selected preset ID */\n  selectedPresetId?: string | null;\n  /** User's custom presets */\n  customPresets?: ClinicalContextPreset[];\n  /** Called when a preset is selected */\n  onSelect: (preset: ClinicalContextPreset) => void;\n  /** Called when user wants to save current context as preset */\n  onSaveAsPreset?: () => void;\n  /** Called when user wants to delete a custom preset */\n  onDeletePreset?: (presetId: string) => void;\n  /** Called when user wants to edit a custom preset */\n  onEditPreset?: (preset: ClinicalContextPreset) => void;\n  /** Whether to show the save as preset button */\n  showSaveOption?: boolean;\n  /** Whether the picker is disabled */\n  disabled?: boolean;\n  /** Whether to show compact mode */\n  compact?: boolean;\n}\n\n/**\n * Get icon SVG for a preset category\n */\nfunction PresetIcon({ icon }: { icon?: string }) {\n  const iconMap: Record<string, React.ReactNode> = {\n    heart: (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n        strokeWidth={1.5}\n        stroke=\"currentColor\"\n        className=\"w-5 h-5\"\n      >\n        <path\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z\"\n        />\n      </svg>\n    ),\n    glucose: (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n        strokeWidth={1.5}\n        stroke=\"currentColor\"\n        className=\"w-5 h-5\"\n      >\n        <path\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23.693L5 15.5m14.8-.2l-1.046 3.662a2.25 2.25 0 01-1.708 1.617l-2.296.383a2.25 2.25 0 01-.75 0l-2.296-.383a2.25 2.25 0 01-1.708-1.617L5 15.5\"\n        />\n      </svg>\n    ),\n    lungs: (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n        strokeWidth={1.5}\n        stroke=\"currentColor\"\n        className=\"w-5 h-5\"\n      >\n        <path\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n        />\n      </svg>\n    ),\n    brain: (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n        strokeWidth={1.5}\n        stroke=\"currentColor\"\n        className=\"w-5 h-5\"\n      >\n        <path\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z\"\n        />\n      </svg>\n    ),\n    custom: (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        fill=\"none\"\n        viewBox=\"0 0 24 24\"\n        strokeWidth={1.5}\n        stroke=\"currentColor\"\n        className=\"w-5 h-5\"\n      >\n        <path\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          d=\"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z\"\n        />\n      </svg>\n    ),\n  };\n\n  return iconMap[icon || \"custom\"] || iconMap.custom;\n}\n\nexport function ClinicalContextPresetPicker({\n  selectedPresetId,\n  customPresets = [],\n  onSelect,\n  onSaveAsPreset,\n  onDeletePreset,\n  onEditPreset,\n  showSaveOption = true,\n  disabled = false,\n  compact = false,\n}: ClinicalContextPresetPickerProps) {\n  const [expandedSection, setExpandedSection] = useState<\n    \"builtin\" | \"custom\" | null\n  >(null);\n\n  const allPresets = useMemo(\n    () => [...BUILTIN_PRESETS, ...customPresets],\n    [customPresets],\n  );\n\n  const toggleSection = useCallback((section: \"builtin\" | \"custom\") => {\n    setExpandedSection((prev) => (prev === section ? null : section));\n  }, []);\n\n  const handleSelect = useCallback(\n    (preset: ClinicalContextPreset) => {\n      if (!disabled) {\n        onSelect(preset);\n      }\n    },\n    [disabled, onSelect],\n  );\n\n  if (compact) {\n    return (\n      <div className=\"space-y-2\" data-testid=\"preset-picker-compact\">\n        <label className=\"text-sm font-medium text-neutral-700\">\n          Clinical Preset\n        </label>\n        <select\n          value={selectedPresetId || \"\"}\n          onChange={(e) => {\n            const preset = allPresets.find((p) => p.id === e.target.value);\n            if (preset) handleSelect(preset);\n          }}\n          disabled={disabled}\n          className=\"w-full px-3 py-2 border border-neutral-300 rounded-lg text-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 disabled:opacity-50\"\n          data-testid=\"preset-select\"\n        >\n          <option value=\"\">Select a preset...</option>\n          <optgroup label=\"Medical Specialties\">\n            {BUILTIN_PRESETS.map((preset) => (\n              <option key={preset.id} value={preset.id}>\n                {preset.name}\n              </option>\n            ))}\n          </optgroup>\n          {customPresets.length > 0 && (\n            <optgroup label=\"Custom Presets\">\n              {customPresets.map((preset) => (\n                <option key={preset.id} value={preset.id}>\n                  {preset.name}\n                </option>\n              ))}\n            </optgroup>\n          )}\n        </select>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\" data-testid=\"preset-picker\">\n      {/* Built-in Presets Section */}\n      <div className=\"border rounded-lg overflow-hidden\">\n        <button\n          type=\"button\"\n          onClick={() => toggleSection(\"builtin\")}\n          className=\"w-full flex items-center justify-between px-4 py-3 bg-neutral-50 hover:bg-neutral-100 transition-colors\"\n          aria-expanded={expandedSection === \"builtin\"}\n          data-testid=\"builtin-presets-toggle\"\n        >\n          <span className=\"text-sm font-medium text-neutral-900\">\n            Medical Specialties\n          </span>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className={`w-4 h-4 transition-transform ${\n              expandedSection === \"builtin\" ? \"rotate-180\" : \"\"\n            }`}\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M19.5 8.25l-7.5 7.5-7.5-7.5\"\n            />\n          </svg>\n        </button>\n\n        {expandedSection === \"builtin\" && (\n          <div className=\"divide-y divide-neutral-100\">\n            {BUILTIN_PRESETS.map((preset) => (\n              <button\n                key={preset.id}\n                type=\"button\"\n                onClick={() => handleSelect(preset)}\n                disabled={disabled}\n                className={`\n                  w-full flex items-start gap-3 px-4 py-3 text-left transition-colors\n                  ${\n                    selectedPresetId === preset.id\n                      ? \"bg-primary-50 border-l-4 border-l-primary-500\"\n                      : \"hover:bg-neutral-50\"\n                  }\n                  ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"}\n                `}\n                data-testid={`preset-${preset.id}`}\n                aria-pressed={selectedPresetId === preset.id}\n              >\n                <div\n                  className={`\n                    flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center\n                    ${\n                      selectedPresetId === preset.id\n                        ? \"bg-primary-100 text-primary-700\"\n                        : \"bg-neutral-100 text-neutral-600\"\n                    }\n                  `}\n                >\n                  <PresetIcon icon={preset.icon} />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-neutral-900\">\n                    {preset.name}\n                  </p>\n                  <p className=\"text-xs text-neutral-500 mt-0.5\">\n                    {preset.description}\n                  </p>\n                </div>\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Custom Presets Section */}\n      <div className=\"border rounded-lg overflow-hidden\">\n        <button\n          type=\"button\"\n          onClick={() => toggleSection(\"custom\")}\n          className=\"w-full flex items-center justify-between px-4 py-3 bg-neutral-50 hover:bg-neutral-100 transition-colors\"\n          aria-expanded={expandedSection === \"custom\"}\n          data-testid=\"custom-presets-toggle\"\n        >\n          <span className=\"text-sm font-medium text-neutral-900\">\n            Custom Presets ({customPresets.length})\n          </span>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className={`w-4 h-4 transition-transform ${\n              expandedSection === \"custom\" ? \"rotate-180\" : \"\"\n            }`}\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M19.5 8.25l-7.5 7.5-7.5-7.5\"\n            />\n          </svg>\n        </button>\n\n        {expandedSection === \"custom\" && (\n          <div className=\"divide-y divide-neutral-100\">\n            {customPresets.length === 0 ? (\n              <div className=\"px-4 py-6 text-center text-sm text-neutral-500\">\n                No custom presets yet.\n                {showSaveOption && \" Save your current context as a preset.\"}\n              </div>\n            ) : (\n              customPresets.map((preset) => (\n                <div\n                  key={preset.id}\n                  className={`\n                    flex items-start gap-3 px-4 py-3 transition-colors\n                    ${\n                      selectedPresetId === preset.id\n                        ? \"bg-primary-50 border-l-4 border-l-primary-500\"\n                        : \"hover:bg-neutral-50\"\n                    }\n                  `}\n                >\n                  <button\n                    type=\"button\"\n                    onClick={() => handleSelect(preset)}\n                    disabled={disabled}\n                    className=\"flex-1 flex items-start gap-3 text-left\"\n                    data-testid={`preset-${preset.id}`}\n                    aria-pressed={selectedPresetId === preset.id}\n                  >\n                    <div\n                      className={`\n                        flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center\n                        ${\n                          selectedPresetId === preset.id\n                            ? \"bg-primary-100 text-primary-700\"\n                            : \"bg-neutral-100 text-neutral-600\"\n                        }\n                      `}\n                    >\n                      <PresetIcon icon=\"custom\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium text-neutral-900\">\n                        {preset.name}\n                      </p>\n                      <p className=\"text-xs text-neutral-500 mt-0.5\">\n                        {preset.description}\n                      </p>\n                    </div>\n                  </button>\n\n                  {/* Edit/Delete buttons */}\n                  <div className=\"flex items-center gap-1\">\n                    {onEditPreset && (\n                      <button\n                        type=\"button\"\n                        onClick={() => onEditPreset(preset)}\n                        className=\"p-1.5 text-neutral-400 hover:text-neutral-600 transition-colors\"\n                        aria-label={`Edit ${preset.name}`}\n                        data-testid={`edit-preset-${preset.id}`}\n                      >\n                        <svg\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          fill=\"none\"\n                          viewBox=\"0 0 24 24\"\n                          strokeWidth={1.5}\n                          stroke=\"currentColor\"\n                          className=\"w-4 h-4\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            d=\"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125\"\n                          />\n                        </svg>\n                      </button>\n                    )}\n                    {onDeletePreset && (\n                      <button\n                        type=\"button\"\n                        onClick={() => onDeletePreset(preset.id)}\n                        className=\"p-1.5 text-neutral-400 hover:text-red-600 transition-colors\"\n                        aria-label={`Delete ${preset.name}`}\n                        data-testid={`delete-preset-${preset.id}`}\n                      >\n                        <svg\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          fill=\"none\"\n                          viewBox=\"0 0 24 24\"\n                          strokeWidth={1.5}\n                          stroke=\"currentColor\"\n                          className=\"w-4 h-4\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            d=\"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0\"\n                          />\n                        </svg>\n                      </button>\n                    )}\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Save as Preset Button */}\n      {showSaveOption && onSaveAsPreset && (\n        <button\n          type=\"button\"\n          onClick={onSaveAsPreset}\n          disabled={disabled}\n          className=\"w-full flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium text-primary-700 bg-primary-50 hover:bg-primary-100 rounded-lg transition-colors disabled:opacity-50\"\n          data-testid=\"save-as-preset\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={1.5}\n            stroke=\"currentColor\"\n            className=\"w-5 h-5\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M12 4.5v15m7.5-7.5h-15\"\n            />\n          </svg>\n          Save Current Context as Preset\n        </button>\n      )}\n    </div>\n  );\n}\n\nexport default ClinicalContextPresetPicker;\n"
}
