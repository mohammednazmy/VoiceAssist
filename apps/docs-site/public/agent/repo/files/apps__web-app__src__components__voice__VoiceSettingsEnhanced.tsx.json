{
  "path": "apps/web-app/src/components/voice/VoiceSettingsEnhanced.tsx",
  "language": "typescript",
  "size": 24579,
  "last_modified": "2025-12-01T21:42:01.329Z",
  "lines": 692,
  "content": "/**\n * Enhanced Voice Settings Component\n * Configure voice input/output preferences with backend persistence\n *\n * Voice Mode Overhaul: Added context-aware style toggle and backend sync\n */\n\nimport { useState, useEffect, useRef } from \"react\";\nimport {\n  Label,\n  Card,\n  CardHeader,\n  CardTitle,\n  CardContent,\n} from \"@voiceassist/ui\";\nimport type { VADConfig } from \"../../utils/vad\";\nimport { DEFAULT_VAD_CONFIG } from \"../../utils/vad\";\nimport { useAuth } from \"../../hooks/useAuth\";\nimport { useVoiceSettingsStore } from \"../../stores/voiceSettingsStore\";\nimport { useVoicePreferencesSync } from \"../../hooks/useVoicePreferencesSync\";\n\nexport interface VoiceSettingsData {\n  // TTS Settings\n  voiceId?: string;\n  speed: number; // 0.5 to 2.0\n  volume: number; // 0 to 1\n  autoPlay: boolean;\n\n  // VAD Settings\n  vadEnabled: boolean;\n  vadEnergyThreshold: number; // 0 to 1\n  vadMinSpeechDuration: number; // ms\n  vadMaxSilenceDuration: number; // ms\n}\n\ninterface VoiceSettingsEnhancedProps {\n  onSettingsChange?: (settings: VoiceSettingsData) => void;\n  initialSettings?: Partial<VoiceSettingsData>;\n}\n\nconst DEFAULT_SETTINGS: VoiceSettingsData = {\n  voiceId: \"alloy\", // OpenAI TTS default voice\n  speed: 1.0,\n  volume: 0.8,\n  autoPlay: true,\n  vadEnabled: true,\n  vadEnergyThreshold: DEFAULT_VAD_CONFIG.energyThreshold,\n  vadMinSpeechDuration: DEFAULT_VAD_CONFIG.minSpeechDuration,\n  vadMaxSilenceDuration: DEFAULT_VAD_CONFIG.maxSilenceDuration,\n};\n\n// OpenAI TTS available voices\nconst AVAILABLE_VOICES = [\n  { id: \"alloy\", name: \"Alloy\", description: \"Neutral and balanced\" },\n  { id: \"echo\", name: \"Echo\", description: \"Warm and conversational\" },\n  { id: \"fable\", name: \"Fable\", description: \"Expressive and dynamic\" },\n  { id: \"onyx\", name: \"Onyx\", description: \"Deep and authoritative\" },\n  { id: \"nova\", name: \"Nova\", description: \"Energetic and youthful\" },\n  { id: \"shimmer\", name: \"Shimmer\", description: \"Soft and gentle\" },\n];\n\n// Sample sentences for voice testing\nconst VOICE_TEST_SAMPLES = [\n  \"Hello! This is a test of your selected voice settings.\",\n  \"The quick brown fox jumps over the lazy dog.\",\n  \"Welcome to VoiceAssist. How can I help you today?\",\n];\n\nexport function VoiceSettingsEnhanced({\n  onSettingsChange,\n  initialSettings,\n}: VoiceSettingsEnhancedProps) {\n  const { apiClient } = useAuth();\n\n  // Use zustand store for persistent settings\n  const {\n    voice,\n    playbackSpeed,\n    autoPlayInVoiceMode,\n    contextAwareStyle,\n    stability,\n    similarityBoost,\n    style: ttsStyle,\n    setVoice,\n    setPlaybackSpeed,\n    setAutoPlayInVoiceMode,\n    setContextAwareStyle,\n    setStability,\n    setSimilarityBoost,\n    setStyle,\n  } = useVoiceSettingsStore();\n\n  // Sync with backend\n  const { resetPreferences } = useVoicePreferencesSync();\n\n  // Local state for VAD and volume (not persisted to backend)\n  const [settings, setSettings] = useState<VoiceSettingsData>({\n    ...DEFAULT_SETTINGS,\n    ...initialSettings,\n    voiceId: voice,\n    speed: playbackSpeed,\n    autoPlay: autoPlayInVoiceMode,\n  });\n\n  const [showAdvanced, setShowAdvanced] = useState(false);\n  const [showTTSAdvanced, setShowTTSAdvanced] = useState(false);\n  const [isTestingVoice, setIsTestingVoice] = useState(false);\n  const [testError, setTestError] = useState<string | null>(null);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n\n  // Sync local state with store on mount\n  useEffect(() => {\n    setSettings((prev) => ({\n      ...prev,\n      voiceId: voice,\n      speed: playbackSpeed,\n      autoPlay: autoPlayInVoiceMode,\n    }));\n  }, [voice, playbackSpeed, autoPlayInVoiceMode]);\n\n  // Load VAD settings from localStorage on mount\n  useEffect(() => {\n    const stored = localStorage.getItem(\"voiceassist-voice-settings\");\n    if (stored) {\n      try {\n        const parsed = JSON.parse(stored);\n        setSettings((prev) => ({\n          ...prev,\n          vadEnabled: parsed.vadEnabled ?? prev.vadEnabled,\n          vadEnergyThreshold:\n            parsed.vadEnergyThreshold ?? prev.vadEnergyThreshold,\n          vadMinSpeechDuration:\n            parsed.vadMinSpeechDuration ?? prev.vadMinSpeechDuration,\n          vadMaxSilenceDuration:\n            parsed.vadMaxSilenceDuration ?? prev.vadMaxSilenceDuration,\n          volume: parsed.volume ?? prev.volume,\n        }));\n      } catch (err) {\n        console.error(\"Failed to parse voice settings:\", err);\n      }\n    }\n  }, []);\n\n  // Save VAD/volume settings to localStorage and notify parent\n  useEffect(() => {\n    localStorage.setItem(\n      \"voiceassist-voice-settings\",\n      JSON.stringify(settings),\n    );\n    onSettingsChange?.(settings);\n  }, [settings, onSettingsChange]);\n\n  const updateSetting = <K extends keyof VoiceSettingsData>(\n    key: K,\n    value: VoiceSettingsData[K],\n  ) => {\n    // Update local state\n    setSettings((prev) => ({ ...prev, [key]: value }));\n\n    // Sync to zustand store for backend-persisted settings\n    if (key === \"voiceId\" && typeof value === \"string\") {\n      setVoice(value);\n    } else if (key === \"speed\" && typeof value === \"number\") {\n      setPlaybackSpeed(value as 0.5 | 0.75 | 1 | 1.25 | 1.5 | 2);\n    } else if (key === \"autoPlay\" && typeof value === \"boolean\") {\n      setAutoPlayInVoiceMode(value);\n    }\n  };\n\n  const resetToDefaults = async () => {\n    await resetPreferences();\n    setSettings(DEFAULT_SETTINGS);\n  };\n\n  // Stop any currently playing test audio\n  const stopTestAudio = () => {\n    if (audioRef.current) {\n      audioRef.current.pause();\n      audioRef.current.currentTime = 0;\n      URL.revokeObjectURL(audioRef.current.src);\n      audioRef.current = null;\n    }\n  };\n\n  // Test voice with current settings\n  const testVoiceSettings = async () => {\n    // Stop any existing playback\n    stopTestAudio();\n\n    setIsTestingVoice(true);\n    setTestError(null);\n\n    try {\n      // Pick a random sample sentence\n      const sampleText =\n        VOICE_TEST_SAMPLES[\n          Math.floor(Math.random() * VOICE_TEST_SAMPLES.length)\n        ];\n\n      // Synthesize speech with current voice\n      const audioBlob = await apiClient.synthesizeSpeech(\n        sampleText,\n        settings.voiceId,\n      );\n\n      // Create audio element and play\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n      audioRef.current = audio;\n\n      // Apply settings\n      audio.volume = settings.volume;\n      audio.playbackRate = settings.speed;\n\n      // Handle playback end\n      audio.onended = () => {\n        setIsTestingVoice(false);\n        URL.revokeObjectURL(audioUrl);\n        audioRef.current = null;\n      };\n\n      // Handle errors\n      audio.onerror = () => {\n        setTestError(\"Failed to play audio\");\n        setIsTestingVoice(false);\n        URL.revokeObjectURL(audioUrl);\n        audioRef.current = null;\n      };\n\n      // Play the audio\n      await audio.play();\n    } catch (err: unknown) {\n      console.error(\"Voice test failed:\", err);\n      const errorMessage =\n        err instanceof Error ? err.message : \"Failed to test voice\";\n      setTestError(errorMessage);\n      setIsTestingVoice(false);\n    }\n  };\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      stopTestAudio();\n    };\n  }, []);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <span>Voice Settings</span>\n          <button\n            type=\"button\"\n            onClick={resetToDefaults}\n            className=\"text-xs text-neutral-500 hover:text-neutral-700 underline\"\n          >\n            Reset to defaults\n          </button>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Voice Selection */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"voice-id\">Voice</Label>\n          <select\n            id=\"voice-id\"\n            value={settings.voiceId}\n            onChange={(e) => updateSetting(\"voiceId\", e.target.value)}\n            className=\"w-full px-3 py-2 border border-neutral-300 rounded-md bg-white text-neutral-900 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n          >\n            {AVAILABLE_VOICES.map((voice) => (\n              <option key={voice.id} value={voice.id}>\n                {voice.name} - {voice.description}\n              </option>\n            ))}\n          </select>\n          <p className=\"text-xs text-neutral-500\">\n            Choose the AI voice for text-to-speech responses\n          </p>\n        </div>\n\n        {/* Voice Speed */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"voice-speed\">\n            Speech Speed: {settings.speed.toFixed(1)}x\n          </Label>\n          <input\n            id=\"voice-speed\"\n            type=\"range\"\n            min=\"0.5\"\n            max=\"2.0\"\n            step=\"0.1\"\n            value={settings.speed}\n            onChange={(e) => updateSetting(\"speed\", parseFloat(e.target.value))}\n            className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n            aria-label=\"Speech speed\"\n          />\n          <div className=\"flex justify-between text-xs text-neutral-500\">\n            <span>0.5x (Slower)</span>\n            <span>1.0x (Normal)</span>\n            <span>2.0x (Faster)</span>\n          </div>\n        </div>\n\n        {/* Volume */}\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"voice-volume\">\n            Volume: {Math.round(settings.volume * 100)}%\n          </Label>\n          <input\n            id=\"voice-volume\"\n            type=\"range\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.1\"\n            value={settings.volume}\n            onChange={(e) =>\n              updateSetting(\"volume\", parseFloat(e.target.value))\n            }\n            className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n            aria-label=\"Volume\"\n          />\n          <div className=\"flex justify-between text-xs text-neutral-500\">\n            <span>Mute</span>\n            <span>100%</span>\n          </div>\n        </div>\n\n        {/* Auto-play */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1\">\n            <Label htmlFor=\"auto-play\" className=\"font-medium\">\n              Auto-play Responses\n            </Label>\n            <p className=\"text-sm text-neutral-600 mt-1\">\n              Automatically play audio responses when received\n            </p>\n          </div>\n          <label className=\"relative inline-flex items-center cursor-pointer ml-4\">\n            <input\n              id=\"auto-play\"\n              type=\"checkbox\"\n              checked={settings.autoPlay}\n              onChange={(e) => updateSetting(\"autoPlay\", e.target.checked)}\n              className=\"sr-only peer\"\n            />\n            <div className=\"w-11 h-6 bg-neutral-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-neutral-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500\"></div>\n          </label>\n        </div>\n\n        {/* Context-Aware Style */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex-1\">\n            <Label htmlFor=\"context-aware-style\" className=\"font-medium\">\n              Context-Aware Voice Style\n            </Label>\n            <p className=\"text-sm text-neutral-600 mt-1\">\n              Automatically adjust voice tone based on content (urgent,\n              empathetic, etc.)\n            </p>\n          </div>\n          <label className=\"relative inline-flex items-center cursor-pointer ml-4\">\n            <input\n              id=\"context-aware-style\"\n              type=\"checkbox\"\n              checked={contextAwareStyle}\n              onChange={(e) => setContextAwareStyle(e.target.checked)}\n              className=\"sr-only peer\"\n            />\n            <div className=\"w-11 h-6 bg-neutral-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-neutral-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500\"></div>\n          </label>\n        </div>\n\n        {/* Advanced TTS Settings Toggle */}\n        <button\n          type=\"button\"\n          onClick={() => setShowTTSAdvanced(!showTTSAdvanced)}\n          className=\"w-full flex items-center justify-between px-3 py-2 text-sm text-neutral-700 bg-neutral-50 rounded-md hover:bg-neutral-100 transition-colors\"\n        >\n          <span className=\"font-medium\">Advanced Voice Quality</span>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className={`w-4 h-4 transition-transform ${showTTSAdvanced ? \"rotate-180\" : \"\"}`}\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M19 9l-7 7-7-7\"\n            />\n          </svg>\n        </button>\n\n        {/* Advanced TTS Settings */}\n        {showTTSAdvanced && (\n          <div className=\"space-y-4 pt-2 border-t border-neutral-200\">\n            {/* Stability */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tts-stability\">\n                Voice Stability: {Math.round(stability * 100)}%\n              </Label>\n              <input\n                id=\"tts-stability\"\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.05\"\n                value={stability}\n                onChange={(e) => setStability(parseFloat(e.target.value))}\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                aria-label=\"Voice stability\"\n              />\n              <p className=\"text-xs text-neutral-500\">\n                Lower = more expressive, Higher = more consistent\n              </p>\n            </div>\n\n            {/* Similarity Boost */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tts-similarity\">\n                Voice Clarity: {Math.round(similarityBoost * 100)}%\n              </Label>\n              <input\n                id=\"tts-similarity\"\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.05\"\n                value={similarityBoost}\n                onChange={(e) => setSimilarityBoost(parseFloat(e.target.value))}\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                aria-label=\"Voice clarity\"\n              />\n              <p className=\"text-xs text-neutral-500\">\n                Higher values produce clearer, more consistent voice\n              </p>\n            </div>\n\n            {/* Style/Emotion */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tts-style\">\n                Expressiveness: {Math.round(ttsStyle * 100)}%\n              </Label>\n              <input\n                id=\"tts-style\"\n                type=\"range\"\n                min=\"0\"\n                max=\"1\"\n                step=\"0.05\"\n                value={ttsStyle}\n                onChange={(e) => setStyle(parseFloat(e.target.value))}\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                aria-label=\"Voice expressiveness\"\n              />\n              <p className=\"text-xs text-neutral-500\">\n                Higher values add more emotion and style variation\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* VAD Toggle */}\n        <div className=\"flex items-center justify-between pt-3 border-t border-neutral-200\">\n          <div className=\"flex-1\">\n            <Label htmlFor=\"vad-enabled\" className=\"font-medium\">\n              Voice Activity Detection (VAD)\n            </Label>\n            <p className=\"text-sm text-neutral-600 mt-1\">\n              Automatically detect when you start and stop speaking\n            </p>\n          </div>\n          <label className=\"relative inline-flex items-center cursor-pointer ml-4\">\n            <input\n              id=\"vad-enabled\"\n              type=\"checkbox\"\n              checked={settings.vadEnabled}\n              onChange={(e) => updateSetting(\"vadEnabled\", e.target.checked)}\n              className=\"sr-only peer\"\n            />\n            <div className=\"w-11 h-6 bg-neutral-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-neutral-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-500\"></div>\n          </label>\n        </div>\n\n        {/* Advanced Settings Toggle */}\n        <button\n          type=\"button\"\n          onClick={() => setShowAdvanced(!showAdvanced)}\n          className=\"w-full flex items-center justify-between px-3 py-2 text-sm text-neutral-700 bg-neutral-50 rounded-md hover:bg-neutral-100 transition-colors\"\n        >\n          <span className=\"font-medium\">Advanced VAD Settings</span>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className={`w-4 h-4 transition-transform ${showAdvanced ? \"rotate-180\" : \"\"}`}\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M19 9l-7 7-7-7\"\n            />\n          </svg>\n        </button>\n\n        {/* Advanced VAD Settings */}\n        {showAdvanced && settings.vadEnabled && (\n          <div className=\"space-y-4 pt-2 border-t border-neutral-200\">\n            {/* Energy Threshold */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"vad-threshold\">\n                Energy Threshold:{\" \"}\n                {(settings.vadEnergyThreshold * 100).toFixed(0)}%\n              </Label>\n              <input\n                id=\"vad-threshold\"\n                type=\"range\"\n                min=\"0.01\"\n                max=\"0.1\"\n                step=\"0.01\"\n                value={settings.vadEnergyThreshold}\n                onChange={(e) =>\n                  updateSetting(\n                    \"vadEnergyThreshold\",\n                    parseFloat(e.target.value),\n                  )\n                }\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                aria-label=\"VAD energy threshold\"\n              />\n              <p className=\"text-xs text-neutral-500\">\n                Higher values require louder speech to trigger detection\n              </p>\n            </div>\n\n            {/* Min Speech Duration */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"vad-min-duration\">\n                Minimum Speech Duration: {settings.vadMinSpeechDuration}ms\n              </Label>\n              <input\n                id=\"vad-min-duration\"\n                type=\"range\"\n                min=\"100\"\n                max=\"1000\"\n                step=\"50\"\n                value={settings.vadMinSpeechDuration}\n                onChange={(e) =>\n                  updateSetting(\n                    \"vadMinSpeechDuration\",\n                    parseInt(e.target.value),\n                  )\n                }\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                aria-label=\"Minimum speech duration\"\n              />\n              <p className=\"text-xs text-neutral-500\">\n                Minimum time speaking before recording starts\n              </p>\n            </div>\n\n            {/* Max Silence Duration */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"vad-max-silence\">\n                Maximum Silence Duration: {settings.vadMaxSilenceDuration}ms\n              </Label>\n              <input\n                id=\"vad-max-silence\"\n                type=\"range\"\n                min=\"500\"\n                max=\"3000\"\n                step=\"100\"\n                value={settings.vadMaxSilenceDuration}\n                onChange={(e) =>\n                  updateSetting(\n                    \"vadMaxSilenceDuration\",\n                    parseInt(e.target.value),\n                  )\n                }\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                aria-label=\"Maximum silence duration\"\n              />\n              <p className=\"text-xs text-neutral-500\">\n                Maximum silence before stopping recording\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* Test Voice Button */}\n        <div className=\"pt-3 border-t border-neutral-200 space-y-2\">\n          <button\n            type=\"button\"\n            className={`w-full px-4 py-2 rounded-md transition-colors font-medium flex items-center justify-center gap-2 ${\n              isTestingVoice\n                ? \"bg-red-500 hover:bg-red-600 text-white\"\n                : \"bg-primary-500 hover:bg-primary-600 text-white\"\n            }`}\n            onClick={isTestingVoice ? stopTestAudio : testVoiceSettings}\n            disabled={isTestingVoice && !audioRef.current}\n          >\n            {isTestingVoice ? (\n              <>\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={2}\n                  stroke=\"currentColor\"\n                  className=\"w-5 h-5\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M5.25 7.5A2.25 2.25 0 017.5 5.25h9a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-9a2.25 2.25 0 01-2.25-2.25v-9z\"\n                  />\n                </svg>\n                Stop Playback\n              </>\n            ) : (\n              <>\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  fill=\"none\"\n                  viewBox=\"0 0 24 24\"\n                  strokeWidth={2}\n                  stroke=\"currentColor\"\n                  className=\"w-5 h-5\"\n                >\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z\"\n                  />\n                </svg>\n                Test Voice Settings\n              </>\n            )}\n          </button>\n          {testError && (\n            <p className=\"text-xs text-red-500 text-center\">{testError}</p>\n          )}\n          <p className=\"text-xs text-neutral-500 text-center\">\n            Hear how your voice settings sound with \"{settings.voiceId}\" voice\n            at {settings.speed}x speed\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\n/**\n * Hook to use voice settings\n */\nexport function useVoiceSettings() {\n  const [settings, setSettings] = useState<VoiceSettingsData>(DEFAULT_SETTINGS);\n\n  useEffect(() => {\n    const stored = localStorage.getItem(\"voiceassist-voice-settings\");\n    if (stored) {\n      try {\n        const parsed = JSON.parse(stored);\n        setSettings({ ...DEFAULT_SETTINGS, ...parsed });\n      } catch (err) {\n        console.error(\"Failed to parse voice settings:\", err);\n      }\n    }\n  }, []);\n\n  const getVADConfig = (): VADConfig => {\n    return {\n      energyThreshold: settings.vadEnergyThreshold,\n      minSpeechDuration: settings.vadMinSpeechDuration,\n      maxSilenceDuration: settings.vadMaxSilenceDuration,\n      sampleRate: DEFAULT_VAD_CONFIG.sampleRate,\n      fftSize: DEFAULT_VAD_CONFIG.fftSize,\n    };\n  };\n\n  return {\n    settings,\n    setSettings,\n    getVADConfig,\n  };\n}\n"
}
