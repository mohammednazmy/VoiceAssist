{
  "path": "apps/admin-panel/src/components/feature-flags/ScheduledChangesPanel.tsx",
  "language": "typescript",
  "size": 29636,
  "last_modified": "2025-12-04T12:32:40.221Z",
  "lines": 896,
  "content": "/**\n * Scheduled Variant Changes Panel\n *\n * Admin panel component for viewing, editing, and cancelling scheduled\n * variant weight changes for feature flags.\n *\n * Features:\n * - List all upcoming scheduled changes\n * - Display scheduled time in user's local timezone\n * - Edit scheduled changes (time, weights, description)\n * - Cancel scheduled changes\n * - Preview change impact\n * - Full accessibility support (keyboard nav, ARIA labels)\n */\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\nimport {\n  useScheduledChanges,\n  ScheduledChange,\n  ScheduledChangeCreate,\n  ScheduledChangeUpdate,\n  ScheduledChangePreview,\n} from \"../../hooks/useScheduledChanges\";\nimport {\n  DataPanel,\n  StatusBadge,\n  ConfirmDialog,\n  EmptyState,\n  LoadingGrid,\n  ErrorState,\n  RefreshButton,\n} from \"../shared\";\n\ninterface ScheduledChangesPanelProps {\n  /** Optional: filter to specific flag name */\n  flagName?: string;\n  /** Callback when a change is created */\n  onChangeCreated?: () => void;\n  /** Callback when a change is cancelled */\n  onChangeCancelled?: () => void;\n  /** Whether user has admin permissions */\n  isAdmin?: boolean;\n}\n\nexport function ScheduledChangesPanel({\n  flagName,\n  onChangeCreated,\n  onChangeCancelled,\n  isAdmin = false,\n}: ScheduledChangesPanelProps) {\n  const {\n    scheduledChanges,\n    loading,\n    error,\n    lastUpdated: _lastUpdated,\n    refreshChanges,\n    createChange,\n    updateChange,\n    cancelChange,\n    deleteChange: _deleteChange,\n    previewChange,\n  } = useScheduledChanges();\n\n  // Filter changes for specific flag if provided\n  const filteredChanges = flagName\n    ? scheduledChanges.filter((c) => c.flag_name === flagName)\n    : scheduledChanges;\n\n  // Modal states\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [editingChange, setEditingChange] = useState<ScheduledChange | null>(\n    null,\n  );\n  const [cancellingChange, setCancellingChange] =\n    useState<ScheduledChange | null>(null);\n  const [previewData, setPreviewData] = useState<{\n    change: ScheduledChange;\n    preview: ScheduledChangePreview;\n  } | null>(null);\n  const [updating, setUpdating] = useState(false);\n\n  // Form state\n  const [formFlagName, setFormFlagName] = useState(flagName || \"\");\n  const [formScheduledAt, setFormScheduledAt] = useState(\"\");\n  const [formTimezone, setFormTimezone] = useState(\n    Intl.DateTimeFormat().resolvedOptions().timeZone,\n  );\n  const [formDescription, setFormDescription] = useState(\"\");\n  const [formChanges, setFormChanges] = useState<Record<string, number>>({});\n\n  // Focus management refs\n  const createButtonRef = useRef<HTMLButtonElement>(null);\n  const modalFirstFocusRef = useRef<HTMLInputElement>(null);\n\n  // Reset form\n  const resetForm = useCallback(() => {\n    setFormFlagName(flagName || \"\");\n    setFormScheduledAt(\"\");\n    setFormTimezone(Intl.DateTimeFormat().resolvedOptions().timeZone);\n    setFormDescription(\"\");\n    setFormChanges({});\n  }, [flagName]);\n\n  // Open create modal\n  const openCreateModal = useCallback(() => {\n    resetForm();\n    setShowCreateModal(true);\n  }, [resetForm]);\n\n  // Close create modal and return focus\n  const closeCreateModal = useCallback(() => {\n    setShowCreateModal(false);\n    createButtonRef.current?.focus();\n  }, []);\n\n  // Open edit modal\n  const openEditModal = useCallback((change: ScheduledChange) => {\n    setFormFlagName(change.flag_name);\n    setFormScheduledAt(change.scheduled_at.slice(0, 16)); // Format for datetime-local\n    setFormTimezone(change.timezone_id);\n    setFormDescription(change.description || \"\");\n    setFormChanges(change.changes);\n    setEditingChange(change);\n  }, []);\n\n  // Close edit modal\n  const closeEditModal = useCallback(() => {\n    setEditingChange(null);\n    resetForm();\n  }, [resetForm]);\n\n  // Handle create\n  const handleCreate = useCallback(async () => {\n    if (!formFlagName) return;\n\n    setUpdating(true);\n    const newChange: ScheduledChangeCreate = {\n      scheduled_at: new Date(formScheduledAt).toISOString(),\n      changes: formChanges,\n      description: formDescription || undefined,\n      timezone_id: formTimezone,\n    };\n\n    const success = await createChange(formFlagName, newChange);\n    if (success) {\n      closeCreateModal();\n      onChangeCreated?.();\n    }\n    setUpdating(false);\n  }, [\n    formFlagName,\n    formScheduledAt,\n    formChanges,\n    formDescription,\n    formTimezone,\n    createChange,\n    closeCreateModal,\n    onChangeCreated,\n  ]);\n\n  // Handle update\n  const handleUpdate = useCallback(async () => {\n    if (!editingChange) return;\n\n    setUpdating(true);\n    const updates: ScheduledChangeUpdate = {\n      scheduled_at: new Date(formScheduledAt).toISOString(),\n      changes: formChanges,\n      description: formDescription || undefined,\n      timezone_id: formTimezone,\n    };\n\n    const success = await updateChange(\n      editingChange.flag_name,\n      editingChange.id,\n      updates,\n    );\n    if (success) {\n      closeEditModal();\n    }\n    setUpdating(false);\n  }, [\n    editingChange,\n    formScheduledAt,\n    formChanges,\n    formDescription,\n    formTimezone,\n    updateChange,\n    closeEditModal,\n  ]);\n\n  // Handle cancel\n  const handleCancel = useCallback(async () => {\n    if (!cancellingChange) return;\n\n    setUpdating(true);\n    const success = await cancelChange(\n      cancellingChange.flag_name,\n      cancellingChange.id,\n    );\n    if (success) {\n      setCancellingChange(null);\n      onChangeCancelled?.();\n    }\n    setUpdating(false);\n  }, [cancellingChange, cancelChange, onChangeCancelled]);\n\n  // Handle preview\n  const handlePreview = useCallback(\n    async (change: ScheduledChange) => {\n      const preview = await previewChange(change.flag_name, change.id);\n      if (preview) {\n        setPreviewData({ change, preview });\n      }\n    },\n    [previewChange],\n  );\n\n  // Focus first input when modal opens\n  useEffect(() => {\n    if (showCreateModal || editingChange) {\n      setTimeout(() => modalFirstFocusRef.current?.focus(), 100);\n    }\n  }, [showCreateModal, editingChange]);\n\n  // Format date for display in user's locale\n  const formatScheduledTime = (isoDate: string, timezone: string) => {\n    try {\n      return new Intl.DateTimeFormat(\"en-US\", {\n        dateStyle: \"medium\",\n        timeStyle: \"short\",\n        timeZone: timezone,\n      }).format(new Date(isoDate));\n    } catch {\n      return new Date(isoDate).toLocaleString();\n    }\n  };\n\n  // Get status badge for change\n  const getChangeBadge = (change: ScheduledChange) => {\n    if (change.cancelled) {\n      return <StatusBadge status=\"error\" label=\"Cancelled\" size=\"sm\" />;\n    }\n    if (change.applied) {\n      return <StatusBadge status=\"online\" label=\"Applied\" size=\"sm\" />;\n    }\n    const scheduledDate = new Date(change.scheduled_at);\n    const now = new Date();\n    const hoursUntil =\n      (scheduledDate.getTime() - now.getTime()) / (1000 * 60 * 60);\n\n    if (hoursUntil < 1) {\n      return <StatusBadge status=\"warning\" label=\"Imminent\" size=\"sm\" />;\n    }\n    if (hoursUntil < 24) {\n      return <StatusBadge status=\"info\" label=\"Today\" size=\"sm\" />;\n    }\n    return <StatusBadge status=\"pending\" label=\"Pending\" size=\"sm\" />;\n  };\n\n  // Loading state\n  if (loading && !scheduledChanges.length) {\n    return <LoadingGrid count={3} cols={1} />;\n  }\n\n  return (\n    <>\n      <DataPanel\n        title={\n          flagName\n            ? `Scheduled Changes for ${flagName}`\n            : `All Scheduled Changes (${filteredChanges.length})`\n        }\n        noPadding\n        actions={\n          <div className=\"flex items-center gap-2\">\n            {isAdmin && (\n              <button\n                ref={createButtonRef}\n                type=\"button\"\n                onClick={openCreateModal}\n                className=\"px-3 py-1.5 text-xs font-medium bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-900\"\n                aria-label=\"Schedule new variant change\"\n              >\n                Schedule Change\n              </button>\n            )}\n            <RefreshButton\n              onClick={refreshChanges}\n              isLoading={loading}\n              aria-label=\"Refresh scheduled changes\"\n            />\n          </div>\n        }\n      >\n        {error && <ErrorState message={error} onRetry={refreshChanges} />}\n\n        {filteredChanges.length === 0 ? (\n          <div className=\"p-4\">\n            <EmptyState\n              message=\"No scheduled changes\"\n              icon=\"ðŸ“…\"\n              action={\n                isAdmin\n                  ? {\n                      label: \"Schedule First Change\",\n                      onClick: openCreateModal,\n                    }\n                  : undefined\n              }\n            />\n          </div>\n        ) : (\n          <div\n            className=\"divide-y divide-slate-800\"\n            role=\"list\"\n            aria-label=\"Scheduled variant changes\"\n          >\n            {filteredChanges.map((change, _index) => (\n              <div\n                key={change.id}\n                className=\"p-4 hover:bg-slate-800/30 transition-colors focus-within:ring-2 focus-within:ring-blue-500 focus-within:ring-inset\"\n                role=\"listitem\"\n                tabIndex={0}\n                aria-label={`Scheduled change for ${change.flag_name} at ${formatScheduledTime(change.scheduled_at, change.timezone_id)}`}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\" && isAdmin && !change.cancelled) {\n                    openEditModal(change);\n                  }\n                }}\n              >\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div className=\"flex-1 min-w-0\">\n                    {/* Header row */}\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <h4 className=\"font-medium text-slate-200 truncate\">\n                        {change.flag_name}\n                      </h4>\n                      {getChangeBadge(change)}\n                    </div>\n\n                    {/* Scheduled time */}\n                    <p className=\"text-sm text-slate-300 mb-1\">\n                      <span className=\"text-slate-500\">Scheduled:</span>{\" \"}\n                      {formatScheduledTime(\n                        change.scheduled_at,\n                        change.timezone_id,\n                      )}\n                      <span className=\"text-slate-500 text-xs ml-2\">\n                        ({change.timezone_id})\n                      </span>\n                    </p>\n\n                    {/* Description */}\n                    {change.description && (\n                      <p className=\"text-sm text-slate-400 mb-2\">\n                        {change.description}\n                      </p>\n                    )}\n\n                    {/* Weight changes */}\n                    <div className=\"flex flex-wrap gap-2 mt-2\">\n                      {Object.entries(change.changes).map(\n                        ([variant, weight]) => (\n                          <span\n                            key={variant}\n                            className=\"text-xs font-mono bg-slate-800/50 px-2 py-1 rounded\"\n                          >\n                            {variant}: {weight}%\n                          </span>\n                        ),\n                      )}\n                    </div>\n\n                    {/* Metadata */}\n                    <p className=\"text-xs text-slate-500 mt-2\">\n                      Created: {new Date(change.created_at).toLocaleString()}\n                      {change.created_by && ` by ${change.created_by}`}\n                    </p>\n                  </div>\n\n                  {/* Actions */}\n                  {isAdmin && !change.cancelled && !change.applied && (\n                    <div\n                      className=\"flex items-center gap-2\"\n                      role=\"group\"\n                      aria-label={`Actions for ${change.flag_name} scheduled change`}\n                    >\n                      <button\n                        type=\"button\"\n                        onClick={() => handlePreview(change)}\n                        className=\"px-2 py-1 text-xs font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                        aria-label={`Preview change for ${change.flag_name}`}\n                      >\n                        Preview\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={() => openEditModal(change)}\n                        className=\"px-2 py-1 text-xs font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                        aria-label={`Edit change for ${change.flag_name}`}\n                      >\n                        Edit\n                      </button>\n                      <button\n                        type=\"button\"\n                        onClick={() => setCancellingChange(change)}\n                        className=\"px-2 py-1 text-xs font-medium text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-red-500\"\n                        aria-label={`Cancel change for ${change.flag_name}`}\n                      >\n                        Cancel\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </DataPanel>\n\n      {/* Create Modal */}\n      {showCreateModal && (\n        <ScheduledChangeFormModal\n          title=\"Schedule Variant Change\"\n          formFlagName={formFlagName}\n          formScheduledAt={formScheduledAt}\n          formTimezone={formTimezone}\n          formDescription={formDescription}\n          formChanges={formChanges}\n          onFlagNameChange={setFormFlagName}\n          onScheduledAtChange={setFormScheduledAt}\n          onTimezoneChange={setFormTimezone}\n          onDescriptionChange={setFormDescription}\n          onChangesChange={setFormChanges}\n          onSubmit={handleCreate}\n          onCancel={closeCreateModal}\n          isLoading={updating}\n          isEdit={false}\n          showFlagName={!flagName}\n          firstFocusRef={modalFirstFocusRef}\n        />\n      )}\n\n      {/* Edit Modal */}\n      {editingChange && (\n        <ScheduledChangeFormModal\n          title={`Edit: ${editingChange.flag_name}`}\n          formFlagName={formFlagName}\n          formScheduledAt={formScheduledAt}\n          formTimezone={formTimezone}\n          formDescription={formDescription}\n          formChanges={formChanges}\n          onFlagNameChange={setFormFlagName}\n          onScheduledAtChange={setFormScheduledAt}\n          onTimezoneChange={setFormTimezone}\n          onDescriptionChange={setFormDescription}\n          onChangesChange={setFormChanges}\n          onSubmit={handleUpdate}\n          onCancel={closeEditModal}\n          isLoading={updating}\n          isEdit={true}\n          showFlagName={false}\n          firstFocusRef={modalFirstFocusRef}\n        />\n      )}\n\n      {/* Cancel Confirmation */}\n      <ConfirmDialog\n        isOpen={!!cancellingChange}\n        onClose={() => setCancellingChange(null)}\n        onConfirm={handleCancel}\n        title=\"Cancel Scheduled Change\"\n        message={\n          <>\n            Are you sure you want to cancel the scheduled change for{\" \"}\n            <strong className=\"text-slate-200\">\n              {cancellingChange?.flag_name}\n            </strong>\n            ? This action cannot be undone.\n          </>\n        }\n        confirmLabel=\"Cancel Change\"\n        variant=\"danger\"\n        isLoading={updating}\n      />\n\n      {/* Preview Modal */}\n      {previewData && (\n        <PreviewModal\n          change={previewData.change}\n          preview={previewData.preview}\n          onClose={() => setPreviewData(null)}\n        />\n      )}\n    </>\n  );\n}\n\n// Form Modal Component\ninterface ScheduledChangeFormModalProps {\n  title: string;\n  formFlagName: string;\n  formScheduledAt: string;\n  formTimezone: string;\n  formDescription: string;\n  formChanges: Record<string, number>;\n  onFlagNameChange: (value: string) => void;\n  onScheduledAtChange: (value: string) => void;\n  onTimezoneChange: (value: string) => void;\n  onDescriptionChange: (value: string) => void;\n  onChangesChange: (value: Record<string, number>) => void;\n  onSubmit: () => void;\n  onCancel: () => void;\n  isLoading: boolean;\n  isEdit: boolean;\n  showFlagName: boolean;\n  firstFocusRef: React.RefObject<HTMLInputElement>;\n}\n\nfunction ScheduledChangeFormModal({\n  title,\n  formFlagName,\n  formScheduledAt,\n  formTimezone,\n  formDescription,\n  formChanges,\n  onFlagNameChange,\n  onScheduledAtChange,\n  onTimezoneChange,\n  onDescriptionChange,\n  onChangesChange,\n  onSubmit,\n  onCancel,\n  isLoading,\n  isEdit,\n  showFlagName,\n  firstFocusRef,\n}: ScheduledChangeFormModalProps) {\n  // Common timezones\n  const timezones = [\n    \"UTC\",\n    \"America/New_York\",\n    \"America/Los_Angeles\",\n    \"America/Chicago\",\n    \"Europe/London\",\n    \"Europe/Paris\",\n    \"Asia/Tokyo\",\n    \"Asia/Singapore\",\n    \"Australia/Sydney\",\n  ];\n\n  // Variant input management\n  const [newVariantName, setNewVariantName] = useState(\"\");\n  const [newVariantWeight, setNewVariantWeight] = useState(0);\n\n  const addVariant = () => {\n    if (newVariantName && !formChanges[newVariantName]) {\n      onChangesChange({ ...formChanges, [newVariantName]: newVariantWeight });\n      setNewVariantName(\"\");\n      setNewVariantWeight(0);\n    }\n  };\n\n  const updateVariantWeight = (name: string, weight: number) => {\n    onChangesChange({ ...formChanges, [name]: weight });\n  };\n\n  const removeVariant = (name: string) => {\n    const updated = { ...formChanges };\n    delete updated[name];\n    onChangesChange(updated);\n  };\n\n  // Trap focus in modal\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Escape\") {\n      onCancel();\n    }\n  };\n\n  // Calculate total weight\n  const totalWeight = Object.values(formChanges).reduce((a, b) => a + b, 0);\n  const isValidWeight = totalWeight === 100;\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby=\"modal-title\"\n      onKeyDown={handleKeyDown}\n    >\n      <div\n        className=\"bg-slate-900 rounded-lg p-6 max-w-lg w-full mx-4 border border-slate-700 max-h-[90vh] overflow-y-auto\"\n        role=\"document\"\n      >\n        <h3\n          id=\"modal-title\"\n          className=\"text-lg font-semibold text-slate-100 mb-4\"\n        >\n          {title}\n        </h3>\n\n        <div className=\"space-y-4\">\n          {/* Flag Name */}\n          {showFlagName && (\n            <div>\n              <label\n                htmlFor=\"flag-name\"\n                className=\"block text-sm font-medium text-slate-300 mb-1\"\n              >\n                Flag Name\n              </label>\n              <input\n                ref={firstFocusRef}\n                id=\"flag-name\"\n                type=\"text\"\n                value={formFlagName}\n                onChange={(e) => onFlagNameChange(e.target.value)}\n                disabled={isEdit}\n                placeholder=\"feature.flag_name\"\n                className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                aria-required=\"true\"\n              />\n            </div>\n          )}\n\n          {/* Scheduled Time */}\n          <div>\n            <label\n              htmlFor=\"scheduled-at\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Scheduled Time\n            </label>\n            <input\n              ref={showFlagName ? undefined : firstFocusRef}\n              id=\"scheduled-at\"\n              type=\"datetime-local\"\n              value={formScheduledAt}\n              onChange={(e) => onScheduledAtChange(e.target.value)}\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              aria-required=\"true\"\n            />\n          </div>\n\n          {/* Timezone */}\n          <div>\n            <label\n              htmlFor=\"timezone\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Timezone\n            </label>\n            <select\n              id=\"timezone\"\n              value={formTimezone}\n              onChange={(e) => onTimezoneChange(e.target.value)}\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              {timezones.map((tz) => (\n                <option key={tz} value={tz}>\n                  {tz}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* Description */}\n          <div>\n            <label\n              htmlFor=\"description\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Description (optional)\n            </label>\n            <textarea\n              id=\"description\"\n              value={formDescription}\n              onChange={(e) => onDescriptionChange(e.target.value)}\n              placeholder=\"Describe the purpose of this change...\"\n              rows={2}\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {/* Variant Weights */}\n          <div>\n            <label className=\"block text-sm font-medium text-slate-300 mb-2\">\n              Variant Weights\n              <span\n                className={`ml-2 text-xs ${isValidWeight ? \"text-green-400\" : \"text-red-400\"}`}\n              >\n                (Total: {totalWeight}%{!isValidWeight && \" - must equal 100%\"})\n              </span>\n            </label>\n\n            {/* Existing variants */}\n            <div className=\"space-y-2 mb-3\">\n              {Object.entries(formChanges).map(([name, weight]) => (\n                <div\n                  key={name}\n                  className=\"flex items-center gap-2\"\n                  role=\"group\"\n                  aria-label={`Variant ${name}`}\n                >\n                  <span className=\"flex-1 text-sm text-slate-300 font-mono\">\n                    {name}\n                  </span>\n                  <input\n                    type=\"number\"\n                    value={weight}\n                    onChange={(e) =>\n                      updateVariantWeight(name, parseInt(e.target.value) || 0)\n                    }\n                    min={0}\n                    max={100}\n                    className=\"w-20 px-2 py-1 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    aria-label={`Weight for ${name}`}\n                  />\n                  <span className=\"text-slate-500 text-sm\">%</span>\n                  <button\n                    type=\"button\"\n                    onClick={() => removeVariant(name)}\n                    className=\"px-2 py-1 text-xs text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded focus:outline-none focus:ring-2 focus:ring-red-500\"\n                    aria-label={`Remove ${name}`}\n                  >\n                    Remove\n                  </button>\n                </div>\n              ))}\n            </div>\n\n            {/* Add new variant */}\n            <div className=\"flex items-center gap-2 pt-2 border-t border-slate-700\">\n              <input\n                type=\"text\"\n                value={newVariantName}\n                onChange={(e) => setNewVariantName(e.target.value)}\n                placeholder=\"variant_name\"\n                className=\"flex-1 px-2 py-1 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                aria-label=\"New variant name\"\n              />\n              <input\n                type=\"number\"\n                value={newVariantWeight}\n                onChange={(e) =>\n                  setNewVariantWeight(parseInt(e.target.value) || 0)\n                }\n                min={0}\n                max={100}\n                className=\"w-20 px-2 py-1 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                aria-label=\"New variant weight\"\n              />\n              <span className=\"text-slate-500 text-sm\">%</span>\n              <button\n                type=\"button\"\n                onClick={addVariant}\n                disabled={!newVariantName}\n                className=\"px-2 py-1 text-xs font-medium bg-slate-700 hover:bg-slate-600 disabled:opacity-50 text-slate-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500\"\n              >\n                Add\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"mt-6 flex justify-end gap-3\">\n          <button\n            type=\"button\"\n            onClick={onCancel}\n            disabled={isLoading}\n            className=\"px-4 py-2 text-sm font-medium text-slate-300 hover:text-slate-100 bg-slate-800 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-slate-500\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={onSubmit}\n            disabled={\n              isLoading ||\n              !formScheduledAt ||\n              Object.keys(formChanges).length === 0 ||\n              !isValidWeight ||\n              (!isEdit && !formFlagName)\n            }\n            className=\"px-4 py-2 text-sm font-medium bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-white rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          >\n            {isLoading ? \"Saving...\" : isEdit ? \"Update\" : \"Schedule\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Preview Modal Component\ninterface PreviewModalProps {\n  change: ScheduledChange;\n  preview: ScheduledChangePreview;\n  onClose: () => void;\n}\n\nfunction PreviewModal({ change, preview, onClose }: PreviewModalProps) {\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby=\"preview-title\"\n      onClick={onClose}\n    >\n      <div\n        className=\"bg-slate-900 rounded-lg p-6 max-w-md w-full mx-4 border border-slate-700\"\n        onClick={(e) => e.stopPropagation()}\n        role=\"document\"\n      >\n        <h3\n          id=\"preview-title\"\n          className=\"text-lg font-semibold text-slate-100 mb-4\"\n        >\n          Change Preview: {change.flag_name}\n        </h3>\n\n        <div className=\"space-y-4\">\n          {/* Before */}\n          <div>\n            <h4 className=\"text-sm font-medium text-slate-400 mb-2\">\n              Current Weights\n            </h4>\n            <div className=\"space-y-1\">\n              {preview.before.variants.map((v) => (\n                <div key={v.name} className=\"flex justify-between text-sm\">\n                  <span className=\"text-slate-300 font-mono\">{v.name}</span>\n                  <span className=\"text-slate-400\">{v.weight}%</span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Arrow */}\n          <div className=\"flex justify-center text-slate-500\">\n            <svg\n              className=\"w-6 h-6\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n              aria-hidden=\"true\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M19 14l-7 7m0 0l-7-7m7 7V3\"\n              />\n            </svg>\n          </div>\n\n          {/* After */}\n          <div>\n            <h4 className=\"text-sm font-medium text-green-400 mb-2\">\n              New Weights\n            </h4>\n            <div className=\"space-y-1\">\n              {preview.after.variants.map((v) => (\n                <div key={v.name} className=\"flex justify-between text-sm\">\n                  <span className=\"text-slate-300 font-mono\">{v.name}</span>\n                  <span className=\"text-green-400\">{v.weight}%</span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Summary */}\n          <p className=\"text-sm text-slate-400 pt-2 border-t border-slate-700\">\n            {preview.change_summary}\n          </p>\n        </div>\n\n        <div className=\"mt-6 flex justify-end\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium text-slate-300 hover:text-slate-100 bg-slate-800 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-slate-500\"\n          >\n            Close\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ScheduledChangesPanel;\n"
}
