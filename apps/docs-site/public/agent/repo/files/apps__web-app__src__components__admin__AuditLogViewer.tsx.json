{
  "path": "apps/web-app/src/components/admin/AuditLogViewer.tsx",
  "language": "typescript",
  "size": 10812,
  "last_modified": "2025-11-27T02:50:32.089Z",
  "lines": 289,
  "content": "/**\n * Audit Log Viewer Component (Phase 8.3)\n * View and filter system audit logs\n */\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { getDefaultAdminApi, type AuditLogEntry } from \"../../lib/api/adminApi\";\n\nexport function AuditLogViewer() {\n  const [logs, setLogs] = useState<AuditLogEntry[]>([]);\n  const [total, setTotal] = useState(0);\n  const [offset, setOffset] = useState(0);\n  const [limit] = useState(50);\n  const [levelFilter, setLevelFilter] = useState<string>(\"\");\n  const [actionFilter, setActionFilter] = useState<string>(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadLogs = useCallback(async () => {\n    try {\n      setError(null);\n      const adminApi = getDefaultAdminApi();\n      const data = await adminApi.getAuditLogs({\n        offset,\n        limit,\n        level: levelFilter || undefined,\n        action: actionFilter || undefined,\n      });\n      setLogs(data.logs);\n      setTotal(data.total);\n      setIsLoading(false);\n    } catch (err) {\n      console.error(\"Failed to load audit logs:\", err);\n      setError(err instanceof Error ? err.message : \"Unknown error\");\n      setIsLoading(false);\n    }\n  }, [offset, limit, levelFilter, actionFilter]);\n\n  useEffect(() => {\n    loadLogs();\n  }, [loadLogs]);\n\n  // Auto-refresh every 30 seconds\n  useEffect(() => {\n    const interval = setInterval(loadLogs, 30000);\n    return () => clearInterval(interval);\n  }, [loadLogs]);\n\n  const getLevelBadge = (level: string) => {\n    switch (level) {\n      case \"error\":\n        return (\n          <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-700\">\n            ERROR\n          </span>\n        );\n      case \"warn\":\n        return (\n          <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-700\">\n            WARN\n          </span>\n        );\n      case \"info\":\n      default:\n        return (\n          <span className=\"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-700\">\n            INFO\n          </span>\n        );\n    }\n  };\n\n  const totalPages = Math.ceil(total / limit);\n  const currentPage = Math.floor(offset / limit) + 1;\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 mx-auto mb-4 rounded-full border-4 border-primary-500 border-t-transparent animate-spin\" />\n          <p className=\"text-neutral-600\">Loading audit logs...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-neutral-900\">Audit Logs</h1>\n          <p className=\"text-sm text-neutral-600\">\n            System activity and security events\n          </p>\n        </div>\n        <button\n          onClick={loadLogs}\n          className=\"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-primary-700 bg-primary-50 rounded-md hover:bg-primary-100 transition-colors\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className=\"w-4 h-4\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99\"\n            />\n          </svg>\n          <span>Refresh</span>\n        </button>\n      </div>\n\n      {/* Error Banner */}\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center space-x-3\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className=\"w-5 h-5 text-red-600\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z\"\n            />\n          </svg>\n          <span className=\"text-sm text-red-700\">{error}</span>\n        </div>\n      )}\n\n      {/* Filters */}\n      <div className=\"bg-white rounded-lg shadow p-4 flex items-center gap-4\">\n        <div className=\"flex items-center space-x-2\">\n          <label className=\"text-sm font-medium text-neutral-700\">Level:</label>\n          <select\n            value={levelFilter}\n            onChange={(e) => {\n              setLevelFilter(e.target.value);\n              setOffset(0);\n            }}\n            className=\"px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500\"\n          >\n            <option value=\"\">All Levels</option>\n            <option value=\"info\">Info</option>\n            <option value=\"warn\">Warning</option>\n            <option value=\"error\">Error</option>\n          </select>\n        </div>\n        <div className=\"flex items-center space-x-2 flex-1\">\n          <label className=\"text-sm font-medium text-neutral-700\">\n            Action:\n          </label>\n          <input\n            type=\"text\"\n            placeholder=\"Filter by action...\"\n            value={actionFilter}\n            onChange={(e) => {\n              setActionFilter(e.target.value);\n              setOffset(0);\n            }}\n            className=\"flex-1 px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500\"\n          />\n        </div>\n        <div className=\"text-sm text-neutral-600\">\n          {total} {total === 1 ? \"entry\" : \"entries\"}\n        </div>\n      </div>\n\n      {/* Logs Table */}\n      <div className=\"bg-white rounded-lg shadow overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"bg-neutral-50 border-b border-neutral-200\">\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase\">\n                  Timestamp\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase\">\n                  Level\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase\">\n                  Action\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase\">\n                  User\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-neutral-600 uppercase\">\n                  Details\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-neutral-200\">\n              {logs.length === 0 ? (\n                <tr>\n                  <td\n                    colSpan={5}\n                    className=\"px-6 py-12 text-center text-neutral-500\"\n                  >\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                      strokeWidth={1.5}\n                      stroke=\"currentColor\"\n                      className=\"w-12 h-12 mx-auto mb-3 text-neutral-400\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z\"\n                      />\n                    </svg>\n                    <p>No audit logs found</p>\n                    <p className=\"text-xs mt-1\">\n                      Audit events will appear here as system activity occurs\n                    </p>\n                  </td>\n                </tr>\n              ) : (\n                logs.map((log, index) => (\n                  <tr key={index} className=\"hover:bg-neutral-50\">\n                    <td className=\"px-6 py-4 text-sm text-neutral-600 whitespace-nowrap\">\n                      {new Date(log.timestamp).toLocaleString()}\n                    </td>\n                    <td className=\"px-6 py-4\">{getLevelBadge(log.level)}</td>\n                    <td className=\"px-6 py-4 text-sm font-medium text-neutral-900\">\n                      {log.action}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-neutral-600\">\n                      {log.user_id ? (\n                        <span className=\"font-mono text-xs\">\n                          {log.user_id.substring(0, 8)}...\n                        </span>\n                      ) : (\n                        <span className=\"text-neutral-400\">System</span>\n                      )}\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-neutral-600 max-w-md truncate\">\n                      {log.details || \"â€”\"}\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n\n        {/* Pagination */}\n        {totalPages > 1 && (\n          <div className=\"px-6 py-4 border-t border-neutral-200 flex items-center justify-between\">\n            <p className=\"text-sm text-neutral-600\">\n              Showing {offset + 1} to {Math.min(offset + limit, total)} of{\" \"}\n              {total} entries\n            </p>\n            <div className=\"flex items-center space-x-2\">\n              <button\n                onClick={() => setOffset(Math.max(0, offset - limit))}\n                disabled={offset === 0}\n                className=\"px-3 py-1 text-sm border border-neutral-300 rounded hover:bg-neutral-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                Previous\n              </button>\n              <span className=\"text-sm text-neutral-600\">\n                Page {currentPage} of {totalPages}\n              </span>\n              <button\n                onClick={() => setOffset(offset + limit)}\n                disabled={offset + limit >= total}\n                className=\"px-3 py-1 text-sm border border-neutral-300 rounded hover:bg-neutral-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                Next\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
}
