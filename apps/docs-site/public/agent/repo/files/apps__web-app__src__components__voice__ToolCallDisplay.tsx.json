{
  "path": "apps/web-app/src/components/voice/ToolCallDisplay.tsx",
  "language": "typescript",
  "size": 9677,
  "last_modified": "2025-12-01T21:42:00.677Z",
  "lines": 346,
  "content": "/**\n * ToolCallDisplay Component\n *\n * Displays real-time tool call status during Thinker/Talker voice sessions.\n * Shows tool name, arguments, status, and results as they execute.\n *\n * Phase: Thinker/Talker Voice Pipeline Migration\n */\n\nimport { useEffect, useState } from \"react\";\nimport type { TTToolCall } from \"../../hooks/useThinkerTalkerSession\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ToolCallDisplayProps {\n  /** Array of tool calls to display */\n  toolCalls: TTToolCall[];\n  /** Maximum number of tool calls to show (older ones collapse) */\n  maxVisible?: number;\n  /** Whether to show tool arguments */\n  showArguments?: boolean;\n  /** Whether to show tool results */\n  showResults?: boolean;\n  /** Custom class name */\n  className?: string;\n}\n\n// ============================================================================\n// Helper Components\n// ============================================================================\n\n/**\n * Status indicator with animated states\n */\nfunction StatusIndicator({ status }: { status: TTToolCall[\"status\"] }) {\n  const statusConfig = {\n    pending: {\n      color: \"bg-neutral-400\",\n      pulse: false,\n      label: \"Pending\",\n    },\n    running: {\n      color: \"bg-blue-500\",\n      pulse: true,\n      label: \"Running\",\n    },\n    completed: {\n      color: \"bg-green-500\",\n      pulse: false,\n      label: \"Completed\",\n    },\n    failed: {\n      color: \"bg-red-500\",\n      pulse: false,\n      label: \"Failed\",\n    },\n  };\n\n  const config = statusConfig[status];\n\n  return (\n    <div className=\"flex items-center gap-1.5\">\n      <span\n        className={`w-2 h-2 rounded-full ${config.color} ${config.pulse ? \"animate-pulse\" : \"\"}`}\n        aria-hidden=\"true\"\n      />\n      <span className=\"text-xs text-neutral-500\">{config.label}</span>\n    </div>\n  );\n}\n\n/**\n * Tool icon based on tool name\n */\nfunction ToolIcon({ toolName }: { toolName: string }) {\n  // Map common tool names to icons\n  const iconMap: Record<string, string> = {\n    search: \"ðŸ”\",\n    retrieve: \"ðŸ“„\",\n    query: \"â“\",\n    calculate: \"ðŸ§®\",\n    web_search: \"ðŸŒ\",\n    code_interpreter: \"ðŸ’»\",\n    file_search: \"ðŸ“\",\n    knowledge_base: \"ðŸ“š\",\n    kb_search: \"ðŸ“š\",\n    kb_read: \"ðŸ“–\",\n    calendar: \"ðŸ“…\",\n    email: \"ðŸ“§\",\n    default: \"âš™ï¸\",\n  };\n\n  const icon =\n    iconMap[toolName.toLowerCase()] ||\n    Object.entries(iconMap).find(([key]) =>\n      toolName.toLowerCase().includes(key),\n    )?.[1] ||\n    iconMap.default;\n\n  return (\n    <span className=\"text-lg\" role=\"img\" aria-label={toolName}>\n      {icon}\n    </span>\n  );\n}\n\n/**\n * Format tool name for display\n */\nfunction formatToolName(name: string): string {\n  return name\n    .replace(/_/g, \" \")\n    .replace(/([A-Z])/g, \" $1\")\n    .trim()\n    .replace(/\\s+/g, \" \")\n    .split(\" \")\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n    .join(\" \");\n}\n\n/**\n * Truncate long strings for display\n */\nfunction truncate(str: string, maxLength: number): string {\n  if (str.length <= maxLength) return str;\n  return str.slice(0, maxLength - 3) + \"...\";\n}\n\n/**\n * Format tool arguments for display\n */\nfunction formatArguments(args: Record<string, unknown>): string {\n  const entries = Object.entries(args);\n  if (entries.length === 0) return \"No arguments\";\n\n  return entries\n    .map(([key, value]) => {\n      const displayValue =\n        typeof value === \"string\" ? truncate(value, 50) : JSON.stringify(value);\n      return `${key}: ${displayValue}`;\n    })\n    .join(\", \");\n}\n\n/**\n * Single tool call item\n */\nfunction ToolCallItem({\n  toolCall,\n  showArguments,\n  showResults,\n  isExpanded,\n  onToggle,\n}: {\n  toolCall: TTToolCall;\n  showArguments: boolean;\n  showResults: boolean;\n  isExpanded: boolean;\n  onToggle: () => void;\n}) {\n  const hasDetails =\n    (showArguments && Object.keys(toolCall.arguments).length > 0) ||\n    (showResults && toolCall.result !== undefined);\n\n  return (\n    <div\n      className={`\n        rounded-lg border transition-all duration-200\n        ${toolCall.status === \"running\" ? \"border-blue-300 bg-blue-50\" : \"border-neutral-200 bg-white\"}\n        ${toolCall.status === \"failed\" ? \"border-red-300 bg-red-50\" : \"\"}\n      `}\n      data-testid={`tool-call-${toolCall.id}`}\n    >\n      {/* Header */}\n      <button\n        className=\"w-full flex items-center justify-between p-3 text-left\"\n        onClick={onToggle}\n        disabled={!hasDetails}\n        aria-expanded={isExpanded}\n      >\n        <div className=\"flex items-center gap-2\">\n          <ToolIcon toolName={toolCall.name} />\n          <span className=\"font-medium text-sm text-neutral-800\">\n            {formatToolName(toolCall.name)}\n          </span>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <StatusIndicator status={toolCall.status} />\n          {hasDetails && (\n            <svg\n              className={`w-4 h-4 text-neutral-400 transition-transform ${isExpanded ? \"rotate-180\" : \"\"}`}\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M19 9l-7 7-7-7\"\n              />\n            </svg>\n          )}\n        </div>\n      </button>\n\n      {/* Expanded details */}\n      {isExpanded && hasDetails && (\n        <div className=\"px-3 pb-3 pt-0 border-t border-neutral-100\">\n          {showArguments && Object.keys(toolCall.arguments).length > 0 && (\n            <div className=\"mt-2\">\n              <div className=\"text-xs font-medium text-neutral-500 mb-1\">\n                Arguments\n              </div>\n              <div className=\"text-xs text-neutral-600 bg-neutral-50 rounded p-2 font-mono overflow-x-auto\">\n                {formatArguments(toolCall.arguments)}\n              </div>\n            </div>\n          )}\n\n          {showResults && toolCall.result !== undefined && (\n            <div className=\"mt-2\">\n              <div className=\"text-xs font-medium text-neutral-500 mb-1\">\n                Result\n              </div>\n              <div className=\"text-xs text-neutral-600 bg-neutral-50 rounded p-2 font-mono overflow-x-auto max-h-32 overflow-y-auto\">\n                {typeof toolCall.result === \"string\"\n                  ? truncate(toolCall.result, 200)\n                  : JSON.stringify(toolCall.result, null, 2)}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Main Component\n// ============================================================================\n\nexport function ToolCallDisplay({\n  toolCalls,\n  maxVisible = 3,\n  showArguments = true,\n  showResults = true,\n  className = \"\",\n}: ToolCallDisplayProps) {\n  const [expandedIds, setExpandedIds] = useState<Set<string>>(new Set());\n  const [showAll, setShowAll] = useState(false);\n\n  // Auto-expand running tool calls\n  useEffect(() => {\n    const runningIds = toolCalls\n      .filter((tc) => tc.status === \"running\")\n      .map((tc) => tc.id);\n\n    if (runningIds.length > 0) {\n      setExpandedIds((prev) => {\n        const next = new Set(prev);\n        runningIds.forEach((id) => next.add(id));\n        return next;\n      });\n    }\n  }, [toolCalls]);\n\n  const toggleExpanded = (id: string) => {\n    setExpandedIds((prev) => {\n      const next = new Set(prev);\n      if (next.has(id)) {\n        next.delete(id);\n      } else {\n        next.add(id);\n      }\n      return next;\n    });\n  };\n\n  if (toolCalls.length === 0) {\n    return null;\n  }\n\n  // Sort by status (running first, then pending, then completed/failed)\n  const sortedToolCalls = [...toolCalls].sort((a, b) => {\n    const statusOrder = { running: 0, pending: 1, completed: 2, failed: 3 };\n    return statusOrder[a.status] - statusOrder[b.status];\n  });\n\n  const visibleToolCalls = showAll\n    ? sortedToolCalls\n    : sortedToolCalls.slice(0, maxVisible);\n  const hiddenCount = sortedToolCalls.length - visibleToolCalls.length;\n\n  return (\n    <div\n      className={`space-y-2 ${className}`}\n      data-testid=\"tool-call-display\"\n      role=\"region\"\n      aria-label=\"Tool calls in progress\"\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <h4 className=\"text-xs font-medium text-neutral-500 uppercase tracking-wide\">\n          Tool Calls ({toolCalls.length})\n        </h4>\n        {toolCalls.some((tc) => tc.status === \"running\") && (\n          <span className=\"text-xs text-blue-600 animate-pulse\">\n            Processing...\n          </span>\n        )}\n      </div>\n\n      {/* Tool call list */}\n      <div className=\"space-y-2\">\n        {visibleToolCalls.map((toolCall) => (\n          <ToolCallItem\n            key={toolCall.id}\n            toolCall={toolCall}\n            showArguments={showArguments}\n            showResults={showResults}\n            isExpanded={expandedIds.has(toolCall.id)}\n            onToggle={() => toggleExpanded(toolCall.id)}\n          />\n        ))}\n      </div>\n\n      {/* Show more/less button */}\n      {sortedToolCalls.length > maxVisible && (\n        <button\n          className=\"w-full text-center text-xs text-blue-600 hover:text-blue-700 py-1\"\n          onClick={() => setShowAll(!showAll)}\n        >\n          {showAll\n            ? \"Show less\"\n            : `Show ${hiddenCount} more tool call${hiddenCount > 1 ? \"s\" : \"\"}`}\n        </button>\n      )}\n    </div>\n  );\n}\n\nexport default ToolCallDisplay;\n"
}
