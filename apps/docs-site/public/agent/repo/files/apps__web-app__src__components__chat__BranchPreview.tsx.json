{
  "path": "apps/web-app/src/components/chat/BranchPreview.tsx",
  "language": "typescript",
  "size": 5240,
  "last_modified": "2025-11-26T06:18:32.184Z",
  "lines": 150,
  "content": "/**\n * BranchPreview Component\n * Shows a confirmation preview before creating a branch from a message\n */\n\nimport type { Message } from \"@voiceassist/types\";\n\nexport interface BranchPreviewProps {\n  messages: Message[];\n  parentMessageId: string;\n  isCreating: boolean;\n  onConfirm: () => Promise<void> | void;\n  onCancel: () => void;\n}\n\nexport function BranchPreview({\n  messages,\n  parentMessageId,\n  isCreating,\n  onConfirm,\n  onCancel,\n}: BranchPreviewProps) {\n  // Find the parent message\n  const parentMessageIndex = messages.findIndex(\n    (m) => m.id === parentMessageId,\n  );\n  const parentMessage =\n    parentMessageIndex >= 0 ? messages[parentMessageIndex] : null;\n\n  // Calculate how many messages will be in the branch\n  const messagesInBranch = parentMessageIndex + 1;\n  const messagesAfterBranch = messages.length - messagesInBranch;\n\n  // Get a preview of the parent message content\n  const contentPreview = parentMessage?.content\n    ? parentMessage.content.length > 150\n      ? `${parentMessage.content.substring(0, 150)}...`\n      : parentMessage.content\n    : \"Unknown message\";\n\n  return (\n    <div\n      className=\"bg-amber-50 border border-amber-200 rounded-lg p-4 shadow-md\"\n      role=\"dialog\"\n      aria-labelledby=\"branch-preview-title\"\n      aria-describedby=\"branch-preview-description\"\n      data-testid=\"branch-preview\"\n    >\n      {/* Header */}\n      <div className=\"flex items-center gap-2 mb-3\">\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          strokeWidth={1.5}\n          stroke=\"currentColor\"\n          className=\"w-5 h-5 text-amber-600\"\n          aria-hidden=\"true\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            d=\"M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z\"\n          />\n        </svg>\n        <h3\n          id=\"branch-preview-title\"\n          className=\"text-sm font-semibold text-amber-900\"\n        >\n          Create Branch from This Message?\n        </h3>\n      </div>\n\n      {/* Description */}\n      <div id=\"branch-preview-description\" className=\"space-y-2 mb-4\">\n        <p className=\"text-sm text-amber-800\">\n          This will create an alternative conversation path starting from\n          message {messagesInBranch} of {messages.length}.\n        </p>\n\n        {/* Parent message preview */}\n        <div className=\"bg-white/50 border border-amber-200 rounded p-3\">\n          <div className=\"flex items-center gap-1 text-xs text-amber-600 mb-1\">\n            <span className=\"font-medium\">\n              {parentMessage?.role === \"user\" ? \"You\" : \"Assistant\"}:\n            </span>\n          </div>\n          <p className=\"text-sm text-amber-900 italic\">\n            &quot;{contentPreview}&quot;\n          </p>\n        </div>\n\n        {/* Info about what happens */}\n        {messagesAfterBranch > 0 && (\n          <p className=\"text-xs text-amber-700\">\n            The {messagesAfterBranch} message\n            {messagesAfterBranch > 1 ? \"s\" : \"\"} after this point will remain in\n            the main conversation.\n          </p>\n        )}\n      </div>\n\n      {/* Actions */}\n      <div className=\"flex items-center justify-end gap-2\">\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          disabled={isCreating}\n          className=\"px-3 py-1.5 text-sm font-medium text-amber-700 bg-white border border-amber-300 rounded-md hover:bg-amber-50 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n          data-testid=\"branch-preview-cancel\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          onClick={onConfirm}\n          disabled={isCreating}\n          className=\"px-3 py-1.5 text-sm font-medium text-white bg-amber-600 rounded-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2\"\n          data-testid=\"branch-preview-confirm\"\n        >\n          {isCreating && (\n            <svg\n              className=\"animate-spin h-4 w-4\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              aria-hidden=\"true\"\n            >\n              <circle\n                className=\"opacity-25\"\n                cx=\"12\"\n                cy=\"12\"\n                r=\"10\"\n                stroke=\"currentColor\"\n                strokeWidth=\"4\"\n              />\n              <path\n                className=\"opacity-75\"\n                fill=\"currentColor\"\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n              />\n            </svg>\n          )}\n          {isCreating ? \"Creating...\" : \"Create Branch\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n"
}
