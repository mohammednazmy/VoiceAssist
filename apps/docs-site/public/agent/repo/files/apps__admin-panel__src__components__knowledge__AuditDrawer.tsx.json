{
  "path": "apps/admin-panel/src/components/knowledge/AuditDrawer.tsx",
  "language": "typescript",
  "size": 3877,
  "last_modified": "2025-11-29T04:26:40.442Z",
  "lines": 125,
  "content": "import { useEffect, useState } from \"react\";\nimport { fetchAPI } from \"../../lib/api\";\nimport type { KnowledgeDocument } from \"../../hooks/useKnowledgeDocuments\";\n\ninterface AuditEvent {\n  id: string;\n  action: string;\n  actor: string;\n  timestamp: string;\n  notes?: string;\n}\n\ninterface AuditDrawerProps {\n  open: boolean;\n  document?: KnowledgeDocument | null;\n  onClose: () => void;\n}\n\nexport function AuditDrawer({ open, document, onClose }: AuditDrawerProps) {\n  const [events, setEvents] = useState<AuditEvent[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const loadAudit = async () => {\n      if (!open || !document) return;\n      setLoading(true);\n      setError(null);\n      try {\n        const data = await fetchAPI<AuditEvent[]>(\n          `/api/admin/kb/documents/${document.id}/audit`,\n        );\n        setEvents(data);\n      } catch (err: unknown) {\n        console.warn(\"Using fallback audit events because API failed\", err);\n        const now = new Date();\n        setEvents([\n          {\n            id: \"evt-1\",\n            action: \"indexed\",\n            actor: \"system/kb-indexer\",\n            timestamp: now.toISOString(),\n            notes: \"Initial ingestion completed.\",\n          },\n          {\n            id: \"evt-2\",\n            action: \"uploaded\",\n            actor: \"admin@example.com\",\n            timestamp: new Date(now.getTime() - 1000 * 60 * 10).toISOString(),\n            notes: `Uploaded ${document.name}`,\n          },\n        ]);\n        setError(\n          \"Audit trail service unavailable; showing fallback demo events.\",\n        );\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadAudit();\n  }, [document, open]);\n\n  if (!open || !document) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex justify-end bg-slate-950/60 backdrop-blur-sm\">\n      <div className=\"bg-slate-900 border-l border-slate-800 w-full max-w-md h-full shadow-2xl p-6 flex flex-col\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <div className=\"text-sm uppercase tracking-wide text-slate-500\">\n              Audit Trail\n            </div>\n            <div className=\"text-lg font-semibold text-slate-100\">\n              {document.name}\n            </div>\n          </div>\n          <button\n            className=\"text-slate-400 hover:text-slate-100\"\n            onClick={onClose}\n            aria-label=\"Close audit drawer\"\n          >\n            ✕\n          </button>\n        </div>\n\n        {loading && (\n          <div className=\"text-slate-400 text-sm\">Loading audit events…</div>\n        )}\n        {error && (\n          <div className=\"mb-3 text-xs text-amber-300 bg-amber-950/40 border border-amber-900 rounded p-2\">\n            {error}\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-y-auto space-y-3 pr-2\">\n          {events.map((evt) => (\n            <div\n              key={evt.id}\n              className=\"border border-slate-800 rounded-md p-3 bg-slate-950/70\"\n            >\n              <div className=\"flex items-center justify-between text-xs text-slate-400\">\n                <span className=\"uppercase tracking-wide\">{evt.action}</span>\n                <span>{new Date(evt.timestamp).toLocaleString()}</span>\n              </div>\n              <div className=\"text-sm text-slate-100 mt-1\">\n                {evt.notes || \"No additional details\"}\n              </div>\n              <div className=\"text-xs text-slate-500 mt-1\">\n                Actor: {evt.actor}\n              </div>\n            </div>\n          ))}\n\n          {!loading && events.length === 0 && (\n            <div className=\"text-sm text-slate-500\">\n              No audit events recorded yet.\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"
}
