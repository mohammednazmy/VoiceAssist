{
  "path": "apps/admin-panel/src/components/users/BulkActionBar.tsx",
  "language": "typescript",
  "size": 10182,
  "last_modified": "2025-12-03T03:40:02.339Z",
  "lines": 295,
  "content": "/**\n * BulkActionBar Component\n *\n * Floating action bar that appears when users are selected.\n * Provides bulk operation buttons for activate, deactivate, and role change.\n */\n\nimport { useState } from \"react\";\nimport {\n  BulkAction,\n  AdminRole,\n  BulkOperationResult,\n} from \"../../hooks/useBulkOperations\";\n\ninterface BulkActionBarProps {\n  selectedCount: number;\n  isLoading: boolean;\n  onAction: (\n    action: BulkAction,\n    role?: AdminRole,\n    reason?: string,\n  ) => Promise<BulkOperationResult>;\n  onClearSelection: () => void;\n  lastResult: BulkOperationResult | null;\n}\n\nexport function BulkActionBar({\n  selectedCount,\n  isLoading,\n  onAction,\n  onClearSelection,\n  lastResult,\n}: BulkActionBarProps) {\n  const [showRoleMenu, setShowRoleMenu] = useState(false);\n  const [showResult, setShowResult] = useState(false);\n\n  const handleAction = async (action: BulkAction, role?: AdminRole) => {\n    const reason = prompt(\n      `Add a reason for this bulk ${action}?`,\n      \"Bulk admin action\",\n    );\n    if (reason === null) return; // User cancelled\n\n    try {\n      await onAction(action, role, reason || undefined);\n      setShowResult(true);\n      setShowRoleMenu(false);\n      // Auto-hide result after 5 seconds\n      setTimeout(() => setShowResult(false), 5000);\n    } catch {\n      // Error is handled by the hook\n    }\n  };\n\n  if (selectedCount === 0) return null;\n\n  return (\n    <div className=\"fixed bottom-6 left-1/2 -translate-x-1/2 z-40\">\n      {/* Result toast */}\n      {showResult && lastResult && (\n        <div className=\"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-80 bg-slate-800 border border-slate-700 rounded-lg shadow-xl p-4 text-sm\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"font-medium text-slate-100\">\n              Bulk {lastResult.action} completed\n            </span>\n            <button\n              onClick={() => setShowResult(false)}\n              className=\"text-slate-400 hover:text-slate-200\"\n            >\n              <svg\n                className=\"w-4 h-4\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                stroke=\"currentColor\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M6 18L18 6M6 6l12 12\"\n                />\n              </svg>\n            </button>\n          </div>\n          <div className=\"space-y-1 text-xs\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-green-400\">\n                {lastResult.successful} successful\n              </span>\n              {lastResult.failed > 0 && (\n                <span className=\"text-red-400\">{lastResult.failed} failed</span>\n              )}\n              {lastResult.skipped > 0 && (\n                <span className=\"text-amber-400\">\n                  {lastResult.skipped} skipped\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Action bar */}\n      <div className=\"bg-slate-900 border border-slate-700 rounded-lg shadow-xl flex items-center gap-1 p-2\">\n        {/* Selection count */}\n        <div className=\"px-3 py-1.5 text-sm text-slate-300 border-r border-slate-700\">\n          <span className=\"font-medium text-blue-400\">{selectedCount}</span>{\" \"}\n          selected\n        </div>\n\n        {/* Activate button */}\n        <button\n          onClick={() => handleAction(\"activate\")}\n          disabled={isLoading}\n          className=\"px-3 py-1.5 text-sm text-green-400 hover:bg-green-900/30 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5\"\n          title=\"Activate selected users\"\n        >\n          <svg\n            className=\"w-4 h-4\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\n            />\n          </svg>\n          <span className=\"hidden sm:inline\">Activate</span>\n        </button>\n\n        {/* Deactivate button */}\n        <button\n          onClick={() => handleAction(\"deactivate\")}\n          disabled={isLoading}\n          className=\"px-3 py-1.5 text-sm text-amber-400 hover:bg-amber-900/30 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5\"\n          title=\"Deactivate selected users\"\n        >\n          <svg\n            className=\"w-4 h-4\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\"\n            />\n          </svg>\n          <span className=\"hidden sm:inline\">Deactivate</span>\n        </button>\n\n        {/* Delete (bulk soft-delete) button */}\n        <button\n          onClick={() => {\n            if (\n              window.confirm(\n                `Are you sure you want to DELETE ${selectedCount} user(s)?\\n\\nThis will deactivate their accounts. This action is logged and audited.`,\n              )\n            ) {\n              handleAction(\"deactivate\");\n            }\n          }}\n          disabled={isLoading}\n          className=\"px-3 py-1.5 text-sm text-red-400 hover:bg-red-900/30 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5\"\n          title=\"Delete selected users (soft delete)\"\n        >\n          <svg\n            className=\"w-4 h-4\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\n            />\n          </svg>\n          <span className=\"hidden sm:inline\">Delete</span>\n        </button>\n\n        {/* Role change dropdown */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowRoleMenu(!showRoleMenu)}\n            disabled={isLoading}\n            className=\"px-3 py-1.5 text-sm text-purple-400 hover:bg-purple-900/30 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1.5\"\n            title=\"Change role for selected users\"\n          >\n            <svg\n              className=\"w-4 h-4\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\"\n              />\n            </svg>\n            <span className=\"hidden sm:inline\">Set Role</span>\n            <svg\n              className=\"w-3 h-3\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M19 9l-7 7-7-7\"\n              />\n            </svg>\n          </button>\n\n          {showRoleMenu && (\n            <div className=\"absolute bottom-full mb-1 right-0 bg-slate-800 border border-slate-700 rounded-lg shadow-xl py-1 min-w-[140px]\">\n              <button\n                onClick={() => {\n                  handleAction(\"set_role\", \"user\");\n                }}\n                className=\"w-full px-4 py-2 text-left text-sm text-slate-200 hover:bg-slate-700 flex items-center gap-2\"\n              >\n                <span className=\"w-2 h-2 rounded-full bg-slate-400\"></span>\n                User\n              </button>\n              <button\n                onClick={() => {\n                  handleAction(\"set_role\", \"viewer\");\n                }}\n                className=\"w-full px-4 py-2 text-left text-sm text-slate-200 hover:bg-slate-700 flex items-center gap-2\"\n              >\n                <span className=\"w-2 h-2 rounded-full bg-blue-400\"></span>\n                Viewer\n              </button>\n              <button\n                onClick={() => {\n                  handleAction(\"set_role\", \"admin\");\n                }}\n                className=\"w-full px-4 py-2 text-left text-sm text-slate-200 hover:bg-slate-700 flex items-center gap-2\"\n              >\n                <span className=\"w-2 h-2 rounded-full bg-purple-400\"></span>\n                Admin\n              </button>\n            </div>\n          )}\n        </div>\n\n        {/* Divider */}\n        <div className=\"w-px h-6 bg-slate-700 mx-1\" />\n\n        {/* Clear selection */}\n        <button\n          onClick={onClearSelection}\n          disabled={isLoading}\n          className=\"px-3 py-1.5 text-sm text-slate-400 hover:text-slate-200 hover:bg-slate-800 rounded transition-colors disabled:opacity-50\"\n          title=\"Clear selection\"\n        >\n          <svg\n            className=\"w-4 h-4\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M6 18L18 6M6 6l12 12\"\n            />\n          </svg>\n        </button>\n\n        {/* Loading indicator */}\n        {isLoading && (\n          <div className=\"px-2\">\n            <div className=\"w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default BulkActionBar;\n"
}
