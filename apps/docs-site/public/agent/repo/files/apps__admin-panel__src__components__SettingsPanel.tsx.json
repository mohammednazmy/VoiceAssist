{
  "path": "apps/admin-panel/src/components/SettingsPanel.tsx",
  "language": "typescript",
  "size": 15303,
  "last_modified": "2025-12-04T09:30:29.374Z",
  "lines": 500,
  "content": "/**\n * SettingsPanel Component\n * System-wide configuration for VoiceAssist admin panel\n * Includes model routing, session settings, and AI behavior defaults\n */\n\nimport { useState } from \"react\";\nimport {\n  useModelAnalytics,\n  ModelRoutingConfig,\n} from \"../hooks/useModelAnalytics\";\nimport { useAuth } from \"../contexts/AuthContext\";\n\ninterface SettingsCardProps {\n  title: string;\n  description?: string;\n  children: React.ReactNode;\n}\n\nfunction SettingsCard({ title, description, children }: SettingsCardProps) {\n  return (\n    <div className=\"bg-slate-950/70 border border-slate-800 rounded-lg p-4 space-y-3\">\n      <div>\n        <h3 className=\"font-medium text-slate-200 text-sm\">{title}</h3>\n        {description && (\n          <p className=\"text-slate-500 text-xs mt-1\">{description}</p>\n        )}\n      </div>\n      {children}\n    </div>\n  );\n}\n\ninterface ToggleProps {\n  label: string;\n  description?: string;\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n  disabled?: boolean;\n}\n\nfunction Toggle({\n  label,\n  description,\n  checked,\n  onChange,\n  disabled,\n}: ToggleProps) {\n  return (\n    <div className=\"flex items-start justify-between gap-4\">\n      <div>\n        <span className=\"text-sm text-slate-300\">{label}</span>\n        {description && (\n          <p className=\"text-xs text-slate-500 mt-0.5\">{description}</p>\n        )}\n      </div>\n      <button\n        role=\"switch\"\n        aria-checked={checked}\n        onClick={() => onChange(!checked)}\n        disabled={disabled}\n        className={`relative inline-flex h-5 w-9 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-900 ${\n          checked ? \"bg-blue-600\" : \"bg-slate-700\"\n        } ${disabled ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n      >\n        <span\n          className={`pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out ${\n            checked ? \"translate-x-4\" : \"translate-x-0\"\n          }`}\n        />\n      </button>\n    </div>\n  );\n}\n\ninterface SelectProps {\n  label: string;\n  value: string;\n  options: Array<{ value: string; label: string }>;\n  onChange: (value: string) => void;\n  disabled?: boolean;\n}\n\nfunction Select({ label, value, options, onChange, disabled }: SelectProps) {\n  return (\n    <div className=\"space-y-1\">\n      <label className=\"text-sm text-slate-300\">{label}</label>\n      <select\n        value={value}\n        onChange={(e) => onChange(e.target.value)}\n        disabled={disabled}\n        className=\"w-full bg-slate-800 border border-slate-700 rounded-md px-3 py-2 text-sm text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50\"\n      >\n        {options.map((opt) => (\n          <option key={opt.value} value={opt.value}>\n            {opt.label}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n}\n\ninterface SliderProps {\n  label: string;\n  value: number;\n  min: number;\n  max: number;\n  step?: number;\n  onChange: (value: number) => void;\n  disabled?: boolean;\n  displayValue?: string;\n}\n\nfunction Slider({\n  label,\n  value,\n  min,\n  max,\n  step = 1,\n  onChange,\n  disabled,\n  displayValue,\n}: SliderProps) {\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex justify-between items-center\">\n        <label className=\"text-sm text-slate-300\">{label}</label>\n        <span className=\"text-sm text-slate-400\">{displayValue ?? value}</span>\n      </div>\n      <input\n        type=\"range\"\n        min={min}\n        max={max}\n        step={step}\n        value={value}\n        onChange={(e) => onChange(Number(e.target.value))}\n        disabled={disabled}\n        className=\"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-600 disabled:opacity-50\"\n      />\n    </div>\n  );\n}\n\n// Model options for routing\nconst CHAT_MODELS = [\n  { value: \"gpt-4-turbo-preview\", label: \"GPT-4 Turbo\" },\n  { value: \"gpt-4o\", label: \"GPT-4o\" },\n  { value: \"gpt-4o-mini\", label: \"GPT-4o Mini\" },\n  { value: \"gpt-3.5-turbo\", label: \"GPT-3.5 Turbo\" },\n  { value: \"local-llama\", label: \"Local LLM (Llama)\" },\n];\n\nconst EMBEDDING_MODELS = [\n  { value: \"text-embedding-3-small\", label: \"text-embedding-3-small\" },\n  { value: \"text-embedding-3-large\", label: \"text-embedding-3-large\" },\n  { value: \"text-embedding-ada-002\", label: \"text-embedding-ada-002\" },\n];\n\nexport function SettingsPanel() {\n  const { isAdmin } = useAuth();\n  const { routingConfig, updateRouting, loading, error } = useModelAnalytics({\n    autoRefresh: false,\n  });\n\n  const [saving, setSaving] = useState(false);\n  const [saveMessage, setSaveMessage] = useState<{\n    type: \"success\" | \"error\";\n    text: string;\n  } | null>(null);\n\n  // Local state for settings (AI behavior defaults)\n  const [aiDefaults, setAiDefaults] = useState({\n    temperature: 0.7,\n    maxTokens: 4096,\n    streamResponses: true,\n  });\n\n  // Session settings (would typically come from backend)\n  const [sessionSettings, setSessionSettings] = useState({\n    idleTimeoutMinutes: 60,\n    absoluteTimeoutHours: 24,\n    sessionConcurrency: 3,\n  });\n\n  const handleRoutingChange = async (updates: Partial<ModelRoutingConfig>) => {\n    if (!isAdmin) return;\n\n    setSaving(true);\n    setSaveMessage(null);\n\n    try {\n      const success = await updateRouting(updates);\n      if (success) {\n        setSaveMessage({ type: \"success\", text: \"Settings saved\" });\n        setTimeout(() => setSaveMessage(null), 3000);\n      } else {\n        setSaveMessage({ type: \"error\", text: \"Failed to save settings\" });\n      }\n    } catch (err) {\n      setSaveMessage({\n        type: \"error\",\n        text: err instanceof Error ? err.message : \"Failed to save\",\n      });\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <section id=\"settings\" className=\"flex-1 p-6 space-y-4\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-slate-800 rounded w-1/4\" />\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"h-48 bg-slate-800 rounded\" />\n            <div className=\"h-48 bg-slate-800 rounded\" />\n          </div>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section id=\"settings\" className=\"flex-1 p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-lg font-semibold text-slate-100\">Settings</h2>\n          <p className=\"text-sm text-slate-500\">\n            System-wide configuration for VoiceAssist\n          </p>\n        </div>\n        {saveMessage && (\n          <div\n            className={`px-3 py-1.5 rounded-md text-sm ${\n              saveMessage.type === \"success\"\n                ? \"bg-green-900/50 text-green-400 border border-green-800\"\n                : \"bg-red-900/50 text-red-400 border border-red-800\"\n            }`}\n          >\n            {saveMessage.text}\n          </div>\n        )}\n      </div>\n\n      {error && (\n        <div className=\"bg-red-900/50 border border-red-800 rounded-lg p-3 text-red-400 text-sm\">\n          {error}\n        </div>\n      )}\n\n      {/* Settings Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\n        {/* Model Routing Card */}\n        <SettingsCard\n          title=\"Model Routing\"\n          description=\"Configure which models to use for different tasks\"\n        >\n          <div className=\"space-y-4\">\n            <Select\n              label=\"Default Chat Model\"\n              value={routingConfig?.default_chat_model || \"gpt-4o\"}\n              options={CHAT_MODELS}\n              onChange={(value) =>\n                handleRoutingChange({ default_chat_model: value })\n              }\n              disabled={!isAdmin || saving}\n            />\n\n            <Select\n              label=\"Default Embedding Model\"\n              value={\n                routingConfig?.default_embedding_model ||\n                \"text-embedding-3-small\"\n              }\n              options={EMBEDDING_MODELS}\n              onChange={(value) =>\n                handleRoutingChange({ default_embedding_model: value })\n              }\n              disabled={!isAdmin || saving}\n            />\n\n            <Select\n              label=\"Fallback Model\"\n              value={routingConfig?.fallback_model || \"gpt-3.5-turbo\"}\n              options={CHAT_MODELS}\n              onChange={(value) =>\n                handleRoutingChange({ fallback_model: value })\n              }\n              disabled={!isAdmin || saving || !routingConfig?.fallback_enabled}\n            />\n\n            <Toggle\n              label=\"Enable Fallback\"\n              description=\"Use fallback model when primary fails\"\n              checked={routingConfig?.fallback_enabled ?? false}\n              onChange={(checked) =>\n                handleRoutingChange({ fallback_enabled: checked })\n              }\n              disabled={!isAdmin || saving}\n            />\n          </div>\n        </SettingsCard>\n\n        {/* PHI Routing Card */}\n        <SettingsCard\n          title=\"PHI Routing\"\n          description=\"HIPAA-compliant routing for Protected Health Information\"\n        >\n          <div className=\"space-y-4\">\n            <Toggle\n              label=\"PHI Detection\"\n              description=\"Automatically detect PHI in messages\"\n              checked={routingConfig?.phi_detection_enabled ?? true}\n              onChange={(checked) =>\n                handleRoutingChange({ phi_detection_enabled: checked })\n              }\n              disabled={!isAdmin || saving}\n            />\n\n            <Toggle\n              label=\"Route PHI to Local Models\"\n              description=\"Send PHI-containing requests to local/on-premise models\"\n              checked={routingConfig?.phi_route_to_local ?? true}\n              onChange={(checked) =>\n                handleRoutingChange({ phi_route_to_local: checked })\n              }\n              disabled={!isAdmin || saving}\n            />\n\n            <div className=\"bg-slate-900/50 border border-slate-700 rounded-md p-3 text-xs text-slate-400\">\n              <strong className=\"text-slate-300\">HIPAA Compliance:</strong> When\n              enabled, messages containing PHI are routed to local models to\n              ensure data doesn't leave your infrastructure.\n            </div>\n          </div>\n        </SettingsCard>\n\n        {/* Session Settings Card */}\n        <SettingsCard\n          title=\"Session Settings\"\n          description=\"Configure session timeouts and security\"\n        >\n          <div className=\"space-y-4\">\n            <Slider\n              label=\"Idle Timeout\"\n              value={sessionSettings.idleTimeoutMinutes}\n              min={5}\n              max={120}\n              step={5}\n              onChange={(value) =>\n                setSessionSettings((s) => ({ ...s, idleTimeoutMinutes: value }))\n              }\n              disabled={!isAdmin}\n              displayValue={`${sessionSettings.idleTimeoutMinutes} min`}\n            />\n\n            <Slider\n              label=\"Absolute Timeout\"\n              value={sessionSettings.absoluteTimeoutHours}\n              min={1}\n              max={72}\n              step={1}\n              onChange={(value) =>\n                setSessionSettings((s) => ({\n                  ...s,\n                  absoluteTimeoutHours: value,\n                }))\n              }\n              disabled={!isAdmin}\n              displayValue={`${sessionSettings.absoluteTimeoutHours} hours`}\n            />\n\n            <Slider\n              label=\"Max Concurrent Sessions\"\n              value={sessionSettings.sessionConcurrency}\n              min={1}\n              max={10}\n              step={1}\n              onChange={(value) =>\n                setSessionSettings((s) => ({\n                  ...s,\n                  sessionConcurrency: value,\n                }))\n              }\n              disabled={!isAdmin}\n              displayValue={`${sessionSettings.sessionConcurrency}`}\n            />\n          </div>\n        </SettingsCard>\n\n        {/* AI Behavior Defaults */}\n        <SettingsCard\n          title=\"AI Behavior Defaults\"\n          description=\"Default parameters for AI responses\"\n        >\n          <div className=\"space-y-4\">\n            <Slider\n              label=\"Temperature\"\n              value={aiDefaults.temperature}\n              min={0}\n              max={2}\n              step={0.1}\n              onChange={(value) =>\n                setAiDefaults((s) => ({ ...s, temperature: value }))\n              }\n              disabled={!isAdmin}\n              displayValue={aiDefaults.temperature.toFixed(1)}\n            />\n\n            <Slider\n              label=\"Max Tokens\"\n              value={aiDefaults.maxTokens}\n              min={256}\n              max={16384}\n              step={256}\n              onChange={(value) =>\n                setAiDefaults((s) => ({ ...s, maxTokens: value }))\n              }\n              disabled={!isAdmin}\n              displayValue={aiDefaults.maxTokens.toLocaleString()}\n            />\n\n            <Toggle\n              label=\"Stream Responses\"\n              description=\"Enable real-time streaming of AI responses\"\n              checked={aiDefaults.streamResponses}\n              onChange={(checked) =>\n                setAiDefaults((s) => ({ ...s, streamResponses: checked }))\n              }\n              disabled={!isAdmin}\n            />\n          </div>\n        </SettingsCard>\n      </div>\n\n      {/* Quick Links */}\n      <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n        <QuickLink\n          href=\"/security\"\n          icon=\"ðŸ”\"\n          label=\"PHI Rules\"\n          description=\"Configure PHI detection\"\n        />\n        <QuickLink\n          href=\"/integrations\"\n          icon=\"ðŸ”—\"\n          label=\"API Keys\"\n          description=\"Manage integrations\"\n        />\n        <QuickLink\n          href=\"/analytics\"\n          icon=\"ðŸ“Š\"\n          label=\"Analytics\"\n          description=\"View usage metrics\"\n        />\n        <QuickLink\n          href=\"/troubleshooting\"\n          icon=\"ðŸ”§\"\n          label=\"Diagnostics\"\n          description=\"System health\"\n        />\n      </div>\n\n      {/* Viewer Notice */}\n      {!isAdmin && (\n        <div className=\"bg-yellow-900/30 border border-yellow-800/50 rounded-lg p-4 text-sm text-yellow-400\">\n          <strong>View Only:</strong> You have viewer access. Contact an\n          administrator to modify settings.\n        </div>\n      )}\n    </section>\n  );\n}\n\ninterface QuickLinkProps {\n  href: string;\n  icon: string;\n  label: string;\n  description: string;\n}\n\nfunction QuickLink({ href, icon, label, description }: QuickLinkProps) {\n  return (\n    <a\n      href={href}\n      className=\"bg-slate-950/50 border border-slate-800 rounded-lg p-3 hover:bg-slate-900/70 hover:border-slate-700 transition-colors group\"\n    >\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-lg\">{icon}</span>\n        <span className=\"text-sm font-medium text-slate-200 group-hover:text-white\">\n          {label}\n        </span>\n      </div>\n      <p className=\"text-xs text-slate-500 mt-1\">{description}</p>\n    </a>\n  );\n}\n"
}
