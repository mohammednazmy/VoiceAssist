{
  "path": "services/api-gateway/app/api/conversation_schemas/schemas.py",
  "language": "python",
  "size": 6716,
  "last_modified": "2025-12-04T11:26:47.158Z",
  "lines": 192,
  "content": "\"\"\"Conversations API Pydantic Schemas.\n\nDefines request and response models for conversation-related endpoints:\n- Conversations: create, update, list\n- Messages: create, edit, delete\n- Branches: create, list, navigate\n- Events: session event logging\n- Settings: per-conversation settings\n\"\"\"\n\nfrom typing import List, Optional\n\nfrom pydantic import BaseModel, Field\n\n# =============================================================================\n# Conversation Schemas\n# =============================================================================\n\n\nclass CreateConversationRequest(BaseModel):\n    \"\"\"Request to create a new conversation\"\"\"\n\n    title: str = Field(..., description=\"Conversation title\")\n    folder_id: Optional[str] = Field(None, description=\"Optional folder ID to organize conversation\")\n\n\nclass UpdateConversationRequest(BaseModel):\n    \"\"\"Request to update a conversation\"\"\"\n\n    title: Optional[str] = Field(None, description=\"New conversation title\")\n    archived: Optional[bool] = Field(None, description=\"Archive status\")\n    folder_id: Optional[str] = Field(None, description=\"Move to folder\")\n\n\nclass ConversationResponse(BaseModel):\n    \"\"\"Response containing conversation details\"\"\"\n\n    id: str\n    userId: str\n    title: str\n    archived: bool = False\n    messageCount: int = 0\n    folderId: Optional[str] = None\n    createdAt: str\n    updatedAt: str\n\n\nclass ConversationsListResponse(BaseModel):\n    \"\"\"Paginated list of conversations\"\"\"\n\n    items: List[ConversationResponse]\n    total: int\n    page: int\n    pageSize: int\n\n\n# =============================================================================\n# Branch Schemas\n# =============================================================================\n\n\nclass CreateBranchRequest(BaseModel):\n    \"\"\"Request to create a new conversation branch\"\"\"\n\n    parent_message_id: str = Field(..., description=\"UUID of the message to branch from\")\n    initial_message: Optional[str] = Field(None, description=\"Optional first message in the new branch\")\n\n\nclass BranchResponse(BaseModel):\n    \"\"\"Response containing branch details\"\"\"\n\n    branch_id: str = Field(..., description=\"Unique identifier for the branch\")\n    session_id: str = Field(..., description=\"Session (conversation) ID\")\n    parent_message_id: str = Field(..., description=\"Parent message UUID\")\n    created_at: str = Field(..., description=\"ISO 8601 timestamp\")\n    message_count: int = Field(default=0, description=\"Number of messages in branch\")\n\n\nclass BranchInfo(BaseModel):\n    \"\"\"Information about a conversation branch\"\"\"\n\n    branch_id: str = Field(..., description=\"Branch identifier\")\n    parent_message_id: Optional[str] = Field(None, description=\"Parent message UUID\")\n    message_count: int = Field(..., description=\"Number of messages in branch\")\n    created_at: str = Field(..., description=\"ISO 8601 timestamp of first message\")\n    last_activity: str = Field(..., description=\"ISO 8601 timestamp of last message\")\n\n\n# =============================================================================\n# Message Schemas\n# =============================================================================\n\n\nclass MessageResponse(BaseModel):\n    \"\"\"Message response with branching fields\"\"\"\n\n    id: str\n    session_id: str\n    role: str\n    content: str\n    parent_message_id: Optional[str] = None\n    branch_id: Optional[str] = None\n    client_message_id: Optional[str] = None\n    created_at: str\n    tokens: Optional[int] = None\n    model: Optional[str] = None\n    is_duplicate: bool = False  # True if this was a duplicate idempotent request\n\n\nclass MessagesListResponse(BaseModel):\n    \"\"\"Paginated list of messages\"\"\"\n\n    items: List[MessageResponse]\n    total: int\n    page: int\n    pageSize: int\n\n\nclass CreateMessageRequest(BaseModel):\n    \"\"\"Request to create a new message with optional idempotency\"\"\"\n\n    content: str = Field(..., description=\"Message content\")\n    role: str = Field(default=\"user\", description=\"Message role (user, assistant, system)\")\n    branch_id: Optional[str] = Field(None, description=\"Branch ID for branched messages\")\n    parent_message_id: Optional[str] = Field(None, description=\"Parent message ID for threaded messages\")\n    client_message_id: Optional[str] = Field(\n        None,\n        description=\"Client-generated ID for idempotent message creation. \"\n        \"If provided and a message with this ID already exists in the \"\n        \"same conversation/branch, the existing message is returned.\",\n    )\n    metadata: Optional[dict] = Field(None, description=\"Additional message metadata\")\n\n\nclass EditMessageRequest(BaseModel):\n    \"\"\"Request to edit a message\"\"\"\n\n    content: str = Field(..., description=\"New message content\")\n\n\n# =============================================================================\n# Session Event Schemas\n# =============================================================================\n\n\nclass SessionEventResponse(BaseModel):\n    \"\"\"Response schema for session events.\"\"\"\n\n    id: str\n    conversation_id: str\n    session_id: Optional[str] = None\n    branch_id: Optional[str] = None\n    event_type: str\n    payload: Optional[dict] = None\n    source: Optional[str] = None\n    trace_id: Optional[str] = None\n    created_at: str\n\n\n# =============================================================================\n# Conversation Settings Schemas\n# =============================================================================\n\n\nclass ConversationSettingsSchema(BaseModel):\n    \"\"\"Schema for per-conversation settings.\"\"\"\n\n    llm_mode: Optional[str] = Field(\n        None,\n        description=\"LLM mode: 'default', 'creative', 'precise', 'balanced'\",\n    )\n    system_prompt: Optional[str] = Field(\n        None,\n        description=\"Custom system prompt for this conversation\",\n    )\n    voice_style: Optional[str] = Field(\n        None,\n        description=\"Voice style: 'alloy', 'echo', 'fable', 'onyx', 'nova', 'shimmer'\",\n    )\n    voice_speed: Optional[float] = Field(None, ge=0.5, le=2.0, description=\"Voice speed multiplier\")\n    language: Optional[str] = Field(None, description=\"Preferred language code (e.g., 'en', 'es', 'fr')\")\n    auto_tts: Optional[bool] = Field(None, description=\"Automatically read assistant responses aloud\")\n    context_window: Optional[int] = Field(\n        None,\n        ge=1,\n        le=100,\n        description=\"Number of previous messages to include as context\",\n    )\n    temperature: Optional[float] = Field(None, ge=0.0, le=2.0, description=\"LLM temperature setting\")\n    max_tokens: Optional[int] = Field(None, ge=100, le=8000, description=\"Max tokens for responses\")\n    custom: Optional[dict] = Field(None, description=\"Custom settings for extensions\")\n"
}
