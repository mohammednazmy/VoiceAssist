{
  "path": "services/api-gateway/app/models/system_api_key.py",
  "language": "python",
  "size": 1627,
  "last_modified": "2025-12-04T11:26:54.524Z",
  "lines": 44,
  "content": "\"\"\"\nSystem API Key model for admin-managed external service credentials.\n\"\"\"\n\nimport uuid\nfrom datetime import datetime, timezone\n\nfrom app.core.database import Base\nfrom sqlalchemy import Boolean, Column, DateTime, ForeignKey, String, Text\nfrom sqlalchemy.dialects.postgresql import UUID\nfrom sqlalchemy.orm import relationship\n\n\nclass SystemAPIKey(Base):\n    \"\"\"System API keys for external service credentials (OpenAI, PubMed, etc.)\"\"\"\n\n    __tablename__ = \"system_api_keys\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    integration_id = Column(String(50), unique=True, nullable=False, index=True)\n    key_name = Column(String(100), nullable=False)\n    encrypted_value = Column(Text, nullable=True)  # Fernet encrypted, NULL = use .env\n    is_override = Column(Boolean, default=False, nullable=False)\n    last_validated_at = Column(DateTime(timezone=True), nullable=True)\n    validation_status = Column(String(20), nullable=True)  # \"valid\", \"invalid\", \"unknown\"\n    updated_by = Column(UUID(as_uuid=True), ForeignKey(\"users.id\"), nullable=True)\n    created_at = Column(\n        DateTime(timezone=True),\n        default=lambda: datetime.now(timezone.utc),\n        nullable=False,\n    )\n    updated_at = Column(\n        DateTime(timezone=True),\n        default=lambda: datetime.now(timezone.utc),\n        onupdate=lambda: datetime.now(timezone.utc),\n        nullable=False,\n    )\n\n    # Relationship\n    updated_by_user = relationship(\"User\", foreign_keys=[updated_by])\n\n    def __repr__(self):\n        return f\"<SystemAPIKey(integration_id={self.integration_id}, key_name={self.key_name})>\"\n"
}
