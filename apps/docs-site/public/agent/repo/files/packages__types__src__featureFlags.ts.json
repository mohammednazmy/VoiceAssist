{
  "path": "packages/types/src/featureFlags.ts",
  "language": "typescript",
  "size": 25114,
  "last_modified": "2025-12-04T12:33:01.711Z",
  "lines": 890,
  "content": "/**\n * VoiceAssist Feature Flag Shared Definitions\n *\n * Single source of truth for feature flag definitions.\n * These definitions are used across all applications (web-app, admin-panel, api-gateway).\n *\n * Naming Convention: {category}.{feature_name}\n * - category: ui | backend | admin | integration | experiment | ops\n * - feature_name: snake_case identifier\n *\n * Example: ui.unified_chat_voice, backend.rag_strategy, ops.maintenance_mode\n */\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\n/**\n * Unified categories for feature flags.\n * Must match Python FlagCategory enum exactly.\n */\nexport const FLAG_CATEGORIES = [\n  \"ui\",\n  \"backend\",\n  \"admin\",\n  \"integration\",\n  \"experiment\",\n  \"ops\",\n] as const;\n\nexport type FlagCategory = (typeof FLAG_CATEGORIES)[number];\n\n/**\n * Feature flag value types.\n */\nexport const FLAG_TYPES = [\n  \"boolean\",\n  \"string\",\n  \"number\",\n  \"json\",\n  \"multivariate\",\n] as const;\n\nexport type FlagType = (typeof FLAG_TYPES)[number];\n\n/**\n * Criticality levels for feature flags.\n */\nexport type FlagCriticality = \"low\" | \"medium\" | \"high\" | \"critical\";\n\n/**\n * Feature flag dependencies.\n */\nexport interface FlagDependencies {\n  /** Services that use this flag */\n  services: readonly string[];\n  /** UI components that depend on this flag */\n  components: readonly string[];\n  /** Other flags this flag depends on or affects */\n  otherFlags: readonly string[];\n}\n\n/**\n * Feature flag metadata.\n */\nexport interface FlagMetadata {\n  /** Criticality level for the flag */\n  criticality: FlagCriticality;\n  /** Team or person responsible for this flag */\n  owner?: string;\n  /** URL to documentation about this flag */\n  docsUrl?: string;\n  /** Whether this flag is deprecated */\n  deprecated?: boolean;\n  /** Deprecation message with migration instructions */\n  deprecatedMessage?: string;\n  /** Whether this flag has been archived */\n  archived?: boolean;\n  /** Allowed values for string flags */\n  allowedValues?: string[];\n  /** Minimum value for number flags */\n  min?: number;\n  /** Maximum value for number flags */\n  max?: number;\n}\n\n// ============================================================================\n// Phase 3.2: Advanced Flag Types - Variants, Targeting, Scheduling\n// ============================================================================\n\n/**\n * Variant definition for multivariate flags.\n * Each variant has a unique ID, name, value, and traffic weight.\n */\nexport interface FlagVariant {\n  /** Unique identifier for this variant */\n  id: string;\n  /** Human-readable variant name */\n  name: string;\n  /** The value returned when this variant is selected */\n  value: unknown;\n  /** Traffic weight (0-100), sum of all variants should equal 100 */\n  weight: number;\n  /** Optional description of what this variant tests */\n  description?: string;\n}\n\n/**\n * Supported operators for targeting rule conditions.\n */\nexport type TargetingOperator =\n  | \"equals\"\n  | \"not_equals\"\n  | \"in\"\n  | \"not_in\"\n  | \"contains\"\n  | \"starts_with\"\n  | \"ends_with\"\n  | \"regex\"\n  | \"gt\"\n  | \"gte\"\n  | \"lt\"\n  | \"lte\"\n  | \"semver_gt\"\n  | \"semver_gte\"\n  | \"semver_lt\"\n  | \"semver_lte\";\n\n/**\n * User attributes available for targeting rules.\n */\nexport type TargetingAttribute =\n  | \"user_id\"\n  | \"user_email\"\n  | \"user_role\"\n  | \"user_created_at\"\n  | \"user_plan\"\n  | \"user_country\"\n  | \"user_language\"\n  | \"app_version\"\n  | \"platform\"\n  | \"custom\";\n\n/**\n * A single targeting rule condition.\n */\nexport interface TargetingCondition {\n  /** The user attribute to evaluate */\n  attribute: TargetingAttribute | string;\n  /** The comparison operator */\n  operator: TargetingOperator;\n  /** The value(s) to compare against */\n  value: string | string[] | number | boolean;\n  /** For custom attributes, the custom attribute key */\n  customAttributeKey?: string;\n}\n\n/**\n * A targeting rule that maps conditions to a variant or enabled state.\n */\nexport interface TargetingRule {\n  /** Unique identifier for this rule */\n  id: string;\n  /** Human-readable rule name */\n  name: string;\n  /** Priority order (lower = higher priority) */\n  priority: number;\n  /** Conditions that must ALL match for this rule to apply (AND logic) */\n  conditions: TargetingCondition[];\n  /** For multivariate: which variant to serve */\n  variant?: string;\n  /** For boolean: whether to enable the flag */\n  enabled?: boolean;\n  /** For non-boolean: the value to return */\n  value?: unknown;\n  /** Optional description of this rule's purpose */\n  description?: string;\n}\n\n/**\n * Complete targeting rules configuration for a flag.\n */\nexport interface FlagTargetingRules {\n  /** List of targeting rules, evaluated in priority order */\n  rules: TargetingRule[];\n  /** Default variant/value when no rules match */\n  defaultVariant?: string;\n  /** Whether flag is enabled when no rules match (for boolean flags) */\n  defaultEnabled?: boolean;\n}\n\n/**\n * Schedule configuration for time-based flag activation.\n */\nexport interface FlagSchedule {\n  /** ISO 8601 timestamp when flag should activate */\n  startAt?: string;\n  /** ISO 8601 timestamp when flag should deactivate */\n  endAt?: string;\n  /** Timezone for schedule evaluation (default: UTC) */\n  timezone?: string;\n  /** Optional recurring schedule (cron-like) */\n  recurring?: {\n    /** Cron expression for recurring activation */\n    cronExpression: string;\n    /** Duration in minutes the flag stays active */\n    durationMinutes: number;\n  };\n}\n\n/**\n * User context for evaluating targeting rules.\n */\nexport interface UserContext {\n  /** User's unique ID */\n  userId?: string;\n  /** User's email address */\n  userEmail?: string;\n  /** User's role */\n  userRole?: string;\n  /** User account creation date */\n  userCreatedAt?: string;\n  /** User's subscription plan */\n  userPlan?: string;\n  /** User's country (ISO 3166-1 alpha-2) */\n  userCountry?: string;\n  /** User's preferred language */\n  userLanguage?: string;\n  /** Application version */\n  appVersion?: string;\n  /** Platform (web, ios, android) */\n  platform?: string;\n  /** Custom attributes for targeting */\n  customAttributes?: Record<string, string | number | boolean>;\n}\n\n/**\n * Environment types for multi-environment flag management.\n */\nexport type FlagEnvironment = \"development\" | \"staging\" | \"production\";\n\n/**\n * Extended feature flag state including runtime values.\n */\nexport interface FeatureFlagState {\n  /** The evaluated value for this user */\n  value: unknown;\n  /** Data source: realtime (SSE), api (HTTP), or cache (localStorage) */\n  source: \"realtime\" | \"api\" | \"cache\";\n  /** Whether the cached value may be stale */\n  isStale: boolean;\n  /** Error message if evaluation failed */\n  error: string | null;\n  /** For multivariate: which variant was selected */\n  variant?: string;\n  /** Which targeting rule matched (if any) */\n  matchedRule?: string;\n}\n\n/**\n * Complete feature flag definition.\n */\nexport interface FeatureFlagDefinition {\n  /** Full flag name with category prefix (e.g., \"ui.unified_chat_voice\") */\n  name: string;\n  /** Human-readable description */\n  description: string;\n  /** Category for grouping flags */\n  category: FlagCategory;\n  /** Type of flag value */\n  type: FlagType;\n  /** Default value when flag doesn't exist */\n  defaultValue: unknown;\n  /** Whether flag is enabled by default */\n  defaultEnabled: boolean;\n  /** Flag metadata */\n  metadata: FlagMetadata;\n  /** Dependencies for impact analysis */\n  dependencies?: FlagDependencies;\n}\n\n// ============================================================================\n// Feature Flag Definitions - Single Source of Truth\n// ============================================================================\n\n/**\n * All feature flags organized by category.\n * This is the single source of truth for flag definitions.\n */\nexport const FEATURE_FLAGS = {\n  // -------------------------------------------------------------------------\n  // UI Flags - Frontend toggles\n  // -------------------------------------------------------------------------\n  ui: {\n    unified_chat_voice: {\n      name: \"ui.unified_chat_voice\",\n      description: \"Enable unified chat and voice interface\",\n      category: \"ui\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"medium\" as const,\n        docsUrl: \"http://localhost:3001/admin/feature-flags#ui\",\n      },\n      dependencies: {\n        services: [\"web-app\"],\n        components: [\"VoiceChat\", \"ChatInterface\", \"UnifiedChatContainer\"],\n        otherFlags: [],\n      },\n    },\n    new_navigation: {\n      name: \"ui.new_navigation\",\n      description: \"Enable new sidebar navigation layout\",\n      category: \"ui\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"web-app\", \"admin-panel\"],\n        components: [\"Sidebar\", \"Navigation\"],\n        otherFlags: [],\n      },\n    },\n    beta_features: {\n      name: \"ui.beta_features\",\n      description: \"Enable beta/experimental UI features\",\n      category: \"ui\" as const,\n      type: \"boolean\" as const,\n      defaultValue: false,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"web-app\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    dark_mode: {\n      name: \"ui.dark_mode\",\n      description: \"Enable dark mode theme option\",\n      category: \"ui\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"web-app\", \"admin-panel\"],\n        components: [\"ThemeProvider\", \"SettingsPanel\"],\n        otherFlags: [],\n      },\n    },\n  },\n\n  // -------------------------------------------------------------------------\n  // Backend Flags - API/service behavior\n  // -------------------------------------------------------------------------\n  backend: {\n    rbac_enforcement: {\n      name: \"backend.rbac_enforcement\",\n      description: \"Enable RBAC permission checks on admin endpoints\",\n      category: \"backend\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"high\" as const,\n        owner: \"security-team\",\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [\"backend.rbac_strict_mode\"],\n      },\n    },\n    rbac_strict_mode: {\n      name: \"backend.rbac_strict_mode\",\n      description: \"Enable strict RBAC mode (deny by default)\",\n      category: \"backend\" as const,\n      type: \"boolean\" as const,\n      defaultValue: false,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"medium\" as const,\n        owner: \"security-team\",\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [\"backend.rbac_enforcement\"],\n      },\n    },\n    rag_strategy: {\n      name: \"backend.rag_strategy\",\n      description: \"RAG query strategy (simple, multi_hop, hybrid)\",\n      category: \"backend\" as const,\n      type: \"string\" as const,\n      defaultValue: \"simple\",\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"high\" as const,\n        allowedValues: [\"simple\", \"multi_hop\", \"hybrid\"],\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    rag_max_results: {\n      name: \"backend.rag_max_results\",\n      description: \"Maximum number of RAG search results to return\",\n      category: \"backend\" as const,\n      type: \"number\" as const,\n      defaultValue: 5,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n        min: 1,\n        max: 20,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    rag_score_threshold: {\n      name: \"backend.rag_score_threshold\",\n      description: \"Minimum similarity score threshold for RAG results\",\n      category: \"backend\" as const,\n      type: \"number\" as const,\n      defaultValue: 0.2,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n        min: 0.0,\n        max: 1.0,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    cache_enabled: {\n      name: \"backend.cache_enabled\",\n      description: \"Enable multi-level caching (L1/L2)\",\n      category: \"backend\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    async_indexing: {\n      name: \"backend.async_indexing\",\n      description: \"Enable asynchronous document indexing\",\n      category: \"backend\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n  },\n\n  // -------------------------------------------------------------------------\n  // Admin Flags - Admin panel features\n  // -------------------------------------------------------------------------\n  admin: {\n    bulk_operations: {\n      name: \"admin.bulk_operations\",\n      description: \"Enable bulk operations in admin panel\",\n      category: \"admin\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n      },\n      dependencies: {\n        services: [\"admin-panel\"],\n        components: [\"BulkActionsToolbar\", \"DataTable\"],\n        otherFlags: [],\n      },\n    },\n    advanced_analytics: {\n      name: \"admin.advanced_analytics\",\n      description: \"Enable advanced analytics dashboard\",\n      category: \"admin\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"admin-panel\", \"api-gateway\"],\n        components: [\"AnalyticsDashboard\"],\n        otherFlags: [],\n      },\n    },\n    audit_log_export: {\n      name: \"admin.audit_log_export\",\n      description: \"Enable audit log export functionality\",\n      category: \"admin\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"admin-panel\", \"api-gateway\"],\n        components: [\"AuditLogPanel\"],\n        otherFlags: [],\n      },\n    },\n  },\n\n  // -------------------------------------------------------------------------\n  // Integration Flags - External services\n  // -------------------------------------------------------------------------\n  integration: {\n    nextcloud: {\n      name: \"integration.nextcloud\",\n      description: \"Enable Nextcloud integration features\",\n      category: \"integration\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"high\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [\"integration.nextcloud_auto_index\"],\n      },\n    },\n    nextcloud_auto_index: {\n      name: \"integration.nextcloud_auto_index\",\n      description: \"Enable automatic indexing of Nextcloud files\",\n      category: \"integration\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [\"integration.nextcloud\"],\n      },\n    },\n    openai: {\n      name: \"integration.openai\",\n      description: \"Enable OpenAI API for RAG queries\",\n      category: \"integration\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"high\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n  },\n\n  // -------------------------------------------------------------------------\n  // Experiment Flags - A/B tests and experiments\n  // -------------------------------------------------------------------------\n  experiment: {\n    onboarding_v2: {\n      name: \"experiment.onboarding_v2\",\n      description: \"A/B test for new onboarding flow\",\n      category: \"experiment\" as const,\n      type: \"boolean\" as const,\n      defaultValue: null,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"web-app\"],\n        components: [\"OnboardingWizard\"],\n        otherFlags: [],\n      },\n    },\n    experimental_api: {\n      name: \"experiment.experimental_api\",\n      description: \"Enable experimental API endpoints\",\n      category: \"experiment\" as const,\n      type: \"boolean\" as const,\n      defaultValue: false,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n  },\n\n  // -------------------------------------------------------------------------\n  // Ops Flags - Operational controls\n  // -------------------------------------------------------------------------\n  ops: {\n    maintenance_mode: {\n      name: \"ops.maintenance_mode\",\n      description: \"Enable maintenance mode (read-only access)\",\n      category: \"ops\" as const,\n      type: \"boolean\" as const,\n      defaultValue: false,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"critical\" as const,\n        owner: \"ops-team\",\n      },\n      dependencies: {\n        services: [\"api-gateway\", \"web-app\", \"admin-panel\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    rate_limiting: {\n      name: \"ops.rate_limiting\",\n      description: \"Enable API rate limiting\",\n      category: \"ops\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"high\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    metrics_enabled: {\n      name: \"ops.metrics_enabled\",\n      description: \"Enable Prometheus metrics collection\",\n      category: \"ops\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    tracing_enabled: {\n      name: \"ops.tracing_enabled\",\n      description: \"Enable OpenTelemetry distributed tracing\",\n      category: \"ops\" as const,\n      type: \"boolean\" as const,\n      defaultValue: true,\n      defaultEnabled: true,\n      metadata: {\n        criticality: \"medium\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n    verbose_logging: {\n      name: \"ops.verbose_logging\",\n      description: \"Enable verbose logging (debug level)\",\n      category: \"ops\" as const,\n      type: \"boolean\" as const,\n      defaultValue: false,\n      defaultEnabled: false,\n      metadata: {\n        criticality: \"low\" as const,\n      },\n      dependencies: {\n        services: [\"api-gateway\"],\n        components: [],\n        otherFlags: [],\n      },\n    },\n  },\n} as const;\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Get all feature flag definitions as a flat array.\n */\nexport function getAllFlags(): FeatureFlagDefinition[] {\n  const allFlags: FeatureFlagDefinition[] = [];\n\n  for (const category of FLAG_CATEGORIES) {\n    const categoryFlags = FEATURE_FLAGS[category];\n    if (categoryFlags) {\n      for (const flag of Object.values(categoryFlags)) {\n        allFlags.push(flag as FeatureFlagDefinition);\n      }\n    }\n  }\n\n  return allFlags;\n}\n\n/**\n * Get a flag definition by its full name.\n * @param name Full flag name (e.g., \"ui.unified_chat_voice\")\n */\nexport function getFlagByName(name: string): FeatureFlagDefinition | undefined {\n  const [category, flagName] = name.split(\".\", 2);\n\n  if (!category || !flagName) {\n    return undefined;\n  }\n\n  const categoryFlags = FEATURE_FLAGS[category as FlagCategory];\n  if (!categoryFlags) {\n    return undefined;\n  }\n\n  return (categoryFlags as Record<string, FeatureFlagDefinition>)[flagName];\n}\n\n/**\n * Get all flag definitions for a specific category.\n */\nexport function getFlagsByCategory(\n  category: FlagCategory,\n): FeatureFlagDefinition[] {\n  const categoryFlags = FEATURE_FLAGS[category];\n  if (!categoryFlags) {\n    return [];\n  }\n\n  return Object.values(categoryFlags) as FeatureFlagDefinition[];\n}\n\n/**\n * Validate a flag name matches the naming convention.\n * Pattern: {category}.{snake_case_name}\n */\nexport function isValidFlagName(name: string): boolean {\n  const pattern =\n    /^(ui|backend|admin|integration|experiment|ops)\\.[a-z][a-z0-9_]*$/;\n  return pattern.test(name);\n}\n\n/**\n * Get flag names grouped by category.\n */\nexport function getFlagNamesByCategory(): Record<FlagCategory, string[]> {\n  const result: Record<FlagCategory, string[]> = {\n    ui: [],\n    backend: [],\n    admin: [],\n    integration: [],\n    experiment: [],\n    ops: [],\n  };\n\n  for (const category of FLAG_CATEGORIES) {\n    const categoryFlags = FEATURE_FLAGS[category];\n    if (categoryFlags) {\n      result[category] = Object.values(categoryFlags).map(\n        (f) => (f as FeatureFlagDefinition).name,\n      );\n    }\n  }\n\n  return result;\n}\n\n// ============================================================================\n// Legacy Compatibility - Map old flag names to new names\n// ============================================================================\n\n/**\n * Map of old flag names to new dot-based names.\n * Used for migration from old naming convention.\n */\nexport const LEGACY_FLAG_NAME_MAP: Record<string, string> = {\n  // Old name -> New name\n  rbac_enforcement: \"backend.rbac_enforcement\",\n  rbac_strict_mode: \"backend.rbac_strict_mode\",\n  metrics_enabled: \"ops.metrics_enabled\",\n  tracing_enabled: \"ops.tracing_enabled\",\n  logging_verbose: \"ops.verbose_logging\",\n  nextcloud_integration: \"integration.nextcloud\",\n  openai_enabled: \"integration.openai\",\n  nextcloud_auto_index: \"integration.nextcloud_auto_index\",\n  rag_strategy: \"backend.rag_strategy\",\n  rag_max_results: \"backend.rag_max_results\",\n  rag_score_threshold: \"backend.rag_score_threshold\",\n  cache_enabled: \"backend.cache_enabled\",\n  async_indexing: \"backend.async_indexing\",\n  beta_features: \"ui.beta_features\",\n  experimental_api: \"experiment.experimental_api\",\n};\n\n/**\n * Resolve a flag name, handling legacy names.\n * @param name Flag name (old or new format)\n * @param warn Whether to emit a deprecation warning for legacy names\n * @returns Resolved flag name in new format\n */\nexport function resolveFlagName(name: string, warn: boolean = false): string {\n  // If it's already in new format, return as-is\n  if (name.includes(\".\")) {\n    return name;\n  }\n\n  // Check if it's a legacy name\n  const newName = LEGACY_FLAG_NAME_MAP[name];\n  if (newName) {\n    if (warn && typeof console !== \"undefined\") {\n      console.warn(\n        `[DEPRECATION] Feature flag '${name}' is deprecated. ` +\n          `Use '${newName}' instead. ` +\n          `Legacy flag names will be removed in a future release.`,\n      );\n    }\n    return newName;\n  }\n\n  return name;\n}\n\n/**\n * Get a flag definition, warning if using a deprecated name.\n *\n * This is the preferred method for accessing flags as it handles\n * legacy name resolution and deprecation warnings.\n *\n * @param name Flag name (old or new format)\n * @returns Flag definition or undefined if not found\n */\nexport function getFlagWithDeprecationCheck(\n  name: string,\n): FeatureFlagDefinition | undefined {\n  const resolvedName = resolveFlagName(name, true);\n  return getFlagByName(resolvedName);\n}\n\n/**\n * Check if a flag name is deprecated (using legacy naming).\n * @param name Flag name to check\n * @returns true if the name is a legacy name that has been remapped\n */\nexport function isDeprecatedFlagName(name: string): boolean {\n  return !name.includes(\".\") && name in LEGACY_FLAG_NAME_MAP;\n}\n"
}
