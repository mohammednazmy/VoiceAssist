{
  "path": "services/api-gateway/app/models/feature_flag_analytics.py",
  "language": "python",
  "size": 2401,
  "last_modified": "2025-12-05T03:07:13.131Z",
  "lines": 65,
  "content": "\"\"\"Feature Flag Analytics Model (Phase 7 - P3.1+).\n\nTracks feature flag usage for analytics and monitoring.\n\"\"\"\n\nfrom __future__ import annotations\n\nimport uuid\nfrom datetime import datetime\n\nfrom app.core.database import Base\nfrom sqlalchemy import Boolean, Column, DateTime, Index, String\nfrom sqlalchemy.dialects.postgresql import UUID\n\n\nclass FeatureFlagAnalytics(Base):\n    \"\"\"Feature flag usage analytics.\n\n    Tracks when feature flags are checked and their outcomes.\n    Used for understanding feature adoption and debugging.\n\n    Attributes:\n        id: Unique identifier\n        flag_name: Feature flag name\n        user_id: User who checked the flag (nullable for anonymous)\n        checked_at: When flag was checked\n        result: Result of the check (true/false)\n        source: Source of the check (api, decorator, service, etc.)\n        endpoint: API endpoint where check occurred (if applicable)\n        trace_id: Distributed trace ID for correlation\n    \"\"\"\n\n    __tablename__ = \"feature_flag_analytics\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    flag_name = Column(String(255), nullable=False, index=True)\n    user_id = Column(UUID(as_uuid=True), nullable=True, index=True)\n    checked_at = Column(DateTime, default=datetime.utcnow, nullable=False, index=True)\n    result = Column(Boolean, nullable=False)\n    source = Column(String(50), nullable=True)  # 'api', 'decorator', 'service'\n    endpoint = Column(String(255), nullable=True)\n    trace_id = Column(String(100), nullable=True, index=True)\n\n    __table_args__ = (\n        # Composite indexes for common queries\n        Index(\"ix_feature_flag_analytics_flag_date\", \"flag_name\", \"checked_at\"),\n        Index(\"ix_feature_flag_analytics_user_date\", \"user_id\", \"checked_at\"),\n    )\n\n    def __repr__(self):\n        return f\"<FeatureFlagAnalytics(flag='{self.flag_name}', user='{self.user_id}', result={self.result})>\"\n\n    def to_dict(self) -> dict:\n        \"\"\"Convert model to dictionary.\"\"\"\n        return {\n            \"id\": str(self.id),\n            \"flag_name\": self.flag_name,\n            \"user_id\": str(self.user_id) if self.user_id else None,\n            \"checked_at\": self.checked_at.isoformat() if self.checked_at else None,\n            \"result\": self.result,\n            \"source\": self.source,\n            \"endpoint\": self.endpoint,\n            \"trace_id\": self.trace_id,\n        }\n"
}
