{
  "path": "apps/admin-panel/src/components/feature-flags/UserOverridesPanel.tsx",
  "language": "typescript",
  "size": 29534,
  "last_modified": "2025-12-04T12:34:39.094Z",
  "lines": 895,
  "content": "/**\n * User Flag Overrides Panel (Phase 4)\n *\n * Admin panel component for managing per-user feature flag overrides.\n *\n * Features:\n * - View override statistics\n * - Search overrides by user ID or flag name\n * - Create new overrides\n * - Edit existing overrides\n * - Bulk enable/disable overrides\n * - Delete overrides\n * - Full accessibility support (keyboard nav, ARIA labels)\n */\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\nimport {\n  useUserOverrides,\n  UserFlagOverride,\n  UserFlagOverrideCreate,\n  UserFlagOverrideUpdate,\n} from \"../../hooks/useUserOverrides\";\nimport {\n  DataPanel,\n  StatusBadge,\n  ConfirmDialog,\n  EmptyState,\n  LoadingGrid,\n  ErrorState,\n  RefreshButton,\n  StatCard,\n} from \"../shared\";\n\ninterface UserOverridesPanelProps {\n  /** Optional: filter to specific user ID */\n  userId?: string;\n  /** Optional: filter to specific flag name */\n  flagName?: string;\n  /** Whether user has admin permissions */\n  isAdmin?: boolean;\n}\n\nexport function UserOverridesPanel({\n  userId,\n  flagName,\n  isAdmin = false,\n}: UserOverridesPanelProps) {\n  const {\n    overrides,\n    loading,\n    error,\n    stats,\n    refreshOverrides,\n    createOverride,\n    updateOverride,\n    deleteOverride,\n    toggleOverride,\n    bulkDelete,\n    refreshStats,\n  } = useUserOverrides({ userId, flagName });\n\n  // Search state\n  const [searchUserId, setSearchUserId] = useState(\"\");\n  const [searchFlagName, setSearchFlagName] = useState(\"\");\n\n  // Modal states\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [editingOverride, setEditingOverride] =\n    useState<UserFlagOverride | null>(null);\n  const [deletingOverride, setDeletingOverride] =\n    useState<UserFlagOverride | null>(null);\n  const [selectedOverrides, setSelectedOverrides] = useState<Set<string>>(\n    new Set(),\n  );\n  const [updating, setUpdating] = useState(false);\n\n  // Form state\n  const [formUserId, setFormUserId] = useState(\"\");\n  const [formFlagName, setFormFlagName] = useState(\"\");\n  const [formValue, setFormValue] = useState(\"\");\n  const [formEnabled, setFormEnabled] = useState(true);\n  const [formReason, setFormReason] = useState(\"\");\n  const [formExpiresAt, setFormExpiresAt] = useState(\"\");\n\n  // Focus management refs\n  const createButtonRef = useRef<HTMLButtonElement>(null);\n  const modalFirstFocusRef = useRef<HTMLInputElement>(null);\n\n  // Filter overrides based on search\n  const filteredOverrides = overrides.filter((override) => {\n    if (searchUserId && !override.user_id.includes(searchUserId)) return false;\n    if (searchFlagName && !override.flag_name.includes(searchFlagName))\n      return false;\n    return true;\n  });\n\n  // Reset form\n  const resetForm = useCallback(() => {\n    setFormUserId(userId || \"\");\n    setFormFlagName(flagName || \"\");\n    setFormValue(\"\");\n    setFormEnabled(true);\n    setFormReason(\"\");\n    setFormExpiresAt(\"\");\n  }, [userId, flagName]);\n\n  // Open create modal\n  const openCreateModal = useCallback(() => {\n    resetForm();\n    setShowCreateModal(true);\n  }, [resetForm]);\n\n  // Close create modal\n  const closeCreateModal = useCallback(() => {\n    setShowCreateModal(false);\n    createButtonRef.current?.focus();\n  }, []);\n\n  // Open edit modal\n  const openEditModal = useCallback((override: UserFlagOverride) => {\n    setFormUserId(override.user_id);\n    setFormFlagName(override.flag_name);\n    setFormValue(JSON.stringify(override.value ?? \"\"));\n    setFormEnabled(override.enabled);\n    setFormReason(override.reason || \"\");\n    setFormExpiresAt(\n      override.expires_at ? override.expires_at.slice(0, 16) : \"\",\n    );\n    setEditingOverride(override);\n  }, []);\n\n  // Close edit modal\n  const closeEditModal = useCallback(() => {\n    setEditingOverride(null);\n    resetForm();\n  }, [resetForm]);\n\n  // Handle create\n  const handleCreate = useCallback(async () => {\n    if (!formUserId || !formFlagName) return;\n\n    setUpdating(true);\n    const newOverride: UserFlagOverrideCreate = {\n      user_id: formUserId,\n      flag_name: formFlagName,\n      value: formValue ? JSON.parse(formValue) : undefined,\n      enabled: formEnabled,\n      reason: formReason || undefined,\n      expires_at: formExpiresAt\n        ? new Date(formExpiresAt).toISOString()\n        : undefined,\n    };\n\n    const success = await createOverride(newOverride);\n    if (success) {\n      closeCreateModal();\n      await refreshStats();\n    }\n    setUpdating(false);\n  }, [\n    formUserId,\n    formFlagName,\n    formValue,\n    formEnabled,\n    formReason,\n    formExpiresAt,\n    createOverride,\n    closeCreateModal,\n    refreshStats,\n  ]);\n\n  // Handle update\n  const handleUpdate = useCallback(async () => {\n    if (!editingOverride) return;\n\n    setUpdating(true);\n    const updates: UserFlagOverrideUpdate = {\n      value: formValue ? JSON.parse(formValue) : undefined,\n      enabled: formEnabled,\n      reason: formReason || undefined,\n      expires_at: formExpiresAt\n        ? new Date(formExpiresAt).toISOString()\n        : undefined,\n    };\n\n    const success = await updateOverride(\n      editingOverride.user_id,\n      editingOverride.flag_name,\n      updates,\n    );\n    if (success) {\n      closeEditModal();\n      await refreshStats();\n    }\n    setUpdating(false);\n  }, [\n    editingOverride,\n    formValue,\n    formEnabled,\n    formReason,\n    formExpiresAt,\n    updateOverride,\n    closeEditModal,\n    refreshStats,\n  ]);\n\n  // Handle delete\n  const handleDelete = useCallback(async () => {\n    if (!deletingOverride) return;\n\n    setUpdating(true);\n    const success = await deleteOverride(\n      deletingOverride.user_id,\n      deletingOverride.flag_name,\n    );\n    if (success) {\n      setDeletingOverride(null);\n      await refreshStats();\n    }\n    setUpdating(false);\n  }, [deletingOverride, deleteOverride, refreshStats]);\n\n  // Handle bulk delete\n  const handleBulkDelete = useCallback(async () => {\n    if (selectedOverrides.size === 0) return;\n\n    setUpdating(true);\n    // Extract user IDs from selected overrides\n    const userIds = Array.from(selectedOverrides).map(\n      (key) => key.split(\":\")[0],\n    );\n    const success = await bulkDelete(userIds);\n    if (success) {\n      setSelectedOverrides(new Set());\n      await refreshStats();\n    }\n    setUpdating(false);\n  }, [selectedOverrides, bulkDelete, refreshStats]);\n\n  // Toggle selection\n  const toggleSelection = useCallback((override: UserFlagOverride) => {\n    const key = `${override.user_id}:${override.flag_name}`;\n    setSelectedOverrides((prev) => {\n      const next = new Set(prev);\n      if (next.has(key)) {\n        next.delete(key);\n      } else {\n        next.add(key);\n      }\n      return next;\n    });\n  }, []);\n\n  // Select all visible\n  const selectAll = useCallback(() => {\n    setSelectedOverrides(\n      new Set(filteredOverrides.map((o) => `${o.user_id}:${o.flag_name}`)),\n    );\n  }, [filteredOverrides]);\n\n  // Clear selection\n  const clearSelection = useCallback(() => {\n    setSelectedOverrides(new Set());\n  }, []);\n\n  // Focus first input when modal opens\n  useEffect(() => {\n    if (showCreateModal || editingOverride) {\n      setTimeout(() => modalFirstFocusRef.current?.focus(), 100);\n    }\n  }, [showCreateModal, editingOverride]);\n\n  // Check if override is expired\n  const isExpired = (override: UserFlagOverride) => {\n    if (!override.expires_at) return false;\n    return new Date(override.expires_at) < new Date();\n  };\n\n  // Get status badge for override\n  const getOverrideBadge = (override: UserFlagOverride) => {\n    if (isExpired(override)) {\n      return <StatusBadge status=\"error\" label=\"Expired\" size=\"sm\" />;\n    }\n    if (!override.enabled) {\n      return <StatusBadge status=\"pending\" label=\"Disabled\" size=\"sm\" />;\n    }\n    return <StatusBadge status=\"online\" label=\"Active\" size=\"sm\" />;\n  };\n\n  // Loading state\n  if (loading && !overrides.length && !stats) {\n    return <LoadingGrid count={3} cols={1} />;\n  }\n\n  return (\n    <>\n      {/* Statistics Cards */}\n      {stats && (\n        <div\n          className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\"\n          role=\"region\"\n          aria-label=\"Override statistics\"\n        >\n          <StatCard\n            label=\"Total Overrides\"\n            value={stats.total_overrides}\n            variant=\"default\"\n          />\n          <StatCard\n            label=\"Active\"\n            value={stats.active_overrides}\n            variant=\"success\"\n          />\n          <StatCard\n            label=\"Expired\"\n            value={stats.expired_overrides}\n            variant=\"warning\"\n          />\n          <StatCard\n            label=\"Users\"\n            value={stats.users_with_overrides}\n            variant=\"info\"\n          />\n        </div>\n      )}\n\n      <DataPanel\n        title={\n          userId\n            ? `Overrides for User ${userId.slice(0, 8)}...`\n            : flagName\n              ? `Overrides for ${flagName}`\n              : `User Flag Overrides (${filteredOverrides.length})`\n        }\n        noPadding\n        actions={\n          <div className=\"flex items-center gap-2\">\n            {isAdmin && selectedOverrides.size > 0 && (\n              <button\n                type=\"button\"\n                onClick={handleBulkDelete}\n                disabled={updating}\n                className=\"px-3 py-1.5 text-xs font-medium bg-red-600 hover:bg-red-700 disabled:bg-red-800 text-white rounded transition-colors focus:outline-none focus:ring-2 focus:ring-red-500\"\n                aria-label={`Delete ${selectedOverrides.size} selected overrides`}\n              >\n                Delete Selected ({selectedOverrides.size})\n              </button>\n            )}\n            {isAdmin && (\n              <button\n                ref={createButtonRef}\n                type=\"button\"\n                onClick={openCreateModal}\n                className=\"px-3 py-1.5 text-xs font-medium bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-900\"\n                aria-label=\"Create new user override\"\n              >\n                Create Override\n              </button>\n            )}\n            <RefreshButton\n              onClick={() => {\n                refreshOverrides();\n                refreshStats();\n              }}\n              isLoading={loading}\n              aria-label=\"Refresh overrides\"\n            />\n          </div>\n        }\n      >\n        {error && (\n          <ErrorState\n            message={error}\n            onRetry={() => {\n              refreshOverrides();\n              refreshStats();\n            }}\n          />\n        )}\n\n        {/* Search/Filter Bar */}\n        <div className=\"p-4 border-b border-slate-800 flex gap-4\">\n          <div className=\"flex-1\">\n            <label htmlFor=\"search-user\" className=\"sr-only\">\n              Search by User ID\n            </label>\n            <input\n              id=\"search-user\"\n              type=\"text\"\n              value={searchUserId}\n              onChange={(e) => setSearchUserId(e.target.value)}\n              placeholder=\"Filter by user ID...\"\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n          <div className=\"flex-1\">\n            <label htmlFor=\"search-flag\" className=\"sr-only\">\n              Search by Flag Name\n            </label>\n            <input\n              id=\"search-flag\"\n              type=\"text\"\n              value={searchFlagName}\n              onChange={(e) => setSearchFlagName(e.target.value)}\n              placeholder=\"Filter by flag name...\"\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n          {isAdmin && filteredOverrides.length > 0 && (\n            <button\n              type=\"button\"\n              onClick={\n                selectedOverrides.size === filteredOverrides.length\n                  ? clearSelection\n                  : selectAll\n              }\n              className=\"px-3 py-2 text-xs font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            >\n              {selectedOverrides.size === filteredOverrides.length\n                ? \"Clear All\"\n                : \"Select All\"}\n            </button>\n          )}\n        </div>\n\n        {filteredOverrides.length === 0 ? (\n          <div className=\"p-4\">\n            <EmptyState\n              message={\n                searchUserId || searchFlagName\n                  ? \"No overrides match your search\"\n                  : \"No user overrides configured\"\n              }\n              icon=\"ðŸŽ›ï¸\"\n              action={\n                isAdmin\n                  ? {\n                      label: \"Create First Override\",\n                      onClick: openCreateModal,\n                    }\n                  : undefined\n              }\n            />\n          </div>\n        ) : (\n          <div\n            className=\"divide-y divide-slate-800\"\n            role=\"list\"\n            aria-label=\"User flag overrides\"\n          >\n            {filteredOverrides.map((override) => {\n              const key = `${override.user_id}:${override.flag_name}`;\n              const isSelected = selectedOverrides.has(key);\n\n              return (\n                <div\n                  key={override.id}\n                  className={`p-4 hover:bg-slate-800/30 transition-colors ${\n                    isSelected ? \"bg-blue-900/20\" : \"\"\n                  }`}\n                  role=\"listitem\"\n                  aria-label={`Override for ${override.flag_name} on user ${override.user_id}`}\n                >\n                  <div className=\"flex items-start gap-4\">\n                    {/* Checkbox */}\n                    {isAdmin && (\n                      <div className=\"flex items-center pt-1\">\n                        <input\n                          type=\"checkbox\"\n                          checked={isSelected}\n                          onChange={() => toggleSelection(override)}\n                          className=\"w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-600 focus:ring-blue-500 focus:ring-offset-slate-900\"\n                          aria-label={`Select override for ${override.flag_name}`}\n                        />\n                      </div>\n                    )}\n\n                    <div className=\"flex-1 min-w-0\">\n                      {/* Header row */}\n                      <div className=\"flex items-center gap-3 mb-2\">\n                        <h4 className=\"font-medium text-slate-200 font-mono\">\n                          {override.flag_name}\n                        </h4>\n                        {getOverrideBadge(override)}\n                      </div>\n\n                      {/* User ID */}\n                      <p className=\"text-sm text-slate-300 mb-1\">\n                        <span className=\"text-slate-500\">User:</span>{\" \"}\n                        <span className=\"font-mono\">{override.user_id}</span>\n                      </p>\n\n                      {/* Value */}\n                      {override.value !== undefined && (\n                        <p className=\"text-sm text-slate-400 mb-1\">\n                          <span className=\"text-slate-500\">Value:</span>{\" \"}\n                          <code className=\"px-1 bg-slate-800 rounded text-xs\">\n                            {JSON.stringify(override.value)}\n                          </code>\n                        </p>\n                      )}\n\n                      {/* Reason */}\n                      {override.reason && (\n                        <p className=\"text-sm text-slate-400 mb-1\">\n                          <span className=\"text-slate-500\">Reason:</span>{\" \"}\n                          {override.reason}\n                        </p>\n                      )}\n\n                      {/* Expiration */}\n                      {override.expires_at && (\n                        <p\n                          className={`text-sm mb-1 ${isExpired(override) ? \"text-red-400\" : \"text-slate-400\"}`}\n                        >\n                          <span className=\"text-slate-500\">Expires:</span>{\" \"}\n                          {new Date(override.expires_at).toLocaleString()}\n                        </p>\n                      )}\n\n                      {/* Metadata */}\n                      <p className=\"text-xs text-slate-500 mt-2\">\n                        Created:{\" \"}\n                        {new Date(override.created_at).toLocaleString()}\n                        {override.created_by && ` by ${override.created_by}`}\n                        {override.updated_by &&\n                          override.updated_by !== override.created_by && (\n                            <span> | Modified by {override.updated_by}</span>\n                          )}\n                      </p>\n                    </div>\n\n                    {/* Actions */}\n                    {isAdmin && (\n                      <div\n                        className=\"flex items-center gap-2\"\n                        role=\"group\"\n                        aria-label={`Actions for ${override.flag_name} override`}\n                      >\n                        <button\n                          type=\"button\"\n                          onClick={() =>\n                            toggleOverride(override.user_id, override.flag_name)\n                          }\n                          className=\"px-2 py-1 text-xs font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                          aria-label={`${override.enabled ? \"Disable\" : \"Enable\"} override`}\n                        >\n                          {override.enabled ? \"Disable\" : \"Enable\"}\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={() => openEditModal(override)}\n                          className=\"px-2 py-1 text-xs font-medium text-slate-400 hover:text-slate-200 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                          aria-label=\"Edit override\"\n                        >\n                          Edit\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={() => setDeletingOverride(override)}\n                          className=\"px-2 py-1 text-xs font-medium text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-red-500\"\n                          aria-label=\"Delete override\"\n                        >\n                          Delete\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </DataPanel>\n\n      {/* Create Modal */}\n      {showCreateModal && (\n        <OverrideFormModal\n          title=\"Create User Override\"\n          formUserId={formUserId}\n          formFlagName={formFlagName}\n          formValue={formValue}\n          formEnabled={formEnabled}\n          formReason={formReason}\n          formExpiresAt={formExpiresAt}\n          onUserIdChange={setFormUserId}\n          onFlagNameChange={setFormFlagName}\n          onValueChange={setFormValue}\n          onEnabledChange={setFormEnabled}\n          onReasonChange={setFormReason}\n          onExpiresAtChange={setFormExpiresAt}\n          onSubmit={handleCreate}\n          onCancel={closeCreateModal}\n          isLoading={updating}\n          isEdit={false}\n          showUserIdField={!userId}\n          showFlagNameField={!flagName}\n          firstFocusRef={modalFirstFocusRef}\n        />\n      )}\n\n      {/* Edit Modal */}\n      {editingOverride && (\n        <OverrideFormModal\n          title={`Edit Override: ${editingOverride.flag_name}`}\n          formUserId={formUserId}\n          formFlagName={formFlagName}\n          formValue={formValue}\n          formEnabled={formEnabled}\n          formReason={formReason}\n          formExpiresAt={formExpiresAt}\n          onUserIdChange={setFormUserId}\n          onFlagNameChange={setFormFlagName}\n          onValueChange={setFormValue}\n          onEnabledChange={setFormEnabled}\n          onReasonChange={setFormReason}\n          onExpiresAtChange={setFormExpiresAt}\n          onSubmit={handleUpdate}\n          onCancel={closeEditModal}\n          isLoading={updating}\n          isEdit={true}\n          showUserIdField={false}\n          showFlagNameField={false}\n          firstFocusRef={modalFirstFocusRef}\n        />\n      )}\n\n      {/* Delete Confirmation */}\n      <ConfirmDialog\n        isOpen={!!deletingOverride}\n        onClose={() => setDeletingOverride(null)}\n        onConfirm={handleDelete}\n        title=\"Delete Override\"\n        message={\n          <>\n            Are you sure you want to delete the override for{\" \"}\n            <strong className=\"text-slate-200\">\n              {deletingOverride?.flag_name}\n            </strong>{\" \"}\n            on user{\" \"}\n            <code className=\"px-1 bg-slate-800 rounded text-xs\">\n              {deletingOverride?.user_id}\n            </code>\n            ? This action cannot be undone.\n          </>\n        }\n        confirmLabel=\"Delete Override\"\n        variant=\"danger\"\n        isLoading={updating}\n      />\n    </>\n  );\n}\n\n// Form Modal Component\ninterface OverrideFormModalProps {\n  title: string;\n  formUserId: string;\n  formFlagName: string;\n  formValue: string;\n  formEnabled: boolean;\n  formReason: string;\n  formExpiresAt: string;\n  onUserIdChange: (value: string) => void;\n  onFlagNameChange: (value: string) => void;\n  onValueChange: (value: string) => void;\n  onEnabledChange: (value: boolean) => void;\n  onReasonChange: (value: string) => void;\n  onExpiresAtChange: (value: string) => void;\n  onSubmit: () => void;\n  onCancel: () => void;\n  isLoading: boolean;\n  isEdit: boolean;\n  showUserIdField: boolean;\n  showFlagNameField: boolean;\n  firstFocusRef: React.RefObject<HTMLInputElement>;\n}\n\nfunction OverrideFormModal({\n  title,\n  formUserId,\n  formFlagName,\n  formValue,\n  formEnabled,\n  formReason,\n  formExpiresAt,\n  onUserIdChange,\n  onFlagNameChange,\n  onValueChange,\n  onEnabledChange,\n  onReasonChange,\n  onExpiresAtChange,\n  onSubmit,\n  onCancel,\n  isLoading,\n  isEdit,\n  showUserIdField,\n  showFlagNameField,\n  firstFocusRef,\n}: OverrideFormModalProps) {\n  // Trap focus in modal\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Escape\") {\n      onCancel();\n    }\n  };\n\n  // Validate JSON value\n  const isValidJson = (value: string) => {\n    if (!value) return true;\n    try {\n      JSON.parse(value);\n      return true;\n    } catch {\n      return false;\n    }\n  };\n\n  const jsonValid = isValidJson(formValue);\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby=\"modal-title\"\n      onKeyDown={handleKeyDown}\n    >\n      <div\n        className=\"bg-slate-900 rounded-lg p-6 max-w-lg w-full mx-4 border border-slate-700 max-h-[90vh] overflow-y-auto\"\n        role=\"document\"\n      >\n        <h3\n          id=\"modal-title\"\n          className=\"text-lg font-semibold text-slate-100 mb-4\"\n        >\n          {title}\n        </h3>\n\n        <div className=\"space-y-4\">\n          {/* User ID */}\n          {showUserIdField && (\n            <div>\n              <label\n                htmlFor=\"user-id\"\n                className=\"block text-sm font-medium text-slate-300 mb-1\"\n              >\n                User ID\n              </label>\n              <input\n                ref={firstFocusRef}\n                id=\"user-id\"\n                type=\"text\"\n                value={formUserId}\n                onChange={(e) => onUserIdChange(e.target.value)}\n                disabled={isEdit}\n                placeholder=\"550e8400-e29b-41d4-a716-446655440000\"\n                className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 disabled:opacity-50 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                aria-required=\"true\"\n              />\n            </div>\n          )}\n\n          {/* Flag Name */}\n          {showFlagNameField && (\n            <div>\n              <label\n                htmlFor=\"flag-name\"\n                className=\"block text-sm font-medium text-slate-300 mb-1\"\n              >\n                Flag Name\n              </label>\n              <input\n                ref={showUserIdField ? undefined : firstFocusRef}\n                id=\"flag-name\"\n                type=\"text\"\n                value={formFlagName}\n                onChange={(e) => onFlagNameChange(e.target.value)}\n                disabled={isEdit}\n                placeholder=\"feature.flag_name\"\n                className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 disabled:opacity-50 font-mono focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                aria-required=\"true\"\n              />\n            </div>\n          )}\n\n          {/* Value (JSON) */}\n          <div>\n            <label\n              htmlFor=\"value\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Value (JSON)\n              {!jsonValid && (\n                <span className=\"ml-2 text-xs text-red-400\">Invalid JSON</span>\n              )}\n            </label>\n            <textarea\n              ref={\n                !showUserIdField && !showFlagNameField\n                  ? firstFocusRef\n                  : undefined\n              }\n              id=\"value\"\n              value={formValue}\n              onChange={(e) => onValueChange(e.target.value)}\n              placeholder='true, 123, \"string\", or {\"complex\": \"value\"}'\n              rows={3}\n              className={`w-full px-3 py-2 text-sm bg-slate-800 border rounded text-slate-200 placeholder-slate-500 font-mono resize-none focus:outline-none focus:ring-2 ${\n                jsonValid\n                  ? \"border-slate-600 focus:ring-blue-500\"\n                  : \"border-red-500 focus:ring-red-500\"\n              }`}\n            />\n          </div>\n\n          {/* Enabled */}\n          <div className=\"flex items-center gap-2\">\n            <input\n              id=\"enabled\"\n              type=\"checkbox\"\n              checked={formEnabled}\n              onChange={(e) => onEnabledChange(e.target.checked)}\n              className=\"w-4 h-4 rounded border-slate-600 bg-slate-800 text-blue-600 focus:ring-blue-500 focus:ring-offset-slate-900\"\n            />\n            <label htmlFor=\"enabled\" className=\"text-sm text-slate-300\">\n              Override Enabled\n            </label>\n          </div>\n\n          {/* Reason */}\n          <div>\n            <label\n              htmlFor=\"reason\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Reason (optional)\n            </label>\n            <input\n              id=\"reason\"\n              type=\"text\"\n              value={formReason}\n              onChange={(e) => onReasonChange(e.target.value)}\n              placeholder=\"Beta testing, debugging, support ticket #123\"\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {/* Expiration */}\n          <div>\n            <label\n              htmlFor=\"expires-at\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Expires At (optional)\n            </label>\n            <input\n              id=\"expires-at\"\n              type=\"datetime-local\"\n              value={formExpiresAt}\n              onChange={(e) => onExpiresAtChange(e.target.value)}\n              className=\"w-full px-3 py-2 text-sm bg-slate-800 border border-slate-600 rounded text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n        </div>\n\n        <div className=\"mt-6 flex justify-end gap-3\">\n          <button\n            type=\"button\"\n            onClick={onCancel}\n            disabled={isLoading}\n            className=\"px-4 py-2 text-sm font-medium text-slate-300 hover:text-slate-100 bg-slate-800 hover:bg-slate-700 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-slate-500\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={onSubmit}\n            disabled={\n              isLoading ||\n              !jsonValid ||\n              (!isEdit && (!formUserId || !formFlagName))\n            }\n            className=\"px-4 py-2 text-sm font-medium bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-white rounded transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          >\n            {isLoading ? \"Saving...\" : isEdit ? \"Update\" : \"Create\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default UserOverridesPanel;\n"
}
