{
  "path": "apps/web-app/src/components/voice/DuplexIndicator.tsx",
  "language": "typescript",
  "size": 8686,
  "last_modified": "2025-12-03T23:50:35.644Z",
  "lines": 339,
  "content": "/**\n * Duplex Indicator Component\n *\n * Visual indicator for full duplex voice state.\n * Shows when both user and AI are speaking simultaneously.\n *\n * Phase 6: Full Duplex Experience\n */\n\nimport React, { useEffect, useState } from \"react\";\nimport type { DuplexState, ActiveStream } from \"../../lib/fullDuplex/types\";\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface DuplexIndicatorProps {\n  /** Current duplex state */\n  state: DuplexState;\n\n  /** Show detailed info */\n  showDetails?: boolean;\n\n  /** Size variant */\n  size?: \"sm\" | \"md\" | \"lg\";\n\n  /** Custom class name */\n  className?: string;\n\n  /** Optional click handler */\n  onClick?: () => void;\n}\n\n// ============================================================================\n// Styles\n// ============================================================================\n\nconst getContainerStyles = (\n  size: \"sm\" | \"md\" | \"lg\",\n  activeStream: ActiveStream,\n): React.CSSProperties => {\n  const sizeMap = {\n    sm: { width: \"24px\", height: \"24px\" },\n    md: { width: \"32px\", height: \"32px\" },\n    lg: { width: \"48px\", height: \"48px\" },\n  };\n\n  const colorMap: Record<ActiveStream, string> = {\n    none: \"#6b7280\", // gray-500\n    user: \"#3b82f6\", // blue-500\n    ai: \"#10b981\", // emerald-500\n    both: \"#f59e0b\", // amber-500\n  };\n\n  return {\n    ...sizeMap[size],\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderRadius: \"50%\",\n    backgroundColor: colorMap[activeStream] + \"20\",\n    border: `2px solid ${colorMap[activeStream]}`,\n    transition: \"all 0.2s ease-in-out\",\n    cursor: \"pointer\",\n  };\n};\n\nconst getPulseStyles = (isActive: boolean): React.CSSProperties => ({\n  width: \"100%\",\n  height: \"100%\",\n  borderRadius: \"50%\",\n  animation: isActive ? \"pulse 1.5s ease-in-out infinite\" : \"none\",\n});\n\n// ============================================================================\n// Component\n// ============================================================================\n\n/**\n * Visual indicator showing full duplex voice state\n */\nexport function DuplexIndicator({\n  state,\n  showDetails = false,\n  size = \"md\",\n  className = \"\",\n  onClick,\n}: DuplexIndicatorProps): JSX.Element {\n  const [_pulseIntensity, setPulseIntensity] = useState(0);\n\n  // Animate pulse based on overlap duration\n  useEffect(() => {\n    if (state.isOverlap) {\n      const intensity = Math.min(1, state.overlapDuration / 500);\n      setPulseIntensity(intensity);\n    } else {\n      setPulseIntensity(0);\n    }\n  }, [state.isOverlap, state.overlapDuration]);\n\n  const getStatusLabel = (): string => {\n    if (state.toolCallInProgress) {\n      return \"Processing...\";\n    }\n    switch (state.activeStream) {\n      case \"both\":\n        return \"Overlap\";\n      case \"user\":\n        return \"Listening\";\n      case \"ai\":\n        return \"Speaking\";\n      default:\n        return \"Ready\";\n    }\n  };\n\n  const getIcon = (): JSX.Element => {\n    const iconSize = size === \"sm\" ? 12 : size === \"md\" ? 16 : 24;\n\n    if (state.activeStream === \"both\") {\n      // Overlap icon - two overlapping circles\n      return (\n        <svg\n          width={iconSize}\n          height={iconSize}\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n        >\n          <circle cx=\"9\" cy=\"12\" r=\"6\" opacity=\"0.7\" />\n          <circle cx=\"15\" cy=\"12\" r=\"6\" opacity=\"0.7\" />\n        </svg>\n      );\n    }\n\n    if (state.activeStream === \"user\") {\n      // Microphone icon\n      return (\n        <svg\n          width={iconSize}\n          height={iconSize}\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n        >\n          <path d=\"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z\" />\n          <path d=\"M19 10v2a7 7 0 0 1-14 0v-2\" />\n          <line x1=\"12\" y1=\"19\" x2=\"12\" y2=\"23\" />\n          <line x1=\"8\" y1=\"23\" x2=\"16\" y2=\"23\" />\n        </svg>\n      );\n    }\n\n    if (state.activeStream === \"ai\") {\n      // Speaker icon\n      return (\n        <svg\n          width={iconSize}\n          height={iconSize}\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n        >\n          <polygon points=\"11 5 6 9 2 9 2 15 6 15 11 19 11 5\" />\n          <path d=\"M15.54 8.46a5 5 0 0 1 0 7.07\" />\n          <path d=\"M19.07 4.93a10 10 0 0 1 0 14.14\" />\n        </svg>\n      );\n    }\n\n    // Ready/idle icon\n    return (\n      <svg\n        width={iconSize}\n        height={iconSize}\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n      >\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      </svg>\n    );\n  };\n\n  return (\n    <div\n      className={`duplex-indicator ${className}`}\n      style={{\n        display: \"inline-flex\",\n        flexDirection: \"column\",\n        alignItems: \"center\",\n        gap: \"4px\",\n      }}\n    >\n      {/* Keyframes for pulse animation */}\n      <style>\n        {`\n          @keyframes pulse {\n            0%, 100% { transform: scale(1); opacity: 1; }\n            50% { transform: scale(1.1); opacity: 0.8; }\n          }\n          @keyframes overlap-pulse {\n            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }\n            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }\n          }\n        `}\n      </style>\n\n      {/* Main indicator */}\n      <div\n        style={{\n          ...getContainerStyles(size, state.activeStream),\n          animation: state.isOverlap\n            ? \"overlap-pulse 1s ease-in-out infinite\"\n            : undefined,\n        }}\n        onClick={onClick}\n        role=\"button\"\n        tabIndex={0}\n        aria-label={getStatusLabel()}\n      >\n        <div\n          style={{\n            ...getPulseStyles(state.userSpeaking || state.aiSpeaking),\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            color:\n              state.activeStream === \"none\"\n                ? \"#6b7280\"\n                : state.activeStream === \"user\"\n                  ? \"#3b82f6\"\n                  : state.activeStream === \"ai\"\n                    ? \"#10b981\"\n                    : \"#f59e0b\",\n          }}\n        >\n          {getIcon()}\n        </div>\n      </div>\n\n      {/* Details panel */}\n      {showDetails && (\n        <div\n          style={{\n            fontSize: size === \"sm\" ? \"10px\" : \"12px\",\n            color: \"#6b7280\",\n            textAlign: \"center\",\n          }}\n        >\n          <div style={{ fontWeight: 500 }}>{getStatusLabel()}</div>\n          {state.isOverlap && (\n            <div style={{ fontSize: \"10px\", color: \"#f59e0b\" }}>\n              {state.overlapDuration}ms\n            </div>\n          )}\n          {state.toolCallInProgress && (\n            <div style={{ fontSize: \"10px\", color: \"#8b5cf6\" }}>\n              Tool active\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Compact Variant\n// ============================================================================\n\n/**\n * Compact inline indicator for status bars\n */\nexport function DuplexIndicatorCompact({\n  state,\n  className = \"\",\n}: {\n  state: DuplexState;\n  className?: string;\n}): JSX.Element {\n  const getColor = (): string => {\n    switch (state.activeStream) {\n      case \"both\":\n        return \"#f59e0b\";\n      case \"user\":\n        return \"#3b82f6\";\n      case \"ai\":\n        return \"#10b981\";\n      default:\n        return \"#6b7280\";\n    }\n  };\n\n  return (\n    <div\n      className={`duplex-indicator-compact ${className}`}\n      style={{\n        display: \"inline-flex\",\n        alignItems: \"center\",\n        gap: \"4px\",\n        fontSize: \"12px\",\n        color: getColor(),\n      }}\n    >\n      <div\n        style={{\n          width: \"8px\",\n          height: \"8px\",\n          borderRadius: \"50%\",\n          backgroundColor: getColor(),\n          animation: state.isOverlap\n            ? \"pulse 1s ease-in-out infinite\"\n            : undefined,\n        }}\n      />\n      <span style={{ fontWeight: 500 }}>\n        {state.isOverlap\n          ? \"Overlap\"\n          : state.activeStream === \"user\"\n            ? \"Listening\"\n            : state.activeStream === \"ai\"\n              ? \"Speaking\"\n              : \"Ready\"}\n      </span>\n    </div>\n  );\n}\n\n// ============================================================================\n// Export\n// ============================================================================\n\nexport default DuplexIndicator;\n"
}
