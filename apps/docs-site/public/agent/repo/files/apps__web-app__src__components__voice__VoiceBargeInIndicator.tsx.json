{
  "path": "apps/web-app/src/components/voice/VoiceBargeInIndicator.tsx",
  "language": "typescript",
  "size": 5623,
  "last_modified": "2025-11-29T01:25:29.829Z",
  "lines": 185,
  "content": "/**\n * VoiceBargeInIndicator\n * Visual indicator shown when user interrupts AI speech (barge-in)\n *\n * Features:\n * - Animated appearance on barge-in\n * - Shows interrupted content preview\n * - Auto-dismiss after timeout\n * - Can be manually dismissed\n */\n\nimport { useEffect, useState } from \"react\";\n\nexport interface BargeInEvent {\n  /** Unique identifier for the barge-in event */\n  id: string;\n  /** Timestamp when barge-in occurred */\n  timestamp: number;\n  /** Content that was interrupted (if available) */\n  interruptedContent?: string;\n  /** How much of the response was completed (0-100) */\n  completionPercentage?: number;\n}\n\nexport interface VoiceBargeInIndicatorProps {\n  /** Current barge-in event to display */\n  event: BargeInEvent | null;\n  /** Called when indicator is dismissed */\n  onDismiss?: () => void;\n  /** Auto-dismiss after this many milliseconds (default: 3000) */\n  autoDismissMs?: number;\n  /** Maximum characters to show in interrupted content preview */\n  maxPreviewLength?: number;\n}\n\nexport function VoiceBargeInIndicator({\n  event,\n  onDismiss,\n  autoDismissMs = 3000,\n  maxPreviewLength = 100,\n}: VoiceBargeInIndicatorProps) {\n  const [isVisible, setIsVisible] = useState(false);\n  const [isAnimatingOut, setIsAnimatingOut] = useState(false);\n\n  useEffect(() => {\n    if (event) {\n      // Reset animation state and show\n      setIsAnimatingOut(false);\n      setIsVisible(true);\n\n      // Auto-dismiss after timeout\n      const dismissTimer = setTimeout(() => {\n        handleDismiss();\n      }, autoDismissMs);\n\n      return () => {\n        clearTimeout(dismissTimer);\n      };\n    } else {\n      setIsVisible(false);\n    }\n  }, [event, autoDismissMs]);\n\n  const handleDismiss = () => {\n    setIsAnimatingOut(true);\n    // Wait for animation to complete before fully hiding\n    setTimeout(() => {\n      setIsVisible(false);\n      setIsAnimatingOut(false);\n      onDismiss?.();\n    }, 200);\n  };\n\n  if (!event || !isVisible) {\n    return null;\n  }\n\n  // Truncate interrupted content if too long\n  const truncatedContent =\n    event.interruptedContent &&\n    event.interruptedContent.length > maxPreviewLength\n      ? event.interruptedContent.substring(0, maxPreviewLength) + \"...\"\n      : event.interruptedContent;\n\n  return (\n    <div\n      className={`\n        fixed bottom-24 left-1/2 -translate-x-1/2 z-50\n        bg-amber-50 border-2 border-amber-400 rounded-lg shadow-lg\n        px-4 py-3 max-w-md w-[calc(100%-2rem)]\n        transition-all duration-200\n        ${isAnimatingOut ? \"opacity-0 translate-y-2\" : \"opacity-100 translate-y-0\"}\n      `}\n      role=\"status\"\n      aria-live=\"polite\"\n      data-testid=\"voice-barge-in-indicator\"\n    >\n      <div className=\"flex items-start gap-3\">\n        {/* Barge-in icon */}\n        <div className=\"flex-shrink-0\">\n          <div className=\"w-8 h-8 rounded-full bg-amber-200 flex items-center justify-center\">\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n              className=\"w-5 h-5 text-amber-700\"\n              aria-hidden=\"true\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M5.25 7.5A2.25 2.25 0 017.5 5.25h9a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-9a2.25 2.25 0 01-2.25-2.25v-9z\"\n              />\n            </svg>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <p className=\"text-sm font-medium text-amber-900\">\n            Response interrupted\n          </p>\n\n          {truncatedContent && (\n            <p\n              className=\"mt-1 text-xs text-amber-700 line-clamp-2\"\n              data-testid=\"interrupted-content-preview\"\n            >\n              \"{truncatedContent}\"\n            </p>\n          )}\n\n          {event.completionPercentage !== undefined && (\n            <div className=\"mt-2 flex items-center gap-2\">\n              <div className=\"flex-1 h-1.5 bg-amber-200 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-amber-500 rounded-full transition-all duration-300\"\n                  style={{ width: `${event.completionPercentage}%` }}\n                  role=\"progressbar\"\n                  aria-valuenow={event.completionPercentage}\n                  aria-valuemin={0}\n                  aria-valuemax={100}\n                  aria-label=\"Response completion before interruption\"\n                  data-testid=\"completion-progress\"\n                />\n              </div>\n              <span className=\"text-xs text-amber-600 font-medium whitespace-nowrap\">\n                {Math.round(event.completionPercentage)}% complete\n              </span>\n            </div>\n          )}\n        </div>\n\n        {/* Dismiss button */}\n        <button\n          type=\"button\"\n          onClick={handleDismiss}\n          className=\"flex-shrink-0 text-amber-500 hover:text-amber-700 transition-colors\"\n          aria-label=\"Dismiss notification\"\n          data-testid=\"barge-in-dismiss\"\n        >\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={2}\n            stroke=\"currentColor\"\n            className=\"w-5 h-5\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M6 18L18 6M6 6l12 12\"\n            />\n          </svg>\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport default VoiceBargeInIndicator;\n"
}
