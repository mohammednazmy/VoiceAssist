{
  "path": "apps/admin-panel/src/components/users/EditUserDialog.tsx",
  "language": "typescript",
  "size": 8166,
  "last_modified": "2025-11-29T09:47:36.107Z",
  "lines": 260,
  "content": "/**\n * EditUserDialog Component\n *\n * Modal dialog for editing user details:\n * - Full name\n * - Role (user/viewer/admin via RoleSelector)\n * - Active status\n * - Optional reason for changes\n */\n\nimport { useState, useEffect, FormEvent } from \"react\";\nimport { useEditUser, UserUpdatePayload } from \"../../hooks/useEditUser\";\nimport { RoleSelector } from \"./RoleSelector\";\n\ninterface EditUserDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  user: {\n    id: string;\n    email: string;\n    full_name?: string;\n    is_admin: boolean;\n    admin_role: \"user\" | \"admin\" | \"viewer\";\n    is_active: boolean;\n  } | null;\n}\n\nexport function EditUserDialog({\n  isOpen,\n  onClose,\n  onSuccess,\n  user,\n}: EditUserDialogProps) {\n  const { updateUser, isLoading, error, clearError } = useEditUser();\n\n  // Form state\n  const [fullName, setFullName] = useState(\"\");\n  const [role, setRole] = useState<\"user\" | \"admin\" | \"viewer\">(\"user\");\n  const [isActive, setIsActive] = useState(true);\n  const [reason, setReason] = useState(\"\");\n  const [formError, setFormError] = useState<string | null>(null);\n  const [successMessage, setSuccessMessage] = useState<string | null>(null);\n\n  // Reset form when dialog opens or user changes\n  useEffect(() => {\n    if (isOpen && user) {\n      setFullName(user.full_name || \"\");\n      setRole(user.admin_role || (user.is_admin ? \"admin\" : \"user\"));\n      setIsActive(user.is_active);\n      setReason(\"\");\n      setFormError(null);\n      setSuccessMessage(null);\n      clearError();\n    }\n  }, [isOpen, user, clearError]);\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n\n    setFormError(null);\n    setSuccessMessage(null);\n\n    // Build update payload (only include changed fields)\n    const updates: UserUpdatePayload = {};\n\n    if (fullName !== (user.full_name || \"\")) {\n      updates.full_name = fullName;\n    }\n\n    if (role !== user.admin_role) {\n      updates.admin_role = role;\n    }\n\n    if (isActive !== user.is_active) {\n      updates.is_active = isActive;\n    }\n\n    if (Object.keys(updates).length === 0) {\n      setFormError(\"No changes to save\");\n      return;\n    }\n\n    if (reason.trim()) {\n      updates.action_reason = reason.trim();\n    }\n\n    try {\n      await updateUser(user.id, updates);\n      setSuccessMessage(\"User updated successfully\");\n      setTimeout(() => {\n        onSuccess();\n        onClose();\n      }, 1000);\n    } catch {\n      // Error is handled by the hook\n    }\n  };\n\n  const handleClose = () => {\n    if (!isLoading) {\n      onClose();\n    }\n  };\n\n  if (!isOpen || !user) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n      {/* Backdrop */}\n      <div className=\"absolute inset-0 bg-black/60\" onClick={handleClose} />\n\n      {/* Dialog */}\n      <div className=\"relative bg-slate-900 border border-slate-700 rounded-lg shadow-xl w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-6 py-4 border-b border-slate-700\">\n          <h2 className=\"text-lg font-semibold text-slate-100\">Edit User</h2>\n          <button\n            onClick={handleClose}\n            disabled={isLoading}\n            className=\"text-slate-400 hover:text-slate-200 disabled:opacity-50\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        {/* Form */}\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-5\">\n          {/* Email (read-only) */}\n          <div>\n            <label className=\"block text-sm font-medium text-slate-300 mb-1\">\n              Email\n            </label>\n            <div className=\"px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-md text-slate-400\">\n              {user.email}\n            </div>\n          </div>\n\n          {/* Full Name */}\n          <div>\n            <label\n              htmlFor=\"fullName\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Full Name\n            </label>\n            <input\n              id=\"fullName\"\n              type=\"text\"\n              value={fullName}\n              onChange={(e) => setFullName(e.target.value)}\n              disabled={isLoading}\n              className=\"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-md text-slate-100\n                focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent\n                disabled:opacity-50 disabled:cursor-not-allowed\"\n              placeholder=\"Enter full name\"\n            />\n          </div>\n\n          {/* Role */}\n          <div>\n            <label className=\"block text-sm font-medium text-slate-300 mb-2\">\n              Role\n            </label>\n            <RoleSelector\n              value={role}\n              onChange={setRole}\n              disabled={isLoading}\n            />\n          </div>\n\n          {/* Active Status */}\n          <div>\n            <label className=\"flex items-center gap-3 cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={isActive}\n                onChange={(e) => setIsActive(e.target.checked)}\n                disabled={isLoading}\n                className=\"h-4 w-4 text-indigo-500 border-slate-600 bg-slate-800 rounded\n                  focus:ring-indigo-500 focus:ring-offset-0\"\n              />\n              <span className=\"text-sm text-slate-300\">Account is active</span>\n            </label>\n            {!isActive && (\n              <p className=\"mt-1 text-xs text-amber-400\">\n                Deactivated users cannot log in\n              </p>\n            )}\n          </div>\n\n          {/* Reason (optional) */}\n          <div>\n            <label\n              htmlFor=\"reason\"\n              className=\"block text-sm font-medium text-slate-300 mb-1\"\n            >\n              Reason for changes{\" \"}\n              <span className=\"text-slate-500 font-normal\">(optional)</span>\n            </label>\n            <textarea\n              id=\"reason\"\n              value={reason}\n              onChange={(e) => setReason(e.target.value)}\n              disabled={isLoading}\n              rows={2}\n              className=\"w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-md text-slate-100\n                focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent\n                disabled:opacity-50 disabled:cursor-not-allowed resize-none\"\n              placeholder=\"e.g., Promoted to admin, Updated profile info...\"\n            />\n          </div>\n\n          {/* Error message */}\n          {(error || formError) && (\n            <div className=\"p-3 bg-red-950/50 border border-red-900 rounded-md text-red-400 text-sm\">\n              {error || formError}\n            </div>\n          )}\n\n          {/* Success message */}\n          {successMessage && (\n            <div className=\"p-3 bg-green-950/50 border border-green-900 rounded-md text-green-400 text-sm\">\n              {successMessage}\n            </div>\n          )}\n\n          {/* Actions */}\n          <div className=\"flex items-center justify-end gap-3 pt-2\">\n            <button\n              type=\"button\"\n              onClick={handleClose}\n              disabled={isLoading}\n              className=\"px-4 py-2 text-sm text-slate-300 hover:text-slate-100 transition-colors\n                disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={isLoading}\n              className=\"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium\n                rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed\n                flex items-center gap-2\"\n            >\n              {isLoading && (\n                <span className=\"inline-block w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n              )}\n              {isLoading ? \"Saving...\" : \"Save Changes\"}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nexport default EditUserDialog;\n"
}
