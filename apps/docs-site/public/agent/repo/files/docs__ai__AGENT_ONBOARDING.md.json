{
  "path": "docs/ai/AGENT_ONBOARDING.md",
  "language": "markdown",
  "size": 22474,
  "last_modified": "2025-12-05T02:34:43.275Z",
  "lines": 696,
  "content": "---\ntitle: AI Agent Onboarding Guide\nslug: ai/agent-onboarding\nsummary: >-\n  Quick context, repository structure, critical rules, and common tasks for AI\n  coding assistants.\nstatus: stable\nstability: production\nowner: docs\nlastUpdated: \"2025-12-04\"\naudience:\n  - ai-agents\ntags:\n  - onboarding\n  - ai-agent\n  - getting-started\n  - workflows\nrelatedServices:\n  - api-gateway\n  - web-app\n  - admin-panel\n  - docs-site\ncategory: ai\nversion: 1.4.0\nai_summary: >-\n  Start here for AI agents working on VoiceAssist. Key directories:\n  services/api-gateway/ (canonical backend, FastAPI), apps/ (web-app, admin-panel,\n  docs-site). NEVER use server/ (deprecated). Machine-readable endpoints at\n  https://assistdocs.asimo.io/agent/*.json. Read IMPLEMENTATION_STATUS.md first\n  for component status. HIPAA-compliant platform - follow PHI handling rules.\n---\n\n# AI Agent Onboarding Guide\n\n**Version:** 1.3.0\n**Last Updated:** 2025-12-02\n**Audience:** AI coding assistants (Claude, GPT, Copilot, etc.)\n\n---\n\n## TL;DR for AI Agents\n\n**Start here.** This section provides the fastest path to context.\n\n### Essential Documents (Read These First)\n\n| Document                                                      | Purpose                       |\n| ------------------------------------------------------------- | ----------------------------- |\n| [Implementation Status](../overview/IMPLEMENTATION_STATUS.md) | What's built vs. planned      |\n| [Service Catalog](../SERVICE_CATALOG.md)                      | All services and their status |\n| [Unified Architecture](../UNIFIED_ARCHITECTURE.md)            | System design overview        |\n| [Debugging Index](../debugging/DEBUGGING_INDEX.md)            | Troubleshooting hub           |\n\n### Machine-Readable Endpoints\n\n| Endpoint                 | Purpose                                          |\n| ------------------------ | ------------------------------------------------ |\n| `GET /agent/index.json`  | Documentation system metadata & discovery        |\n| `GET /agent/docs.json`   | All documents with metadata (filter client-side) |\n| `GET /agent/tasks.json`  | Common agent tasks with commands and docs        |\n| `GET /agent/schema.json` | JSON Schema for API response types               |\n| `GET /search-index.json` | Full-text search index (Fuse.js format)          |\n| `GET /sitemap.xml`       | XML sitemap for crawlers                         |\n\n**Base URL:** `https://assistdocs.asimo.io`\n\n### Safety & Norms\n\n| Document                                                  | Purpose                         |\n| --------------------------------------------------------- | ------------------------------- |\n| [CLAUDE_EXECUTION_GUIDE.md](../CLAUDE_EXECUTION_GUIDE.md) | Claude-specific guidelines      |\n| [CLAUDE_PROMPTS.md](../CLAUDE_PROMPTS.md)                 | Standard prompt templates       |\n| [Security Compliance](../SECURITY_COMPLIANCE.md)          | HIPAA and security requirements |\n\n### Canonical Backend Location\n\n**ALWAYS use:** `services/api-gateway/` (FastAPI, production-ready)\n\n**NEVER use:** `server/` (deprecated stub)\n\n---\n\n## Quick Context\n\nVoiceAssist is an enterprise-grade, HIPAA-compliant medical AI assistant platform. This document helps AI agents quickly understand the codebase and work effectively.\n\n### Project Status\n\n> **Full Status:** See [Implementation Status](../overview/IMPLEMENTATION_STATUS.md) for detailed component status.\n\n| Component             | Status           | Location                    |\n| --------------------- | ---------------- | --------------------------- |\n| Backend (API Gateway) | Production Ready | `services/api-gateway/`     |\n| Infrastructure        | Production Ready | `infrastructure/`, `ha-dr/` |\n| Admin Panel           | Production Ready | `apps/admin-panel/`         |\n| Docs Site             | Production Ready | `apps/docs-site/`           |\n| Web App               | Production Ready | `apps/web-app/`             |\n| Legacy Server         | Deprecated       | `server/` (DO NOT USE)      |\n\n### Key Facts\n\n- **Backend Framework:** FastAPI (Python 3.11+)\n- **Frontend Framework:** React 18+ with TypeScript, Vite\n- **Package Manager:** pnpm (monorepo with Turborepo)\n- **Database:** PostgreSQL with pgvector extension\n- **Cache:** Redis\n- **Vector Store:** Qdrant\n- **LLM Provider:** OpenAI (GPT-4, embeddings)\n- **Authentication:** JWT with access/refresh tokens\n- **Compliance:** HIPAA-compliant (42/42 requirements met)\n\n---\n\n## Repository Structure\n\n```\nVoiceAssist/\n├── services/\n│   └── api-gateway/          # CANONICAL BACKEND (FastAPI)\n│       ├── app/\n│       │   ├── api/          # 20+ API modules\n│       │   ├── core/         # Config, security, logging\n│       │   ├── models/       # SQLAlchemy ORM models\n│       │   ├── schemas/      # Pydantic schemas\n│       │   └── services/     # Business logic (40+ services)\n│       └── alembic/          # Database migrations\n│\n├── apps/                     # Frontend Applications (Monorepo)\n│   ├── web-app/             # Main user-facing app\n│   ├── admin-panel/         # Admin dashboard\n│   └── docs-site/           # Documentation site (Next.js 14)\n│\n├── packages/                 # Shared Packages\n│   ├── api-client/          # Type-safe HTTP client\n│   ├── config/              # Shared configurations\n│   ├── design-tokens/       # Medical-themed design system\n│   ├── telemetry/           # Observability utilities\n│   ├── types/               # TypeScript type definitions\n│   ├── ui/                  # React component library\n│   └── utils/               # Utility functions (PHI detection)\n│\n├── infrastructure/          # IaC (Terraform, Ansible)\n├── ha-dr/                   # High Availability & DR configs\n├── tests/                   # Backend test suite\n├── docs/                    # Documentation\n│\n├── server/                  # DEPRECATED - DO NOT USE\n│\n├── docker-compose.yml       # Development stack\n├── pnpm-workspace.yaml      # pnpm workspace config\n└── turbo.json               # Turborepo config\n```\n\n---\n\n## Critical Rules\n\n### 1. Use the Correct Backend\n\n**ALWAYS use `services/api-gateway/`** - This is the production backend.\n\n**NEVER use `server/`** - This is a deprecated stub kept for reference only.\n\n### 2. API Endpoint Patterns\n\n```\n/api/auth/*          - Authentication\n/api/users/*         - User management\n/conversations/*     - Chat/sessions\n/api/admin/*         - Admin operations\n/health, /ready      - Health checks\n/metrics             - Prometheus metrics\n/ws                  - WebSocket endpoint\n```\n\n### 3. Security Requirements\n\n- All PHI (Protected Health Information) must be encrypted at rest and in transit\n- Use audit logging for any PHI access via `app/services/audit_service.py`\n- Never log sensitive data in plain text\n- All API endpoints handling PHI need `@requires_audit` decorator\n\n### 4. Code Style\n\n**Backend (Python):**\n\n- PEP 8 compliant\n- Type hints required for all functions\n- Docstrings for public APIs\n- Use async/await for I/O operations\n\n**Frontend (TypeScript):**\n\n- Strict TypeScript mode enabled\n- ESLint + Prettier enforced\n- React functional components with hooks\n\n---\n\n## Common Tasks\n\n### Adding a New API Endpoint\n\n1. Create handler in `services/api-gateway/app/api/<module>.py`\n2. Add Pydantic schemas in `app/schemas/<module>.py`\n3. Register routes in `app/main.py`\n4. Write tests in `tests/`\n\nExample structure:\n\n```python\n# app/api/example.py\nfrom fastapi import APIRouter, Depends\nfrom app.core.dependencies import get_current_user\nfrom app.schemas.example import ExampleRequest, ExampleResponse\n\nrouter = APIRouter(prefix=\"/api/example\", tags=[\"example\"])\n\n@router.post(\"/\", response_model=ExampleResponse)\nasync def create_example(\n    request: ExampleRequest,\n    user = Depends(get_current_user)\n):\n    \"\"\"Create a new example.\"\"\"\n    pass\n```\n\n### Adding a New Frontend Component\n\n1. Create component in `packages/ui/src/components/`\n2. Export from `packages/ui/src/index.ts`\n3. Add Storybook story in `packages/ui/src/stories/`\n4. Use in apps via `@voiceassist/ui`\n\n### Running Tests\n\n```bash\n# Backend tests\npytest                      # All tests\npytest -m unit             # Unit only\npytest -m e2e              # E2E only\npytest --cov=app           # With coverage\n\n# Frontend tests\npnpm test                  # All packages\npnpm --filter web-app test # Specific app\n```\n\n### Database Migrations\n\n```bash\ncd services/api-gateway\n\n# Create migration\nalembic revision --autogenerate -m \"description\"\n\n# Apply migrations\nalembic upgrade head\n\n# Rollback\nalembic downgrade -1\n```\n\n---\n\n## Common Tasks for AI Agents\n\nThis section provides task-specific guidance for common development scenarios.\n\n### Task: Add a New REST Endpoint to the API Gateway\n\n**Docs to read first:**\n\n- [API_REFERENCE.md](../API_REFERENCE.md) - Endpoint patterns and conventions\n- [api-reference/rest-api.md](../api-reference/rest-api.md) - Detailed endpoint specs\n- [BACKEND_ARCHITECTURE.md](../BACKEND_ARCHITECTURE.md) - Service layer design\n\n**Directories to inspect:**\n\n- `services/api-gateway/app/api/` - Existing API modules\n- `services/api-gateway/app/schemas/` - Pydantic request/response schemas\n- `services/api-gateway/app/services/` - Business logic services\n\n**Steps:**\n\n1. Create handler in `app/api/<module>.py`\n2. Add schemas in `app/schemas/<module>.py`\n3. Register router in `app/main.py`\n4. Add tests in `tests/test_<module>.py`\n\n**Verify:**\n\n```bash\ncd services/api-gateway\npytest tests/test_<module>.py -v\ncurl http://localhost:8000/<endpoint>\n```\n\n### Task: Debug a Failing Medical Query (RAG Issues)\n\n**Docs to read first:**\n\n- [SEMANTIC_SEARCH_DESIGN.md](../SEMANTIC_SEARCH_DESIGN.md) - RAG architecture\n- [debugging/DEBUGGING_BACKEND.md](../debugging/DEBUGGING_BACKEND.md) - Backend debugging\n\n**Key files:**\n\n- `app/services/rag_service.py` - RAG pipeline logic\n- `app/services/llm_client.py` - OpenAI integration\n- `app/services/cache_service.py` - Cache layer\n\n**Diagnostic commands:**\n\n```bash\n# Check RAG service logs\njournalctl -u voiceassist-api -f | grep -i rag\n\n# Test embedding generation\ncurl -X POST http://localhost:8000/api/search/test \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"test medical query\"}'\n\n# Check Qdrant health\ncurl http://localhost:6333/collections\n```\n\n### Task: Debug Voice / WebSocket Issues\n\n**Docs to read first:**\n\n- [debugging/DEBUGGING_VOICE_REALTIME.md](../debugging/DEBUGGING_VOICE_REALTIME.md) - Voice debugging\n- [REALTIME_ARCHITECTURE.md](../REALTIME_ARCHITECTURE.md) - WebSocket design\n- [VOICE_MODE_PIPELINE.md](../VOICE_MODE_PIPELINE.md) - Voice pipeline\n\n**Key files:**\n\n- `apps/web-app/src/hooks/useThinkerTalkerSession.ts` - Primary voice WebSocket client\n- `apps/web-app/src/hooks/useRealtimeVoiceSession.ts` - Legacy Realtime API client\n- `app/api/thinker_talker_websocket_handler.py` - T/T WebSocket server\n- `app/api/realtime.py` - Legacy WebSocket endpoint\n\n**Diagnostic commands:**\n\n```bash\n# Check WebSocket endpoint\ncurl -i -N -H \"Connection: Upgrade\" \\\n  -H \"Upgrade: websocket\" \\\n  http://localhost:8000/ws\n\n# Check browser console for WebSocket errors\n# Look for: \"WebSocket connection failed\" or \"error_no_match\"\n```\n\n### Task: Fix a Broken Docs Page or Missing Document\n\n**Docs to read first:**\n\n- [debugging/DEBUGGING_DOCS_SITE.md](../debugging/DEBUGGING_DOCS_SITE.md) - Docs site debugging\n- [INTERNAL_DOCS_SYSTEM.md](../INTERNAL_DOCS_SYSTEM.md) - Docs system internals\n\n**Key files:**\n\n- `apps/docs-site/src/lib/navigation.ts` - Navigation config\n- `apps/docs-site/src/lib/docs.ts` - Document loading\n- `apps/docs-site/src/components/DocPage.tsx` - Page rendering\n\n**Steps to fix a 404:**\n\n1. Check if doc exists in `docs/` with correct path\n2. Verify route in `navigation.ts` matches expected URL\n3. Ensure doc has valid frontmatter if metadata is required\n4. Rebuild and redeploy:\n\n```bash\ncd apps/docs-site\npnpm build\nsudo cp -r out/* /var/www/assistdocs.asimo.io/\n```\n\n### Task: Update Agent JSON or Search Index\n\n**Key files:**\n\n- `apps/docs-site/scripts/generate-agent-json.js` - Agent JSON generator\n- `apps/docs-site/scripts/generate-search-index.js` - Search index generator\n\n**Commands:**\n\n```bash\ncd apps/docs-site\n\n# Regenerate agent JSON\npnpm run generate-agent-json\n\n# Regenerate search index\npnpm run generate-search-index\n\n# Full rebuild\npnpm build\n```\n\n**Verify:**\n\n```bash\ncurl https://assistdocs.asimo.io/agent/docs.json | jq '.count'\ncurl https://assistdocs.asimo.io/search-index.json | jq '.docs | length'\n```\n\n---\n\n## Key Files Reference\n\n### Backend Entry Points\n\n| File                                        | Purpose                    |\n| ------------------------------------------- | -------------------------- |\n| `services/api-gateway/app/main.py`          | FastAPI app initialization |\n| `services/api-gateway/app/core/config.py`   | Configuration management   |\n| `services/api-gateway/app/core/security.py` | JWT/auth utilities         |\n| `services/api-gateway/app/core/database.py` | Database connection        |\n\n### Important Services\n\n| File                            | Purpose             |\n| ------------------------------- | ------------------- |\n| `app/services/rag_service.py`   | RAG/retrieval logic |\n| `app/services/llm_client.py`    | OpenAI integration  |\n| `app/services/cache_service.py` | Multi-level caching |\n| `app/services/audit_service.py` | HIPAA audit logging |\n| `app/services/feature_flags.py` | Feature flag system |\n\n### Frontend Entry Points\n\n| File                                | Purpose                   |\n| ----------------------------------- | ------------------------- |\n| `apps/web-app/src/main.tsx`         | Web app entry             |\n| `apps/admin-panel/src/main.tsx`     | Admin panel entry         |\n| `apps/docs-site/src/app/layout.tsx` | Docs site layout          |\n| `packages/ui/src/index.ts`          | Component library exports |\n\n---\n\n## Documentation Map\n\n| Topic                    | Document                         |\n| ------------------------ | -------------------------------- |\n| Architecture Overview    | `docs/UNIFIED_ARCHITECTURE.md`   |\n| Backend Details          | `docs/BACKEND_ARCHITECTURE.md`   |\n| API Reference (concepts) | `docs/API_REFERENCE.md`          |\n| API Reference (detailed) | `docs/api-reference/rest-api.md` |\n| Security & HIPAA         | `docs/SECURITY_COMPLIANCE.md`    |\n| Database Schema          | `docs/DATA_MODEL.md`             |\n| Development Setup        | `docs/DEVELOPMENT_SETUP.md`      |\n| Deployment Guide         | `docs/DEPLOYMENT_GUIDE.md`       |\n| Operations Runbooks      | `docs/operations/runbooks/`      |\n| Agent API Reference      | `docs/ai/AGENT_API_REFERENCE.md` |\n| Docs System Internals    | `docs/INTERNAL_DOCS_SYSTEM.md`   |\n\n---\n\n## Machine-Readable Documentation API\n\nThe docs site exposes JSON endpoints for programmatic access:\n\n| Endpoint                 | Purpose                                 |\n| ------------------------ | --------------------------------------- |\n| `GET /agent/index.json`  | Documentation system metadata           |\n| `GET /agent/docs.json`   | Full document list with metadata        |\n| `GET /agent/tasks.json`  | Common tasks with commands and docs     |\n| `GET /search-index.json` | Full-text search index (Fuse.js format) |\n\n### Interpreting Document Metadata\n\nWhen filtering `/agent/docs.json`, use these fields to find relevant documents:\n\n| Field       | Values                                             | AI Agent Guidance                             |\n| ----------- | -------------------------------------------------- | --------------------------------------------- |\n| `status`    | `stable`, `experimental`, `draft`, `deprecated`    | Prefer `stable` for authoritative information |\n| `stability` | `production`, `beta`, `experimental`, `legacy`     | Prefer `production` for reliable features     |\n| `audience`  | `[\"agent\"]`, `[\"human\"]`, `[\"backend\"]`, etc.      | Filter for `agent` to find AI-optimized docs  |\n| `owner`     | `backend`, `frontend`, `infra`, `docs`, `security` | Use to find domain experts                    |\n| `tags`      | Varies (e.g., `[\"api\", \"debugging\"]`)              | Use for topic-based filtering                 |\n\n### Example Workflows\n\n**Find docs for debugging:**\n\n```javascript\nconst data = await fetch(\"/agent/docs.json\").then((r) => r.json());\nconst debugDocs = data.docs.filter((d) => d.tags?.includes(\"debugging\") && d.status === \"stable\");\n```\n\n**Find task-specific guidance:**\n\n```javascript\nconst tasks = await fetch(\"/agent/tasks.json\").then((r) => r.json());\nconst task = tasks.tasks.find((t) => t.id === \"debug-api-error\");\n// task.docs contains relevant documentation paths\n// task.commands contains diagnostic shell commands\n```\n\n**Full-text search:**\n\n```javascript\nimport Fuse from \"fuse.js\";\nconst index = await fetch(\"/search-index.json\").then((r) => r.json());\nconst fuse = new Fuse(index.docs, {\n  keys: [\"title\", \"summary\", \"content\"],\n  threshold: 0.3,\n});\nconst results = fuse.search(\"authentication error\");\n```\n\nSee [Agent API Reference](./AGENT_API_REFERENCE.md) for full endpoint documentation.\n\n---\n\n## AI-Docs Integration (Semantic Search)\n\nDocumentation is embedded into Qdrant for semantic search, enabling AI assistants to find relevant docs using natural language queries.\n\n### Architecture\n\n| Component   | Location                               | Purpose                          |\n| ----------- | -------------------------------------- | -------------------------------- |\n| Embedder    | `scripts/embed-docs.py`                | Embeds docs into Qdrant          |\n| Search Tool | `server/app/tools/docs_search_tool.py` | LLM tool for semantic doc search |\n| Collection  | `platform_docs` (Qdrant)               | Vector storage for embeddings    |\n\n### Embedding Configuration\n\n| Property            | Value                  |\n| ------------------- | ---------------------- |\n| **Collection**      | `platform_docs`        |\n| **Embedding Model** | text-embedding-3-small |\n| **Dimensions**      | 1536                   |\n| **Distance Metric** | Cosine                 |\n\n### Tool Functions\n\n```python\n# Semantic search across platform documentation\ndocs_search(query: str, category: str = None, max_results: int = 5)\n\n# Retrieve full section content by path\ndocs_get_section(doc_path: str, section: str = None)\n```\n\n### Re-indexing Documentation\n\n```bash\n# Incremental update (skip unchanged)\npython scripts/embed-docs.py\n\n# Force re-index all\npython scripts/embed-docs.py --force\n\n# Preview without indexing\npython scripts/embed-docs.py --dry-run\n```\n\n---\n\n## Environment Setup\n\n### Required Environment Variables\n\n```bash\n# Core\nDATABASE_URL=postgresql://user:pass@localhost:5432/voiceassist\nREDIS_URL=redis://localhost:6379\nOPENAI_API_KEY=sk-...\n\n# Security\nJWT_SECRET_KEY=<random-32-bytes>\nENCRYPTION_KEY=<random-32-bytes>\n\n# Optional\nQDRANT_HOST=localhost\nQDRANT_PORT=6333\nLOG_LEVEL=INFO\n```\n\n### Quick Start\n\n```bash\n# 1. Clone and setup\ngit clone https://github.com/mohammednazmy/VoiceAssist.git\ncd VoiceAssist\ncp .env.example .env\n# Edit .env with your keys\n\n# 2. Start backend (Docker)\ndocker compose up -d\ncurl http://localhost:8000/health\n\n# 3. Start frontend\npnpm install\npnpm dev\n```\n\n---\n\n## Troubleshooting\n\n### Common Issues\n\n**Import Error: Module not found**\n\n- Check you're in correct directory\n- Backend: `services/api-gateway/`\n- Frontend: use package names like `@voiceassist/ui`\n\n**Database Connection Failed**\n\n- Verify `DATABASE_URL` in `.env`\n- Ensure PostgreSQL is running: `docker compose ps`\n\n**Tests Failing**\n\n- Run `alembic upgrade head` for latest schema\n- Check Redis is running for cache tests\n\n### Debugging Guides\n\nFor detailed troubleshooting, see the debugging documentation:\n\n| Guide                                                      | Purpose                               |\n| ---------------------------------------------------------- | ------------------------------------- |\n| [Debugging Overview](../debugging/DEBUGGING_OVERVIEW.md)   | Quick symptom-to-guide reference      |\n| [Backend Debugging](../debugging/DEBUGGING_BACKEND.md)     | API Gateway, database, cache issues   |\n| [Frontend Debugging](../debugging/DEBUGGING_FRONTEND.md)   | React, browser, network issues        |\n| [Voice/Realtime](../debugging/DEBUGGING_VOICE_REALTIME.md) | WebSocket, STT, TTS issues            |\n| [Docs Site](../debugging/DEBUGGING_DOCS_SITE.md)           | Next.js, static export, Apache issues |\n\n### Getting Help\n\n1. Check the [Debugging Overview](../debugging/DEBUGGING_OVERVIEW.md) for common symptoms\n2. Search existing docs in `docs/`\n3. Check test files for usage examples\n\n---\n\n## API Quick Reference\n\n### Authentication Flow\n\n```http\nPOST /api/auth/register    # Create account\nPOST /api/auth/login       # Get tokens\nPOST /api/auth/refresh     # Refresh access token\nPOST /api/auth/logout      # Invalidate tokens\n```\n\n### Conversation Flow\n\n```http\nPOST /conversations/                    # Create session\nGET /conversations/{id}                 # Get session\nPOST /conversations/{id}/messages       # Send message\nGET /conversations/{id}/messages        # Get messages\n```\n\n### Admin Operations\n\n```http\nGET /api/admin/panel/stats             # Dashboard stats\nGET /api/admin/kb/documents            # List KB documents\nPOST /api/admin/kb/documents           # Upload document\nGET /api/admin/feature-flags           # List flags\nPUT /api/admin/feature-flags/{key}     # Update flag\n```\n\n### Health Checks\n\n```http\nGET /health                # Liveness probe\nGET /ready                 # Readiness probe (checks deps)\nGET /metrics               # Prometheus metrics\n```\n\n---\n\n## Version History\n\n| Version | Date       | Changes                                               |\n| ------- | ---------- | ----------------------------------------------------- |\n| 1.3.0   | 2025-12-02 | Added AI-Docs integration section, fixed voice hooks  |\n| 1.2.0   | 2025-11-27 | Added tasks.json endpoint, improved metadata guidance |\n| 1.1.0   | 2025-11-27 | Added common tasks and debugging workflows            |\n| 1.0.0   | 2025-11-27 | Initial release                                       |\n\n---\n\n_For the full documentation index, see [docs/README.md](../README.md)._\n"
}
