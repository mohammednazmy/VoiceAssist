{
  "path": "apps/web-app/src/components/voice/VoiceModeSettings.tsx",
  "language": "typescript",
  "size": 37079,
  "last_modified": "2025-12-04T01:17:12.281Z",
  "lines": 974,
  "content": "/**\n * Voice Mode Settings Modal\n * Allows users to configure voice settings including voice selection,\n * language, VAD sensitivity, and behavior preferences.\n *\n * Phase 9.3: Added audio device, playback speed, keyboard shortcuts\n * Phase 7-10: Added multilingual, calibration, offline, conversation intelligence settings\n */\n\nimport { useCallback, useState, useMemo } from \"react\";\nimport {\n  useVoiceSettingsStore,\n  LANGUAGE_OPTIONS,\n  PLAYBACK_SPEED_OPTIONS,\n  ELEVENLABS_VOICE_OPTIONS,\n  QUALITY_PRESET_OPTIONS,\n  type LanguageOption,\n  type QualityPreset,\n} from \"../../stores/voiceSettingsStore\";\nimport { AudioDeviceSelector } from \"./AudioDeviceSelector\";\nimport { PlaybackSpeedControl } from \"./PlaybackSpeedControl\";\nimport { CalibrationDialog } from \"./CalibrationDialog\";\n\nexport interface VoiceModeSettingsProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function VoiceModeSettings({ isOpen, onClose }: VoiceModeSettingsProps) {\n  // Calibration dialog state\n  const [showCalibration, setShowCalibration] = useState(false);\n\n  const {\n    language,\n    vadSensitivity,\n    autoStartOnOpen,\n    showStatusHints,\n    // Phase 9.3 additions\n    selectedAudioDeviceId,\n    playbackSpeed,\n    keyboardShortcutsEnabled,\n    showFrequencySpectrum,\n    // ElevenLabs voice\n    elevenlabsVoiceId,\n    // Quality preset (Phase: Talker Enhancement)\n    qualityPreset,\n\n    // Phase 7: Multilingual settings\n    autoLanguageDetection,\n    languageSwitchConfidence,\n\n    // Phase 8: Calibration settings\n    vadCalibrated,\n    lastCalibrationDate,\n    personalizedVadThreshold,\n    enableBehaviorLearning,\n\n    // Phase 9: Offline mode settings\n    enableOfflineFallback,\n    preferOfflineVAD,\n    ttsCacheEnabled,\n\n    // Phase 10: Conversation management settings\n    enableSentimentTracking,\n    enableDiscourseAnalysis,\n    enableResponseRecommendations,\n    showSuggestedFollowUps,\n\n    // Privacy settings\n    storeTranscriptHistory,\n    shareAnonymousAnalytics,\n\n    // Actions\n    setLanguage,\n    setVadSensitivity,\n    setAutoStartOnOpen,\n    setShowStatusHints,\n    // Phase 9.3 additions\n    setSelectedAudioDeviceId,\n    setPlaybackSpeed,\n    setKeyboardShortcutsEnabled,\n    setShowFrequencySpectrum,\n    setElevenlabsVoiceId,\n    // Quality preset action\n    setQualityPreset,\n\n    // Phase 7: Multilingual actions\n    setAutoLanguageDetection,\n    setLanguageSwitchConfidence,\n\n    // Phase 8: Calibration actions\n    setEnableBehaviorLearning,\n\n    // Phase 9: Offline mode actions\n    setEnableOfflineFallback,\n    setPreferOfflineVAD,\n    setTtsCacheEnabled,\n\n    // Phase 10: Conversation management actions\n    setEnableSentimentTracking,\n    setEnableDiscourseAnalysis,\n    setEnableResponseRecommendations,\n    setShowSuggestedFollowUps,\n\n    // Privacy actions\n    setStoreTranscriptHistory,\n    setShareAnonymousAnalytics,\n\n    reset,\n  } = useVoiceSettingsStore();\n\n  // Format calibration date\n  const calibrationDateFormatted = useMemo(() => {\n    if (!lastCalibrationDate) return null;\n    return new Date(lastCalibrationDate).toLocaleDateString(undefined, {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n    });\n  }, [lastCalibrationDate]);\n\n  const handleReset = useCallback(() => {\n    if (window.confirm(\"Reset all voice settings to defaults?\")) {\n      reset();\n    }\n  }, [reset]);\n\n  const handleLanguageChange = useCallback(\n    (e: React.ChangeEvent<HTMLSelectElement>) => {\n      setLanguage(e.target.value as LanguageOption);\n    },\n    [setLanguage],\n  );\n\n  const handleSensitivityChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setVadSensitivity(parseInt(e.target.value, 10));\n    },\n    [setVadSensitivity],\n  );\n\n  const handleElevenlabsVoiceChange = useCallback(\n    (e: React.ChangeEvent<HTMLSelectElement>) => {\n      setElevenlabsVoiceId(e.target.value);\n    },\n    [setElevenlabsVoiceId],\n  );\n\n  const handleQualityPresetChange = useCallback(\n    (preset: QualityPreset) => {\n      setQualityPreset(preset);\n    },\n    [setQualityPreset],\n  );\n\n  const handleLanguageConfidenceChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setLanguageSwitchConfidence(parseFloat(e.target.value));\n    },\n    [setLanguageSwitchConfidence],\n  );\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n      onClick={onClose}\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby=\"voice-settings-title\"\n      data-testid=\"voice-settings-modal\"\n    >\n      <div\n        className=\"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6 max-h-[90vh] overflow-y-auto\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-6\">\n          <h2\n            id=\"voice-settings-title\"\n            className=\"text-lg font-semibold text-neutral-900\"\n          >\n            Voice Mode Settings\n          </h2>\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"text-neutral-400 hover:text-neutral-600 transition-colors\"\n            aria-label=\"Close settings\"\n            data-testid=\"close-settings\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n              className=\"w-6 h-6\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          </button>\n        </div>\n\n        {/* Settings Form */}\n        <div className=\"space-y-5\">\n          {/* Voice Selection (ElevenLabs) */}\n          <div>\n            <label\n              htmlFor=\"elevenlabs-voice-select\"\n              className=\"block text-sm font-medium text-neutral-700 mb-1\"\n            >\n              Voice\n            </label>\n            <select\n              id=\"elevenlabs-voice-select\"\n              value={elevenlabsVoiceId || \"TxGEqnHWrfWFTfGW9XjX\"}\n              onChange={handleElevenlabsVoiceChange}\n              className=\"w-full rounded-md border border-neutral-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent\"\n              data-testid=\"voice-select\"\n            >\n              <optgroup label=\"Premium Voices\">\n                {ELEVENLABS_VOICE_OPTIONS.filter((v) => v.premium).map(\n                  (voice) => (\n                    <option key={voice.id} value={voice.id}>\n                      {voice.name} ({voice.gender})\n                    </option>\n                  ),\n                )}\n              </optgroup>\n              <optgroup label=\"Standard Voices\">\n                {ELEVENLABS_VOICE_OPTIONS.filter((v) => !v.premium).map(\n                  (voice) => (\n                    <option key={voice.id} value={voice.id}>\n                      {voice.name} ({voice.gender})\n                    </option>\n                  ),\n                )}\n              </optgroup>\n            </select>\n            <p className=\"text-xs text-neutral-500 mt-1\">\n              Select the voice for AI spoken responses\n            </p>\n          </div>\n\n          {/* Voice Quality Preset */}\n          <div>\n            <label className=\"block text-sm font-medium text-neutral-700 mb-2\">\n              Voice Quality\n            </label>\n            <div className=\"flex gap-2\">\n              {QUALITY_PRESET_OPTIONS.map((option) => (\n                <button\n                  key={option.value}\n                  type=\"button\"\n                  onClick={() => handleQualityPresetChange(option.value)}\n                  className={`flex-1 px-3 py-2 text-sm font-medium rounded-md border transition-colors ${\n                    qualityPreset === option.value\n                      ? \"bg-primary-50 border-primary-500 text-primary-700\"\n                      : \"bg-white border-neutral-300 text-neutral-700 hover:bg-neutral-50\"\n                  }`}\n                  data-testid={`quality-preset-${option.value}`}\n                  title={option.description}\n                >\n                  {option.label}\n                </button>\n              ))}\n            </div>\n            <p className=\"text-xs text-neutral-500 mt-1\">\n              {QUALITY_PRESET_OPTIONS.find((o) => o.value === qualityPreset)\n                ?.description || \"Adjust speed vs naturalness trade-off\"}\n            </p>\n          </div>\n\n          {/* Language Selection */}\n          <div>\n            <label\n              htmlFor=\"language-select\"\n              className=\"block text-sm font-medium text-neutral-700 mb-1\"\n            >\n              Language\n            </label>\n            <select\n              id=\"language-select\"\n              value={language}\n              onChange={handleLanguageChange}\n              className=\"w-full rounded-md border border-neutral-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent\"\n              data-testid=\"language-select\"\n            >\n              {LANGUAGE_OPTIONS.map((opt) => (\n                <option key={opt.value} value={opt.value}>\n                  {opt.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          {/* VAD Sensitivity Slider */}\n          <div>\n            <label\n              htmlFor=\"vad-sensitivity\"\n              className=\"block text-sm font-medium text-neutral-700 mb-1\"\n            >\n              Voice Detection Sensitivity: {vadSensitivity}%\n            </label>\n            <input\n              type=\"range\"\n              id=\"vad-sensitivity\"\n              min=\"0\"\n              max=\"100\"\n              value={vadSensitivity}\n              onChange={handleSensitivityChange}\n              className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n              data-testid=\"vad-sensitivity-slider\"\n            />\n            <div className=\"flex justify-between text-xs text-neutral-500 mt-1\">\n              <span>Less sensitive</span>\n              <span>More sensitive</span>\n            </div>\n          </div>\n\n          {/* Auto-Start Toggle */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"auto-start\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Auto-start voice mode\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Automatically start voice mode when opening chat\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"auto-start\"\n              checked={autoStartOnOpen}\n              onChange={(e) => setAutoStartOnOpen(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"auto-start-checkbox\"\n            />\n          </div>\n\n          {/* Show Status Hints Toggle */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"show-hints\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Show status hints\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Display helpful tips during voice conversations\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"show-hints\"\n              checked={showStatusHints}\n              onChange={(e) => setShowStatusHints(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"show-hints-checkbox\"\n            />\n          </div>\n\n          {/* Section Divider */}\n          <div className=\"border-t border-neutral-200 pt-5\">\n            <h3 className=\"text-sm font-semibold text-neutral-800 mb-4\">\n              Advanced Settings\n            </h3>\n          </div>\n\n          {/* Audio Device Selection */}\n          <AudioDeviceSelector\n            selectedDeviceId={selectedAudioDeviceId || undefined}\n            onDeviceSelect={setSelectedAudioDeviceId}\n          />\n\n          {/* Playback Speed Control */}\n          <div>\n            <label className=\"block text-sm font-medium text-neutral-700 mb-2\">\n              AI Response Playback Speed\n            </label>\n            <PlaybackSpeedControl\n              speed={playbackSpeed}\n              onSpeedChange={setPlaybackSpeed}\n              variant=\"buttons\"\n            />\n            <p className=\"text-xs text-neutral-500 mt-1\">\n              Adjust how fast AI audio responses play\n            </p>\n          </div>\n\n          {/* Keyboard Shortcuts Toggle */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"keyboard-shortcuts\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Keyboard shortcuts\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Use Space to toggle recording, Esc to cancel\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"keyboard-shortcuts\"\n              checked={keyboardShortcutsEnabled}\n              onChange={(e) => setKeyboardShortcutsEnabled(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"keyboard-shortcuts-checkbox\"\n            />\n          </div>\n\n          {/* Frequency Spectrum Toggle */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"show-spectrum\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Show frequency spectrum\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Display detailed audio frequency visualization\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"show-spectrum\"\n              checked={showFrequencySpectrum}\n              onChange={(e) => setShowFrequencySpectrum(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"show-spectrum-checkbox\"\n            />\n          </div>\n\n          {/* ================================================================\n              Phase 7: Language & Detection Settings\n              ================================================================ */}\n          <div className=\"border-t border-neutral-200 pt-5\">\n            <h3 className=\"text-sm font-semibold text-neutral-800 mb-4 flex items-center gap-2\">\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-4 h-4 text-blue-500\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 016-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138c.896.061 1.785.147 2.666.257m-4.589 8.495a18.023 18.023 0 01-3.827-5.802\"\n                />\n              </svg>\n              Language & Detection\n            </h3>\n          </div>\n\n          {/* Auto Language Detection */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"auto-language-detection\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Auto-detect language\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Automatically detect which language you're speaking\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"auto-language-detection\"\n              checked={autoLanguageDetection}\n              onChange={(e) => setAutoLanguageDetection(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"auto-language-detection-checkbox\"\n            />\n          </div>\n\n          {/* Language Switch Confidence */}\n          {autoLanguageDetection && (\n            <div>\n              <label\n                htmlFor=\"language-confidence\"\n                className=\"block text-sm font-medium text-neutral-700 mb-1\"\n              >\n                Detection confidence:{\" \"}\n                {Math.round(languageSwitchConfidence * 100)}%\n              </label>\n              <input\n                type=\"range\"\n                id=\"language-confidence\"\n                min=\"0.5\"\n                max=\"1\"\n                step=\"0.05\"\n                value={languageSwitchConfidence}\n                onChange={handleLanguageConfidenceChange}\n                className=\"w-full h-2 bg-neutral-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n                data-testid=\"language-confidence-slider\"\n              />\n              <div className=\"flex justify-between text-xs text-neutral-500 mt-1\">\n                <span>More flexible</span>\n                <span>More strict</span>\n              </div>\n            </div>\n          )}\n\n          {/* ================================================================\n              Phase 8: Calibration Settings\n              ================================================================ */}\n          <div className=\"border-t border-neutral-200 pt-5\">\n            <h3 className=\"text-sm font-semibold text-neutral-800 mb-4 flex items-center gap-2\">\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-4 h-4 text-purple-500\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z\"\n                />\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"\n                />\n              </svg>\n              Voice Calibration\n            </h3>\n          </div>\n\n          {/* Calibration Status */}\n          <div className=\"p-4 bg-neutral-50 rounded-lg border border-neutral-200\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex items-start gap-3\">\n                <div\n                  className={`w-10 h-10 rounded-full flex items-center justify-center ${\n                    vadCalibrated\n                      ? \"bg-green-100 text-green-600\"\n                      : \"bg-amber-100 text-amber-600\"\n                  }`}\n                >\n                  {vadCalibrated ? (\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                      strokeWidth={2}\n                      stroke=\"currentColor\"\n                      className=\"w-5 h-5\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n                      />\n                    </svg>\n                  ) : (\n                    <svg\n                      xmlns=\"http://www.w3.org/2000/svg\"\n                      fill=\"none\"\n                      viewBox=\"0 0 24 24\"\n                      strokeWidth={2}\n                      stroke=\"currentColor\"\n                      className=\"w-5 h-5\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        d=\"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z\"\n                      />\n                    </svg>\n                  )}\n                </div>\n                <div>\n                  <p className=\"font-medium text-neutral-800\">\n                    {vadCalibrated ? \"Calibrated\" : \"Not Calibrated\"}\n                  </p>\n                  <p className=\"text-xs text-neutral-500 mt-0.5\">\n                    {vadCalibrated\n                      ? `Last calibrated: ${calibrationDateFormatted}`\n                      : \"Calibrate for personalized voice detection\"}\n                  </p>\n                  {vadCalibrated && personalizedVadThreshold !== null && (\n                    <p className=\"text-xs text-neutral-500\">\n                      Personalized threshold:{\" \"}\n                      {Math.round(personalizedVadThreshold * 100)}%\n                    </p>\n                  )}\n                </div>\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => setShowCalibration(true)}\n                className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\n                  vadCalibrated\n                    ? \"text-neutral-600 hover:text-neutral-800 bg-white border border-neutral-300 hover:bg-neutral-50\"\n                    : \"text-white bg-primary-500 hover:bg-primary-600\"\n                }`}\n                data-testid=\"calibrate-button\"\n              >\n                {vadCalibrated ? \"Recalibrate\" : \"Calibrate\"}\n              </button>\n            </div>\n          </div>\n\n          {/* Enable Behavior Learning */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"behavior-learning\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Adaptive learning\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Learn from your speech patterns to improve detection over time\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"behavior-learning\"\n              checked={enableBehaviorLearning}\n              onChange={(e) => setEnableBehaviorLearning(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"behavior-learning-checkbox\"\n            />\n          </div>\n\n          {/* ================================================================\n              Phase 9: Offline Mode Settings\n              ================================================================ */}\n          <div className=\"border-t border-neutral-200 pt-5\">\n            <h3 className=\"text-sm font-semibold text-neutral-800 mb-4 flex items-center gap-2\">\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-4 h-4 text-teal-500\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 011.06 0z\"\n                />\n              </svg>\n              Offline & Connectivity\n            </h3>\n          </div>\n\n          {/* Enable Offline Fallback */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"offline-fallback\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Offline voice fallback\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Use local voice detection when network is unavailable\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"offline-fallback\"\n              checked={enableOfflineFallback}\n              onChange={(e) => setEnableOfflineFallback(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"offline-fallback-checkbox\"\n            />\n          </div>\n\n          {/* Prefer Offline VAD */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"prefer-offline-vad\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Prefer local processing\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Process voice locally when possible for lower latency\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"prefer-offline-vad\"\n              checked={preferOfflineVAD}\n              onChange={(e) => setPreferOfflineVAD(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"prefer-offline-vad-checkbox\"\n            />\n          </div>\n\n          {/* TTS Cache */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"tts-cache\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Cache speech audio\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Store common phrases for faster playback\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"tts-cache\"\n              checked={ttsCacheEnabled}\n              onChange={(e) => setTtsCacheEnabled(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"tts-cache-checkbox\"\n            />\n          </div>\n\n          {/* ================================================================\n              Phase 10: Conversation Intelligence Settings\n              ================================================================ */}\n          <div className=\"border-t border-neutral-200 pt-5\">\n            <h3 className=\"text-sm font-semibold text-neutral-800 mb-4 flex items-center gap-2\">\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-4 h-4 text-indigo-500\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z\"\n                />\n              </svg>\n              Conversation Intelligence\n            </h3>\n          </div>\n\n          {/* Sentiment Tracking */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"sentiment-tracking\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Sentiment analysis\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Detect emotional tone to improve AI responses\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"sentiment-tracking\"\n              checked={enableSentimentTracking}\n              onChange={(e) => setEnableSentimentTracking(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"sentiment-tracking-checkbox\"\n            />\n          </div>\n\n          {/* Discourse Analysis */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"discourse-analysis\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Topic tracking\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Track conversation topics for better context\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"discourse-analysis\"\n              checked={enableDiscourseAnalysis}\n              onChange={(e) => setEnableDiscourseAnalysis(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"discourse-analysis-checkbox\"\n            />\n          </div>\n\n          {/* Response Recommendations */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"response-recommendations\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Smart response tuning\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Automatically adjust AI responses based on conversation flow\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"response-recommendations\"\n              checked={enableResponseRecommendations}\n              onChange={(e) =>\n                setEnableResponseRecommendations(e.target.checked)\n              }\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"response-recommendations-checkbox\"\n            />\n          </div>\n\n          {/* Suggested Follow-ups */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"suggested-followups\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Show follow-up suggestions\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Display suggested questions to continue the conversation\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"suggested-followups\"\n              checked={showSuggestedFollowUps}\n              onChange={(e) => setShowSuggestedFollowUps(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"suggested-followups-checkbox\"\n            />\n          </div>\n\n          {/* ================================================================\n              Privacy Settings\n              ================================================================ */}\n          <div className=\"border-t border-neutral-200 pt-5\">\n            <h3 className=\"text-sm font-semibold text-neutral-800 mb-4 flex items-center gap-2\">\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-4 h-4 text-emerald-500\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z\"\n                />\n              </svg>\n              Privacy\n            </h3>\n          </div>\n\n          {/* Store Transcript History */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"store-transcripts\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Store conversation history\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Save voice transcripts locally for continuity\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"store-transcripts\"\n              checked={storeTranscriptHistory}\n              onChange={(e) => setStoreTranscriptHistory(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"store-transcripts-checkbox\"\n            />\n          </div>\n\n          {/* Anonymous Analytics */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <label\n                htmlFor=\"anonymous-analytics\"\n                className=\"text-sm font-medium text-neutral-700\"\n              >\n                Share usage analytics\n              </label>\n              <p className=\"text-xs text-neutral-500\">\n                Help improve voice features with anonymous data\n              </p>\n            </div>\n            <input\n              type=\"checkbox\"\n              id=\"anonymous-analytics\"\n              checked={shareAnonymousAnalytics}\n              onChange={(e) => setShareAnonymousAnalytics(e.target.checked)}\n              className=\"w-5 h-5 rounded border-neutral-300 text-primary-500 focus:ring-primary-500\"\n              data-testid=\"anonymous-analytics-checkbox\"\n            />\n          </div>\n        </div>\n\n        {/* Current Config Summary */}\n        <div className=\"mt-6 p-3 bg-neutral-50 rounded-lg\">\n          <p className=\"text-xs text-neutral-600\">\n            <strong>Current:</strong>{\" \"}\n            {ELEVENLABS_VOICE_OPTIONS.find((v) => v.id === elevenlabsVoiceId)\n              ?.name || \"Josh\"}{\" \"}\n            voice,{\" \"}\n            {QUALITY_PRESET_OPTIONS.find((q) => q.value === qualityPreset)\n              ?.label || \"Balanced\"}{\" \"}\n            quality, {LANGUAGE_OPTIONS.find((l) => l.value === language)?.label}\n            ,{\" \"}\n            {PLAYBACK_SPEED_OPTIONS.find((s) => s.value === playbackSpeed)\n              ?.label || \"1x\"}{\" \"}\n            playback\n          </p>\n        </div>\n\n        {/* Footer Actions */}\n        <div className=\"mt-6 flex justify-between\">\n          <button\n            type=\"button\"\n            onClick={handleReset}\n            className=\"px-4 py-2 text-sm font-medium text-neutral-600 hover:text-neutral-900 transition-colors\"\n            data-testid=\"reset-settings\"\n          >\n            Reset to defaults\n          </button>\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 bg-primary-500 text-white text-sm font-medium rounded-md hover:bg-primary-600 transition-colors\"\n            data-testid=\"done-button\"\n          >\n            Done\n          </button>\n        </div>\n      </div>\n\n      {/* Calibration Dialog */}\n      <CalibrationDialog\n        isOpen={showCalibration}\n        onClose={() => setShowCalibration(false)}\n      />\n    </div>\n  );\n}\n"
}
