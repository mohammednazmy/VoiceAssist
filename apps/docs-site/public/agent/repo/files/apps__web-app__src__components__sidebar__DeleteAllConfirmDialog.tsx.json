{
  "path": "apps/web-app/src/components/sidebar/DeleteAllConfirmDialog.tsx",
  "language": "typescript",
  "size": 7141,
  "last_modified": "2025-12-01T21:42:00.657Z",
  "lines": 207,
  "content": "/**\n * DeleteAllConfirmDialog Component\n * A confirmation dialog for deleting all conversations.\n *\n * Features:\n * - Requires typing \"DELETE\" to confirm (safety mechanism)\n * - Shows count of conversations to be deleted\n * - Loading state during deletion\n * - Keyboard support (Escape to cancel)\n *\n * Phase 11: VoiceAssist Voice Pipeline Sprint\n */\n\nimport { useState, useEffect, useCallback } from \"react\";\n\nexport interface DeleteAllConfirmDialogProps {\n  /** Whether the dialog is open */\n  isOpen: boolean;\n  /** Number of conversations to be deleted */\n  conversationCount: number;\n  /** Called when deletion is confirmed */\n  onConfirm: () => void;\n  /** Called when deletion is cancelled */\n  onCancel: () => void;\n  /** Whether deletion is in progress */\n  isDeleting?: boolean;\n}\n\nconst CONFIRMATION_TEXT = \"DELETE\";\n\nexport function DeleteAllConfirmDialog({\n  isOpen,\n  conversationCount,\n  onConfirm,\n  onCancel,\n  isDeleting = false,\n}: DeleteAllConfirmDialogProps) {\n  const [confirmText, setConfirmText] = useState(\"\");\n  const isConfirmEnabled = confirmText === CONFIRMATION_TEXT && !isDeleting;\n\n  // Reset text when dialog opens/closes\n  useEffect(() => {\n    if (!isOpen) {\n      setConfirmText(\"\");\n    }\n  }, [isOpen]);\n\n  // Handle Escape key to cancel\n  const handleKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === \"Escape\" && !isDeleting) {\n        onCancel();\n      }\n    },\n    [onCancel, isDeleting],\n  );\n\n  useEffect(() => {\n    if (isOpen) {\n      document.addEventListener(\"keydown\", handleKeyDown);\n      return () => document.removeEventListener(\"keydown\", handleKeyDown);\n    }\n  }, [isOpen, handleKeyDown]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      onClick={(e) => {\n        // Close on backdrop click if not deleting\n        if (e.target === e.currentTarget && !isDeleting) {\n          onCancel();\n        }\n      }}\n      data-testid=\"delete-all-confirm-dialog\"\n    >\n      <div\n        className=\"bg-white dark:bg-slate-900 border border-neutral-200 dark:border-slate-700 rounded-xl shadow-xl max-w-md w-full mx-4 p-5 space-y-4\"\n        role=\"alertdialog\"\n        aria-modal=\"true\"\n        aria-labelledby=\"delete-all-dialog-title\"\n        aria-describedby=\"delete-all-dialog-description\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2 rounded-full bg-red-100 dark:bg-red-500/10\">\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-6 h-6 text-red-600 dark:text-red-500\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z\"\n              />\n            </svg>\n          </div>\n          <h2\n            id=\"delete-all-dialog-title\"\n            className=\"text-lg font-semibold text-neutral-900 dark:text-slate-100\"\n          >\n            Delete All Conversations?\n          </h2>\n        </div>\n\n        {/* Description */}\n        <div id=\"delete-all-dialog-description\" className=\"space-y-3\">\n          <p className=\"text-sm text-neutral-600 dark:text-slate-400\">\n            This action{\" \"}\n            <strong className=\"text-red-600 dark:text-red-400\">\n              cannot be undone\n            </strong>\n            . You are about to permanently delete{\" \"}\n            <strong className=\"text-neutral-900 dark:text-slate-200\">\n              {conversationCount} conversation\n              {conversationCount !== 1 ? \"s\" : \"\"}\n            </strong>{\" \"}\n            and all associated messages.\n          </p>\n\n          <p className=\"text-sm text-neutral-600 dark:text-slate-400\">\n            To confirm, please type{\" \"}\n            <code className=\"px-1.5 py-0.5 bg-neutral-100 dark:bg-slate-800 rounded font-mono text-red-600 dark:text-red-400\">\n              {CONFIRMATION_TEXT}\n            </code>{\" \"}\n            below:\n          </p>\n        </div>\n\n        {/* Confirmation Input */}\n        <input\n          type=\"text\"\n          value={confirmText}\n          onChange={(e) => setConfirmText(e.target.value.toUpperCase())}\n          placeholder={`Type ${CONFIRMATION_TEXT} to confirm`}\n          disabled={isDeleting}\n          className=\"w-full px-3 py-2 border border-neutral-300 dark:border-slate-600 rounded-lg\n                     bg-white dark:bg-slate-800 text-neutral-900 dark:text-slate-100\n                     placeholder:text-neutral-400 dark:placeholder:text-slate-500\n                     focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500\n                     disabled:opacity-50 disabled:cursor-not-allowed\n                     font-mono text-sm\"\n          data-testid=\"delete-all-confirm-input\"\n          autoFocus\n        />\n\n        {/* Actions */}\n        <div className=\"flex justify-end gap-3 pt-2\">\n          <button\n            type=\"button\"\n            onClick={onCancel}\n            disabled={isDeleting}\n            className=\"px-4 py-2 text-sm rounded-lg border border-neutral-300 dark:border-slate-700\n                       text-neutral-700 dark:text-slate-300\n                       hover:bg-neutral-50 dark:hover:bg-slate-800\n                       hover:text-neutral-900 dark:hover:text-slate-100\n                       disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            data-testid=\"delete-all-cancel-button\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={onConfirm}\n            disabled={!isConfirmEnabled}\n            className=\"px-4 py-2 text-sm rounded-lg bg-red-600 hover:bg-red-500 text-white\n                       disabled:opacity-50 disabled:cursor-not-allowed transition-colors\n                       flex items-center gap-2\"\n            data-testid=\"delete-all-confirm-button\"\n          >\n            {isDeleting && (\n              <svg\n                className=\"w-4 h-4 animate-spin\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n              >\n                <circle\n                  className=\"opacity-25\"\n                  cx=\"12\"\n                  cy=\"12\"\n                  r=\"10\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"4\"\n                />\n                <path\n                  className=\"opacity-75\"\n                  fill=\"currentColor\"\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                />\n              </svg>\n            )}\n            {isDeleting ? \"Deleting...\" : \"Delete All\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default DeleteAllConfirmDialog;\n"
}
