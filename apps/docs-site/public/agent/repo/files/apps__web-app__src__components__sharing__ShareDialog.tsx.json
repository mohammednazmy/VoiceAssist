{
  "path": "apps/web-app/src/components/sharing/ShareDialog.tsx",
  "language": "typescript",
  "size": 14468,
  "last_modified": "2025-12-03T23:50:35.642Z",
  "lines": 379,
  "content": "/**\n * ShareDialog Component\n * Dialog for creating and managing conversation share links\n */\n\nimport { useState, useEffect } from \"react\";\nimport { Button, Input } from \"@voiceassist/ui\";\nimport { useAuth } from \"../../hooks/useAuth\";\nimport type { ShareLink } from \"@voiceassist/types\";\nimport { extractErrorMessage } from \"@voiceassist/types\";\n\ninterface ShareDialogProps {\n  isOpen: boolean;\n  onClose: () => void;\n  conversationId: string;\n  conversationTitle: string;\n}\n\nexport function ShareDialog({\n  isOpen,\n  onClose,\n  conversationId,\n  conversationTitle,\n}: ShareDialogProps) {\n  const { apiClient } = useAuth();\n  const [activeLinks, setActiveLinks] = useState<ShareLink[]>([]);\n  const [_isLoading, setIsLoading] = useState(false);\n  const [isCreating, setIsCreating] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  // Form state\n  const [expiresInHours, setExpiresInHours] = useState(24);\n  const [password, setPassword] = useState(\"\");\n  const [allowAnonymous, setAllowAnonymous] = useState(true);\n  const [newShareUrl, setNewShareUrl] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (isOpen) {\n      loadShareLinks();\n      setNewShareUrl(null);\n      setPassword(\"\");\n    }\n  }, [isOpen, conversationId]);\n\n  const loadShareLinks = async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const links = await apiClient.listShareLinks(conversationId);\n      setActiveLinks(links);\n    } catch (err: unknown) {\n      setError(extractErrorMessage(err));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCreateLink = async () => {\n    setIsCreating(true);\n    setError(null);\n\n    try {\n      const response = await apiClient.createShareLink(conversationId, {\n        expiresInHours,\n        password: password.trim() || null,\n        allowAnonymous,\n      });\n\n      // Build full URL\n      const baseUrl = window.location.origin;\n      const fullUrl = `${baseUrl}${response.shareUrl}`;\n      setNewShareUrl(fullUrl);\n\n      // Reload links\n      await loadShareLinks();\n\n      // Reset form\n      setPassword(\"\");\n    } catch (err: unknown) {\n      setError(extractErrorMessage(err));\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const handleRevokeLink = async (shareToken: string) => {\n    try {\n      await apiClient.revokeShareLink(conversationId, shareToken);\n      await loadShareLinks();\n    } catch (err: unknown) {\n      setError(extractErrorMessage(err));\n    }\n  };\n\n  const handleCopyLink = (url: string) => {\n    navigator.clipboard.writeText(url);\n    // Could show a toast notification here\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleString(\"en-US\", {\n      month: \"short\",\n      day: \"numeric\",\n      year: \"numeric\",\n      hour: \"numeric\",\n      minute: \"2-digit\",\n    });\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\n      <div\n        className=\"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden flex flex-col\"\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby=\"share-dialog-title\"\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-6 border-b border-neutral-200\">\n          <div>\n            <h2\n              id=\"share-dialog-title\"\n              className=\"text-lg font-semibold text-neutral-900\"\n            >\n              Share Conversation\n            </h2>\n            <p className=\"text-sm text-neutral-600 mt-1\">{conversationTitle}</p>\n          </div>\n          <button\n            onClick={onClose}\n            className=\"p-1 hover:bg-neutral-100 rounded transition-colors\"\n            aria-label=\"Close dialog\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={2}\n              stroke=\"currentColor\"\n              className=\"w-5 h-5 text-neutral-500\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          </button>\n        </div>\n\n        {/* Content - Scrollable */}\n        <div className=\"flex-1 overflow-y-auto p-6 space-y-6\">\n          {/* New Share Link Created */}\n          {newShareUrl && (\n            <div className=\"p-4 bg-green-50 border border-green-200 rounded-md\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-green-900 mb-2\">\n                    Share link created!\n                  </p>\n                  <div className=\"flex items-center gap-2\">\n                    <code className=\"flex-1 px-3 py-2 bg-white border border-green-300 rounded text-sm text-green-900 truncate\">\n                      {newShareUrl}\n                    </code>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => handleCopyLink(newShareUrl)}\n                      className=\"shrink-0\"\n                    >\n                      <svg\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        fill=\"none\"\n                        viewBox=\"0 0 24 24\"\n                        strokeWidth={2}\n                        stroke=\"currentColor\"\n                        className=\"w-4 h-4\"\n                      >\n                        <path\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                          d=\"M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5A3.375 3.375 0 006.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0015 2.25h-1.5a2.251 2.251 0 00-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 00-9-9z\"\n                        />\n                      </svg>\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Create New Share Link */}\n          <div className=\"space-y-4\">\n            <h3 className=\"text-sm font-semibold text-neutral-900\">\n              Create New Share Link\n            </h3>\n\n            {/* Expiration */}\n            <div>\n              <label\n                htmlFor=\"expires-in\"\n                className=\"block text-sm font-medium text-neutral-700 mb-1\"\n              >\n                Link Expiration\n              </label>\n              <select\n                id=\"expires-in\"\n                value={expiresInHours}\n                onChange={(e) => setExpiresInHours(Number(e.target.value))}\n                className=\"w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              >\n                <option value={1}>1 hour</option>\n                <option value={24}>24 hours</option>\n                <option value={168}>7 days</option>\n                <option value={720}>30 days</option>\n              </select>\n            </div>\n\n            {/* Password Protection */}\n            <div>\n              <label\n                htmlFor=\"password\"\n                className=\"block text-sm font-medium text-neutral-700 mb-1\"\n              >\n                Password Protection (Optional)\n              </label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Leave blank for no password\"\n                className=\"w-full\"\n              />\n            </div>\n\n            {/* Allow Anonymous Access */}\n            <div className=\"flex items-center\">\n              <input\n                id=\"allow-anonymous\"\n                type=\"checkbox\"\n                checked={allowAnonymous}\n                onChange={(e) => setAllowAnonymous(e.target.checked)}\n                className=\"w-4 h-4 text-primary-600 border-neutral-300 rounded focus:ring-primary-500\"\n              />\n              <label\n                htmlFor=\"allow-anonymous\"\n                className=\"ml-2 text-sm text-neutral-700\"\n              >\n                Allow anonymous access\n              </label>\n            </div>\n\n            <Button\n              onClick={handleCreateLink}\n              disabled={isCreating}\n              className=\"w-full\"\n            >\n              {isCreating ? (\n                <>\n                  <div className=\"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  Creating Link...\n                </>\n              ) : (\n                \"Create Share Link\"\n              )}\n            </Button>\n          </div>\n\n          {/* Active Share Links */}\n          {activeLinks.length > 0 && (\n            <div className=\"space-y-3\">\n              <h3 className=\"text-sm font-semibold text-neutral-900\">\n                Active Share Links\n              </h3>\n              <div className=\"space-y-2\">\n                {activeLinks.map((link) => (\n                  <div\n                    key={link.shareToken}\n                    className=\"p-4 border border-neutral-200 rounded-md hover:bg-neutral-50 transition-colors\"\n                  >\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <code className=\"text-xs text-neutral-600 truncate\">\n                            {window.location.origin}\n                            {link.shareUrl}\n                          </code>\n                          <button\n                            onClick={() =>\n                              handleCopyLink(\n                                `${window.location.origin}${link.shareUrl}`,\n                              )\n                            }\n                            className=\"p-1 hover:bg-neutral-200 rounded transition-colors shrink-0\"\n                            title=\"Copy link\"\n                          >\n                            <svg\n                              xmlns=\"http://www.w3.org/2000/svg\"\n                              fill=\"none\"\n                              viewBox=\"0 0 24 24\"\n                              strokeWidth={2}\n                              stroke=\"currentColor\"\n                              className=\"w-4 h-4\"\n                            >\n                              <path\n                                strokeLinecap=\"round\"\n                                strokeLinejoin=\"round\"\n                                d=\"M8.25 7.5V6.108c0-1.135.845-2.098 1.976-2.192.373-.03.748-.057 1.123-.08M15.75 18H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08M15.75 18.75v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5A3.375 3.375 0 006.375 7.5H5.25m11.9-3.664A2.251 2.251 0 0015 2.25h-1.5a2.251 2.251 0 00-2.15 1.586m5.8 0c.065.21.1.433.1.664v.75h-6V4.5c0-.231.035-.454.1-.664M6.75 7.5H4.875c-.621 0-1.125.504-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V16.5a9 9 0 00-9-9z\"\n                              />\n                            </svg>\n                          </button>\n                        </div>\n                        <div className=\"flex items-center gap-3 text-xs text-neutral-600\">\n                          <span>Expires: {formatDate(link.expiresAt)}</span>\n                          <span>â€¢</span>\n                          <span>\n                            {link.accessCount}{\" \"}\n                            {link.accessCount === 1 ? \"access\" : \"accesses\"}\n                          </span>\n                          {link.passwordProtected && (\n                            <>\n                              <span>â€¢</span>\n                              <span className=\"text-primary-600\">\n                                ðŸ”’ Password protected\n                              </span>\n                            </>\n                          )}\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => handleRevokeLink(link.shareToken)}\n                        className=\"p-2 text-red-600 hover:bg-red-50 rounded transition-colors\"\n                        title=\"Revoke link\"\n                      >\n                        <svg\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          fill=\"none\"\n                          viewBox=\"0 0 24 24\"\n                          strokeWidth={2}\n                          stroke=\"currentColor\"\n                          className=\"w-4 h-4\"\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            d=\"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0\"\n                          />\n                        </svg>\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Error Message */}\n          {error && (\n            <div className=\"p-3 bg-red-50 border border-red-200 rounded-md\">\n              <p className=\"text-sm text-red-800\">{error}</p>\n            </div>\n          )}\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex justify-end p-6 border-t border-neutral-200\">\n          <Button onClick={onClose} variant=\"outline\">\n            Close\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
}
