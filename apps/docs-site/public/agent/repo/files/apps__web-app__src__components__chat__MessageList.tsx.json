{
  "path": "apps/web-app/src/components/chat/MessageList.tsx",
  "language": "typescript",
  "size": 6321,
  "last_modified": "2025-11-27T06:53:16.475Z",
  "lines": 201,
  "content": "/**\n * MessageList Component\n * Virtualized list of messages using react-virtuoso\n *\n * Features:\n * - Virtualized rendering for performance\n * - Scroll-to-load older messages\n * - Auto-scroll to bottom on new messages\n */\n\nimport { useEffect, useRef, useCallback } from \"react\";\nimport { Virtuoso, VirtuosoHandle } from \"react-virtuoso\";\nimport type { Message } from \"@voiceassist/types\";\nimport { MessageBubble } from \"./MessageBubble\";\nimport { StreamingIndicator } from \"./StreamingIndicator\";\n\nexport interface MessageListProps {\n  messages: Message[];\n  isTyping?: boolean;\n  streamingMessageId?: string;\n  onEditSave?: (messageId: string, newContent: string) => Promise<void>;\n  onRegenerate?: (messageId: string) => Promise<void>;\n  onDelete?: (messageId: string) => Promise<void>;\n  onBranch?: (messageId: string) => Promise<void>;\n  /** Set of message IDs that have branches created from them */\n  branchedMessageIds?: Set<string>;\n  /** Pagination: callback to load older messages */\n  onLoadMore?: () => void;\n  /** Pagination: whether there are more messages to load */\n  hasMore?: boolean;\n  /** Pagination: whether currently loading more messages */\n  isLoadingMore?: boolean;\n  /** Total number of messages in conversation */\n  totalCount?: number;\n}\n\nexport function MessageList({\n  messages,\n  isTyping,\n  streamingMessageId,\n  onEditSave,\n  onRegenerate,\n  onDelete,\n  onBranch,\n  branchedMessageIds,\n  onLoadMore,\n  hasMore = false,\n  isLoadingMore = false,\n  totalCount,\n}: MessageListProps) {\n  const virtuosoRef = useRef<VirtuosoHandle>(null);\n  const isLoadingRef = useRef(false);\n\n  // Handle scroll to top - load older messages\n  const handleStartReached = useCallback(() => {\n    if (hasMore && !isLoadingRef.current && onLoadMore) {\n      isLoadingRef.current = true;\n      onLoadMore();\n    }\n  }, [hasMore, onLoadMore]);\n\n  // Reset loading ref when isLoadingMore changes to false\n  useEffect(() => {\n    if (!isLoadingMore) {\n      isLoadingRef.current = false;\n    }\n  }, [isLoadingMore]);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    if (messages.length > 0) {\n      virtuosoRef.current?.scrollToIndex({\n        index: messages.length - 1,\n        behavior: \"smooth\",\n        align: \"end\",\n      });\n    }\n  }, [messages.length]);\n\n  if (messages.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-full\">\n        <div className=\"text-center max-w-md px-4\">\n          <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-primary-100 flex items-center justify-center\">\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-8 h-8 text-primary-600\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z\"\n              />\n            </svg>\n          </div>\n          <h3 className=\"text-lg font-semibold text-neutral-900 mb-2\">\n            Start a Conversation\n          </h3>\n          <p className=\"text-neutral-600\">\n            Ask me anything about medical information, treatment protocols, or\n            healthcare guidance.\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  // Loading indicator component for the header\n  const LoadingHeader = () => {\n    if (isLoadingMore) {\n      return (\n        <div className=\"flex justify-center py-3\">\n          <div className=\"flex items-center gap-2 text-sm text-neutral-500\">\n            <svg\n              className=\"animate-spin h-4 w-4\"\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n            >\n              <circle\n                className=\"opacity-25\"\n                cx=\"12\"\n                cy=\"12\"\n                r=\"10\"\n                stroke=\"currentColor\"\n                strokeWidth=\"4\"\n              />\n              <path\n                className=\"opacity-75\"\n                fill=\"currentColor\"\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n              />\n            </svg>\n            <span>Loading older messages...</span>\n          </div>\n        </div>\n      );\n    }\n\n    if (hasMore) {\n      return (\n        <div className=\"flex justify-center py-2\">\n          <span className=\"text-xs text-neutral-400\">\n            Scroll up to load more\n          </span>\n        </div>\n      );\n    }\n\n    if (totalCount && totalCount > 0) {\n      return (\n        <div className=\"flex justify-center py-2\">\n          <span className=\"text-xs text-neutral-400\">\n            Beginning of conversation ({totalCount} messages)\n          </span>\n        </div>\n      );\n    }\n\n    return null;\n  };\n\n  return (\n    <div role=\"region\" aria-label=\"Message list\" className=\"h-full\">\n      <Virtuoso\n        ref={virtuosoRef}\n        data={messages}\n        className=\"h-full\"\n        initialTopMostItemIndex={messages.length - 1}\n        followOutput=\"smooth\"\n        startReached={handleStartReached}\n        itemContent={(index, message) => (\n          <MessageBubble\n            key={message.id}\n            message={message}\n            isStreaming={isTyping && message.id === streamingMessageId}\n            onEditSave={onEditSave}\n            onRegenerate={onRegenerate}\n            onDelete={onDelete}\n            onBranch={onBranch}\n            hasBranch={branchedMessageIds?.has(message.id)}\n          />\n        )}\n        components={{\n          Header: LoadingHeader,\n          Footer: () =>\n            isTyping && !streamingMessageId ? (\n              <div className=\"flex justify-start mb-4\">\n                <StreamingIndicator message=\"AI is thinking...\" />\n              </div>\n            ) : null,\n        }}\n      />\n    </div>\n  );\n}\n"
}
