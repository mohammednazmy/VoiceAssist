{
  "path": "apps/web-app/src/components/conversations/ConversationList.tsx",
  "language": "typescript",
  "size": 12207,
  "last_modified": "2025-11-26T04:53:13.101Z",
  "lines": 359,
  "content": "/**\n * ConversationList Component\n * Displays list of user's conversations with actions and skeleton loading\n */\n\nimport { useState } from \"react\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport { useConversations } from \"../../hooks/useConversations\";\nimport { useToastContext } from \"../../contexts/ToastContext\";\nimport { Input } from \"@voiceassist/ui\";\nimport { ConversationListItem } from \"./ConversationListItem\";\n\nexport interface ConversationListProps {\n  showArchived?: boolean;\n}\n\n/** Skeleton loader for conversation items */\nfunction ConversationSkeleton() {\n  return (\n    <div className=\"px-3 py-2.5 animate-pulse\">\n      <div className=\"h-4 bg-neutral-200 rounded w-3/4 mb-2\" />\n      <div className=\"h-3 bg-neutral-100 rounded w-full mb-1.5\" />\n      <div className=\"h-3 bg-neutral-100 rounded w-1/3\" />\n    </div>\n  );\n}\n\nexport function ConversationList({\n  showArchived = false,\n}: ConversationListProps) {\n  const navigate = useNavigate();\n  const { conversationId } = useParams<{ conversationId: string }>();\n  const toast = useToastContext();\n  const [isCreating, setIsCreating] = useState(false);\n\n  const {\n    conversations,\n    isLoading,\n    isLoadingMore,\n    error,\n    searchQuery,\n    setSearchQuery,\n    hasMore,\n    loadMore,\n    createConversation,\n    updateConversation,\n    archiveConversation,\n    deleteConversation,\n    reload,\n  } = useConversations({\n    onError: (title, description) => {\n      toast.error(title, description);\n    },\n    pageSize: 20,\n  });\n\n  // Filter by archived status locally (since API may not filter)\n  const filteredConversations = conversations\n    .filter((c) => (showArchived ? c.archived : !c.archived))\n    .sort(\n      (a, b) =>\n        new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime(),\n    );\n\n  const handleCreateNew = async () => {\n    setIsCreating(true);\n    try {\n      const newConversation = await createConversation(\"New Conversation\");\n      navigate(`/chat/${newConversation.id}`);\n      toast.success(\"Created conversation\", \"New conversation started\");\n    } catch (err) {\n      console.error(\"Failed to create conversation:\", err);\n      // Error toast already shown by useConversations\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  const handleRename = async (id: string, newTitle: string) => {\n    try {\n      await updateConversation(id, { title: newTitle });\n      // Success - optimistic update already applied\n    } catch (err) {\n      console.error(\"Failed to rename conversation:\", err);\n      // Error toast already shown by useConversations, will rollback\n      throw err;\n    }\n  };\n\n  const handleArchive = async (id: string) => {\n    try {\n      await archiveConversation(id);\n      // If archiving the active conversation, navigate away\n      if (id === conversationId) {\n        navigate(\"/chat\");\n      }\n      toast.info(\n        \"Conversation archived\",\n        \"You can find it in the archived section\",\n      );\n    } catch (err) {\n      console.error(\"Failed to archive conversation:\", err);\n      // Error toast already shown by useConversations, will rollback\n      throw err;\n    }\n  };\n\n  const handleDelete = async (id: string) => {\n    try {\n      await deleteConversation(id);\n      // If deleting the active conversation, navigate away\n      if (id === conversationId) {\n        navigate(\"/chat\");\n      }\n      toast.success(\n        \"Conversation deleted\",\n        \"The conversation has been permanently deleted\",\n      );\n    } catch (err) {\n      console.error(\"Failed to delete conversation:\", err);\n      // Error toast already shown by useConversations, will rollback\n      throw err;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex flex-col h-full\">\n        {/* Header skeleton */}\n        <div className=\"px-4 py-3 border-b border-neutral-200 bg-white space-y-3\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"h-5 w-24 bg-neutral-200 rounded animate-pulse\" />\n            <div className=\"h-8 w-8 bg-neutral-100 rounded animate-pulse\" />\n          </div>\n          <div className=\"h-9 bg-neutral-100 rounded animate-pulse\" />\n        </div>\n        {/* Skeleton items */}\n        <div className=\"flex-1 overflow-y-auto p-2 space-y-1\">\n          {[...Array(6)].map((_, i) => (\n            <ConversationSkeleton key={i} />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (error && filteredConversations.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-full p-4\">\n        <div className=\"text-center max-w-sm\">\n          <div className=\"w-12 h-12 mx-auto mb-3 rounded-full bg-red-100 flex items-center justify-center\">\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-6 h-6 text-red-600\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z\"\n              />\n            </svg>\n          </div>\n          <p className=\"text-sm font-medium text-neutral-900 mb-1\">{error}</p>\n          <button\n            type=\"button\"\n            onClick={() => reload()}\n            className=\"text-sm text-primary-600 hover:text-primary-700 underline\"\n          >\n            Try again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (conversations.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full p-6\">\n        <div className=\"text-center max-w-sm\">\n          <div className=\"w-16 h-16 mx-auto mb-4 rounded-full bg-neutral-100 flex items-center justify-center\">\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-8 h-8 text-neutral-400\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z\"\n              />\n            </svg>\n          </div>\n          <h3 className=\"text-base font-semibold text-neutral-900 mb-2\">\n            {showArchived\n              ? \"No archived conversations\"\n              : \"No conversations yet\"}\n          </h3>\n          <p className=\"text-sm text-neutral-600 mb-6\">\n            {showArchived\n              ? \"Archived conversations will appear here.\"\n              : \"Start a new conversation to get going!\"}\n          </p>\n          {!showArchived && (\n            <button\n              type=\"button\"\n              onClick={handleCreateNew}\n              disabled={isCreating}\n              className=\"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-500 rounded-md hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {isCreating ? (\n                <>\n                  <div className=\"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  Creating...\n                </>\n              ) : (\n                <>\n                  <svg\n                    xmlns=\"http://www.w3.org/2000/svg\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    strokeWidth={2}\n                    stroke=\"currentColor\"\n                    className=\"w-4 h-4 mr-2\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      d=\"M12 4.5v15m7.5-7.5h-15\"\n                    />\n                  </svg>\n                  New Conversation\n                </>\n              )}\n            </button>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* Header with New Conversation button */}\n      <div className=\"flex flex-col px-4 py-3 border-b border-neutral-200 bg-white space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-sm font-semibold text-neutral-900\">\n            {showArchived ? \"Archived\" : \"Conversations\"}\n          </h2>\n          {!showArchived && (\n            <button\n              type=\"button\"\n              onClick={handleCreateNew}\n              disabled={isCreating}\n              className=\"p-1.5 text-primary-600 hover:bg-primary-50 rounded-md transition-colors disabled:opacity-50 focus:outline-none focus:ring-2 focus:ring-primary-500\"\n              aria-label=\"New conversation\"\n            >\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={2}\n                stroke=\"currentColor\"\n                className=\"w-5 h-5\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M12 4.5v15m7.5-7.5h-15\"\n                />\n              </svg>\n            </button>\n          )}\n        </div>\n\n        {/* Search Input */}\n        <div className=\"relative\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            strokeWidth={1.5}\n            stroke=\"currentColor\"\n            className=\"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              d=\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"\n            />\n          </svg>\n          <Input\n            type=\"text\"\n            placeholder=\"Search...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-9 text-sm\"\n          />\n        </div>\n      </div>\n\n      {/* Conversation List */}\n      <div className=\"flex-1 overflow-y-auto p-2 space-y-1\" role=\"list\">\n        {filteredConversations.length === 0 && searchQuery && (\n          <div className=\"p-4 text-center\">\n            <p className=\"text-sm text-neutral-600\">No conversations found</p>\n          </div>\n        )}\n        {filteredConversations.map((conversation) => (\n          <ConversationListItem\n            key={conversation.id}\n            conversation={conversation}\n            isActive={conversation.id === conversationId}\n            onRename={handleRename}\n            onArchive={handleArchive}\n            onDelete={handleDelete}\n          />\n        ))}\n\n        {/* Load More Button */}\n        {hasMore && !searchQuery && (\n          <div className=\"pt-2 pb-1\">\n            <button\n              type=\"button\"\n              onClick={loadMore}\n              disabled={isLoadingMore}\n              className=\"w-full py-2 text-sm text-primary-600 hover:text-primary-700 hover:bg-primary-50 rounded-md transition-colors disabled:opacity-50\"\n            >\n              {isLoadingMore ? (\n                <span className=\"flex items-center justify-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n                  Loading more...\n                </span>\n              ) : (\n                \"Load more conversations\"\n              )}\n            </button>\n          </div>\n        )}\n\n        {/* Loading more skeletons */}\n        {isLoadingMore && (\n          <div className=\"space-y-1\">\n            {[...Array(3)].map((_, i) => (\n              <ConversationSkeleton key={`loading-more-${i}`} />\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"
}
