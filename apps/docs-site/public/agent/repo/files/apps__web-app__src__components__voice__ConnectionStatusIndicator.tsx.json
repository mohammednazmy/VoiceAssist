{
  "path": "apps/web-app/src/components/voice/ConnectionStatusIndicator.tsx",
  "language": "typescript",
  "size": 4848,
  "last_modified": "2025-12-01T03:29:18.156Z",
  "lines": 201,
  "content": "/**\n * ConnectionStatusIndicator\n * Compact, unified status indicator for voice mode connection state\n *\n * Features:\n * - Colored badge with animated states\n * - Hover tooltip with details\n * - Compact enough for header placement\n */\n\n/**\n * Connection status type for voice mode\n * Used by both OpenAI Realtime and Thinker/Talker pipelines\n */\nexport type ConnectionStatus =\n  | \"disconnected\"\n  | \"connecting\"\n  | \"connected\"\n  | \"reconnecting\"\n  | \"error\"\n  | \"failed\"\n  | \"expired\"\n  | \"mic_permission_denied\";\n\ninterface ConnectionStatusIndicatorProps {\n  status: ConnectionStatus;\n  isOfflineMode?: boolean;\n  isOfflineRecording?: boolean;\n  reconnectAttempts?: number;\n  className?: string;\n}\n\nconst statusConfig: Record<\n  ConnectionStatus | \"offline\" | \"offline_recording\",\n  {\n    label: string;\n    color: string;\n    bgColor: string;\n    animate?: string;\n    icon: \"dot\" | \"spinner\" | \"warning\" | \"mic\";\n  }\n> = {\n  disconnected: {\n    label: \"Disconnected\",\n    color: \"text-neutral-500\",\n    bgColor: \"bg-neutral-100\",\n    icon: \"dot\",\n  },\n  connecting: {\n    label: \"Connecting...\",\n    color: \"text-yellow-600\",\n    bgColor: \"bg-yellow-50\",\n    animate: \"animate-pulse\",\n    icon: \"spinner\",\n  },\n  connected: {\n    label: \"Connected\",\n    color: \"text-green-600\",\n    bgColor: \"bg-green-50\",\n    icon: \"dot\",\n  },\n  reconnecting: {\n    label: \"Reconnecting...\",\n    color: \"text-orange-600\",\n    bgColor: \"bg-orange-50\",\n    animate: \"animate-pulse\",\n    icon: \"spinner\",\n  },\n  error: {\n    label: \"Error\",\n    color: \"text-red-600\",\n    bgColor: \"bg-red-50\",\n    icon: \"warning\",\n  },\n  failed: {\n    label: \"Failed\",\n    color: \"text-red-600\",\n    bgColor: \"bg-red-50\",\n    icon: \"warning\",\n  },\n  expired: {\n    label: \"Expired\",\n    color: \"text-amber-600\",\n    bgColor: \"bg-amber-50\",\n    icon: \"warning\",\n  },\n  mic_permission_denied: {\n    label: \"Mic Blocked\",\n    color: \"text-red-600\",\n    bgColor: \"bg-red-50\",\n    icon: \"mic\",\n  },\n  offline: {\n    label: \"Offline\",\n    color: \"text-orange-600\",\n    bgColor: \"bg-orange-50\",\n    icon: \"warning\",\n  },\n  offline_recording: {\n    label: \"Recording\",\n    color: \"text-red-600\",\n    bgColor: \"bg-red-50\",\n    animate: \"animate-pulse\",\n    icon: \"mic\",\n  },\n};\n\nfunction StatusIcon({ type }: { type: \"dot\" | \"spinner\" | \"warning\" | \"mic\" }) {\n  switch (type) {\n    case \"spinner\":\n      return (\n        <svg className=\"w-3 h-3 animate-spin\" fill=\"none\" viewBox=\"0 0 24 24\">\n          <circle\n            className=\"opacity-25\"\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            strokeWidth=\"4\"\n          />\n          <path\n            className=\"opacity-75\"\n            fill=\"currentColor\"\n            d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z\"\n          />\n        </svg>\n      );\n    case \"warning\":\n      return (\n        <svg\n          className=\"w-3 h-3\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          stroke=\"currentColor\"\n          strokeWidth={2}\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            d=\"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z\"\n          />\n        </svg>\n      );\n    case \"mic\":\n      return (\n        <svg\n          className=\"w-3 h-3\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          stroke=\"currentColor\"\n          strokeWidth={2}\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            d=\"M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z\"\n          />\n        </svg>\n      );\n    case \"dot\":\n    default:\n      return <span className=\"w-2 h-2 rounded-full bg-current\" />;\n  }\n}\n\nexport function ConnectionStatusIndicator({\n  status,\n  isOfflineMode = false,\n  isOfflineRecording = false,\n  reconnectAttempts = 0,\n  className = \"\",\n}: ConnectionStatusIndicatorProps) {\n  // Determine effective status\n  const effectiveStatus = isOfflineRecording\n    ? \"offline_recording\"\n    : isOfflineMode && status !== \"connected\"\n      ? \"offline\"\n      : status;\n\n  const config = statusConfig[effectiveStatus];\n\n  // Build tooltip text\n  let tooltip = config.label;\n  if (status === \"reconnecting\" && reconnectAttempts > 0) {\n    tooltip += ` (attempt ${reconnectAttempts})`;\n  }\n\n  return (\n    <div\n      className={`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${config.bgColor} ${config.color} ${config.animate || \"\"} ${className}`}\n      title={tooltip}\n      data-testid=\"connection-status-indicator\"\n      role=\"status\"\n      aria-label={`Connection status: ${config.label}`}\n    >\n      <StatusIcon type={config.icon} />\n      <span className=\"hidden sm:inline\">{config.label}</span>\n    </div>\n  );\n}\n"
}
