{
  "path": "apps/web-app/src/components/unified-chat/UnifiedHeader.tsx",
  "language": "typescript",
  "size": 9241,
  "last_modified": "2025-12-02T03:06:59.238Z",
  "lines": 298,
  "content": "/**\n * Unified Header\n *\n * Header for the unified chat/voice interface with conversation title,\n * connection status, and action buttons.\n */\n\nimport { useState, useCallback } from \"react\";\nimport {\n  PanelLeftOpen,\n  PanelRightOpen,\n  Share2,\n  Download,\n  Settings,\n  Edit2,\n  Check,\n  X,\n  Loader2,\n  Menu,\n} from \"lucide-react\";\nimport {\n  useUnifiedConversationStore,\n  selectConnectionStatus,\n} from \"../../stores/unifiedConversationStore\";\nimport { useIsMobile } from \"../../hooks/useIsMobile\";\nimport type { Conversation } from \"@voiceassist/types\";\n\ninterface UnifiedHeaderProps {\n  conversation: Conversation | null;\n  isSidebarOpen: boolean;\n  isContextPaneOpen: boolean;\n  onToggleSidebar: () => void;\n  onToggleContextPane: () => void;\n  onTitleChange?: (newTitle: string) => Promise<void>;\n  onExport?: () => void;\n  onShare?: () => void;\n  onSettings?: () => void;\n}\n\nexport function UnifiedHeader({\n  conversation,\n  isSidebarOpen,\n  isContextPaneOpen,\n  onToggleSidebar,\n  onToggleContextPane,\n  onTitleChange,\n  onExport,\n  onShare,\n  onSettings,\n}: UnifiedHeaderProps) {\n  const [isEditingTitle, setIsEditingTitle] = useState(false);\n  const [editedTitle, setEditedTitle] = useState(\"\");\n  const [isSavingTitle, setIsSavingTitle] = useState(false);\n  const [titleError, setTitleError] = useState<string | null>(null);\n  const isMobile = useIsMobile();\n\n  // Get unified connection status\n  const connectionStatus = useUnifiedConversationStore(selectConnectionStatus);\n  const voiceModeActive = useUnifiedConversationStore((s) => s.voiceModeActive);\n\n  const handleStartEdit = useCallback(() => {\n    setEditedTitle(conversation?.title || \"New Conversation\");\n    setTitleError(null);\n    setIsEditingTitle(true);\n  }, [conversation?.title]);\n\n  const handleSaveTitle = useCallback(async () => {\n    const trimmedTitle = editedTitle.trim();\n\n    // Validation\n    if (!trimmedTitle) {\n      setTitleError(\"Title cannot be empty\");\n      return;\n    }\n\n    if (trimmedTitle === conversation?.title) {\n      setIsEditingTitle(false);\n      return;\n    }\n\n    if (trimmedTitle.length > 100) {\n      setTitleError(\"Title must be 100 characters or less\");\n      return;\n    }\n\n    setIsSavingTitle(true);\n    setTitleError(null);\n\n    try {\n      if (onTitleChange) {\n        await onTitleChange(trimmedTitle);\n      }\n      setIsEditingTitle(false);\n    } catch (error) {\n      setTitleError(\n        error instanceof Error ? error.message : \"Failed to save title\",\n      );\n    } finally {\n      setIsSavingTitle(false);\n    }\n  }, [editedTitle, conversation?.title, onTitleChange]);\n\n  const handleCancelEdit = useCallback(() => {\n    setIsEditingTitle(false);\n    setEditedTitle(\"\");\n    setTitleError(null);\n  }, []);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        handleSaveTitle();\n      } else if (e.key === \"Escape\") {\n        handleCancelEdit();\n      }\n    },\n    [handleSaveTitle, handleCancelEdit],\n  );\n\n  const getConnectionStatusColor = () => {\n    switch (connectionStatus) {\n      case \"connected\":\n        return \"bg-green-500\";\n      case \"connecting\":\n      case \"reconnecting\":\n        return \"bg-amber-500 animate-pulse\";\n      case \"error\":\n        return \"bg-red-500\";\n      default:\n        return \"bg-neutral-400\";\n    }\n  };\n\n  const getConnectionStatusText = () => {\n    switch (connectionStatus) {\n      case \"connected\":\n        return voiceModeActive ? \"Voice Connected\" : \"Connected\";\n      case \"connecting\":\n        return \"Connecting...\";\n      case \"reconnecting\":\n        return \"Reconnecting...\";\n      case \"error\":\n        return \"Connection Error\";\n      default:\n        return \"Disconnected\";\n    }\n  };\n\n  return (\n    <header\n      className=\"flex items-center justify-between px-4 py-3 border-b border-neutral-200 bg-white\"\n      data-testid=\"unified-header\"\n    >\n      {/* Left Section */}\n      <div className=\"flex items-center gap-3\">\n        {/* Sidebar Toggle - always visible on mobile, only when collapsed on desktop */}\n        {(isMobile || !isSidebarOpen) && (\n          <button\n            onClick={onToggleSidebar}\n            className=\"p-2 hover:bg-neutral-100 rounded-lg transition-colors\"\n            aria-label=\"Open sidebar\"\n          >\n            {isMobile ? (\n              <Menu className=\"w-5 h-5 text-neutral-600\" />\n            ) : (\n              <PanelLeftOpen className=\"w-5 h-5 text-neutral-600\" />\n            )}\n          </button>\n        )}\n\n        {/* Title */}\n        <div className=\"flex flex-col\">\n          <div className=\"flex items-center gap-2\">\n            {isEditingTitle ? (\n              <div className=\"flex items-center gap-2\">\n                <input\n                  type=\"text\"\n                  value={editedTitle}\n                  onChange={(e) => {\n                    setEditedTitle(e.target.value);\n                    setTitleError(null);\n                  }}\n                  className={`px-2 py-1 text-lg font-semibold border rounded focus:outline-none focus:ring-2 focus:ring-primary-500 ${\n                    titleError ? \"border-red-300\" : \"border-primary-300\"\n                  }`}\n                  autoFocus\n                  disabled={isSavingTitle}\n                  onKeyDown={handleKeyDown}\n                  maxLength={100}\n                  aria-label=\"Conversation title\"\n                  aria-invalid={!!titleError}\n                />\n                <button\n                  onClick={handleSaveTitle}\n                  disabled={isSavingTitle}\n                  className=\"p-1.5 hover:bg-green-100 text-green-600 rounded transition-colors disabled:opacity-50\"\n                  aria-label=\"Save title\"\n                >\n                  {isSavingTitle ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  ) : (\n                    <Check className=\"w-4 h-4\" />\n                  )}\n                </button>\n                <button\n                  onClick={handleCancelEdit}\n                  disabled={isSavingTitle}\n                  className=\"p-1.5 hover:bg-red-100 text-red-600 rounded transition-colors disabled:opacity-50\"\n                  aria-label=\"Cancel editing\"\n                >\n                  <X className=\"w-4 h-4\" />\n                </button>\n              </div>\n            ) : (\n              <button\n                onClick={handleStartEdit}\n                className=\"flex items-center gap-2 group\"\n                disabled={!conversation}\n              >\n                <h1 className=\"text-lg font-semibold text-neutral-900\">\n                  {conversation?.title || \"New Conversation\"}\n                </h1>\n                {conversation && (\n                  <Edit2 className=\"w-4 h-4 text-neutral-400 opacity-0 group-hover:opacity-100 transition-opacity\" />\n                )}\n              </button>\n            )}\n          </div>\n\n          {/* Title Error */}\n          {titleError && (\n            <p className=\"text-xs text-red-500 mt-1\">{titleError}</p>\n          )}\n        </div>\n\n        {/* Connection Status - hide text on mobile */}\n        <div className=\"flex items-center gap-2 px-2 py-1 bg-neutral-50 rounded-full\">\n          <span\n            className={`w-2 h-2 rounded-full ${getConnectionStatusColor()}`}\n          />\n          <span\n            className={`text-xs text-neutral-600 ${isMobile ? \"hidden sm:inline\" : \"\"}`}\n          >\n            {getConnectionStatusText()}\n          </span>\n        </div>\n      </div>\n\n      {/* Right Section */}\n      <div className=\"flex items-center gap-1 sm:gap-2\">\n        {/* Action Buttons - show share/export only on larger screens */}\n        <button\n          onClick={onShare}\n          disabled={!conversation}\n          className=\"hidden sm:block p-2 hover:bg-neutral-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          aria-label=\"Share conversation\"\n          title=\"Share\"\n        >\n          <Share2 className=\"w-5 h-5 text-neutral-600\" />\n        </button>\n\n        <button\n          onClick={onExport}\n          disabled={!conversation}\n          className=\"hidden sm:block p-2 hover:bg-neutral-100 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n          aria-label=\"Export conversation\"\n          title=\"Export\"\n        >\n          <Download className=\"w-5 h-5 text-neutral-600\" />\n        </button>\n\n        <button\n          onClick={onSettings}\n          className=\"p-2 hover:bg-neutral-100 rounded-lg transition-colors\"\n          aria-label=\"Settings\"\n          title=\"Settings\"\n        >\n          <Settings className=\"w-5 h-5 text-neutral-600\" />\n        </button>\n\n        {/* Context Pane Toggle - always visible on mobile, only when collapsed on desktop */}\n        {(isMobile || !isContextPaneOpen) && (\n          <button\n            onClick={onToggleContextPane}\n            className=\"p-2 hover:bg-neutral-100 rounded-lg transition-colors\"\n            aria-label=\"Open context pane\"\n          >\n            <PanelRightOpen className=\"w-5 h-5 text-neutral-600\" />\n          </button>\n        )}\n      </div>\n    </header>\n  );\n}\n\nexport default UnifiedHeader;\n"
}
