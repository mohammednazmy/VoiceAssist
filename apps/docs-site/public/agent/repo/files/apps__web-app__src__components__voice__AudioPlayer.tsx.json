{
  "path": "apps/web-app/src/components/voice/AudioPlayer.tsx",
  "language": "typescript",
  "size": 5121,
  "last_modified": "2025-11-29T04:27:41.404Z",
  "lines": 194,
  "content": "/**\n * Audio Player Component\n * Plays synthesized speech with controls\n */\n\nimport { useState, useRef, useCallback, useEffect } from \"react\";\nimport { Button } from \"@voiceassist/ui\";\n\ninterface AudioPlayerProps {\n  audioBlob: Blob | null;\n  autoPlay?: boolean;\n  onPlaybackEnd?: () => void;\n}\n\nexport function AudioPlayer({\n  audioBlob,\n  autoPlay = false,\n  onPlaybackEnd,\n}: AudioPlayerProps) {\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [duration, setDuration] = useState(0);\n  const [currentTime, setCurrentTime] = useState(0);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const audioUrlRef = useRef<string | null>(null);\n\n  // Create audio element when blob changes\n  useEffect(() => {\n    if (!audioBlob) {\n      // Clean up previous audio\n      if (audioRef.current) {\n        audioRef.current.pause();\n        audioRef.current = null;\n      }\n      if (audioUrlRef.current) {\n        URL.revokeObjectURL(audioUrlRef.current);\n        audioUrlRef.current = null;\n      }\n      setIsPlaying(false);\n      setCurrentTime(0);\n      setDuration(0);\n      return;\n    }\n\n    // Revoke previous URL\n    if (audioUrlRef.current) {\n      URL.revokeObjectURL(audioUrlRef.current);\n    }\n\n    // Create new audio URL\n    const url = URL.createObjectURL(audioBlob);\n    audioUrlRef.current = url;\n\n    const audio = new Audio(url);\n\n    audio.addEventListener(\"loadedmetadata\", () => {\n      setDuration(audio.duration);\n    });\n\n    audio.addEventListener(\"timeupdate\", () => {\n      setCurrentTime(audio.currentTime);\n    });\n\n    audio.addEventListener(\"ended\", () => {\n      setIsPlaying(false);\n      setCurrentTime(0);\n      onPlaybackEnd?.();\n    });\n\n    audio.addEventListener(\"play\", () => {\n      setIsPlaying(true);\n    });\n\n    audio.addEventListener(\"pause\", () => {\n      setIsPlaying(false);\n    });\n\n    audioRef.current = audio;\n\n    if (autoPlay) {\n      audio.play().catch((err) => {\n        console.error(\"Autoplay failed:\", err);\n      });\n    }\n\n    // Cleanup\n    return () => {\n      audio.pause();\n      URL.revokeObjectURL(url);\n    };\n  }, [audioBlob, autoPlay, onPlaybackEnd]);\n\n  const togglePlayback = useCallback(() => {\n    if (!audioRef.current) return;\n\n    if (isPlaying) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play().catch((err) => {\n        console.error(\"Playback failed:\", err);\n      });\n    }\n  }, [isPlaying]);\n\n  const handleSeek = useCallback(\n    (event: React.ChangeEvent<HTMLInputElement>) => {\n      if (!audioRef.current) return;\n\n      const newTime = parseFloat(event.target.value);\n      audioRef.current.currentTime = newTime;\n      setCurrentTime(newTime);\n    },\n    [],\n  );\n\n  const formatTime = (seconds: number): string => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, \"0\")}`;\n  };\n\n  if (!audioBlob) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex items-center space-x-3 p-3 bg-primary-50 rounded-md border border-primary-200\">\n      {/* Play/Pause Button */}\n      <Button\n        type=\"button\"\n        variant=\"ghost\"\n        size=\"sm\"\n        onClick={togglePlayback}\n        aria-label={isPlaying ? \"Pause\" : \"Play\"}\n        className=\"flex-shrink-0\"\n      >\n        {isPlaying ? (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n            className=\"w-5 h-5\"\n          >\n            <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\" />\n          </svg>\n        ) : (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            fill=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n            className=\"w-5 h-5\"\n          >\n            <path d=\"M8 5v14l11-7z\" />\n          </svg>\n        )}\n      </Button>\n\n      {/* Progress Bar */}\n      <div className=\"flex-1 flex flex-col space-y-1\">\n        <input\n          type=\"range\"\n          min=\"0\"\n          max={duration || 0}\n          value={currentTime}\n          onChange={handleSeek}\n          className=\"w-full h-2 bg-primary-200 rounded-lg appearance-none cursor-pointer accent-primary-500\"\n          aria-label=\"Audio progress\"\n        />\n        <div className=\"flex justify-between text-xs text-neutral-600\">\n          <span>{formatTime(currentTime)}</span>\n          <span>{formatTime(duration)}</span>\n        </div>\n      </div>\n\n      {/* Volume Icon */}\n      <div className=\"flex-shrink-0 text-primary-600\">\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          fill=\"none\"\n          viewBox=\"0 0 24 24\"\n          strokeWidth={1.5}\n          stroke=\"currentColor\"\n          className=\"w-5 h-5\"\n        >\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            d=\"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z\"\n          />\n        </svg>\n      </div>\n    </div>\n  );\n}\n"
}
