{
  "path": "services/api-gateway/app/models/attachment.py",
  "language": "python",
  "size": 2132,
  "last_modified": "2025-12-05T03:07:13.130Z",
  "lines": 59,
  "content": "\"\"\"\nMessage attachment model for file uploads in chat\n\"\"\"\n\nimport uuid\nfrom datetime import datetime\n\nfrom app.core.database import Base\nfrom sqlalchemy import Column, DateTime, ForeignKey, Integer, String, Text\nfrom sqlalchemy.dialects.postgresql import JSONB, UUID\nfrom sqlalchemy.orm import relationship\n\n\nclass MessageAttachment(Base):\n    \"\"\"Message attachment model for file uploads\"\"\"\n\n    __tablename__ = \"message_attachments\"\n\n    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)\n    message_id = Column(\n        UUID(as_uuid=True),\n        ForeignKey(\"messages.id\", ondelete=\"CASCADE\"),\n        nullable=False,\n        index=True,\n    )\n\n    # File information\n    file_name = Column(String(255), nullable=False)\n    file_type = Column(String(50), nullable=False)  # 'pdf', 'image', 'text', 'markdown'\n    file_size = Column(Integer, nullable=False)  # Size in bytes\n    file_url = Column(Text, nullable=False)  # S3/storage URL\n    mime_type = Column(String(100), nullable=True)\n    file_metadata = Column(JSONB, nullable=True)  # Additional metadata (renamed to avoid SQLAlchemy conflict)\n\n    # Timestamps\n    uploaded_at = Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)\n    created_at = Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)\n\n    # Relationship\n    message = relationship(\"Message\", back_populates=\"attachments\")\n\n    def __repr__(self):\n        return f\"<MessageAttachment(id={self.id}, file_name={self.file_name}, file_type={self.file_type})>\"\n\n    def to_dict(self):\n        \"\"\"Convert to dictionary\"\"\"\n        return {\n            \"id\": str(self.id),\n            \"message_id\": str(self.message_id),\n            \"file_name\": self.file_name,\n            \"file_type\": self.file_type,\n            \"file_size\": self.file_size,\n            \"file_url\": self.file_url,\n            \"mime_type\": self.mime_type,\n            \"file_metadata\": self.file_metadata,\n            \"uploaded_at\": self.uploaded_at.isoformat() if self.uploaded_at else None,\n            \"created_at\": self.created_at.isoformat() if self.created_at else None,\n        }\n"
}
