{
  "path": "apps/web-app/src/components/chat/BranchSidebar.tsx",
  "language": "typescript",
  "size": 11424,
  "last_modified": "2025-11-23T12:17:53.528Z",
  "lines": 268,
  "content": "/**\n * BranchSidebar Component\n * Displays a list of conversation branches and allows switching between them\n */\n\nimport { useBranching } from \"../../hooks/useBranching\";\n\nexport interface BranchSidebarProps {\n  sessionId: string | null;\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function BranchSidebar({\n  sessionId,\n  isOpen,\n  onClose,\n}: BranchSidebarProps) {\n  const { branches, currentBranchId, isLoading, error, switchBranch } =\n    useBranching(sessionId);\n\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 md:relative md:inset-auto md:z-auto\">\n      {/* Backdrop (mobile only) */}\n      <div\n        className=\"fixed inset-0 bg-black/50 md:hidden\"\n        onClick={onClose}\n        aria-hidden=\"true\"\n      />\n\n      {/* Sidebar */}\n      <div\n        className=\"fixed right-0 top-0 h-full w-80 bg-white dark:bg-neutral-900 border-l border-neutral-200 dark:border-neutral-700 shadow-lg md:relative md:w-64 md:shadow-none overflow-y-auto\"\n        role=\"complementary\"\n        aria-label=\"Conversation branches\"\n      >\n        {/* Header */}\n        <div className=\"sticky top-0 bg-white dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-700 px-4 py-3 flex items-center justify-between z-10\">\n          <h2 className=\"text-lg font-semibold text-neutral-900 dark:text-neutral-100\">\n            Branches\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"md:hidden p-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors\"\n            aria-label=\"Close branch sidebar\"\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              strokeWidth={1.5}\n              stroke=\"currentColor\"\n              className=\"w-5 h-5 text-neutral-600 dark:text-neutral-400\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-4\">\n          {/* Loading State */}\n          {isLoading && (\n            <div\n              className=\"flex items-center justify-center py-8\"\n              role=\"status\"\n              aria-live=\"polite\"\n            >\n              <svg\n                className=\"animate-spin h-6 w-6 text-primary-500\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                aria-hidden=\"true\"\n              >\n                <circle\n                  className=\"opacity-25\"\n                  cx=\"12\"\n                  cy=\"12\"\n                  r=\"10\"\n                  stroke=\"currentColor\"\n                  strokeWidth=\"4\"\n                ></circle>\n                <path\n                  className=\"opacity-75\"\n                  fill=\"currentColor\"\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n                ></path>\n              </svg>\n              <span className=\"sr-only\">Loading branches...</span>\n            </div>\n          )}\n\n          {/* Error State */}\n          {error && (\n            <div\n              className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-sm text-red-700 dark:text-red-400\"\n              role=\"alert\"\n            >\n              <p className=\"font-medium\">Error loading branches</p>\n              <p className=\"mt-1\">{error}</p>\n            </div>\n          )}\n\n          {/* Empty State */}\n          {!isLoading && !error && branches.length === 0 && (\n            <div className=\"text-center py-8 text-neutral-500 dark:text-neutral-400\">\n              <svg\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth={1.5}\n                stroke=\"currentColor\"\n                className=\"w-12 h-12 mx-auto mb-3 opacity-50\"\n              >\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  d=\"M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z\"\n                />\n              </svg>\n              <p className=\"text-sm\">No branches yet</p>\n              <p className=\"text-xs mt-1\">\n                Create a branch from any message to explore alternative\n                conversations\n              </p>\n            </div>\n          )}\n\n          {/* Branch List */}\n          {!isLoading && !error && branches.length > 0 && (\n            <ul className=\"space-y-2\" role=\"list\">\n              {branches.map((branch) => {\n                const isActive = branch.branchId === currentBranchId;\n\n                return (\n                  <li key={branch.branchId}>\n                    <button\n                      onClick={() => switchBranch(branch.branchId)}\n                      className={`w-full text-left px-4 py-3 rounded-lg border transition-all ${\n                        isActive\n                          ? \"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700\"\n                          : \"bg-neutral-50 dark:bg-neutral-800 border-neutral-200 dark:border-neutral-700 hover:bg-neutral-100 dark:hover:bg-neutral-700\"\n                      }`}\n                      aria-pressed={isActive}\n                      aria-label={`Switch to ${branch.branchId === \"main\" ? \"main branch\" : `branch ${branch.branchId}`}`}\n                    >\n                      {/* Branch Icon and Name */}\n                      <div className=\"flex items-center gap-2 mb-2\">\n                        <svg\n                          xmlns=\"http://www.w3.org/2000/svg\"\n                          fill=\"none\"\n                          viewBox=\"0 0 24 24\"\n                          strokeWidth={1.5}\n                          stroke=\"currentColor\"\n                          className={`w-4 h-4 ${\n                            isActive\n                              ? \"text-primary-600 dark:text-primary-400\"\n                              : \"text-neutral-500 dark:text-neutral-400\"\n                          }`}\n                        >\n                          <path\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                            d=\"M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z\"\n                          />\n                        </svg>\n                        <span\n                          className={`font-medium text-sm ${\n                            isActive\n                              ? \"text-primary-900 dark:text-primary-100\"\n                              : \"text-neutral-900 dark:text-neutral-100\"\n                          }`}\n                        >\n                          {branch.branchId === \"main\"\n                            ? \"Main\"\n                            : `Branch ${branch.branchId.split(\"-\").pop()}`}\n                        </span>\n                        {isActive && (\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            viewBox=\"0 0 20 20\"\n                            fill=\"currentColor\"\n                            className=\"w-4 h-4 ml-auto text-primary-600 dark:text-primary-400\"\n                            aria-hidden=\"true\"\n                          >\n                            <path\n                              fillRule=\"evenodd\"\n                              d=\"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z\"\n                              clipRule=\"evenodd\"\n                            />\n                          </svg>\n                        )}\n                      </div>\n\n                      {/* Branch Metadata */}\n                      <div className=\"flex items-center gap-3 text-xs text-neutral-600 dark:text-neutral-400\">\n                        <div className=\"flex items-center gap-1\">\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            fill=\"none\"\n                            viewBox=\"0 0 24 24\"\n                            strokeWidth={1.5}\n                            stroke=\"currentColor\"\n                            className=\"w-3.5 h-3.5\"\n                          >\n                            <path\n                              strokeLinecap=\"round\"\n                              strokeLinejoin=\"round\"\n                              d=\"M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z\"\n                            />\n                          </svg>\n                          <span>{branch.messageCount} messages</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <svg\n                            xmlns=\"http://www.w3.org/2000/svg\"\n                            fill=\"none\"\n                            viewBox=\"0 0 24 24\"\n                            strokeWidth={1.5}\n                            stroke=\"currentColor\"\n                            className=\"w-3.5 h-3.5\"\n                          >\n                            <path\n                              strokeLinecap=\"round\"\n                              strokeLinejoin=\"round\"\n                              d=\"M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z\"\n                            />\n                          </svg>\n                          <span>\n                            {new Date(branch.lastActivity).toLocaleDateString(\n                              \"en-US\",\n                              {\n                                month: \"short\",\n                                day: \"numeric\",\n                              },\n                            )}\n                          </span>\n                        </div>\n                      </div>\n                    </button>\n                  </li>\n                );\n              })}\n            </ul>\n          )}\n        </div>\n\n        {/* Footer Info */}\n        <div className=\"sticky bottom-0 bg-neutral-50 dark:bg-neutral-800 border-t border-neutral-200 dark:border-neutral-700 px-4 py-3 text-xs text-neutral-600 dark:text-neutral-400\">\n          <p>\n            Branches let you explore alternative conversation paths without\n            losing your main discussion.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n"
}
