{
  "path": "apps/web-app/src/components/performance/LazyComponent.tsx",
  "language": "typescript",
  "size": 3183,
  "last_modified": "2025-12-03T23:50:35.642Z",
  "lines": 139,
  "content": "/**\n * Lazy Component Wrapper\n * Defers rendering of components until they enter the viewport\n *\n * Phase 10: Performance & Scalability\n */\n\nimport {\n  Suspense,\n  lazy,\n  ComponentType,\n  ReactNode,\n  useState,\n  useEffect,\n} from \"react\";\nimport { useLazyLoad } from \"../../hooks/useIntersectionObserver\";\n\ninterface LazyComponentProps {\n  /** Fallback to show while loading */\n  fallback?: ReactNode;\n  /** Custom placeholder while not in view */\n  placeholder?: ReactNode;\n  /** Height of placeholder (for layout stability) */\n  placeholderHeight?: string | number;\n  /** Additional className for wrapper */\n  className?: string;\n  /** Children to render when in view */\n  children: ReactNode;\n}\n\n/**\n * Wrapper that only renders children when they enter the viewport\n */\nexport function LazyComponent({\n  fallback: _fallback = null,\n  placeholder,\n  placeholderHeight = \"auto\",\n  className = \"\",\n  children,\n}: LazyComponentProps) {\n  const { ref, isInView } = useLazyLoad();\n\n  return (\n    <div\n      ref={ref}\n      className={className}\n      style={{\n        minHeight:\n          !isInView && placeholderHeight ? placeholderHeight : undefined,\n      }}\n    >\n      {isInView\n        ? children\n        : placeholder || (\n            <div\n              style={{ height: placeholderHeight }}\n              className=\"bg-neutral-100 animate-pulse rounded\"\n            />\n          )}\n    </div>\n  );\n}\n\n/**\n * Create a lazy-loaded component that loads when in viewport\n */\nexport function createLazyComponent<P extends object>(\n  importFn: () => Promise<{ default: ComponentType<P> }>,\n  options: {\n    fallback?: ReactNode;\n    preloadDelay?: number;\n  } = {},\n): ComponentType<P> {\n  const LazyComp = lazy(importFn);\n  const { fallback = <LoadingSpinner />, preloadDelay } = options;\n\n  // Preload after delay if specified\n  if (preloadDelay !== undefined) {\n    setTimeout(() => {\n      importFn();\n    }, preloadDelay);\n  }\n\n  return function LazyWrapper(props: P) {\n    const { ref, isInView } = useLazyLoad();\n    const [hasBeenVisible, setHasBeenVisible] = useState(false);\n\n    useEffect(() => {\n      if (isInView && !hasBeenVisible) {\n        setHasBeenVisible(true);\n      }\n    }, [isInView, hasBeenVisible]);\n\n    return (\n      <div ref={ref}>\n        {hasBeenVisible ? (\n          <Suspense fallback={fallback}>\n            {/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}\n            <LazyComp {...(props as any)} />\n          </Suspense>\n        ) : (\n          fallback\n        )}\n      </div>\n    );\n  };\n}\n\n/**\n * Simple loading spinner component\n */\nfunction LoadingSpinner() {\n  return (\n    <div className=\"flex items-center justify-center p-4\">\n      <div className=\"w-6 h-6 border-2 border-primary-500 border-t-transparent rounded-full animate-spin\" />\n    </div>\n  );\n}\n\n/**\n * Skeleton placeholder for lazy components\n */\nexport function LazyPlaceholder({\n  height = 100,\n  className = \"\",\n}: {\n  height?: number | string;\n  className?: string;\n}) {\n  return (\n    <div\n      className={`bg-neutral-100 animate-pulse rounded ${className}`}\n      style={{ height }}\n      role=\"presentation\"\n      aria-hidden=\"true\"\n    />\n  );\n}\n"
}
